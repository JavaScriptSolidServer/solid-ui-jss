!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("$rdf")):"function"==typeof define&&define.amd?define(["$rdf"],t):"object"==typeof exports?exports.UI=t(require("$rdf")):e.UI=t(e.$rdf)}(this,e=>(()=>{var t,n,r={172(e){e.exports=function(e,t){this.v=e,this.k=t},e.exports.__esModule=!0,e.exports.default=e.exports},264(t){"use strict";t.exports=e},373(e){e.exports=function(e){var t=Object(e),n=[];for(var r in t)n.unshift(r);return function e(){for(;n.length;)if((r=n.pop())in t)return e.value=r,e.done=!1,e;return e.done=!0,e}},e.exports.__esModule=!0,e.exports.default=e.exports},378(e,t,n){"use strict";n.d(t,{LN:()=>a,Pt:()=>o,i1:()=>s});var r=n(423),i="https://solidos.github.io/solid-ui/src",o=(e=n.hmd(e)).scriptURI?{iconBase:e.scriptURI.slice(0,e.scriptURI.lastIndexOf("/"))+"/icons/",originalIconBase:e.scriptURI.slice(0,e.scriptURI.lastIndexOf("/"))+"/originalIcons/"}:"undefined"!=typeof $SolidTestEnvironment&&$SolidTestEnvironment.iconBase?{iconBase:$SolidTestEnvironment.iconBase,originalIconBase:$SolidTestEnvironment.originalIconBase}:{iconBase:i+"/icons/",originalIconBase:i+"/originalIcons/"};(0,r.Rm)("   icons.iconBase is set to : "+o.iconBase);var a=o.iconBase,s=o.originalIconBase},386(e){const t={acl:"http://www.w3.org/ns/auth/acl#",arg:"http://www.w3.org/ns/pim/arg#",as:"https://www.w3.org/ns/activitystreams#",bookmark:"http://www.w3.org/2002/01/bookmark#",cal:"http://www.w3.org/2002/12/cal/ical#",cco:"http://www.ontologyrepository.com/CommonCoreOntologies/",cert:"http://www.w3.org/ns/auth/cert#",contact:"http://www.w3.org/2000/10/swap/pim/contact#",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",doap:"http://usefulinc.com/ns/doap#",foaf:"http://xmlns.com/foaf/0.1/",geo:"http://www.w3.org/2003/01/geo/wgs84_pos#",gpx:"http://www.w3.org/ns/pim/gpx#",gr:"http://purl.org/goodrelations/v1#",http:"http://www.w3.org/2007/ont/http#",httph:"http://www.w3.org/2007/ont/httph#",icalTZ:"http://www.w3.org/2002/12/cal/icaltzd#",ldp:"http://www.w3.org/ns/ldp#",link:"http://www.w3.org/2007/ont/link#",log:"http://www.w3.org/2000/10/swap/log#",meeting:"http://www.w3.org/ns/pim/meeting#",mo:"http://purl.org/ontology/mo/",org:"http://www.w3.org/ns/org#",owl:"http://www.w3.org/2002/07/owl#",pad:"http://www.w3.org/ns/pim/pad#",patch:"http://www.w3.org/ns/pim/patch#",prov:"http://www.w3.org/ns/prov#",pto:"http://www.productontology.org/id/",qu:"http://www.w3.org/2000/10/swap/pim/qif#",trip:"http://www.w3.org/ns/pim/trip#",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",rss:"http://purl.org/rss/1.0/",sched:"http://www.w3.org/ns/pim/schedule#",schema:"http://schema.org/",sioc:"http://rdfs.org/sioc/ns#",skos:"http://www.w3.org/2004/02/skos/core#",solid:"http://www.w3.org/ns/solid/terms#",space:"http://www.w3.org/ns/pim/space#",stat:"http://www.w3.org/ns/posix/stat#",tab:"http://www.w3.org/2007/ont/link#",tabont:"http://www.w3.org/2007/ont/link#",ui:"http://www.w3.org/ns/ui#",vann:"http://purl.org/vocab/vann/",vcard:"http://www.w3.org/2006/vcard/ns#",wf:"http://www.w3.org/2005/01/wf/flow#",xsd:"http://www.w3.org/2001/XMLSchema#"};e.exports=function(e={namedNode:e=>e}){const n={};for(const r in t){const i=t[r];n[r]=function(t=""){return e.namedNode(i+t)}}return n}},423(e,t,n){"use strict";function r(){var e;(e=console).log.apply(e,arguments)}function i(){var e;(e=console).warn.apply(e,arguments)}function o(){var e;(e=console).error.apply(e,arguments)}function a(){var e;(e=console).trace.apply(e,arguments)}n.d(t,{R8:()=>i,Rm:()=>r,uP:()=>a,z3:()=>o})},546(e){function t(n,r,i,o){var a=Object.defineProperty;try{a({},"",{})}catch(n){a=0}e.exports=t=function(e,n,r,i){function o(n,r){t(e,n,function(e){return this._invoke(n,r,e)})}n?a?a(e,n,{value:r,enumerable:!i,configurable:!i,writable:!i}):e[n]=r:(o("next",0),o("throw",1),o("return",2))},e.exports.__esModule=!0,e.exports.default=e.exports,t(n,r,i,o)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},579(e,t,n){var r=n(738).default;e.exports=function(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}throw new TypeError(r(e)+" is not iterable")},e.exports.__esModule=!0,e.exports.default=e.exports},580(e){"use strict";
/*!
 * escape-html
 * Copyright(c) 2012-2013 TJ Holowaychuk
 * Copyright(c) 2015 Andreas Lubbe
 * Copyright(c) 2015 Tiancheng "Timothy" Gu
 * MIT Licensed
 */var t=/["'&<>]/;e.exports=function(e){var n,r=""+e,i=t.exec(r);if(!i)return r;var o="",a=0,s=0;for(a=i.index;a<r.length;a++){switch(r.charCodeAt(a)){case 34:n="&quot;";break;case 38:n="&amp;";break;case 39:n="&#39;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}s!==a&&(o+=r.substring(s,a)),s=a+1,o+=n}return s!==a?o+r.substring(s,a):o}},633(e,t,n){var r=n(172),i=n(993),o=n(869),a=n(887),s=n(791),c=n(373),l=n(579);function u(){"use strict";var t=i(),n=t.m(u),d=(Object.getPrototypeOf?Object.getPrototypeOf(n):n.__proto__).constructor;function p(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))}var f={throw:1,return:2,break:3,continue:3};function h(e){var t,n;return function(r){t||(t={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(e,t){return n(r.a,f[e],t)},delegateYield:function(e,i,o){return t.resultName=i,n(r.d,l(e),o)},finish:function(e){return n(r.f,e)}},n=function(e,n,i){r.p=t.prev,r.n=t.next;try{return e(n,i)}finally{t.next=r.n}}),t.resultName&&(t[t.resultName]=r.v,t.resultName=void 0),t.sent=r.v,t.next=r.n;try{return e.call(this,t)}finally{r.p=t.prev,r.n=t.next}}}return(e.exports=u=function(){return{wrap:function(e,n,r,i){return t.w(h(e),n,r,i&&i.reverse())},isGeneratorFunction:p,mark:t.m,awrap:function(e,t){return new r(e,t)},AsyncIterator:s,async:function(e,t,n,r,i){return(p(t)?a:o)(h(e),t,n,r,i)},keys:c,values:l}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=u,e.exports.__esModule=!0,e.exports.default=e.exports},738(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},756(e,t,n){var r=n(633)();e.exports=r;try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},791(e,t,n){var r=n(172),i=n(546);e.exports=function e(t,n){function o(e,i,a,s){try{var c=t[e](i),l=c.value;return l instanceof r?n.resolve(l.v).then(function(e){o("next",e,a,s)},function(e){o("throw",e,a,s)}):n.resolve(l).then(function(e){c.value=e,a(c)},function(e){return o("throw",e,a,s)})}catch(e){s(e)}}var a;this.next||(i(e.prototype),i(e.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),i(this,"_invoke",function(e,t,r){function i(){return new n(function(t,n){o(e,r,t,n)})}return a=a?a.then(i,i):i()},!0)},e.exports.__esModule=!0,e.exports.default=e.exports},869(e,t,n){var r=n(887);e.exports=function(e,t,n,i,o){var a=r(e,t,n,i,o);return a.next().then(function(e){return e.done?e.value:a.next()})},e.exports.__esModule=!0,e.exports.default=e.exports},887(e,t,n){var r=n(993),i=n(791);e.exports=function(e,t,n,o,a){return new i(r().w(e,t,n,o),a||Promise)},e.exports.__esModule=!0,e.exports.default=e.exports},993(e,t,n){var r=n(546);function i(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */
var t,n,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.toStringTag||"@@toStringTag";function c(e,i,o,a){var s=i&&i.prototype instanceof u?i:u,c=Object.create(s.prototype);return r(c,"_invoke",function(e,r,i){var o,a,s,c=0,u=i||[],d=!1,p={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,a=0,s=t,p.n=n,l}};function f(e,r){for(a=e,s=r,n=0;!d&&c&&!i&&n<u.length;n++){var i,o=u[n],f=p.p,h=o[2];e>3?(i=h===r)&&(s=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=t):o[0]<=f&&((i=e<2&&f<o[1])?(a=0,p.v=r,p.n=o[1]):f<h&&(i=e<3||o[0]>r||r>h)&&(o[4]=e,o[5]=r,p.n=h,a=0))}if(i||e>1)return l;throw d=!0,r}return function(i,u,h){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&f(u,h),a=u,s=h;(n=a<2?t:s)||!d;){o||(a?a<3?(a>1&&(p.n=-1),f(a,s)):p.n=s:p.v=s);try{if(c=2,o){if(a||(i="next"),n=o[i]){if(!(n=n.call(o,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,a<2&&(a=0)}else 1===a&&(n=o.return)&&n.call(o),a<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),a=1);o=t}else if((n=(d=p.n<0)?s:e.call(r,p))!==l)break}catch(e){o=t,a=1,s=e}finally{c=1}}return{value:n,done:d}}}(e,o,a),!0),c}var l={};function u(){}function d(){}function p(){}n=Object.getPrototypeOf;var f=[][a]?n(n([][a]())):(r(n={},a,function(){return this}),n),h=p.prototype=u.prototype=Object.create(f);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,r(e,s,"GeneratorFunction")),e.prototype=Object.create(h),e}return d.prototype=p,r(h,"constructor",p),r(p,"constructor",d),d.displayName="GeneratorFunction",r(p,s,"GeneratorFunction"),r(h),r(h,s,"Generator"),r(h,a,function(){return this}),r(h,"toString",function(){return"[object Generator]"}),(e.exports=i=function(){return{w:c,m}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports}},i={};function o(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={id:e,loaded:!1,exports:{}};return r[e](n,n.exports,o),n.loaded=!0,n.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,o.t=function(e,r){if(1&r&&(e=this(e)),8&r)return e;if("object"==typeof e&&e){if(4&r&&e.__esModule)return e;if(16&r&&"function"==typeof e.then)return e}var i=Object.create(null);o.r(i);var a={};t=t||[null,n({}),n([]),n(n)];for(var s=2&r&&e;("object"==typeof s||"function"==typeof s)&&!~t.indexOf(s);s=n(s))Object.getOwnPropertyNames(s).forEach(t=>a[t]=()=>e[t]);return a.default=()=>e,o.d(i,a),i},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};return(()=>{"use strict";o.r(a),o.d(a,{acl:()=>Ts,aclControl:()=>Rs,create:()=>Ls,createTypes:()=>p,dom:()=>lf,icons:()=>dr.Pt,infiniteMessageArea:()=>hp,initFooter:()=>of,initHeader:()=>Jp,language:()=>n,log:()=>e,login:()=>i,matrix:()=>Ps,media:()=>Us,messageArea:()=>rc,ns:()=>v,pad:()=>l,participation:()=>c,preferences:()=>u,style:()=>ar,table:()=>_p,tabs:()=>d,utils:()=>t,widgets:()=>s});var e={};o.r(e),o.d(e,{LogLevel:()=>en,alert:()=>fn,clear:()=>hn,debug:()=>ln,dumpHTML:()=>gn,error:()=>dn,escapeForXML:()=>wn,info:()=>un,logAscending:()=>vn,logDescending:()=>yn,msg:()=>sn,setInternals:()=>bn,setLevel:()=>mn,success:()=>pn,warn:()=>cn});var t={};o.r(t),o.d(t,{AJARImage:()=>Lr,RDFComparePredicateObject:()=>Mr,RDFComparePredicateSubject:()=>Fr,addLoadEvent:()=>Tr,ancestor:()=>kr,beep:()=>gr,clearVariableNames:()=>mr,emptyNode:()=>Er,escapeForXML:()=>Or,findPos:()=>Rr,genUuid:()=>yr,getAbout:()=>Ar,getEyeFocus:()=>Ir,getTarget:()=>Cr,getTerm:()=>_r,hashColor:()=>vr,include:()=>Sr,label:()=>En,labelForXML:()=>Dr,labelWithOntology:()=>Br,newVariableName:()=>hr,ontologyLabel:()=>Pr,predParentOf:()=>Hr,predicateLabel:()=>jr,predicateLabelForXML:()=>Ur,shortName:()=>Nr,stackString:()=>xr,syncTableToArray:()=>wr,syncTableToArrayReOrdered:()=>br});var n={};o.r(n),o.d(n,{addDefaults:()=>no,defaultPreferredLanguages:()=>to,filterByLanguage:()=>so,getPreferredLanguages:()=>oo,getPreferredLanguagesFor:()=>ro,languageCodeURIBase:()=>eo});var r={};o.r(r),o.d(r,{AUTOCOMPLETE_LIMIT:()=>co,ESCOResultToBindings:()=>Co,bindingToTerm:()=>xo,dbPediaTypeMap:()=>go,dbpediaParameters:()=>mo,escoParameters:()=>ho,fetcherOptionsJsonPublicData:()=>fo,getDbpediaDetails:()=>Ho,getWikidataDetails:()=>Oo,getWikidataDetailsOld:()=>Uo,getWikidataLocation:()=>Mo,instituteDetailsWikidataQuery:()=>po,loadFromBindings:()=>Eo,loadPublicDataThing:()=>Po,queryESCODataByName:()=>ko,queryPublicDataByName:()=>So,queryPublicDataConstruct:()=>Lo,queryPublicDataSelect:()=>Ro,variableNameToPredicateMap:()=>bo,wikidataClasses:()=>uo,wikidataIncomingClassMap:()=>wo,wikidataOutgoingClassMap:()=>vo,wikidataParameters:()=>yo});var i={};o.r(i),o.d(i,{ensureLoadedPreferences:()=>$a,ensureLoadedProfile:()=>za,ensureLoggedIn:()=>Wa,filterAvailablePanes:()=>ss,findAppInstances:()=>Ka,getUserRoles:()=>os,loginStatusBox:()=>ns,newAppInstance:()=>is,registrationControl:()=>Qa,registrationList:()=>Xa,renderScopeHeadingRow:()=>Ya,renderSignInPopup:()=>ts,scopeLabel:()=>Ga,selectWorkspace:()=>rs});var s={};o.r(s),o.d(s,{Group:()=>Qs,GroupBuilder:()=>Zs,GroupPicker:()=>Gs,PeoplePicker:()=>Vs,Person:()=>Ys,addStyleSheet:()=>Bi,allClassURIs:()=>Si,appendForm:()=>ha,askName:()=>vi,attachmentList:()=>ki,basicField:()=>Xi,buildCheckboxForm:()=>Sa,button:()=>hi,cancelButton:()=>mi,clearElement:()=>Yr,complain:()=>Zr,continueButton:()=>gi,createLinkDiv:()=>xi,createLinkForURI:()=>Kr,createNameDiv:()=>bi,defaultAnnotationStore:()=>_i,deleteButtonWithCheck:()=>fi,editFormButton:()=>fa,errorMessageBlock:()=>Wr,extractLogURI:()=>Xr,faviconOrDefault:()=>pi,field:()=>zi,fieldFunction:()=>Ki,fieldLabel:()=>Zi,fieldParams:()=>$i,fieldStore:()=>Yi,fileUploadButtonDiv:()=>ji,findClosest:()=>ga,findImage:()=>li,findImageFromURI:()=>ci,formatDateTime:()=>ti,formsFor:()=>va,iconForClass:()=>ai,imagesOf:()=>oi,index:()=>Pi,isAudio:()=>Oi,isImage:()=>Ui,isVideo:()=>Di,linkButton:()=>Ri,linkIcon:()=>qr,makeDescription:()=>Ea,makeDraggable:()=>cr,makeDropTarget:()=>sr,makeSelectForCategory:()=>Aa,makeSelectForChoice:()=>Ra,makeSelectForClassifierOptions:()=>Ca,makeSelectForNestedCategory:()=>_a,makeSelectForOptions:()=>ka,mostSpecificClassURI:()=>qi,newButton:()=>ba,newThing:()=>Ta,openHrefInOutlineMode:()=>Ai,personTR:()=>yi,promptForNew:()=>xa,propertiesForClass:()=>ma,propertyTriage:()=>Ti,publicData:()=>r,refreshTree:()=>Ci,removeButton:()=>Ii,renderAsDiv:()=>Ei,renderAsRow:()=>wi,renderAutoComplete:()=>qo,renderAutocompleteControl:()=>Xo,renderNameValuePair:()=>Qi,selectorPanel:()=>Li,selectorPanelRefresh:()=>Ni,setImage:()=>di,setName:()=>ii,setVisible:()=>zo,shortDate:()=>ei,shortTime:()=>ri,sortByLabel:()=>wa,sortBySequence:()=>ya,timestamp:()=>ni,uploadFiles:()=>lr});var c={};o.r(c),o.d(c,{manageParticipation:()=>bd,participationObject:()=>yd,recordParticipation:()=>wd,renderParticipants:()=>vd});var l={};o.r(l),o.d(l,{getChunks:()=>Ad,lightColorHash:()=>Cd,manageParticipation:()=>bd,notepad:()=>kd,notepadToHTML:()=>Sd,participationObject:()=>yd,recordParticipation:()=>wd,renderParticipants:()=>vd,xmlEncode:()=>_d});var u={};o.r(u),o.d(u,{get:()=>yp,getPreferencesForClass:()=>kp,recordPersonalDefaults:()=>xp,recordSharedPreferences:()=>bp,renderPreferencesForm:()=>Ep,set:()=>wp,value:()=>vp});var d={};o.r(d),o.d(d,{TabWidgetElement:()=>Bp,tabWidget:()=>Dp});var p={};o.r(p);var f=o(386),h=o.n(f),m=o(264),g=o.t(m,2);const v=h()(m);function y(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function w(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function a(e){y(o,r,i,a,s,"next",e)}function s(e){y(o,r,i,a,s,"throw",e)}a(void 0)})}}var b=o(756),x=o.n(b),E={386(e){const t={acl:"http://www.w3.org/ns/auth/acl#",arg:"http://www.w3.org/ns/pim/arg#",as:"https://www.w3.org/ns/activitystreams#",bookmark:"http://www.w3.org/2002/01/bookmark#",cal:"http://www.w3.org/2002/12/cal/ical#",cco:"http://www.ontologyrepository.com/CommonCoreOntologies/",cert:"http://www.w3.org/ns/auth/cert#",contact:"http://www.w3.org/2000/10/swap/pim/contact#",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",doap:"http://usefulinc.com/ns/doap#",foaf:"http://xmlns.com/foaf/0.1/",geo:"http://www.w3.org/2003/01/geo/wgs84_pos#",gpx:"http://www.w3.org/ns/pim/gpx#",gr:"http://purl.org/goodrelations/v1#",http:"http://www.w3.org/2007/ont/http#",httph:"http://www.w3.org/2007/ont/httph#",icalTZ:"http://www.w3.org/2002/12/cal/icaltzd#",ldp:"http://www.w3.org/ns/ldp#",link:"http://www.w3.org/2007/ont/link#",log:"http://www.w3.org/2000/10/swap/log#",meeting:"http://www.w3.org/ns/pim/meeting#",mo:"http://purl.org/ontology/mo/",org:"http://www.w3.org/ns/org#",owl:"http://www.w3.org/2002/07/owl#",pad:"http://www.w3.org/ns/pim/pad#",patch:"http://www.w3.org/ns/pim/patch#",prov:"http://www.w3.org/ns/prov#",pto:"http://www.productontology.org/id/",qu:"http://www.w3.org/2000/10/swap/pim/qif#",trip:"http://www.w3.org/ns/pim/trip#",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",rss:"http://purl.org/rss/1.0/",sched:"http://www.w3.org/ns/pim/schedule#",schema:"http://schema.org/",sioc:"http://rdfs.org/sioc/ns#",skos:"http://www.w3.org/2004/02/skos/core#",solid:"http://www.w3.org/ns/solid/terms#",space:"http://www.w3.org/ns/pim/space#",stat:"http://www.w3.org/ns/posix/stat#",tab:"http://www.w3.org/2007/ont/link#",tabont:"http://www.w3.org/2007/ont/link#",ui:"http://www.w3.org/ns/ui#",vann:"http://purl.org/vocab/vann/",vcard:"http://www.w3.org/2006/vcard/ns#",wf:"http://www.w3.org/2005/01/wf/flow#",xsd:"http://www.w3.org/2001/XMLSchema#"};e.exports=function(e={namedNode:e=>e}){const n={};for(const r in t){const i=t[r];n[r]=function(t=""){return e.namedNode(i+t)}}return n}}},C={};function k(e){var t=C[e];if(void 0!==t)return t.exports;var n=C[e]={exports:{}};return E[e](n,n.exports,k),n.exports}function A(...e){console.log(...e)}function _(...e){console.warn(...e)}k.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return k.d(t,{a:t}),t},k.d=(e,t)=>{for(var n in t)k.o(t,n)&&!k.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},k.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),k.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const S=crypto,T=e=>e instanceof CryptoKey;function R(e,t,...n){if((n=n.filter(Boolean)).length>2){const t=n.pop();e+=`one of type ${n.join(", ")}, or ${t}.`}else 2===n.length?e+=`one of type ${n[0]} or ${n[1]}.`:e+=`of type ${n[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}const I=(e,...t)=>R("Key must be ",e,...t);function L(e,t,...n){return R(`Key for the ${e} algorithm must be `,t,...n)}const N=new TextEncoder,P=new TextDecoder;function B(...e){const t=e.reduce((e,{length:t})=>e+t,0),n=new Uint8Array(t);let r=0;for(const t of e)n.set(t,r),r+=t.length;return n}const O=e=>(e=>{let t=e;"string"==typeof t&&(t=N.encode(t));const n=[];for(let e=0;e<t.length;e+=32768)n.push(String.fromCharCode.apply(null,t.subarray(e,e+32768)));return btoa(n.join(""))})(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),D=e=>{let t=e;t instanceof Uint8Array&&(t=P.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return(e=>{const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n})(t)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}},U=e=>!!T(e)||"KeyObject"===e?.[Symbol.toStringTag],j=["CryptoKey"],M=async e=>{if(e instanceof Uint8Array)return{kty:"oct",k:O(e)};if(!T(e))throw new TypeError(I(e,...j,"Uint8Array"));if(!e.extractable)throw new TypeError("non-extractable CryptoKey cannot be exported as a JWK");const{ext:t,key_ops:n,alg:r,use:i,...o}=await S.subtle.exportKey("jwk",e);return o};async function F(e){return M(e)}class H extends Error{constructor(e,t){super(e,t),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}H.code="ERR_JOSE_GENERIC";class W extends H{constructor(e,t,n="unspecified",r="unspecified"){super(e,{cause:{claim:n,reason:r,payload:t}}),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=n,this.reason=r,this.payload=t}}W.code="ERR_JWT_CLAIM_VALIDATION_FAILED";class $ extends H{constructor(e,t,n="unspecified",r="unspecified"){super(e,{cause:{claim:n,reason:r,payload:t}}),this.code="ERR_JWT_EXPIRED",this.claim=n,this.reason=r,this.payload=t}}$.code="ERR_JWT_EXPIRED";class J extends H{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}}J.code="ERR_JOSE_ALG_NOT_ALLOWED";class z extends H{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}}z.code="ERR_JOSE_NOT_SUPPORTED";(class extends H{constructor(e="decryption operation failed",t){super(e,t),this.code="ERR_JWE_DECRYPTION_FAILED"}}).code="ERR_JWE_DECRYPTION_FAILED";(class extends H{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}}).code="ERR_JWE_INVALID";class q extends H{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}}q.code="ERR_JWS_INVALID";class K extends H{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}}K.code="ERR_JWT_INVALID";class V extends H{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}}V.code="ERR_JWK_INVALID";class G extends H{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}}G.code="ERR_JWKS_INVALID";class Q extends H{constructor(e="no applicable key found in the JSON Web Key Set",t){super(e,t),this.code="ERR_JWKS_NO_MATCHING_KEY"}}Q.code="ERR_JWKS_NO_MATCHING_KEY";class Z extends H{constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}Symbol.asyncIterator,Z.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";class Y extends H{constructor(e="request timed out",t){super(e,t),this.code="ERR_JWKS_TIMEOUT"}}Y.code="ERR_JWKS_TIMEOUT";class X extends H{constructor(e="signature verification failed",t){super(e,t),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}function ee(e,t){const n=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:n,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:n,name:"RSA-PSS",saltLength:e.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:n,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:n,name:"ECDSA",namedCurve:t.namedCurve};case"Ed25519":return{name:"Ed25519"};case"EdDSA":return{name:t.name};default:throw new z(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}X.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";const te=(e,t)=>{if(e.startsWith("RS")||e.startsWith("PS")){const{modulusLength:n}=t.algorithm;if("number"!=typeof n||n<2048)throw new TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}};function ne(e,t="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function re(e,t){return e.name===t}function ie(e){return parseInt(e.name.slice(4),10)}function oe(e,t){if(t.length&&!t.some(t=>e.usages.includes(t))){let e="CryptoKey does not support this operation, its usages must include ";if(t.length>2){const n=t.pop();e+=`one of ${t.join(", ")}, or ${n}.`}else 2===t.length?e+=`one of ${t[0]} or ${t[1]}.`:e+=`${t[0]}.`;throw new TypeError(e)}}function ae(e,t,...n){switch(t){case"HS256":case"HS384":case"HS512":{if(!re(e.algorithm,"HMAC"))throw ne("HMAC");const n=parseInt(t.slice(2),10);if(ie(e.algorithm.hash)!==n)throw ne(`SHA-${n}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!re(e.algorithm,"RSASSA-PKCS1-v1_5"))throw ne("RSASSA-PKCS1-v1_5");const n=parseInt(t.slice(2),10);if(ie(e.algorithm.hash)!==n)throw ne(`SHA-${n}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!re(e.algorithm,"RSA-PSS"))throw ne("RSA-PSS");const n=parseInt(t.slice(2),10);if(ie(e.algorithm.hash)!==n)throw ne(`SHA-${n}`,"algorithm.hash");break}case"EdDSA":if("Ed25519"!==e.algorithm.name&&"Ed448"!==e.algorithm.name)throw ne("Ed25519 or Ed448");break;case"Ed25519":if(!re(e.algorithm,"Ed25519"))throw ne("Ed25519");break;case"ES256":case"ES384":case"ES512":{if(!re(e.algorithm,"ECDSA"))throw ne("ECDSA");const n=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}(t);if(e.algorithm.namedCurve!==n)throw ne(n,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}oe(e,n)}function se(e){if(!function(e){return"object"==typeof e&&null!==e}(e)||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function ce(e){return se(e)&&"string"==typeof e.kty}const le=async e=>{if(!e.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:t,keyUsages:n}=function(e){let t,n;switch(e.kty){case"RSA":switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},n=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},n=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},n=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new z('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},n=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},n=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},n=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},n=e.d?["deriveBits"]:[];break;default:throw new z('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(e.alg){case"Ed25519":t={name:"Ed25519"},n=e.d?["sign"]:["verify"];break;case"EdDSA":t={name:e.crv},n=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},n=e.d?["deriveBits"]:[];break;default:throw new z('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new z('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:n}}(e),r=[t,e.ext??!1,e.key_ops??n],i={...e};return delete i.alg,delete i.use,S.subtle.importKey("jwk",i,...r)},ue=e=>D(e);let de,pe;const fe=e=>"KeyObject"===e?.[Symbol.toStringTag],he=async(e,t,n,r,i=!1)=>{let o=e.get(t);if(o?.[r])return o[r];const a=await le({...n,alg:r});return i&&Object.freeze(t),o?o[r]=a:e.set(t,{[r]:a}),a},me=(e,t)=>{if(fe(e)){let n=e.export({format:"jwk"});return delete n.d,delete n.dp,delete n.dq,delete n.p,delete n.q,delete n.qi,n.k?ue(n.k):(pe||(pe=new WeakMap),he(pe,e,n,t))}if(ce(e)){if(e.k)return D(e.k);pe||(pe=new WeakMap);return he(pe,e,e,t,!0)}return e},ge=(e,t)=>{if(fe(e)){let n=e.export({format:"jwk"});return n.k?ue(n.k):(de||(de=new WeakMap),he(de,e,n,t))}if(ce(e)){if(e.k)return D(e.k);de||(de=new WeakMap);return he(de,e,e,t,!0)}return e};async function ve(e,t,n){if("sign"===n&&(t=await ge(t,e)),"verify"===n&&(t=await me(t,e)),T(t))return ae(t,e,n),t;if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw new TypeError(I(t,...j));return S.subtle.importKey("raw",t,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[n])}throw new TypeError(I(t,...j,"Uint8Array","JSON Web Key"))}const ye=async(e,t,n)=>{const r=await ve(e,t,"sign");te(e,r);const i=await S.subtle.sign(ee(e,r.algorithm),r,n);return new Uint8Array(i)},we=(...e)=>{const t=e.filter(Boolean);if(0===t.length||1===t.length)return!0;let n;for(const e of t){const t=Object.keys(e);if(n&&0!==n.size)for(const e of t){if(n.has(e))return!1;n.add(e)}else n=new Set(t)}return!0},be=e=>e?.[Symbol.toStringTag],xe=(e,t,n)=>{if(void 0!==t.use&&"sig"!==t.use)throw new TypeError("Invalid key for this operation, when present its use must be sig");if(void 0!==t.key_ops&&!0!==t.key_ops.includes?.(n))throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${n}`);if(void 0!==t.alg&&t.alg!==e)throw new TypeError(`Invalid key for this operation, when present its alg must be ${e}`);return!0},Ee=(e,t,n,r)=>{if(!(t instanceof Uint8Array)){if(r&&ce(t)){if(function(e){return ce(e)&&"oct"===e.kty&&"string"==typeof e.k}(t)&&xe(e,t,n))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!U(t))throw new TypeError(L(e,t,...j,"Uint8Array",r?"JSON Web Key":null));if("secret"!==t.type)throw new TypeError(`${be(t)} instances for symmetric algorithms must be of type "secret"`)}};function Ce(e,t,n,r){t.startsWith("HS")||"dir"===t||t.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(t)?Ee(t,n,r,e):((e,t,n,r)=>{if(r&&ce(t))switch(n){case"sign":if(function(e){return"oct"!==e.kty&&"string"==typeof e.d}(t)&&xe(e,t,n))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(function(e){return"oct"!==e.kty&&void 0===e.d}(t)&&xe(e,t,n))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!U(t))throw new TypeError(L(e,t,...j,r?"JSON Web Key":null));if("secret"===t.type)throw new TypeError(`${be(t)} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===n&&"public"===t.type)throw new TypeError(`${be(t)} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===n&&"public"===t.type)throw new TypeError(`${be(t)} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&"verify"===n&&"private"===t.type)throw new TypeError(`${be(t)} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&"encrypt"===n&&"private"===t.type)throw new TypeError(`${be(t)} instances for asymmetric algorithm encryption must be of type "public"`)})(t,n,r,e)}Ce.bind(void 0,!1);const ke=Ce.bind(void 0,!0);const Ae=function(e,t,n,r,i){if(void 0!==i.crit&&void 0===r?.crit)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!r||void 0===r.crit)return new Set;if(!Array.isArray(r.crit)||0===r.crit.length||r.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let o;o=void 0!==n?new Map([...Object.entries(n),...t.entries()]):t;for(const t of r.crit){if(!o.has(t))throw new z(`Extension Header Parameter "${t}" is not recognized`);if(void 0===i[t])throw new e(`Extension Header Parameter "${t}" is missing`);if(o.get(t)&&void 0===r[t])throw new e(`Extension Header Parameter "${t}" MUST be integrity protected`)}return new Set(r.crit)};class _e{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,t){if(!this._protectedHeader&&!this._unprotectedHeader)throw new q("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!we(this._protectedHeader,this._unprotectedHeader))throw new q("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const n={...this._protectedHeader,...this._unprotectedHeader};let r=!0;if(Ae(q,new Map([["b64",!0]]),t?.crit,this._protectedHeader,n).has("b64")&&(r=this._protectedHeader.b64,"boolean"!=typeof r))throw new q('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:i}=n;if("string"!=typeof i||!i)throw new q('JWS "alg" (Algorithm) Header Parameter missing or invalid');ke(i,e,"sign");let o,a=this._payload;r&&(a=N.encode(O(a))),o=this._protectedHeader?N.encode(O(JSON.stringify(this._protectedHeader))):N.encode("");const s=B(o,N.encode("."),a),c=await ye(i,e,s),l={signature:O(c),payload:""};return r&&(l.payload=P.decode(a)),this._unprotectedHeader&&(l.header=this._unprotectedHeader),this._protectedHeader&&(l.protected=P.decode(o)),l}}class Se{constructor(e){this._flattened=new _e(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,t){const n=await this._flattened.sign(e,t);if(void 0===n.payload)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${n.protected}.${n.payload}.${n.signature}`}}const Te=e=>Math.floor(e.getTime()/1e3),Re=86400,Ie=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,Le=e=>{const t=Ie.exec(e);if(!t||t[4]&&t[1])throw new TypeError("Invalid time period format");const n=parseFloat(t[2]);let r;switch(t[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":r=Math.round(n);break;case"minute":case"minutes":case"min":case"mins":case"m":r=Math.round(60*n);break;case"hour":case"hours":case"hr":case"hrs":case"h":r=Math.round(3600*n);break;case"day":case"days":case"d":r=Math.round(n*Re);break;case"week":case"weeks":case"w":r=Math.round(604800*n);break;default:r=Math.round(31557600*n)}return"-"===t[1]||"ago"===t[4]?-r:r};function Ne(e,t){if(!Number.isFinite(t))throw new TypeError(`Invalid ${e} input`);return t}class Pe{constructor(e={}){if(!se(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return"number"==typeof e?this._payload={...this._payload,nbf:Ne("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:Ne("setNotBefore",Te(e))}:this._payload={...this._payload,nbf:Te(new Date)+Le(e)},this}setExpirationTime(e){return"number"==typeof e?this._payload={...this._payload,exp:Ne("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:Ne("setExpirationTime",Te(e))}:this._payload={...this._payload,exp:Te(new Date)+Le(e)},this}setIssuedAt(e){return void 0===e?this._payload={...this._payload,iat:Te(new Date)}:e instanceof Date?this._payload={...this._payload,iat:Ne("setIssuedAt",Te(e))}:this._payload="string"==typeof e?{...this._payload,iat:Ne("setIssuedAt",Te(new Date)+Le(e))}:{...this._payload,iat:Ne("setIssuedAt",e)},this}}class Be extends Pe{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,t){const n=new Se(N.encode(JSON.stringify(this._payload)));if(n.setProtectedHeader(this._protectedHeader),Array.isArray(this._protectedHeader?.crit)&&this._protectedHeader.crit.includes("b64")&&!1===this._protectedHeader.b64)throw new K("JWTs MUST NOT use unencoded payload");return n.sign(e,t)}}const Oe=async(e,t,n)=>{let r,i,o=!1;"function"==typeof AbortController&&(r=new AbortController,i=setTimeout(()=>{o=!0,r.abort()},t));const a=await fetch(e.href,{signal:r?r.signal:void 0,redirect:"manual",headers:n.headers}).catch(e=>{if(o)throw new Y;throw e});if(void 0!==i&&clearTimeout(i),200!==a.status)throw new H("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await a.json()}catch{throw new H("Failed to parse the JSON Web Key Set HTTP response as JSON")}};async function De(e,t){if(!se(e))throw new TypeError("JWK must be an object");switch(t||(t=e.alg),e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw new TypeError('missing "k" (Key Value) Parameter value');return D(e.k);case"RSA":if("oth"in e&&void 0!==e.oth)throw new z('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return le({...e,alg:t});default:throw new z('Unsupported "kty" (Key Type) Parameter value')}}function Ue(e){return se(e)}function je(e){return"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}class Me{constructor(e){if(this._cached=new WeakMap,!function(e){return e&&"object"==typeof e&&Array.isArray(e.keys)&&e.keys.every(Ue)}(e))throw new G("JSON Web Key Set malformed");this._jwks=je(e)}async getKey(e,t){const{alg:n,kid:r}={...e,...t?.header},i=function(e){switch("string"==typeof e&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new z('Unsupported "alg" value for a JSON Web Key Set')}}(n),o=this._jwks.keys.filter(e=>{let t=i===e.kty;if(t&&"string"==typeof r&&(t=r===e.kid),t&&"string"==typeof e.alg&&(t=n===e.alg),t&&"string"==typeof e.use&&(t="sig"===e.use),t&&Array.isArray(e.key_ops)&&(t=e.key_ops.includes("verify")),t)switch(n){case"ES256":t="P-256"===e.crv;break;case"ES256K":t="secp256k1"===e.crv;break;case"ES384":t="P-384"===e.crv;break;case"ES512":t="P-521"===e.crv;break;case"Ed25519":t="Ed25519"===e.crv;break;case"EdDSA":t="Ed25519"===e.crv||"Ed448"===e.crv}return t}),{0:a,length:s}=o;if(0===s)throw new Q;if(1!==s){const e=new Z,{_cached:t}=this;throw e[Symbol.asyncIterator]=async function*(){for(const e of o)try{yield await Fe(t,e,n)}catch{}},e}return Fe(this._cached,a,n)}}async function Fe(e,t,n){const r=e.get(t)||e.set(t,{}).get(t);if(void 0===r[n]){const e=await De({...t,ext:!0},n);if(e instanceof Uint8Array||"public"!==e.type)throw new G("JSON Web Key Set members must be public keys");r[n]=e}return r[n]}function He(e){const t=new Me(e),n=async(e,n)=>t.getKey(e,n);return Object.defineProperties(n,{jwks:{value:()=>je(t._jwks),enumerable:!0,configurable:!1,writable:!1}}),n}let We;if("undefined"==typeof navigator||!navigator.userAgent?.startsWith?.("Mozilla/5.0 ")){We=`${"jose"}/${"v5.10.0"}`}const $e=Symbol();class Je{constructor(e,t){if(!(e instanceof URL))throw new TypeError("url must be an instance of URL");var n,r;this._url=new URL(e.href),this._options={agent:t?.agent,headers:t?.headers},this._timeoutDuration="number"==typeof t?.timeoutDuration?t?.timeoutDuration:5e3,this._cooldownDuration="number"==typeof t?.cooldownDuration?t?.cooldownDuration:3e4,this._cacheMaxAge="number"==typeof t?.cacheMaxAge?t?.cacheMaxAge:6e5,void 0!==t?.[$e]&&(this._cache=t?.[$e],n=t?.[$e],r=this._cacheMaxAge,"object"==typeof n&&null!==n&&"uat"in n&&"number"==typeof n.uat&&!(Date.now()-n.uat>=r)&&"jwks"in n&&se(n.jwks)&&Array.isArray(n.jwks.keys)&&Array.prototype.every.call(n.jwks.keys,se)&&(this._jwksTimestamp=this._cache.uat,this._local=He(this._cache.jwks)))}coolingDown(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cooldownDuration}fresh(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cacheMaxAge}async getKey(e,t){this._local&&this.fresh()||await this.reload();try{return await this._local(e,t)}catch(n){if(n instanceof Q&&!1===this.coolingDown())return await this.reload(),this._local(e,t);throw n}}async reload(){this._pendingFetch&&("undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"undefined"!=typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this._pendingFetch=void 0);const e=new Headers(this._options.headers);We&&!e.has("User-Agent")&&(e.set("User-Agent",We),this._options.headers=Object.fromEntries(e.entries())),this._pendingFetch||(this._pendingFetch=Oe(this._url,this._timeoutDuration,this._options).then(e=>{this._local=He(e),this._cache&&(this._cache.uat=Date.now(),this._cache.jwks=e),this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(e=>{throw this._pendingFetch=void 0,e})),await this._pendingFetch}}const ze=async(e,t,n,r)=>{const i=await ve(e,t,"verify");te(e,i);const o=ee(e,i.algorithm);try{return await S.subtle.verify(o,i,n,r)}catch{return!1}},qe=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw new TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)};async function Ke(e,t,n){if(e instanceof Uint8Array&&(e=P.decode(e)),"string"!=typeof e)throw new q("Compact JWS must be a string or Uint8Array");const{0:r,1:i,2:o,length:a}=e.split(".");if(3!==a)throw new q("Invalid Compact JWS");const s=await async function(e,t,n){if(!se(e))throw new q("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new q('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new q("JWS Protected Header incorrect type");if(void 0===e.payload)throw new q("JWS Payload missing");if("string"!=typeof e.signature)throw new q("JWS Signature missing or incorrect type");if(void 0!==e.header&&!se(e.header))throw new q("JWS Unprotected Header incorrect type");let r={};if(e.protected)try{const t=D(e.protected);r=JSON.parse(P.decode(t))}catch{throw new q("JWS Protected Header is invalid")}if(!we(r,e.header))throw new q("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const i={...r,...e.header};let o=!0;if(Ae(q,new Map([["b64",!0]]),n?.crit,r,i).has("b64")&&(o=r.b64,"boolean"!=typeof o))throw new q('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:a}=i;if("string"!=typeof a||!a)throw new q('JWS "alg" (Algorithm) Header Parameter missing or invalid');const s=n&&qe("algorithms",n.algorithms);if(s&&!s.has(a))throw new J('"alg" (Algorithm) Header Parameter value not allowed');if(o){if("string"!=typeof e.payload)throw new q("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new q("JWS Payload must be a string or an Uint8Array instance");let c=!1;"function"==typeof t?(t=await t(r,e),c=!0,ke(a,t,"verify"),ce(t)&&(t=await De(t,a))):ke(a,t,"verify");const l=B(N.encode(e.protected??""),N.encode("."),"string"==typeof e.payload?N.encode(e.payload):e.payload);let u,d;try{u=D(e.signature)}catch{throw new q("Failed to base64url decode the signature")}if(!await ze(a,t,u,l))throw new X;if(o)try{d=D(e.payload)}catch{throw new q("Failed to base64url decode the payload")}else d="string"==typeof e.payload?N.encode(e.payload):e.payload;const p={payload:d};return void 0!==e.protected&&(p.protectedHeader=r),void 0!==e.header&&(p.unprotectedHeader=e.header),c?{...p,key:t}:p}({payload:i,protected:r,signature:o},t,n),c={payload:s.payload,protectedHeader:s.protectedHeader};return"function"==typeof t?{...c,key:s.key}:c}const Ve=e=>e.toLowerCase().replace(/^application\//,""),Ge=(e,t,n={})=>{let r;try{r=JSON.parse(P.decode(t))}catch{}if(!se(r))throw new K("JWT Claims Set must be a top-level JSON object");const{typ:i}=n;if(i&&("string"!=typeof e.typ||Ve(e.typ)!==Ve(i)))throw new W('unexpected "typ" JWT header value',r,"typ","check_failed");const{requiredClaims:o=[],issuer:a,subject:s,audience:c,maxTokenAge:l}=n,u=[...o];void 0!==l&&u.push("iat"),void 0!==c&&u.push("aud"),void 0!==s&&u.push("sub"),void 0!==a&&u.push("iss");for(const e of new Set(u.reverse()))if(!(e in r))throw new W(`missing required "${e}" claim`,r,e,"missing");if(a&&!(Array.isArray(a)?a:[a]).includes(r.iss))throw new W('unexpected "iss" claim value',r,"iss","check_failed");if(s&&r.sub!==s)throw new W('unexpected "sub" claim value',r,"sub","check_failed");if(c&&(d=r.aud,p="string"==typeof c?[c]:c,!("string"==typeof d?p.includes(d):Array.isArray(d)&&p.some(Set.prototype.has.bind(new Set(d))))))throw new W('unexpected "aud" claim value',r,"aud","check_failed");var d,p;let f;switch(typeof n.clockTolerance){case"string":f=Le(n.clockTolerance);break;case"number":f=n.clockTolerance;break;case"undefined":f=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:h}=n,m=Te(h||new Date);if((void 0!==r.iat||l)&&"number"!=typeof r.iat)throw new W('"iat" claim must be a number',r,"iat","invalid");if(void 0!==r.nbf){if("number"!=typeof r.nbf)throw new W('"nbf" claim must be a number',r,"nbf","invalid");if(r.nbf>m+f)throw new W('"nbf" claim timestamp check failed',r,"nbf","check_failed")}if(void 0!==r.exp){if("number"!=typeof r.exp)throw new W('"exp" claim must be a number',r,"exp","invalid");if(r.exp<=m-f)throw new $('"exp" claim timestamp check failed',r,"exp","check_failed")}if(l){const e=m-r.iat;if(e-f>("number"==typeof l?l:Le(l)))throw new $('"iat" claim timestamp check failed (too far in the past)',r,"iat","check_failed");if(e<0-f)throw new W('"iat" claim timestamp check failed (it should be in the past)',r,"iat","check_failed")}return r};const Qe=async(e,t)=>{const n=`SHA-${e.slice(-3)}`;return new Uint8Array(await S.subtle.digest(n,t))},Ze=(e,t)=>{if("string"!=typeof e||!e)throw new V(`${t} missing or invalid`)};async function Ye(e,t){if(!se(e))throw new TypeError("JWK must be an object");if(t??(t="sha256"),"sha256"!==t&&"sha384"!==t&&"sha512"!==t)throw new TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');let n;switch(e.kty){case"EC":Ze(e.crv,'"crv" (Curve) Parameter'),Ze(e.x,'"x" (X Coordinate) Parameter'),Ze(e.y,'"y" (Y Coordinate) Parameter'),n={crv:e.crv,kty:e.kty,x:e.x,y:e.y};break;case"OKP":Ze(e.crv,'"crv" (Subtype of Key Pair) Parameter'),Ze(e.x,'"x" (Public Key) Parameter'),n={crv:e.crv,kty:e.kty,x:e.x};break;case"RSA":Ze(e.e,'"e" (Exponent) Parameter'),Ze(e.n,'"n" (Modulus) Parameter'),n={e:e.e,kty:e.kty,n:e.n};break;case"oct":Ze(e.k,'"k" (Key Value) Parameter'),n={k:e.k,kty:e.kty};break;default:throw new z('"kty" (Key Type) Parameter missing or unsupported')}const r=N.encode(JSON.stringify(n));return O(await Qe(t,r))}function Xe(e){const t=e?.modulusLength??2048;if("number"!=typeof t||t<2048)throw new z("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return t}async function et(e,t){return async function(e,t){let n,r;switch(e){case"PS256":case"PS384":case"PS512":n={name:"RSA-PSS",hash:`SHA-${e.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:Xe(t)},r=["sign","verify"];break;case"RS256":case"RS384":case"RS512":n={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:Xe(t)},r=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":n={name:"RSA-OAEP",hash:`SHA-${parseInt(e.slice(-3),10)||1}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:Xe(t)},r=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":n={name:"ECDSA",namedCurve:"P-256"},r=["sign","verify"];break;case"ES384":n={name:"ECDSA",namedCurve:"P-384"},r=["sign","verify"];break;case"ES512":n={name:"ECDSA",namedCurve:"P-521"},r=["sign","verify"];break;case"Ed25519":n={name:"Ed25519"},r=["sign","verify"];break;case"EdDSA":{r=["sign","verify"];const e=t?.crv??"Ed25519";switch(e){case"Ed25519":case"Ed448":n={name:e};break;default:throw new z("Invalid or unsupported crv option provided")}break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{r=["deriveKey","deriveBits"];const e=t?.crv??"P-256";switch(e){case"P-256":case"P-384":case"P-521":n={name:"ECDH",namedCurve:e};break;case"X25519":case"X448":n={name:e};break;default:throw new z("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448")}break}default:throw new z('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return S.subtle.generateKey(n,t?.extractable??!1,r)}(e,t)}const tt=D;
/**
 * solid-oidc.js - Minimal Solid-OIDC client for browsers
 *
 * A zero-build, single-file Solid-OIDC authentication library.
 *
 * @license MIT
 * @author JavaScriptSolidServer
 * @see https://github.com/JavaScriptSolidServer/solid-oidc
 *
 * Based on solid-oidc-client-browser by uvdsl (Christoph Braun)
 * @see https://github.com/uvdsl/solid-oidc-client-browser
 *
 * Implements:
 * - RFC 6749 - OAuth 2.0
 * - RFC 7636 - PKCE
 * - RFC 9207 - OAuth 2.0 Authorization Server Issuer Identification
 * - RFC 9449 - DPoP (Demonstration of Proof-of-Possession)
 * - Solid-OIDC Specification
 */
const nt="sessionStateChange",rt="sessionExpirationWarning",it="sessionExpiration";class ot{constructor(e="solid-oidc",t="session",n=1){this.dbName=e,this.storeName=t,this.dbVersion=n,this.db=null}async init(){return new Promise((e,t)=>{const n=indexedDB.open(this.dbName,this.dbVersion);n.onerror=()=>t(new Error(`Database error: ${n.error}`)),n.onsuccess=()=>{this.db=n.result,e(this)},n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this.storeName)||t.createObjectStore(this.storeName)}})}async setItem(e,t){return this.db||await this.init(),new Promise((n,r)=>{const i=this.db.transaction(this.storeName,"readwrite");i.oncomplete=()=>n(),i.onerror=()=>r(new Error(`Transaction error: ${i.error}`)),i.objectStore(this.storeName).put(t,e)})}async getItem(e){return this.db||await this.init(),new Promise((t,n)=>{const r=this.db.transaction(this.storeName,"readonly");r.onerror=()=>n(new Error(`Transaction error: ${r.error}`));const i=r.objectStore(this.storeName).get(e);i.onsuccess=()=>t(i.result||null)})}async deleteItem(e){return this.db||await this.init(),new Promise((t,n)=>{const r=this.db.transaction(this.storeName,"readwrite");r.oncomplete=()=>t(),r.onerror=()=>n(new Error(`Transaction error: ${r.error}`)),r.objectStore(this.storeName).delete(e)})}async clear(){return this.db||await this.init(),new Promise((e,t)=>{const n=this.db.transaction(this.storeName,"readwrite");n.oncomplete=()=>e(),n.onerror=()=>t(new Error(`Transaction error: ${n.error}`)),n.objectStore(this.storeName).clear()})}close(){this.db&&(this.db.close(),this.db=null)}}async function at(e,t,n,r=null){const i=await F(e.publicKey),o={htu:t,htm:n};return r&&(o.ath=r),new Be(o).setIssuedAt().setJti(crypto.randomUUID()).setProtectedHeader({alg:"ES256",typ:"dpop+jwt",jwk:i}).sign(e.privateKey)}async function st(e,t,n){const r=await at(n,e,"POST"),i=await fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",DPoP:r},body:new URLSearchParams(t)});if(!i.ok)throw new Error(`Token request failed: ${i.status}`);return i.json()}async function ct(e,t,n,r,i){const o=function(e,t){const n=new Je(e,t),r=async(e,t)=>n.getKey(e,t);return Object.defineProperties(r,{coolingDown:{get:()=>n.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>n.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>n.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>!!n._pendingFetch,enumerable:!0,configurable:!1},jwks:{value:()=>n._local?.jwks(),enumerable:!0,configurable:!1,writable:!1}}),r}(new URL(t)),{payload:a}=await async function(e,t,n){const r=await Ke(e,t,n);if(r.protectedHeader.crit?.includes("b64")&&!1===r.protectedHeader.b64)throw new K("JWTs MUST NOT use unencoded payload");const i={payload:Ge(r.protectedHeader,r.payload,n),protectedHeader:r.protectedHeader};return"function"==typeof t?{...i,key:r.key}:i}(e,o,{issuer:n,audience:"solid"}),s=await Ye(await F(i.publicKey));if(a.cnf?.jkt!==s)throw new Error("DPoP thumbprint mismatch");if(a.client_id!==r)throw new Error("client_id mismatch");return a}class lt extends EventTarget{constructor(e={}){super(),this.clientId=e.clientId||null,this.database=e.database||new ot,this.onStateChange=e.onStateChange||null,this.onExpirationWarning=e.onExpirationWarning||null,this.onExpiration=e.onExpiration||null,this._isActive=!1,this._webId=null,this._exp=null,this._ath=null,this._tokens=null,this._idpDetails=null,this._refreshPromise=null,this.onStateChange&&this.addEventListener(nt,this.onStateChange),this.onExpirationWarning&&this.addEventListener(rt,this.onExpirationWarning),this.onExpiration&&this.addEventListener(it,this.onExpiration)}get isActive(){return this._isActive}get webId(){return this._webId}isExpired(){return!this._exp||Math.floor(Date.now()/1e3)>=this._exp}getExpiresIn(){return this._exp?this._exp-Math.floor(Date.now()/1e3):-1}async login(e,t){const n=new URL(t),r=n.origin+n.pathname+n.search,i=await async function(e){const t=new URL(e).origin,n=await fetch(`${t}/.well-known/openid-configuration`);if(!n.ok)throw new Error(`OIDC discovery failed: ${n.status}`);return n.json()}(e),o=i.issuer,a=e=>e.endsWith("/")?e.slice(0,-1):e;if(a(e)!==a(o))throw new Error(`Issuer mismatch: ${o} !== ${e}`);sessionStorage.setItem("solid_oidc_idp",o),sessionStorage.setItem("solid_oidc_token_endpoint",i.token_endpoint),sessionStorage.setItem("solid_oidc_jwks_uri",i.jwks_uri);let s=this.clientId;if(!s){s=(await async function(e,t){const n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({application_type:"web",redirect_uris:t,token_endpoint_auth_method:"none",grant_types:["authorization_code","refresh_token"],response_types:["code"],scope:"openid offline_access webid"})});if(!n.ok)throw new Error(`Client registration failed: ${n.status}`);return n.json()}(i.registration_endpoint,[r])).client_id,sessionStorage.setItem("solid_oidc_client_id",s)}const c=await async function(){const e=crypto.randomUUID()+"-"+crypto.randomUUID(),t=new Uint8Array(await crypto.subtle.digest("SHA-256",(new TextEncoder).encode(e)));return{verifier:e,challenge:btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}}();sessionStorage.setItem("solid_oidc_pkce_verifier",c.verifier);const l=crypto.randomUUID();sessionStorage.setItem("solid_oidc_csrf",l);const u=new URL(i.authorization_endpoint);u.searchParams.set("response_type","code"),u.searchParams.set("redirect_uri",r),u.searchParams.set("scope","openid offline_access webid"),u.searchParams.set("client_id",s),u.searchParams.set("code_challenge_method","S256"),u.searchParams.set("code_challenge",c.challenge),u.searchParams.set("state",l),u.searchParams.set("prompt","consent"),window.location.href=u.toString()}async handleRedirectFromLogin(){const e=new URL(window.location.href),t=e.searchParams.get("code");if(!t)return;const n=sessionStorage.getItem("solid_oidc_idp"),r=e.searchParams.get("iss");if(!n||r!==n)throw new Error(`Issuer mismatch: ${r} !== ${n}`);const i=sessionStorage.getItem("solid_oidc_csrf");if(e.searchParams.get("state")!==i)throw new Error("CSRF token mismatch");e.searchParams.delete("code"),e.searchParams.delete("iss"),e.searchParams.delete("state"),window.history.replaceState({},document.title,e.toString());const o=sessionStorage.getItem("solid_oidc_pkce_verifier"),a=sessionStorage.getItem("solid_oidc_token_endpoint"),s=sessionStorage.getItem("solid_oidc_jwks_uri"),c=this.clientId||sessionStorage.getItem("solid_oidc_client_id");if(!o||!a||!c)throw new Error("Missing session data");const l=await et("ES256"),u=await st(a,{grant_type:"authorization_code",code:t,code_verifier:o,redirect_uri:e.origin+e.pathname,client_id:c},l);await ct(u.access_token,s,n,c,l),this._idpDetails={idp:n,jwksUri:s,tokenEndpoint:a},await this.database.init(),await Promise.all([this.database.setItem("idp",n),this.database.setItem("jwks_uri",s),this.database.setItem("token_endpoint",a),this.database.setItem("client_id",c),this.database.setItem("dpop_keypair",l),this.database.setItem("refresh_token",u.refresh_token)]),this.database.close(),sessionStorage.removeItem("solid_oidc_idp"),sessionStorage.removeItem("solid_oidc_token_endpoint"),sessionStorage.removeItem("solid_oidc_jwks_uri"),sessionStorage.removeItem("solid_oidc_client_id"),sessionStorage.removeItem("solid_oidc_pkce_verifier"),sessionStorage.removeItem("solid_oidc_csrf"),await this._setTokens({...u,dpop_key_pair:l}),this._dispatchStateChange()}async restore(){return this._refreshPromise||(this._refreshPromise=(async()=>{try{const e=await async function(e){await e.init();const[t,n,r,i]=await Promise.all([e.getItem("refresh_token"),e.getItem("token_endpoint"),e.getItem("client_id"),e.getItem("dpop_keypair")]);if(!(t&&n&&r&&i))throw new Error("Missing refresh data");const o=await st(n,{grant_type:"refresh_token",refresh_token:t,client_id:r},i);return o.refresh_token&&await e.setItem("refresh_token",o.refresh_token),e.close(),{...o,dpop_key_pair:i}}(this.database);await this._setTokens(e),this._dispatchStateChange()}catch(e){throw this._isActive&&(this.isExpired()?this._dispatchExpiration():this._dispatchExpirationWarning()),e}finally{this._refreshPromise=null}})()),this._refreshPromise}async logout(){this._isActive=!1,this._webId=null,this._exp=null,this._ath=null,this._tokens=null,this._idpDetails=null,await this.database.init(),await this.database.clear(),this.database.close(),this._dispatchStateChange()}async authFetch(e,t={}){if(!this._isActive)return fetch(e,t);let n,r,i;this.isExpired()&&await this.restore(),e instanceof Request?(n=new URL(e.url),r=t.method||e.method||"GET",i=new Headers(e.headers)):(n=new URL(e.toString()),r=t.method||"GET",i=t.headers?new Headers(t.headers):new Headers);const o=await at(this._tokens.dpop_key_pair,`${n.origin}${n.pathname}`,r.toUpperCase(),this._ath);return i.set("DPoP",o),i.set("Authorization",`DPoP ${this._tokens.access_token}`),e instanceof Request?fetch(new Request(e,{...t,headers:i})):fetch(n,{...t,headers:i})}async _setTokens(e){this._tokens=e;const t=function(e){if("string"!=typeof e)throw new K("JWTs must use Compact JWS serialization, JWT must be a string");const{1:t,length:n}=e.split(".");if(5===n)throw new K("Only JWTs using Compact JWS serialization can be decoded");if(3!==n)throw new K("Invalid JWT");if(!t)throw new K("JWTs must contain a payload");let r,i;try{r=tt(t)}catch{throw new K("Failed to base64url decode the payload")}try{i=JSON.parse(P.decode(r))}catch{throw new K("Failed to parse the decoded payload as JSON")}if(!se(i))throw new K("Invalid JWT Claims Set");return i}(e.access_token);if(!t.webid)throw new Error("Missing webid claim");if(!t.exp)throw new Error("Missing exp claim");this._ath=await async function(e){const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t),r=Array.from(new Uint8Array(n));return btoa(String.fromCharCode(...r)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(e.access_token),this._webId=t.webid,this._exp=t.exp,this._isActive=!0}_dispatchStateChange(){this.dispatchEvent(new CustomEvent(nt,{detail:{isActive:this._isActive,webId:this._webId}}))}_dispatchExpirationWarning(){this.dispatchEvent(new CustomEvent(rt,{detail:{expires_in:this.getExpiresIn()}}))}_dispatchExpiration(){this.dispatchEvent(new CustomEvent(it))}}const ut="sessionRestore",dt="login",pt="logout",ft="sessionExpired",ht="error";class mt{constructor(){this.listeners=new Map}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){var n;null===(n=this.listeners.get(e))||void 0===n||n.delete(t)}emit(e,...t){var n;null===(n=this.listeners.get(e))||void 0===n||n.forEach(e=>e(...t))}}const gt=new class{constructor(e){this._session=new lt({clientId:null==e?void 0:e.clientId,database:new ot,onStateChange:e=>{const t=e.detail;(null==t?void 0:t.isActive)?(this._events.emit(dt),this._events.emit(ut,window.location.href)):this._events.emit(pt)},onExpiration:()=>{this._events.emit(ft)}}),this._events=new mt,this._sessionId=crypto.randomUUID()}get events(){return this._events}get info(){var e;return{isLoggedIn:this._session.isActive,webId:null!==(e=this._session.webId)&&void 0!==e?e:void 0,sessionId:this._sessionId,expirationDate:this._session.isActive?Date.now()+1e3*this._session.getExpiresIn():void 0}}async handleIncomingRedirect(e){const t="string"==typeof e?{url:e}:null!=e?e:{};try{if(await this._session.handleRedirectFromLogin(),!this._session.isActive&&!1!==t.restorePreviousSession)try{await this._session.restore()}catch{}return this.info}catch(e){return void this._events.emit(ht,e)}}async login(e){const t=e.redirectUrl||window.location.href;await this._session.login(e.oidcIssuer,t)}async logout(){await this._session.logout()}async fetch(e,t){return this._session.authFetch(e,t)}},vt=g;var yt=k(386);const wt=k.n(yt)()(vt),bt=(0,vt.sym)("http://www.iana.org/assignments/link-relations/acl");function xt(e){const t=wt;function n(e,n,r,i={}){const o=i.public||[],a=(0,vt.graph)(),s=(0,vt.Namespace)("http://www.w3.org/ns/auth/acl#");let c=a.sym(`${r}#a1`);const l=a.sym(r),u=a.sym(e);if(a.add(c,t.rdf("type"),s("Authorization"),l),a.add(c,s("accessTo"),u,l),i.defaultForNew&&a.add(c,s("default"),u,l),a.add(c,s("agent"),n,l),a.add(c,s("mode"),s("Read"),l),a.add(c,s("mode"),s("Write"),l),a.add(c,s("mode"),s("Control"),l),o.length){c=a.sym(`${r}#a2`),a.add(c,t.rdf("type"),s("Authorization"),l),a.add(c,s("accessTo"),u,l),a.add(c,s("agentClass"),t.foaf("Agent"),l);for(let e=0;e<o.length;e++)a.add(c,s("mode"),s(o[e]),l)}return(0,vt.serialize)(l,a,r)}return{findAclDocUrl:async function(t){await e.fetcher.load(t);const n=e.any(t,bt);if(!n)throw new Error(`No ACL link discovered for ${t}`);return n.value},setACLUserPublic:function(t,r,i){const o=e.any(e.sym(t),bt);return Promise.resolve().then(()=>o||function(t){const n=e.fetcher;if(!n)throw new Error("Cannot fetch ACL rel, store has no fetcher");return n.load(t).then(n=>{if(!n.ok)throw new Error("fetchACLRel: While loading:"+n.error);const r=e.any(e.sym(t),bt);if(!r)throw new Error("fetchACLRel: No Link rel=ACL header for "+t);return r})}(t).catch(e=>{throw new Error(`Error fetching rel=ACL header for ${t}: ${e}`)})).then(o=>{const a=n(t,r,o.uri,i);if(!e.fetcher)throw new Error("Cannot PUT this, store has no fetcher");return e.fetcher.webOperation("PUT",o.uri,{data:a,contentType:"text/turtle"}).then(e=>{if(!e.ok)throw new Error("Error writing ACL text: "+e.error);return o})})},genACLText:n}}function Et(){const{$SolidTestEnvironment:e}=window;if(void 0!==e&&e.username)return A("Assuming the user is "+e.username),(0,vt.sym)(e.username);if("undefined"!=typeof document&&document.location&&"http://localhost"===(""+document.location).slice(0,16)){const e=document.getElementById("appTarget");if(!e)return null;const t=e.getAttribute("testID");return t?(A("Assuming user is "+t),(0,vt.sym)(t)):null}return null}class Ct{constructor(e){this.session=e}get authSession(){return this.session}currentUser(){const e=(()=>{let{SolidAppContext:e}=window;if(e||(e={}),e.viewingNoAuthPage=!1,e.noAuth&&window.document&&window.document.location.href.startsWith(e.noAuth)){e.viewingNoAuthPage=!0;const t=new URLSearchParams(window.document.location.search);if(t){let n=e.viewedPage=t.get("uri")||null;if(n&&(n=decodeURI(n),!n.startsWith(e.noAuth))){const t=n.split(/\//);e.idp=t[0]+"//"+t[2],e.viewingNoAuthPage=!1}}}return e})();return e.viewingNoAuthPage?(0,vt.sym)(e.webId):this&&this.session&&this.session.info&&this.session.info.webId&&this.session.info.isLoggedIn?(0,vt.sym)(this.session.info.webId):Et()}async checkUser(e){const t=new URL(window.location.href).hash;t&&window.localStorage.setItem("preLoginRedirectHash",t),this.session.events.on(ut,e=>{A(`Session restored to ${e}`),document.location.toString()!==e&&history.replaceState(null,"",e)});const n=new URL(window.location.href);n.hash="",await this.session.handleIncomingRedirect({restorePreviousSession:!0,url:n.href});const r=window.localStorage.getItem("preLoginRedirectHash");if(r){const e=new URL(window.location.href);e.hash!==r&&(history.pushState?history.pushState(null,document.title,r):location.hash=r,e.hash=r),window.localStorage.setItem("preLoginRedirectHash","")}let i=Et();if(i)return Promise.resolve(e?e(i):i);const o=this.webIdFromSession(this.session.info);return o&&(i=this.saveUser(o)),i&&A(`(Logged in as ${i} by authentication)`),Promise.resolve(e?e(i):i)}saveUser(e,t){let n;if(e){n="string"==typeof e?e:e.uri;const r=(0,vt.namedNode)(n);return t&&(t.me=r),r}return null}webIdFromSession(e){return(null==e?void 0:e.webId)&&e.isLoggedIn?e.webId:null}}function kt(e){return(0,vt.sym)(e.uri+"#id"+Date.now())}function At(e){return!e||`${window.location.origin}/`!==new URL(e.value).origin}const _t="index.ttl#this";function St(e,t){const n=wt;async function r(t,n,r){await e.fetcher.load(t);const i=e.any(t,new vt.NamedNode("http://www.iana.org/assignments/link-relations/acl"));if(!i)throw new Error("Chat ACL doc not found!");const o=`\n            @prefix acl: <http://www.w3.org/ns/auth/acl#>.\n            <#owner>\n            a acl:Authorization;\n            acl:agent <${n.value}>;\n            acl:accessTo <.>;\n            acl:default <.>;\n            acl:mode\n                acl:Read, acl:Write, acl:Control.\n            <#invitee>\n            a acl:Authorization;\n            acl:agent <${r.value}>;\n            acl:accessTo <.>;\n            acl:default <.>;\n            acl:mode\n                acl:Read, acl:Append.\n            `;await e.fetcher.webOperation("PUT",i.value,{data:o,contentType:"text/turtle"})}async function i(t,r){const i=e.any(r,n.solid("privateTypeIndex"));if(!i)throw new Error("Private type index not found!");await e.fetcher.load(i);const o=kt(i),a=[(0,vt.st)(o,n.rdf("type"),n.solid("TypeRegistration"),i.doc()),(0,vt.st)(o,n.solid("forClass"),n.meeting("LongChat"),i.doc()),(0,vt.st)(o,n.solid("instance"),t,i.doc())];await new Promise((t,n)=>{e.updater.update([],a,function(e,r,i){r?t(null):n(new Error(i))})})}async function o(n){const r=await t.loadMe(),i=function(e,t){const n=new URL(`IndividualChats/${new URL(e.value).host}/`,t.value).toString();return new vt.NamedNode(n)}(n,await t.getPodRoot(r));let o=!0;try{await e.fetcher.load(new vt.NamedNode(i.value+"index.ttl#this"))}catch(e){o=!1}return{me:r,chatContainer:i,exists:o}}async function a(e,t){return(await s({me:t,newBase:e.value})).newInstance}function s(t){const r=e,i=r.updater;if(t.me&&!t.me.uri)throw new Error("chat mintNew:  Invalid userid "+t.me);const o=t.newInstance=t.newInstance||r.sym(t.newBase+_t),a=o.doc();return r.add(o,n.rdf("type"),n.meeting("LongChat"),a),r.add(o,n.dc("title"),"Chat channel",a),r.add(o,n.dc("created"),(0,vt.term)(new Date(Date.now())),a),t.me&&r.add(o,n.dc("author"),t.me,a),new Promise(function(e,n){null==i||i.put(a,r.statementsMatching(void 0,void 0,void 0,a),"text/turtle",function(r,i,a){i?e({...t,newInstance:o}):n(new Error("FAILED to save new chat channel at: "+r+" : "+a))})})}async function c(t,r){var i;await e.fetcher.load(t.doc());const o=e.any(t,n.ldp("inbox"),void 0,t.doc());if(!o)throw new Error(`Invitee inbox not found! ${t.value}`);const a=`\n        <> a <http://www.w3.org/ns/pim/meeting#LongChatInvite> ;\n        ${n.rdf("seeAlso")} <${r.value}> .\n        `,s=await(null===(i=e.fetcher)||void 0===i?void 0:i.webOperation("POST",o.value,{data:a,contentType:"text/turtle"}));if(!(null==s?void 0:s.headers.get("location")))throw new Error(`Invite sending returned a ${null==s?void 0:s.status}`)}return{setAcl:r,addToPrivateTypeIndex:i,findChat:o,createChatThing:a,getChat:async function(e,t=!0){const{me:n,chatContainer:s,exists:l}=await o(e);if(l)return new vt.NamedNode(s.value+_t);if(t){const t=await a(s,n);return await c(e,t),await r(s,n,e),await i(t,n),t}return null},sendInvite:c,mintNew:s}}function Tt(e,t,n,r,i){return{createInboxFor:async function(e,i){const o=await t.loadMe(),a=`${(await t.getPodRoot(o)).value}p2p-inboxes/${encodeURIComponent(i)}/`;return await r.createContainer(a),await n.setSinglePeerAccess({ownerWebId:o.value,peerWebId:e,accessToModes:"acl:Append",target:a}),a},getNewMessages:async function(e){e||(e=await t.loadMe());const n=await t.getMainInbox(e);return(await r.getContainerMembers(n)).filter(e=>!r.isContainer(e))},markAsRead:async function(t,n){const r=await e.fetcher._fetch(t);if(200!==r.status)throw new Error(`Not OK! ${t}`);const i=function(e,t){const n=t.getUTCFullYear(),r=("0"+(t.getUTCMonth()+1)).slice(-2),i=("0"+t.getUTCDate()).slice(-2),o=e.split("/"),a=o[o.length-1];return new URL(`./archive/${n}/${r}/${i}/${a}`,e).toString()}(t,n),o={method:"PUT",body:await r.text(),headers:[["Content-Type",r.headers.get("Content-Type")||"application/octet-stream"]]};"2"===(await e.fetcher._fetch(i,o)).status.toString()[0]&&await e.fetcher._fetch(t,{method:"DELETE"})}}}class Rt extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype),this.name=new.target.name}}class It extends Rt{}class Lt extends Rt{}class Nt extends Rt{}class Pt extends Rt{}class Bt extends Rt{}class Ot extends Rt{constructor(e,t){super(t),this.status=e}}function Dt(e,t,n){const r=wt;async function i(t){await o(t);const i=function(e){const t=e.uri.replace("/profile/","/").replace("/public/","/").split("/").slice(0,-1).join("/")+"/Settings/Preferences.ttl";return(0,vt.sym)(t)}(t);let a;try{a=await n.followOrCreateLink(t,r.space("preferencesFile"),i,t.doc())}catch(e){if(_(`User ${t} has no pointer in profile to preferences file.`),e instanceof Pt)throw e;if(e instanceof Bt)throw e;if(e instanceof It)throw e;if(e instanceof Lt)throw e;if(e instanceof Nt)throw e;if(e instanceof Ot)throw e;throw e}try{await e.fetcher.load(a)}catch(e){const n=`Unable to load preference of user ${t}: ${e}`;if(_(n),401===e.response.status)throw new It;if(403===e.response.status){if(At(a))throw new Lt;throw new Nt}throw new Error(n)}return a}async function o(t){if(!t)throw new Error("loadProfile: no user given.");try{await e.fetcher.load(t.doc())}catch(e){throw new Error(`Unable to load profile of user ${t}: ${e}`)}return t.doc()}function a(t){return e.any(t,r.space("storage"),void 0,t.doc())}return{loadMe:async function(){const n=t.currentUser();if(null===n)throw new Error("Current user not found! Not logged in?");return await e.fetcher.load(n.doc()),n},getPodRoot:function(e){const t=a(e);if(!t)throw new Error("User pod root not found!");return t},getMainInbox:async function(t){await e.fetcher.load(t);const n=e.any(t,r.ldp("inbox"),void 0,t.doc());if(!n)throw new Error("User main inbox not found!");return n},findStorage:a,loadPreferences:i,loadProfile:o,silencedLoadPreferences:async function(e){try{return await i(e)}catch(e){return}}}}function Ut(e,t,n,r){const i=wt;async function o(t){if(!t)throw new Error("loadTypeIndexesFor: No user given");const o=await n.loadProfile(t),a=l(t);let s;try{s=await r.followOrCreateLink(t,i.solid("publicTypeIndex"),a,o)}catch(e){_(`User ${t} has no pointer in profile to publicTypeIndex file.`)}const c=s?[{label:"public",index:s,agent:t}]:[];let d,p;try{d=await n.silencedLoadPreferences(t)}catch(e){d=null}if(d){const n=u(d);let a;try{a=e.any(t,i.solid("privateTypeIndex"),void 0,o)||await r.followOrCreateLink(t,i.solid("privateTypeIndex"),n,d)}catch(e){_(`User ${t} has no pointer in preference file to privateTypeIndex file.`)}p=a?[{label:"private",index:a,agent:t}]:[]}else p=[];const f=c.concat(p);if(0===f.length)return f;const h=f.map(e=>e.index);try{await e.fetcher.load(h)}catch(e){_("Problems loading type index: ",e)}return f}async function a(t){let r;try{r=await n.silencedLoadPreferences(t)}catch(e){_(`User ${t} has no pointer in profile to preferences file.`)}if(r){const n=e.each(t,i.solid("community"),void 0,r).concat(e.each(t,i.solid("community"),void 0,t.doc()));let a=[];for(const e of n)a=a.concat(await o(e));return a}return[]}async function s(e){return(await o(e)).concat((await a(e)).flat())}async function c(e,t){const n=await s(t);let r=[];for(const t of n){const n=await d(t,e);r=r.concat(n)}return r}function l(e){var t;return(0,vt.sym)((null===(t=e.doc().dir())||void 0===t?void 0:t.uri)+"publicTypeIndex.ttl")}function u(e){var t;return(0,vt.sym)((null===(t=e.doc().dir())||void 0===t?void 0:t.uri)+"privateTypeIndex.ttl")}async function d(t,n){const r=t.index,o=[],a=e.statementsMatching(null,i.solid("instance"),null,r).concat(e.statementsMatching(null,i.solid("instanceContainer"),null,r)).map(e=>e.subject);for(const s of a){const a=e.any(s,i.solid("forClass"),null,r);if(!n||a.sameTerm(n)){const n=e.each(s,i.solid("instance"),null,r);for(const e of n)o.push({instance:e,type:a,scope:t});const c=e.each(s,i.solid("instanceContainer"),null,r);for(const n of c)await e.fetcher.load(n),o.push({instance:(0,vt.sym)(n.value),type:a,scope:t})}}return o}return{registerInTypeIndex:async function(t,n,r){const o=kt(n),a=[(0,vt.st)(o,i.rdf("type"),i.solid("TypeRegistration"),n),(0,vt.st)(o,i.solid("forClass"),r,n),(0,vt.st)(o,i.solid("instance"),t,n)];try{await e.updater.update([],a)}catch(e){const r=`Unable to register ${t} in index ${n}: ${e}`;return console.warn(r),null}return o},getRegistrations:function(t,n){return e.each(void 0,i.solid("instance"),t).filter(t=>e.holds(t,i.solid("forClass"),n))},loadTypeIndexesFor:o,loadCommunityTypeIndexes:a,loadAllTypeIndexes:s,getScopedAppInstances:c,getAppInstances:async function(e){const n=t.currentUser();if(!n)throw new Error("getAppInstances: Must be logged in to find apps.");return(await c(e,n)).map(e=>e.instance)},suggestPublicTypeIndex:l,suggestPrivateTypeIndex:u,deleteTypeIndexRegistration:async function(t){const n=e.the(null,i.solid("instance"),t.instance,t.scope.index);if(!n)throw new Error(`deleteTypeIndexRegistration: No registration found for ${t.instance}`);const r=e.statementsMatching(n,null,null,t.scope.index);await e.updater.update(r,[])},getScopedAppsFromIndex:d}}function jt(e,t){A("SolidLogic: Unique instance created.  There should only be one of these.");const n=vt.graph();vt.fetcher(n,{fetch:e.fetch}),n.updater=new vt.UpdateManager(n),n.features=[];const r=new Ct(t),i=xt(n),o=function(e){function t(t){return e.statementsMatching(t,(0,vt.sym)("http://www.w3.org/ns/ldp#contains"),void 0).map(e=>e.object)}function n(e){const t=e.value;return"/"===t.charAt(t.length-1)}return{isContainer:n,createContainer:async function(t){if(!n((0,vt.sym)(t)))throw new Error(`Not a container URL ${t}`);const r=await e.fetcher._fetch(t,{method:"PUT",headers:{"Content-Type":"text/turtle","If-None-Match":"*",Link:'<http://www.w3.org/ns/ldp#BasicContainer>; rel="type"'},body:" "});if("2"!==r.status.toString()[0])throw new Error(`Not OK: got ${r.status} response while creating container at ${t}`)},getContainerElements:t,getContainerMembers:async function(n){return await e.fetcher.load(n),t(n)}}}(n),a=function(e,t,n){async function r(t){let n;try{n=await e.fetcher.load(t)}catch(n){if(404!==n.response.status){if(401===n.response.status)throw new It;if(403===n.response.status){if(At(t))throw new Lt;throw new Nt}const e="createIfNotExists doc load error NOT 404:  "+t+": "+n;throw new Ot(n.status,n.message+e)}try{await e.fetcher.webOperation("PUT",t,{data:"",contentType:"text/turtle"})}catch(e){throw new Bt("createIfNotExists: PUT FAILED: "+t+": "+e)}await e.fetcher.load(t)}return n}return{recursiveDelete:async function r(i){try{if(n.isContainer(i)){const o=await t.findAclDocUrl(i);await e.fetcher._fetch(o,{method:"DELETE"});const a=await n.getContainerMembers(i);await Promise.all(a.map(e=>r(e)))}const o=i.value;return e.fetcher._fetch(o,{method:"DELETE"})}catch(e){A(`Please manually remove ${i.value} from your system.`,e)}},setSinglePeerAccess:async function(n){let r=["@prefix acl: <http://www.w3.org/ns/auth/acl#>.","",`<#alice> a acl:Authorization;\n  acl:agent <${n.ownerWebId}>;`,`  acl:accessTo <${n.target}>;`,`  acl:default <${n.target}>;`,"  acl:mode acl:Read, acl:Write, acl:Control.",""].join("\n");n.accessToModes&&(r+=["<#bobAccessTo> a acl:Authorization;",`  acl:agent <${n.peerWebId}>;`,`  acl:accessTo <${n.target}>;`,`  acl:mode ${n.accessToModes}.`,""].join("\n")),n.defaultModes&&(r+=["<#bobDefault> a acl:Authorization;",`  acl:agent <${n.peerWebId}>;`,`  acl:default <${n.target}>;`,`  acl:mode ${n.defaultModes}.`,""].join("\n"));const i=await t.findAclDocUrl((0,vt.sym)(n.target));return e.fetcher._fetch(i,{method:"PUT",body:r,headers:[["Content-Type","text/turtle"]]})},createEmptyRdfDoc:async function(t,n){await e.fetcher.webOperation("PUT",t.uri,{data:`# ${new Date} ${n}\n  `,contentType:"text/turtle"})},followOrCreateLink:async function(t,n,i,o){await e.fetcher.load(o);const a=e.any(t,n,null,o);if(a)return a;if(!e.updater.editable(o)){const e=`followOrCreateLink: cannot edit ${o.value}`;throw _(e),new Pt(e)}try{await e.updater.update([],[(0,vt.st)(t,n,i,o)])}catch(e){throw _(`followOrCreateLink: Error making link in ${o} to ${i}: ${e}`),new Bt(e)}try{await r(i)}catch(e){throw _(`followOrCreateLink: Error loading or saving new linked document: ${i}: ${e}`),e}return i},loadOrCreateIfNotExists:r}}(n,i,o),s=Dt(n,r,a),c=St(n,s),l=Tt(n,s,a,o),u=Ut(n,r,s,a);return A("SolidAuthnLogic initialized"),{store:n,authn:r,acl:i,inbox:l,chat:c,profile:s,typeIndex:u,load:function(e){return n.fetcher.load(e)},updatePromise:function(e,t=[]){return new Promise((r,i)=>{n.updater.update(e,t,function(e,t,n){t?r():i(new Error(n))})})},clearStore:function(){n.statements.slice().forEach(n.remove.bind(n))}}}const Mt=async(e,t)=>{const n=t&&t.credentials&&"omit"==t.credentials;return gt.info.webId&&!n?gt.fetch(e,t):window.fetch(e,t)},Ft=Symbol.for("solid-logic-singleton"),Ht="undefined"!=typeof window?window:k.g;const Wt=(Ht[Ft]?A("SolidLogic: Using existing global singleton instance."):(A("SolidLogic: Creating new global singleton instance."),Ht[Ft]=jt({fetch:Mt},gt),A("Unique quadstore initialized.")),Ht[Ft]),$t=[{name:"Solid Community",uri:"https://solidcommunity.net"},{name:"Solid Web",uri:"https://solidweb.org"},{name:"Solid Web ME",uri:"https://solidweb.me"},{name:"Inrupt.com",uri:"https://login.inrupt.com"}];const Jt=Wt.authn,zt=Wt.authn.authSession,qt=Wt.store;var Kt=1,Vt=2,Gt=4,Qt=8,Zt=16,Yt=32,Xt=63,en=function(e){return e[e.Error=1]="Error",e[e.Warning=2]="Warning",e[e.Message=4]="Message",e[e.Success=8]="Success",e[e.Info=16]="Info",e[e.Debug=32]="Debug",e[e.All=63]="All",e}({}),tn=Kt+Vt+Gt,nn=!1,rn=document,on=window;function an(e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"mesg";if(tn&(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Gt))if(void 0!==rn){var n=rn.getElementById("status");if(!n)return;var r=rn.createElement("span");r.setAttribute("class",t);var i=new Date;r.innerHTML="".concat(i.getHours(),":").concat(i.getMinutes(),":").concat(i.getSeconds()," [").concat(t,"] ").concat(wn(e),"<br/>"),nn?n.insertBefore(r,n.firstChild):n.appendChild(r)}else"undefined"!=typeof console&&console.log(e)}function sn(e){an(e)}function cn(e){an(e,Vt,"warn")}function ln(e){an(e,Yt,"dbug")}function un(e){an(e,Zt,"info")}function dn(e){an(e,Kt,"eror")}function pn(e){an(e,Qt,"good")}function fn(e){on&&void 0!==on.alert?on.alert(e):cn(e)}function hn(){var e,t=null===(e=rn)||void 0===e?void 0:e.getElementById("status");t&&(t.innerHTML="")}function mn(e){tn=Xt,ln("Log level is now "+e),tn=e}function gn(){var e;if(rn){var t=tn;tn=Xt,ln((null===(e=rn)||void 0===e||null===(e=e.body)||void 0===e?void 0:e.innerHTML)||""),tn=t}}function vn(){nn=!0}function yn(){nn=!1}function wn(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function bn(e,t){on=e,rn=t}var xn={log:e,ns:v,rdf:m};function En(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(e){return t?e.slice(0,1).toUpperCase()+e.slice(1):e}function r(e){var t="";"/"===e.slice(-1)&&(e=e.slice(0,-1));for(var r=0;r<e.length;r++)"_"!==e[r]&&"-"!==e[r]?(t+=e[r],r+1<e.length&&e[r].toUpperCase()!==e[r]&&e[r+1].toLowerCase()!==e[r+1]&&(t+=" ")):t+=" ";return"has "===t.slice(0,4)&&(t=t.slice(4)),n(t)}var i=function(e){return qt.any(e,xn.ns.ui("label"))||qt.any(e,xn.ns.link("message"))||qt.any(e,xn.ns.vcard("fn"))||qt.any(e,xn.ns.foaf("name"))||qt.any(e,xn.ns.dct("title"))||qt.any(e,xn.ns.dc("title"))||qt.any(e,xn.ns.rss("title"))||qt.any(e,xn.ns.contact("fullName"))||qt.any(e,qt.sym("http://www.w3.org/2001/04/roadmap/org#name"))||qt.any(e,xn.ns.cal("summary"))||qt.any(e,xn.ns.foaf("nick"))||qt.any(e,xn.ns.as("name"))||qt.any(e,xn.ns.schema("name"))||qt.any(e,xn.ns.rdfs("label"))||qt.any(e,qt.sym("http://www.w3.org/2004/02/skos/core#prefLabel"))}(e);if(i)return n(i.value);if("BlankNode"===e.termType)return"...";if("Collection"===e.termType)return"("+e.elements.length+")";var o=e.uri;if(void 0===o)return e.toString();try{o=o.split("/").map(decodeURIComponent).join("/")}catch(e){for(var a=o.length-3;a>0;a--)for(var s="0123456789abcefABCDEF";"%"===o[a]&&s.indexOf(o[a+1])>=0&&s.indexOf(o[a+2])>=0;)o=o.slice(0,a)+String.fromCharCode(parseInt(o.slice(a+1,a+3),16))+o.slice(a+3)}o=Cn(o,"/profile/card#me"),o=Cn(o,"#this");var c=(o=Cn(o,"#me")).indexOf("#");if(c>=0)return r(o.slice(c+1));var l=o.lastIndexOf("/",o.length-2);return l>=0&&l<e.uri.length?r(o.slice(l+1)):n(decodeURIComponent(e.uri))}function Cn(e,t){var n=-1*t.length;return e.slice(n)===t?e.slice(0,n):e}var kn=o(423),An=Wt.store;function _n(e,t,n,r){var i=v.acl,o="/"===e.uri.slice(-1),a=An.each(void 0,i("default"),n,r).concat(An.each(void 0,i("defaultForNew"),n,r)).reduce(function(t,n){return t.concat(An.statementsMatching(n,v.rdf("type"),i("Authorization"),r)).concat(An.statementsMatching(n,i("agent"),void 0,r)).concat(An.statementsMatching(n,i("agentClass"),void 0,r)).concat(An.statementsMatching(n,i("agentGroup"),void 0,r)).concat(An.statementsMatching(n,i("origin"),void 0,r)).concat(An.statementsMatching(n,i("originClass"),void 0,r)).concat(An.statementsMatching(n,i("mode"),void 0,r)).concat((0,m.st)(n,i("accessTo"),e,r)).concat(o?(0,m.st)(n,i("default"),e,r):[])},[]),s=(0,m.graph)();return a.forEach(function(e){return s.add(c(e.subject),c(e.predicate),c(e.object),(0,m.sym)(t.uri))}),s;function c(e){var n=r.uri.length;return(0,m.sym)(e.uri.slice(0,n)===r.uri?t.uri+e.uri.slice(n):e.uri)}}function Sn(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:An,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?function(t,n){return t.each(void 0,n.acl("default"),e).concat(t.each(void 0,n.acl("defaultForNew"),e))}(n,v):n.each(void 0,v.acl("accessTo"),e),i=v.acl,o={agent:{},agentClass:{},agentGroup:{},origin:{},originClass:{}};return Object.keys(o).forEach(function(e){r.forEach(function(t){n.each(t,i("mode")).forEach(function(r){n.each(t,i(e)).forEach(function(n){o[e][n.uri]=o[e][n.uri]||{},o[e][n.uri][r.uri]=t})})})}),o}function Tn(e,t){var n=function(e,t){for(var n in{agent:!0,agentClass:!0,agentGroup:!0,origin:!0,originClass:!0})if(e[n])for(var r in e[n])for(var i in e[n][r])if(!t[n][r]||!t[n][r][i])return!1;return!0};return n(e,t)&&n(t,e)}function Rn(e){for(var t,n,r=e[0],i=function(i){["agent","agentClass","agentGroup","origin","originClass"].forEach(function(o){if((t=e[i])[o])for(n in t[o])for(var a in t[o][n])r[o][n]||(r[o][n]=[]),r[o][n][a]=!0})},o=1;o<e.length;o++)i(o);return r}function In(e,t){var n=[],r=function(e){e.length?jn(e.shift().doc(),function(i,o,a,s,c,l){var u=!o;if(!i||!c||!l)return t(i,s);var d=u?Sn(c,l):Sn(a,s);n.push(d),r(e.slice(1))}):t(!0,Rn(n))};r(e)}function Ln(e){var t={};return["agent","agentClass","agentGroup","origin","originClass"].forEach(function(n){for(var r in e[n]){var i=[];for(var o in e[n][r])i.push(o);i.sort();var a=i.join("\n");t[a]||(t[a]=[]),t[a].push([n,r])}}),t}function Nn(e,t,n,r){return Pn(e,t,Ln(n),r)}function Pn(e,t,n,r,i,o){var a=v.acl;for(var s in n){var c=n[s];if(c.length){var l=s.split("\n"),u=l.map(function(e){return e.split("#")[1]}).join("");o&&!i&&(u+="Default");var d=e.sym(r.uri+"#"+u);e.add(d,v.rdf("type"),a("Authorization"),r),i&&e.add(d,a("accessTo"),t,r),o&&e.add(d,a("default"),t,r);for(var p=0;p<l.length;p++)e.add(d,a("mode"),e.sym(l[p]),r);for(var f=0;f<c.length;f++){var h=c[f][0],m=c[f][1];e.add(d,a(h),e.sym(m),r)}}}}function Bn(e){var t="";for(var n in e){t+=n.split("\n").map(function(e){return e.split("#")[1][0]}).join("")+":";for(var r=e[n],i=0;i<r.length;i++){var o=r[i][0],a=(0,m.sym)(r[i][1]);t+="agent"===o?"@":"",t+=a.sameTerm(v.foaf("Agent"))?"*":En(a),i<r.length-1&&(t+=",")}t+=";"}return"{"+t.slice(0,-1)+"}"}function On(e,t,n,r,i){return Dn(e,t,Ln(n),r,i)}function Dn(e,t,n,r,i){var o,a=(0,m.graph)();Pn(a,t,n,r,!0),null===(o=e.updater)||void 0===o||o.put(r,a.statementsMatching(void 0,void 0,void 0,r),"text/turtle",function(o,a,s){var c;a?(null===(c=e.fetcher)||void 0===c||c.unload(r),Pn(e,t,n,r,!0),e.fetcher.requested[r.uri]="done",i(a)):i(a,s)})}function Un(e,t,n,r){n=n||kn.Rm;var i=e.doc();jn(i,function(o,a,s,c,l,u){if(!o||!l||!u)return r(!1,c);var d=a?Sn(s,c):Sn(l,u);In(t,function(t,o){if(!t)return r(!1,o);Tn(o,d)?n("Nice - same ACL. no change "+En(e)+" "+i):(n("Group ACLs differ for "+En(e)+" "+i),On(An,s,o,c,r))})})}function jn(e,t){Mn(e,function(n,r,i,o){var a=v.acl;if(!n)return t(!1,!1,r,o);var s=function(n){"/"===n.slice(-1)&&(n=n.slice(0,-1));var r=n.lastIndexOf("/");if(n.indexOf("/",n.indexOf("//")+2)>r)return t(!1,!0,404,"Found no ACL resource");n=n.slice(0,r+1);var o=(0,m.sym)(n);Mn(o,function(r,c,l){if(!r)return t(!1,!0,c,"( No ACL pointer ".concat(n," ").concat(c,")").concat(l));if(403===c)return t(!1,!0,c,"( default ACL file FORBIDDEN. Stop.".concat(n,")"));if(404===c)return s(n);if(200!==c)return t(!1,!0,c,"Error status '".concat(c,"' searching for default for ").concat(o));if(!An.each(void 0,a("default"),An.sym(n),l).concat(An.each(void 0,a("defaultForNew"),An.sym(n),l)).length)return s(n);var u=An.sym(n);return t(!0,!1,e,i,u,l)})};return n?404!==r?403===r?t(!1,!1,r,"(Sharing not available to you)".concat(o)):200!==r?t(!1,!1,r,"Error ".concat(r," accessing Access Control information for ").concat(e,": ").concat(o)):t(!0,!0,e,i):void s(e.uri):t(!1,!1,r,"Error accessing Access Control information for ".concat(e,") ").concat(o))})}function Mn(e,t){if(!An.fetcher)throw new Error("kb has no fetcher");An.fetcher.nowOrWhenFetched(e,void 0,function(n,r){if(!n)return t(n,"Can't get headers to find ACL for ".concat(e,": ").concat(r));var i=An.any(e,bt);if(i){if(!An.fetcher)throw new Error("kb has no fetcher");if(An.fetcher.nonexistent[i.value])return t(!0,404,i,"ACL file ".concat(i," does not exist."));An.fetcher.nowOrWhenFetched(i,void 0,function(e,n,r){e?t(!0,200,i):t(!0,r.status,i,"Can't read Access Control File ".concat(i,": ").concat(n))})}else t(!1,900,"No Link rel=ACL header for ".concat(e))})}function Fn(e){return Hn.apply(this,arguments)}function Hn(){return(Hn=w(x().mark(function e(t){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){return jn((0,m.sym)(t),function(r,i,o,a,s){return r?e(i?o:s):n(new Error("Error loading ".concat(t)))})}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Wn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $n(e){return $n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$n(e)}function Jn(e){var t=function(e,t){if("object"!=$n(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=$n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==$n(t)?t:t+""}function zn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Jn(r.key),r)}}function qn(e,t,n){return t&&zn(e.prototype,t),n&&zn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Kn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Vn(e,t){if(e){if("string"==typeof e)return Kn(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Kn(e,t):void 0}}function Gn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],c=!0,l=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw i}}return s}}(e,t)||Vn(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}for(var Qn={jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp",svg:"image/svg+xml",ico:"image/x-icon",bmp:"image/bmp",tiff:"image/tiff",tif:"image/tiff",avif:"image/avif",pdf:"application/pdf",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",odt:"application/vnd.oasis.opendocument.text",ods:"application/vnd.oasis.opendocument.spreadsheet",txt:"text/plain",html:"text/html",htm:"text/html",css:"text/css",csv:"text/csv",xml:"text/xml",md:"text/markdown",markdown:"text/markdown",js:"text/javascript",mjs:"text/javascript",ts:"text/typescript",json:"application/json",jsonld:"application/ld+json",ttl:"text/turtle",n3:"text/n3",nt:"application/n-triples",nq:"application/n-quads",rdf:"application/rdf+xml",trig:"application/trig",mp3:"audio/mpeg",wav:"audio/wav",ogg:"audio/ogg",oga:"audio/ogg",m4a:"audio/mp4",flac:"audio/flac",aac:"audio/aac",weba:"audio/webm",mp4:"video/mp4",m4v:"video/mp4",webm:"video/webm",ogv:"video/ogg",avi:"video/x-msvideo",mov:"video/quicktime",mkv:"video/x-matroska",zip:"application/zip",gz:"application/gzip",tar:"application/x-tar",rar:"application/vnd.rar","7z":"application/x-7z-compressed",woff:"font/woff",woff2:"font/woff2",ttf:"font/ttf",otf:"font/otf",eot:"application/vnd.ms-fontobject",wasm:"application/wasm",bin:"application/octet-stream"},Zn={},Yn=0,Xn=Object.entries(Qn);Yn<Xn.length;Yn++){var er=Gn(Xn[Yn],2),tr=er[0],nr=er[1];Zn[nr]||(Zn[nr]=tr)}function rr(e){var t,n=null===(t=e.split(".").pop())||void 0===t?void 0:t.toLowerCase();return n&&Qn[n]||!1}function ir(e){var t=e.split(";")[0].trim().toLowerCase();return Zn[t]||!1}const or={highlightColor:"#7C4DFF",formBorderColor:"#888888",formHeadingColor:"#888888",lowProfileLinkColor:"#3B5998",formFieldNameBoxWidth:"8em",mediaModuleCanvasWidth:"640",mediaModuleCanvasHeight:"480",textInputSize:20,tabBorderRadius:"0.2em",textInputBackgroundColor:"#eef",textInputBackgroundColorUneditable:"#fff",textInputColor:"#000",textInputColorPending:"#888",defaultErrorBackgroundColor:"#fee",participationDefaultBackground:"white",basicMaxLength:"4096"};var ar={checkboxStyle:"color: black; font-size: 100%; padding-left: 0.5 em; padding-right: 0.5 em;",checkboxInputStyle:"font-size: 150%; height: 1.2em; width: 1.2em; background-color: #eef; border-radius:0.2em; margin: 0.1em;",fieldLabelStyle:"color: #3B5998; text-decoration: none;",formSelectStyle:"background-color: #eef; padding: 0.5em;  border: .05em solid #88c; border-radius:0.2em; font-size: 100%; margin:0.4em;",textInputStyle:"background-color: #eef; padding: 0.5em;  border: .05em solid #88c; border-radius:0.2em; font-size: 100%; margin:0.4em;",textInputStyleUneditable:"background-color: white; padding: 0.5em;  border: .05em solid white; border-radius:0.2em; font-size: 100%; margin:0.4em;",buttonStyle:"background-color: #fff; padding: 0.7em;  border: .01em solid white; border-radius:0.2em; font-size: 100%; margin: 0.3em;",commentStyle:"padding: 0.7em;  border: none; font-size: 100%; white-space: pre-wrap;",iconStyle:"width: 3em; height: 3em; margin: 0.1em; border-radius: 1em;",smallButtonStyle:"margin: 0.2em; width: 1em; height:1em;",classIconStyle:"width: 3em; height: 3em; margin: 0.1em; border-radius: 0.2em; border: 0.1em solid green; padding: 0.2em; background-color: #efe;",confirmPopupStyle:"padding: 0.7em; border-radius: 0.2em; border: 0.1em solid orange; background-color: white; box-shadow: 0.5em 0.9em #888;",messageBodyStyle:"white-space: pre-wrap; width: 99%; font-size:100%; border: 0.07em solid #eee; border-radius:0.2em; padding: .3em 0.5em; margin: 0.1em;",pendingeditModifier:"color: #bbb;",personaBarStyle:"width: 100%; height: 4em; background-color: #eee; vertical-align: middle;",searchInputStyle:"border: 0.1em solid #444; border-radius: 0.2em; width: 100%; font-size: 100%; padding: 0.1em 0.6em; margin 0.2em;",autocompleteRowStyle:"border: 0.2em solid straw;",signInAndUpButtonStyle:"padding: 1em; border-radius:0.2em; font-size: 100%;",headerBannerLoginInput:"margin: 0.75em 0 0.75em 0.5em !important; padding: 0.5em !important;",signUpBackground:"background-color: #eef;",signInBackground:"background-color: #efe;",heading1Style:"font-size: 180%; font-weight: bold; color: #888888; padding: 0.5em; margin: 0.7em 0.0m;",heading2Style:"font-size: 130%; font-weight: bold; color: #888888; padding: 0.4em; margin: 0.7em 0.0em;",heading3Style:"font-size: 120%; font-weight: bold; color: #888888; padding: 0.3em; margin: 0.7em 0.0em;",heading4Style:"font-size: 110%; font-weight: bold; color: #888888; padding: 0.2em; margin: 0.7em 0.0em;",formHeadingStyle:"font-size: 110%; font-weight: bold; color: #888888; padding: 0.2em;  margin: 0.7em 0.0em;",formTextInput:"font-size: 100%; margin: 0.1em; padding: 0.1em;",formGroupStyle:["padding-left: 0em; border: 0.0em solid ".concat(or.formBorderColor,"; border-radius: 0.2em;"),"padding-left: 2em; border: 0.05em solid ".concat(or.formBorderColor,"; border-radius: 0.2em;"),"padding-left: 2em; border: 0.1em solid ".concat(or.formBorderColor,"; border-radius: 0.2em;"),"padding-left: 2em; border: 0.2em solid ".concat(or.formBorderColor,"; border-radius: 0.2em;")],formFieldLabelStyle:"color: ".concat(or.lowProfileLinkColor,"; text-decoration: none;"),formFieldNameBoxStyle:"padding: 0.3em; vertical-align: middle; width:".concat(or.formFieldNameBoxWidth,";"),multilineTextInputStyle:"font-size:100%; white-space: pre-wrap; background-color: #eef; border: 0.07em solid gray; padding: 1em 0.5em; margin: 1em 1em;",renderAsDivStyle:"display: flex; align-items: center; justify-content: space-between; height: 2.5em; padding: 1em;",imageDivStyle:"width:2.5em; padding:0.5em; height: 2.5em;",linkDivStyle:"width:2em; padding:0.5em; height: 4em;",aclControlBoxContainer:"margin: 1em;",aclControlBoxHeader:"font-size: 120%; margin: 0 0 1rem;",aclControlBoxStatus:"display: none; margin: 1rem 0;",aclControlBoxStatusRevealed:"display: block;",aclGroupContent:"maxWidth: 650;",accessGroupList:"display: grid; grid-template-columns: 1fr; margin: 1em; width: 100%;",accessGroupListItem:"display: grid; grid-template-columns: 100px auto 30%;",defaultsController:"display: flex;",defaultsControllerNotice:"color: #888; flexGrow: 1; fontSize: 80%;",bigButton:"background-color: white; border: 0.1em solid #888; border-radius: 0.3em; max-width: 50%; padding-bottom: 1em; padding-top: 1em;",group:"color: #888;",group1:"color: green;",group2:"color: #cc0;",group3:"color: orange;",group5:"color: red;",group9:"color: blue;",group13:"color: purple;",trustedAppAddApplicationsTable:"background-color: #eee;",trustedAppCancelButton:"float: right;",trustedAppControllerI:"border-color: orange; border-radius: 1em; border-width: 0.1em;",temporaryStatusInit:"background: green;",temporaryStatusEnd:"background: transparent; transition: background 5s linear;",headerUserMenuLink:"background: none; border: 0; color: black; cursor: pointer; display: block; font-family: Arial; font-size: 1em; text-align: left; padding: 1em;  width: 100%; text-decoration: none;",headerUserMenuLinkHover:"background: none; border: 0; color: black; cursor: pointer; display: block; font-family: Arial; font-size: 1em; text-align: left; padding: 1em;  width: 100%; text-decoration: none; background-image: linear-gradient(to right, #7C4DFF 0%, #18A9E6 50%, #01C9EA 100%);",headerUserMenuTrigger:"background: none; border: 0; cursor: pointer; width: 60px; height: 60px;",headerUserMenuTriggerImg:"border-radius: 50%; height: 56px; width: 28px !important;",headerUserMenuButton:"background: none; border: 0; color: black; cursor: pointer; display: block; font-family: Arial; font-size: 1em; text-align: left; padding: 1em; width: 100%;",headerUserMenuButtonHover:"background: none; border: 0; color: black; cursor: pointer; display: block; font-family: Arial; font-size: 1em; text-align: left; padding: 1em; width: 100%; background-image: linear-gradient(to right, #7C4DFF 0%, #18A9E6 50%, #01C9EA 100%);",headerUserMenuList:"list-style: none; margin: 0; padding: 0;",headerUserMenuListDisplay:"list-style: none; margin: 0; padding: 0; display:true;",headerUserMenuNavigationMenu:"background: white; border: solid 1px #000000; border-right: 0; position: absolute; right: 0; top: 60px; width: 200px; z-index: 1; display: true;",headerUserMenuNavigationMenuNotDisplayed:"background: white; border: solid 1px #000000; border-right: 0; position: absolute; right: 0; top: 60px; width: 200px; z-index: 1; display: none;",headerUserMenuListItem:"border-bottom: solid 1px #000000;",headerUserMenuPhoto:"border-radius: 50%; background-position: center; background-repeat: no-repeat; background-size: cover; height: 50px; width: 50px;",headerBanner:"box-shadow: 0px 1px 4px #000000; display: flex; justify-content: space-between; padding: 0 1.5em; margin-bottom: 4px;",headerBannerLink:"display: block;",headerBannerRightMenu:"display: flex;",headerBannerLogin:"margin-left: auto;",allChildrenVisible:"display:true;",headerBannerUserMenu:"border-left: solid 1px #000000; margin-left: auto;",headerBannerHelpMenu:"border-left: solid 1px #000000; margin-left: auto;",headerBannerIcon:"background-size: 65px 60px !important; height: 60px !important; width: 65px !important;",footer:"border-top: solid 1px $divider-color; font-size: 0.9em; padding: 0.5em 1.5em;",primaryButton:"background-color: #7c4dff; color: #ffffff; font-family: Raleway, Roboto, sans-serif; border-radius: 0.25em; border-color: #7c4dff; border: 1px solid; cursor: pointer; font-size: .8em; text-decoration: none; padding: 0.5em 4em; transition: 0.25s all ease-in-out; outline: none;",primaryButtonHover:"background-color: #9f7dff; color: #ffffff; font-family: Raleway, Roboto, sans-serif;border-radius: 0.25em; border-color: #7c4dff; border: 1px solid; cursor: pointer; font-size: .8em; text-decoration: none; padding: 0.5em 4em; transition: 0.25s all ease-in-out; outline: none; transition: 0.25s all ease-in-out;",primaryButtonNoBorder:"background-color: #ffffff; color: #7c4dff; font-family: Raleway, Roboto, sans-serif;border-radius: 0.25em; border-color: #7c4dff; border: 1px solid; cursor: pointer; font-size: .8em; text-decoration: none; padding: 0.5em 4em; transition: 0.25s all ease-in-out; outline: none;",primaryButtonNoBorderHover:"background-color: #7c4dff; color: #ffffff; font-family: Raleway, Roboto, sans-serif; border-radius: 0.25em; border-color: #7c4dff; border: 1px solid; cursor: pointer; font-size: .8em; text-decoration: none; padding: 0.5em 4em; transition: 0.25s all ease-in-out; outline: none; transition: 0.25s all ease-in-out;",secondaryButton:"background-color: #01c9ea; color: #ffffff; font-family: Raleway, Roboto, sans-serif;border-radius: 0.25em; border-color: #01c9ea; border: 1px solid; cursor: pointer; font-size: .8em; text-decoration: none; padding: 0.5em 4em; transition: 0.25s all ease-in-out; outline: none;",secondaryButtonHover:"background-color: #37cde6; color: #ffffff; font-family: Raleway, Roboto, sans-serif;border-radius: 0.25em; border-color: #7c4dff; border: 1px solid; cursor: pointer; font-size: .8em; text-decoration: none; padding: 0.5em 4em; transition: 0.25s all ease-in-out; outline: none; transition: 0.25s all ease-in-out;",secondaryButtonNoBorder:"background-color: #ffffff; color: #01c9ea; font-family: Raleway, Roboto, sans-serif; border-radius: 0.25em; border-color: #01c9ea; border: 1px solid; cursor: pointer; font-size: .8em; text-decoration: none; padding: 0.5em 4em; transition: 0.25s all ease-in-out; outline: none;",secondaryButtonNoBorderHover:"background-color: #01c9ea; color: #ffffff; font-family: Raleway, Roboto, sans-serif; border-radius: 0.25em; border-color: #01c9ea; border: 1px solid; cursor: pointer; font-size: .8em; text-decoration: none; padding: 0.5em 4em; transition: 0.25s all ease-in-out; outline: none; transition: 0.25s all ease-in-out;",controlStyle:"border-radius: 0.5em; margin: 0.8em; width:".concat(or.mediaModuleCanvasWidth,"; height:").concat(or.mediaModuleCanvasHeight,";"),dragEvent:"background-color: #ccc; border: 0.25em dashed black; border-radius: 0.3em;",dropEvent:"background-color: white; border: 0em solid black;",restoreStyle:"background-color: white;",errorCancelButton:"width: 2em; height: 2em; align: right;",errorMessageBlockStyle:"margin: 0.1em; padding: 0.5em; border: 0.05em solid gray; color:black;",notepadStyle:"padding: 1em; overflow: auto; resize: horizontal; min-width: 40em;",upstreamStatus:"width: 50%;",downstreamStatus:"width: 50%;",baseStyle:"font-size: 100%; font-family: monospace; width: 100%; border: none; white-space: pre-wrap;",headingCore:"font-family: sans-serif; font-weight: bold;  border: none;",headingStyle:["font-size: 110%; padding-top: 0.5em; padding-bottom: 0.5em; width: 100%;","font-size: 120%; padding-top: 1em; padding-bottom: 1em; width: 100%;","font-size: 150%; padding-top: 1em; padding-bottom: 1em; width: 100%;"],participantsStyle:"margin: 0.8em;",participantsBlock:"height: 1.5em; width: 1.5em; margin: 0.3em; border 0.01em solid #888;",personTableTD:"vertical-align: middle;",tabsNavElement:"margin: 0;",tabsRootElement:"display: flex; height: 100%; width: 100%;",tabsMainElement:"margin: 0; width:100%; height: 100%;",tabContainer:"list-style-type: none; display: flex; height: 100%; width: 100%; margin: 0; padding: 0;",makeNewSlot:"background: none; border: none; font: inherit; cursor: pointer;",ellipsis:"position: absolute; right: 0; bottom: 0; width: 20%; background: none; color: inherit; border: none; padding: 0; font: inherit; cursor: pointer; outline: inherit;"};function sr(e,t,n){var r=function(e){e.preventDefault(),e.dataTransfer.dropEffect="copy"},i=function(e){kn.Rm("dragenter event dropEffect: "+e.dataTransfer.dropEffect),this.localStyle&&(this.savedStyle||(this.savedStyle=ar.dragEvent)),e.dataTransfer.dropEffect="link",kn.Rm("dragenter event dropEffect 2: "+e.dataTransfer.dropEffect)},o=function(e){kn.Rm("dragleave event dropEffect: "+e.dataTransfer.dropEffect),this.savedStyle?this.localStyle=this.savedStyle:this.localStyle=ar.dropEvent},a=function(e){e.preventDefault&&e.preventDefault(),kn.Rm("Drop event. dropEffect: "+e.dataTransfer.dropEffect),kn.Rm("Drop event. types: "+(e.dataTransfer.types?e.dataTransfer.types.join(", "):"NOPE"));var r,i=null;if(e.dataTransfer.types){for(var o=0;o<e.dataTransfer.types.length;o++){var a=e.dataTransfer.types[o];if("text/uri-list"===a)i=e.dataTransfer.getData(a).split("\n"),kn.Rm("Dropped text/uri-list: "+i);else if("text/plain"===a)r=e.dataTransfer.getData(a);else if("Files"===a&&n){for(var s=e.dataTransfer.files,c=0;s[c];c++){var l=s[c];kn.Rm("Filename: "+l.name+", type: "+(l.type||"n/a")+" size: "+l.size+" bytes, last modified: "+(l.lastModifiedDate?l.lastModifiedDate.toLocaleDateString():"n/a"))}n(s)}}null===i&&r&&"http"===r.slice(0,4)&&(i=r,kn.Rm("Waring: Poor man's drop: using text for URI"))}else i=[e.dataTransfer.getData("Text")],kn.Rm("WARNING non-standard drop event: "+i[0]);return kn.Rm("Dropped URI list (2): "+i),i&&t(i),this.localStyle=ar.restoreStyle,!1};!function(e){e||kn.Rm("@@@ addTargetListeners: ele "+e),e.addEventListener("dragover",r),e.addEventListener("dragenter",i),e.addEventListener("dragleave",o),e.addEventListener("drop",a)}(e)}function cr(e,t){e.setAttribute("draggable","true"),e.addEventListener("dragstart",function(n){e.style.fontWeight="bold",n.dataTransfer.setData("text/uri-list",t.uri),n.dataTransfer.setData("text/plain",t.uri),n.dataTransfer.setData("text/html",e.outerHTML),kn.Rm("Dragstart: "+e+" -> "+t+"de: "+n.dataTransfer.dropEffect)},!1),e.addEventListener("drag",function(e){e.preventDefault(),e.stopPropagation()},!1),e.addEventListener("dragend",function(n){e.style.fontWeight="normal",kn.Rm("Dragend dropeffect: "+n.dataTransfer.dropEffect),kn.Rm("Dragend: "+e+" -> "+t)},!1)}function lr(e,t,n,r,i){for(var o=0;t[o];o++){var a=t[o];kn.Rm(" dropped: Filename: "+a.name+", type: "+(a.type||"n/a")+" size: "+a.size+" bytes, last modified: "+(a.lastModifiedDate?a.lastModifiedDate.toLocaleDateString():"n/a"));var s=new FileReader;s.onload=function(t){return function(o){var a=o.target.result,s="";kn.Rm(" File read byteLength : "+a.byteLength);var c=t.type;if(t.type&&""!==t.type){var l=ir(t.type);l&&"false"!==l&&!t.name.endsWith("."+l)&&t.type!==rr(t.name)&&(s="_."+l)}else if(!(c=rr(t.name))){var u="Filename needs to have an extension which gives a type we know: "+t.name;throw kn.Rm(u),alert(u),new Error(u)}var d=t.type.startsWith("image/")&&r||n,p=d+(d.endsWith("/")?"":"/")+encodeURIComponent(t.name)+s;e.webOperation("PUT",p,{data:a,contentType:c}).then(function(e){kn.Rm(" Upload: put OK: "+p),i(t,p)},function(e){var t=" Upload: FAIL "+p+", Error: "+e;throw kn.Rm(t),alert(t),new Error(t)})}}(a),s.readAsArrayBuffer(a)}}ar.setStyle=function(e,t){e.style=ar[t]};var ur,dr=o(378),pr={log:e,ns:v,rdf:m},fr=0;function hr(){return"v"+fr++}function mr(){fr=0}function gr(){if(ur){var e=new ur;return function(t,n,r,i){t=+(t||.3),r=r||"sine","function"!=typeof i&&(i=function(){});var o=e.createOscillator();o.type=r,o.frequency.value=n||256,o.connect(e.destination),o.start(0),o.stop(t)}}}function vr(e){e=e.uri||e;var t;return"#"+(16777215&(t=e,t.split("").reduce(function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e},0))|12632256).toString(16)}function yr(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function wr(e,t,n){var r,i,o;for(o=0;o<e.children.length;o++)(i=e.children[o]).trashMe=!0;for(var a=0;a<t.length;a++){var s=t[a];for(r=!1,o=0;o<e.children.length;o++)if((i=e.children[o]).subject&&i.subject.sameTerm(s)){i.trashMe=!1,r=!0;break}if(!r){var c=n(s);if(a>=e.children.length)e.appendChild(c);else{var l=e.children[a];e.insertBefore(c,l)}c.subject=s}}for(o=0;o<e.children.length;o++)(i=e.children[o]).trashMe&&e.removeChild(i)}function br(e,t,n){for(var r={},i=0;i<e.children.length;i++){var o=e.children[i];r[o.subject.toNT()]=o}for(var a=0;a<t.length;a++){var s=t[a];if(a>=e.children.length){var c=n(s);c.subject=s,e.appendChild(c)}else{var l=e.children[a];if(l.subject.sameTerm(s));else{var u=r[s.toNT()];if(u)e.removeChild(u),e.insertBefore(u,l);else{var d=n(s);l.before(d),d.subject=s}}}}for(;e.children.length>t.length;)e.removeChild(e.children[e.children.length-1])}function xr(e){var t,n=e+"\n";if(!e.stack)return n+"No stack available.\n";var r=e.stack.toString().split("\n"),i=[];for(t=0;t<r.length;t++){var o=r[t];if(o.indexOf("ecmaunit.js")>-1)break;"("===o.charAt(0)&&(o="function"+o);var a=o.split("@");i.push(a)}for(t=0;t<i.length;t++)n+="  "+i[t][1]+"\n    "+i[t][0];return n}function Er(e){for(var t=e.childNodes,n=t.length-1;n>=0;n--)e.removeChild(t[n]);return e}function Cr(e){var t;return(e=e||window.event).target?t=e.target:e.srcElement&&(t=e.srcElement),3===t.nodeType&&(t=t.parentNode),t}function kr(e,t){var n;for(n=e;n;n=n.parentNode)try{if(n.tagName===t)return n}catch(e){return}}function Ar(e,t){var n,r;for(n=t;n&&1===n.nodeType;n=n.parentNode)if(r=n.getAttribute("about"))return e.fromNT(r);pr.log.debug("getAbout: No about found")}function _r(e){var t=e.parentNode,n=t?t.AJAR_statement:void 0;switch(n?e.className:""){case"pred":case"pred selected":return n.predicate;case"obj":case"obj selected":return t.AJAR_inverse?n.subject:n.object;case"":case"selected":return Ar(qt,e);case"undetermined selected":return e.nextSibling?n.predicate:t.AJAR_inverse?n.subject:n.object}}function Sr(e,t){var n=e.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",t),n}function Tr(e){var t=window.onload;"function"!=typeof window.onload?window.onload=e:window.onload=function(){t(),e()}}function Rr(e){var t=e.ownerDocument.documentElement.getBoundingClientRect(),n=e.getBoundingClientRect();return[n.left-t.left,n.top-t.top]}function Ir(e,t,n,r){r||(r=window);var i=Rr(e)[1],o=window.SolidAppContext||{},a=i-(o&&o.scroll||52)-r.scrollY;if(t)return n?void r.scrollBy(0,i+e.clientHeight-(r.scrollY+r.innerHeight)):void r.scrollBy(0,a);var s=r.setInterval(function(){r.scrollBy(0,a/10),10===++c&&r.clearInterval(s)},50),c=0}function Lr(e,t,n,r){r||(r=document);var i=r.createElement("img");return i.setAttribute("src",e),i.addEventListener("copy",function(e){e.clipboardData.setData("text/plain",""),e.clipboardData.setData("text/html",""),e.preventDefault()}),void 0!==n&&i.setAttribute("title",n),i}function Nr(e){var t=e;"#/".indexOf(t[t.length-1])>=0&&(t=t.slice(0,-1));var n,r=[];for(var i in this.prefixes)r[this.prefixes[i]]=i;var o,a=function(e){return"ns"!==e&&(n=e,!0)},s=t.lastIndexOf("#");for(s>=0&&(t=t.slice(s-1));;){var c=t.lastIndexOf("/");for(c>=0&&(t=t.slice(c+1)),o=0;o<t.length&&this.prefixchars.indexOf(t[o]);)o++;if((t=t.slice(0,o)).length<6&&a(t))return n;if(a(t.slice(0,3)))return n;if(a(t.slice(0,2)))return n;if(a(t.slice(0,4)))return n;if(a(t.slice(0,1)))return n;if(a(t.slice(0,5)))return n;for(o=0;;o++)if(a(t.slice(0,3)+o))return n}}function Pr(e){if(void 0===e.uri)return"??";var t,n=e.uri,r=[],i=n.lastIndexOf("#");if(i>=0)n=n.slice(0,i+1);else{if(!((i=n.lastIndexOf("/"))>=0))return e.uri+"?!";n=n.slice(0,i+1)}for(var o in pr.ns)r[pr.ns[o]]=o;try{return r[n]}catch(e){}for(n=n.slice(0,-1);n;){if(!((i=n.lastIndexOf("/"))>=0))return e.uri+"!?";if(t=n.slice(i+1),n=n.slice(0,i),"ns"!==t&&"0123456789".indexOf(t[0])<0)return t}}function Br(e,t){var n=qt.findTypeURIs(e);return n[pr.ns.rdf("Predicate").uri]||n[pr.ns.rdfs("Class").uri]?En(e,t)+" ("+Pr(e)+")":En(e,t)}function Or(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;")}function Dr(e){return Or(En(e))}function Ur(e,t){return Or(jr(e,t))}function jr(e,t){var n=En(e);if(t){var r=qt.any(e,pr.ns.owl("inverseOf"))||qt.any(void 0,pr.ns.owl("inverseOf"),e);return r?En(r):"type"===n?"...":"is "+n+" of"}return n}function Mr(e,t){var n=e.predicate.compareTerm(t.predicate);return 0!==n?n:e.object.compareTerm(t.object)}function Fr(e,t){var n=e.predicate.compareTerm(t.predicate);return 0!==n?n:e.subject.compareTerm(t.subject)}function Hr(e){for(var t=e;;){if(t.getAttribute("predTR"))return t;if(!t.previousSibling||"TR"!==t.previousSibling.nodeName)return pr.log.error("Could not find predParent"),e;t=t.previousSibling}}function Wr(e,t,n,r){var i=e.createElement("div"),o=r||t instanceof Error?t:null;return o?(console.error("errorMessageBlock: ".concat(o," at: ").concat(o.stack||"??"),o),i.textContent=o.message):i.textContent=t,i.appendChild(mi(e,function(){i.parentNode&&i.parentNode.removeChild(i)})).style=ar.errorCancelButton,i.setAttribute("style",ar.errorMessageBlockStyle),i.style.backgroundColor=n||or.defaultErrorBackgroundColor,i}"undefined"!=typeof AudioContext?ur=AudioContext:"undefined"!=typeof window&&(ur=window.AudioContext||window.webkitAudioContext);var $r=function(e,t,n){var r=e.createElement("tr");return r.appendChild(e.createElement("td")).appendChild(t),r.subject=n,r},Jr=function(e,t){e.addEventListener("click",t)},zr=function(e,t,n){var r=t.appendChild(e.createElement("div"));r.setAttribute("style",ar.imageDivStyle),r.appendChild(n),n.setAttribute("draggable","false")};function qr(e,t,n){var r=e.createElement("a");r.setAttribute("href",t.uri),t.uri.startsWith("http")&&r.setAttribute("target","_blank");var i=r.appendChild(e.createElement("img"));return i.setAttribute("src",n||dr.i1+"go-to-this.png"),i.setAttribute("style","margin: 0.3em;"),r}var Kr=function(e,t,n){var r=qr(e,n);t.appendChild(r).classList.add("HoverControlHide"),t.appendChild(e.createElement("br"))},Vr=dr.Pt.iconBase,Gr=Vr+"noun_1180156.svg",Qr=Vr+"noun_1180158.svg";function Zr(e,t){if(t){var n=function(e){var t=e&&e.statusArea||e&&e.div||null;if(t)return t;var n=e&&e.dom;if(n||"undefined"==typeof document||(n=document),n){var r=n.getElementsByTagName("body")[0];return t=n.createElement("div"),r.insertBefore(t,r.firstElementChild),e&&(e.statusArea=t),t}return null}(e);kn.Rm("Complaint: "+t),n?n.appendChild(Wr(e&&e.dom||document,t)):alert(t)}}function Yr(e){for(;e.firstChild;)e.removeChild(e.firstChild);return e}function Xr(e){var t=e.search(/logFile=/),n=e.search(/&rulesFile=/);return e.substring(t+8,n)}function ei(e,t){if(!e)return"???";try{var n=(new Date).toISOString();return e.slice(0,10)!==n.slice(0,10)||t?e.slice(0,4)===n.slice(0,4)?["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(e.slice(5,7),10)-1]+" "+parseInt(e.slice(8,10),10):e.slice(0,10):e.slice(11,16)}catch(e){return"shortdate:"+e}}function ti(e,t){return t.split("{").map(function(t){var n=t.split("}")[0];return t?("000"+(e["get"+n]()+({Month:1}[n]||0))).slice(-({Milliseconds:3,FullYear:4}[n]||2))+t.split("}")[1]:""}).join("")}function ni(){return ti(new Date,"{FullYear}-{Month}-{Date}T{Hours}:{Minutes}:{Seconds}.{Milliseconds}")}function ri(){return ti(new Date,"{Hours}:{Minutes}:{Seconds}.{Milliseconds}")}function ii(e,t){var n=qt,r=function(e){var t=n.any(e,v.vcard("fn"))||n.any(e,v.foaf("name"))||n.any(e,v.vcard("organization-name"));return t?t.value:null},i=t.sameTerm(v.foaf("Agent"))?"Everyone":r(t);if(e.textContent=i||En(t),!i&&t.uri){if(!n.fetcher)throw new Error("kb has no fetcher");n.fetcher.nowOrWhenFetched(t.doc(),void 0,function(n){e.textContent=r(t)||En(t)})}}function oi(e,t){return t.each(e,v.sioc("avatar")).concat(t.each(e,v.foaf("img"))).concat(t.each(e,v.vcard("logo"))).concat(t.each(e,v.vcard("hasPhoto"))).concat(t.each(e,v.vcard("photo"))).concat(t.each(e,v.foaf("depiction")))}var ai={"solid:AppProviderClass":"noun_144.svg","solid:AppProvider":"noun_15177.svg","solid:Pod":"noun_Cabinet_1434380.svg","vcard:Group":"noun_339237.svg","vcard:Organization":"noun_143899.svg","vcard:Individual":"noun_15059.svg","schema:Person":"noun_15059.svg","foaf:Person":"noun_15059.svg","foaf:Agent":"noun_98053.svg","acl:AuthenticatedAgent":"noun_99101.svg","prov:SoftwareAgent":"noun_Robot_849764.svg","vcard:AddressBook":"noun_15695.svg","trip:Trip":"noun_581629.svg","meeting:LongChat":"noun_1689339.svg","meeting:Meeting":"noun_66617.svg","meeting:Project":"noun_1036577.svg","ui:Form":"noun_122196.svg","rdfs:Class":"class-rectangle.svg","rdf:Property":"property-diamond.svg","owl:Ontology":"noun_classification_1479198.svg","wf:Tracker":"noun_122196.svg","wf:Task":"noun_17020_gray-tick.svg","wf:Open":"noun_17020_sans-tick.svg","wf:Closed":"noun_17020.svg"};function si(e){var t=e.uri.split("#")[0],n=t.indexOf("//");if(n<0)throw new Error("This URI does not have a web site part (origin)");var r=t.indexOf("/",n+2);return r<0?t.slice(0)+"/":t.slice(0,r+1)}function ci(e){var t=Vr;return"string"!=typeof e&&e.uri?4!==e.uri.split("/").length||e.uri.split("/")[1]||e.uri.split("/")[3]?e.uri.startsWith("message:")||e.uri.startsWith("mid:")?t+"noun_480183.svg":e.uri.startsWith("mailto:")?t+"noun_567486.svg":e.uri.startsWith("https:")&&e.uri.indexOf("#")<0?si(e)+"favicon.ico":null:t+"noun_15177.svg":t+"noun_10636_grey.svg"}function li(e){var t=qt,n=Vr;if(e.sameTerm(v.foaf("Agent"))||e.sameTerm(v.rdf("Resource")))return n+"noun_98053.svg";var r=t.any(e,v.sioc("avatar"))||t.any(e,v.foaf("img"))||t.any(e,v.vcard("logo"))||t.any(e,v.vcard("hasPhoto"))||t.any(e,v.vcard("photo"))||t.any(e,v.foaf("depiction"));return r?r.uri:null}function ui(e,t,n){var r=qt,i=li(t);if(i)return e.setAttribute("src",i),!0;var o=n[t.uri];if(o)return e.setAttribute("src",o),e.style=ar.classIconStyle,!0;var a=ci(t);if(a)return e.setAttribute("src",a),!0;var s=r.findTypeURIs(t);for(var c in s)if(n[c])return e.setAttribute("src",n[c]),!1;return e.setAttribute("src",Vr+"noun_10636_grey.svg"),!1}function di(e,t){var n=qt,r={};for(var i in ai){var o=i.split(":")[0],a=i.split(":")[1],s=v[o](a);r[s.uri]=m.uri.join(ai[i],Vr)}if(!ui(e,t,r)&&t.uri){if(!n.fetcher)throw new Error("kb has no fetcher");n.fetcher.nowOrWhenFetched(t.doc(),void 0,function(n){n&&ui(e,t,r)})}}function pi(e,t){var n=e.createElement("img");n.style=ar.iconStyle;if(n.setAttribute("src",Vr+(function(e){if(!e.uri)return!1;var t=e.uri.split("/");return 3===t.length||4===t.length&&""===t[3]}(t)?"noun_15177.svg":"noun_681601.svg")),t.uri&&t.uri.startsWith("https:")&&t.uri.indexOf("#")<0){var r=e.createElement("object");return r.setAttribute("data",si(t)+"favicon.ico"),r.setAttribute("type","image/x-icon"),r.appendChild(n),r}return di(n,t),n}function fi(e,t,n,r){var i=Vr+"noun_2188_red.svg",o=e.createElement("img");o.setAttribute("src",i),o.setAttribute("style",ar.smallButtonStyle),o.style.float="right";var a="Remove this "+n;return o.title=a,o.classList.add("hoverControlHide"),o.addEventListener("click",function(){var n=e.createElement("div");t.insertBefore(n,o),n.style.position="relative",n.appendChild(function(e,t,n,r){function i(){t.parentElement.removeChild(t)}function o(){i(),r()}var a=e.createElement("div");a.style=ar.confirmPopupStyle,a.style.position="absolute",a.style.top="-1em",a.style.display="grid",a.style.gridTemplateColumns="auto auto";var s=e.createElement("div");s.style.gridColumn="1/2",s.style.gridRow="1";var c=e.createElement("div");c.style.gridColumn="1/2",c.style.gridRow="2";var l=mi(e,i);a.appendChild(l),l.style.gridColumn="1",l.style.gridRow="2";var u=a.appendChild(e.createElement("button"));u.style=ar.buttonStyle,u.style.gridRow="2",u.style.gridColumn="2",u.textContent="Cancel";var d=hi(e,dr.Pt.iconBase+"noun_925021.svg","Delete it");a.appendChild(d),d.style.gridRow="1",d.style.gridColumn="1";var p=a.appendChild(e.createElement("button"));return p.style=ar.buttonStyle,p.style.gridRow="1",p.style.gridColumn="2",p.textContent=n,a.appendChild(p),d.addEventListener("click",o),p.addEventListener("click",o),u.addEventListener("click",i),a}(e,n,a,r))}),t.classList.add("hoverControl"),t.appendChild(o),o.setAttribute("data-testid","deleteButtonWithCheck"),o}function hi(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{buttonColor:"Primary",needsBorder:!1},o=e.createElement("button");if(o.setAttribute("type","button"),t){var a=o.appendChild(e.createElement("img"));a.setAttribute("src",t),a.setAttribute("style","width: 2em; height: 2em;"),a.title=n,o.setAttribute("style",ar.buttonStyle)}else o.textContent=n.toLocaleUpperCase(),o.onmouseover=function(){"Secondary"===i.buttonColor?i.needsBorder?o.setAttribute("style",ar.secondaryButtonNoBorderHover):o.setAttribute("style",ar.secondaryButtonHover):i.needsBorder?o.setAttribute("style",ar.primaryButtonNoBorderHover):o.setAttribute("style",ar.primaryButtonHover)},o.onmouseout=function(){"Secondary"===i.buttonColor?i.needsBorder?o.setAttribute("style",ar.secondaryButtonNoBorder):o.setAttribute("style",ar.secondaryButton):i.needsBorder?o.setAttribute("style",ar.primaryButtonNoBorder):o.setAttribute("style",ar.primaryButton)},"Secondary"===i.buttonColor?i.needsBorder?o.setAttribute("style",ar.secondaryButtonNoBorder):o.setAttribute("style",ar.secondaryButton):i.needsBorder?o.setAttribute("style",ar.primaryButtonNoBorder):o.setAttribute("style",ar.primaryButton);return r&&o.addEventListener("click",r,!1),o}function mi(e,t){var n=hi(e,Gr,"Cancel",t);return n.firstChild&&(n.firstChild.style.opacity="0.3"),n}function gi(e,t){return hi(e,Qr,"Continue",t)}function vi(e,t,n,r,i,o){return new Promise(function(t,a){var s=e.createElement("div");r=r||v.foaf("name");var c=(o=o||(i?En(i):"  "))+" "+En(r)+": ";s.appendChild(e.createElement("p")).textContent=c;var l=e.createElement("input");function u(){s.parentNode.removeChild(s),t(l.value.trim())}l.setAttribute("type","text"),l.setAttribute("size","100"),l.setAttribute("maxLength","2048"),l.setAttribute("style",ar.textInputStyle),l.select(),s.appendChild(l),n.appendChild(s),l.addEventListener("keyup",function(e){13===e.keyCode&&u()},!1),s.appendChild(e.createElement("br")),s.appendChild(mi(e,function(e){s.parentNode.removeChild(s),t(null)})),s.appendChild(gi(e,function(e){u()})),l.focus()})}var yi=wi;function wi(e,t,n,r){var i=e.createElement("tr");r=r||{};var o=i.appendChild(e.createElement("td")),a=i.appendChild(e.createElement("td")),s=i.appendChild(e.createElement("td")),c=r.image||pi(e,n);if(o.setAttribute("style","vertical-align: middle; width:2.5em; padding:0.5em; height: 2.5em;"),a.setAttribute("style","vertical-align: middle; text-align:left;"),s.setAttribute("style","vertical-align: middle; width:2em; padding:0.5em; height: 4em;"),o.appendChild(c),r.title?a.textContent=r.title:ii(a,n),r.deleteFunction&&fi(e,s,r.noun||"one",r.deleteFunction),n.uri){if(!1!==r.link)s.appendChild(qr(e,n)).classList.add("HoverControlHide"),s.appendChild(e.createElement("br"));!1!==r.draggable&&(c.setAttribute("draggable","false"),cr(i,n))}return i.subject=n,i}function bi(e,t,n,r){var i=t.appendChild(e.createElement("div"));n?i.textContent=n:ii(i,r)}function xi(e,t,n,r){var i=t.appendChild(e.createElement("div"));i.setAttribute("style",ar.linkDivStyle),r.deleteFunction&&fi(e,i,r.noun||"one",r.deleteFunction),n.uri&&(!1!==r.link&&Kr(e,i,n),cr(t,n))}function Ei(e,t,n){var r=e.createElement("div");r.setAttribute("style",ar.renderAsDivStyle);var i=(n=n||{}).image||pi(e,t);return zr(e,r,i),bi(e,r,n.title,t),xi(e,r,t,n),n.clickable&&n.onClickFunction&&Jr(r,n.onClickFunction),n.wrapInATR?$r(e,r,t):r}function Ci(e){if(e.refresh)e.refresh();else for(var t=0;t<e.children.length;t++)Ci(e.children[t])}function ki(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};function i(n){var r=n,i={noun:p};return l&&(i.deleteFunction=function(){!function(e){if(!f.updater)throw new Error("kb has no updater");f.updater.update((0,m.st)(t,d,e,c),[],function(e,t,n,r){t?o():Zr(void 0,"Error deleting one: "+n)})}(r)}),yi(e,d,n,i)}var o=function(){var e=f.each(t,d);e.sort(),wr(w,e,i)};function a(e){var n=[];if(e.forEach(function(e){var r=(0,m.sym)(e);kn.Rm("Dropped on attachemnt "+e),n.push((0,m.st)(t,d,r,c))}),!f.updater)throw new Error("kb has no updater");f.updater.update([],n,function(e,t,n,r){t?o():Zr(void 0,"Error adding one: "+n)})}function s(e){var n,i;lr(f.fetcher,e,null===(n=r.uploadFolder)||void 0===n?void 0:n.uri,null===(i=r.uploadFolder)||void 0===i?void 0:i.uri,function(e,n){var r=[(0,m.st)(t,d,f.sym(n),c)];if(!f.updater)throw new Error("kb has no updater");f.updater.update([],r,function(e,t,n,r){t?o():Zr(void 0,"Error adding link to uploaded file: "+n)})})}var c=r.doc||t.doc();void 0===r.modify&&(r.modify=!0);var l=r.modify,u=r.promptIcon||Vr+"noun_748003.svg",d=r.predicate||v.wf("attachment"),p=r.noun||"attachment",f=qt,h=n.appendChild(e.createElement("table"));h.setAttribute("style","margin-top: 1em; margin-bottom: 1em;");var g=h.appendChild(e.createElement("tr")),y=g.appendChild(e.createElement("td")),w=g.appendChild(e.createElement("td")).appendChild(e.createElement("table"));if(w.appendChild(e.createElement("tr")),h.refresh=o,o(),l){var b=hi(e,u,"Drop attachments here");y.appendChild(b);var x=r.uploadFolder?s:null;if(sr(b,a,x),sr(y,a,x),r.uploadFolder){var E=ji(e,s);y.appendChild(E)}}return h}function Ai(e){e.preventDefault(),e.stopPropagation();var t=Cr(e).getAttribute("href");if(!t)return kn.Rm("openHrefInOutlineMode: No href found!\n");var n=window.document;n.outlineManager?n.outlineManager.GotoSubject(qt.sym(t),!0,void 0,!0,void 0):window&&window.panes&&window.panes.getOutliner?window.panes.getOutliner().GotoSubject(qt.sym(t),!0,void 0,!0,void 0):kn.Rm("ERROR: Can't access outline manager in this config")}function _i(e){if(void 0!==e.uri){var t=e.uri;if("http://"===t.slice(0,7)){var n=(t=t.slice(7)).indexOf("#");if(n>=0)t=t.slice(0,n);else{var r=t.lastIndexOf("/");if(r<0)return;t=t.slice(0,r)}return qt.sym("http://tabulator.org/wiki/annnotation/"+t)}}}function Si(){var e={};return qt.statementsMatching(void 0,v.rdf("type"),void 0).forEach(function(t){t.object.value&&(e[t.object.value]=!0)}),qt.statementsMatching(void 0,v.rdfs("subClassOf"),void 0).forEach(function(t){t.object.value&&(e[t.object.value]=!0),t.subject.value&&(e[t.subject.value]=!0)}),qt.each(void 0,v.rdf("type"),v.rdfs("Class")).forEach(function(t){t.value&&(e[t.value]=!0)}),e}function Ti(e){var t={},n={},r={},i=0,o=0,a=0,s=e.predicateIndex;for(var c in s){"Literal"===s[c][0].object.termType?(n[c]=!0,o++):(r[c]=!0,i++)}for(var l=e.each(void 0,v.rdf("type"),v.rdf("Property")),u=0;u<l.length;u++){var d=l[u].toNT();r[d]||n[d]||(n[d]=!0,r[d]=!0,a++)}return t.op=r,t.dp=n,un("propertyTriage: ".concat(i," non-lit, ").concat(o," literal. ").concat(a," unknown.")),t}function Ri(e,t){var n=e.createElement("button");return n.setAttribute("type","button"),n.textContent="Goto "+En(t),n.addEventListener("click",function(n){e.outlineManager.GotoSubject(t,!0,void 0,!0,void 0)},!0),n}function Ii(e,t){var n=e.createElement("button");return n.setAttribute("type","button"),n.textContent="",n.addEventListener("click",function(e){t.parentNode.removeChild(t)},!0),n}function Li(e,t,n,r,i,o,a,s,c){return Ni(e.createElement("div"),e,t,n,r,i,o,a,s,c)}function Ni(e,t,n,r,i,o,a,s,c,l){var u="border: 0.1em solid #ddd; border-bottom: none; width: 95%; height: 2em; padding: 0.5em;",d=null;e.innerHTML="";for(var p=function(e,a){var p,f,h=function(){var e=o?n.each(void 0,i,a):n.each(a,i);y.setAttribute("class",0===e.length?"hideTillHover":""),f.setAttribute("src",s.connectIcon||Vr+"noun_25830.svg"),f.setAttribute("title",e.length?e.length:"attach")},m=Pi.twoLine.widgetForClass(r);(p=m(t,a)).setAttribute("style",u);var g=t.createElement("div");g.setAttribute("class","hideTillHover"),g.setAttribute("style","float:right; width:10%");var v=t.createElement("a");v.setAttribute("href",a.uri),v.setAttribute("style","float:right"),g.appendChild(v).textContent=">",e.appendChild(g);var y=t.createElement("div");return y.setAttribute("style",(o?"float:left;":"float:right;")+" width:30px;"),f=t.createElement("img"),h(),y.appendChild(f),e.appendChild(y),p.addEventListener("click",function(e){d===p?(p.setAttribute("style",u),d=null):(d&&d.setAttribute("style",u),p.setAttribute("style",u+"background-color: #ccc; color:black;"),d=p),c(a,e,d===p),h()},!1),f.addEventListener("click",function(e){l(a,e,o,h)},!1),e.appendChild(p),e},f=0;f<a.length;f++){var h=t.createElement("div");e.appendChild(h),p(h,a[f])}return e}var Pi={};function Bi(e,t){for(var n=e.querySelectorAll("link"),r=0;r<n.length;r++)if("stylesheet"===(n[r].getAttribute("rel")||"")&&(n[r].getAttribute("href")||"")===t)return;var i=e.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",t),e.getElementsByTagName("head")[0].appendChild(i)}function Oi(e){return Ui(e,"audio")}function Di(e){return Ui(e,"video")}function Ui(e,t){var n=t||"image",r=qt.findTypeURIs(e),i=m.Util.mediaTypeClass(n+"/*").uri.split("*")[0];for(var o in r)if(o.startsWith(i))return!0;return{audio:"http://purl.org/dc/dcmitype/Sound",image:"http://purl.org/dc/dcmitype/Image",video:"http://purl.org/dc/dcmitype/MovingImage"}[n]in r}function ji(e,t){var n=e.createElement("div"),r=n.appendChild(e.createElement("input"));return r.setAttribute("type","file"),r.setAttribute("multiple","true"),r.addEventListener("change",function(e){kn.Rm("File drop event: ",e),e.files?t(e.files):e.target&&e.target.files?t(e.target.files):alert("Sorry no files .. internal error?")},!1),r.style="display:none",sr(n.appendChild(hi(e,Vr+"noun_Upload_76574_000000.svg","Upload files",function(e){r.click()})),null,t),n}function Mi(e,t,n){return(t=Jn(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Pi={line:{},twoLine:{"":function(e,t){var n=e.createElement("div");return n.textContent=En(t),n},"http://www.w3.org/2000/10/swap/pim/qif#Transaction":function(e,t){var n="",r=function(e){var r=qt.any(t,v.qu(e));return r||(n+="@@ No value for "+e+"! "),r?Or(r.value):"?"},i=e.createElement("table");return i.innerHTML='\n      <tr>\n      <td colspan="2"> '.concat(r("payee"),"</td>\n      < /tr>\n      < tr >\n      <td>").concat(r("date").slice(0,10),'</td>\n      <td style = "text-align: right;">').concat(r("amount"),"</td>\n      </tr>"),n&&(i.innerHTML='\n      <tr>\n        <td><a href="'.concat(Or(t.uri),'">').concat(Or(n),"</a></td>\n      </tr>")),i},"http://www.w3.org/ns/pim/trip#Trip":function(e,t){var n=function(e){var n=qt.any(t,e);return n?Or(n.value):"?"},r=e.createElement("table");return r.innerHTML='\n    <tr>\n      <td colspan="2">'.concat(n(v.dc("title")),'</td>\n    </tr>\n    <tr style="color: #777">\n      <td>').concat(n(v.cal("dtstart")),"</td>\n      <td>").concat(n(v.cal("dtend")),"</td>\n    </tr>"),r},widgetForClass:function(e){var t=Pi.twoLine[e.uri],n=qt;if(t)return t;var r=n.findSuperClassesNT(e);for(var i in r)if(t=Pi.twoLine[n.fromNT(i).uri])return t;return Pi.twoLine[""]}}};const Fi={authEndpoint:"",fallbackAuthEndpoint:"https://databox.me/",signupEndpoint:"https://solidproject.org/use-solid/",signupWindowHeight:600,signupWindowWidth:1024,key:"",cert:""};function Hi(e){this.config=e||Fi}var Wi;Hi.prototype.listen=function(){return new Promise(function(e,t){var n=window.addEventListener?"addEventListener":"attachEvent";(0,window[n])("attachEvent"===n?"onmessage":"message",function(n){var r=n.data;if("User:"===r.slice(0,5)){var i=r.slice(5,r.length);return i&&i.length>0&&"http"===i.slice(0,4)?e(i):t(i)}},!0)})},Hi.prototype.signup=function(e){e=e||this.config.signupEndpoint;var t=this.config.signupWindowWidth,n=this.config.signupWindowHeight,r=window.screen.width/2-(t/2+10),i=window.screen.height/2-(n/2+50),o=e+"?origin="+encodeURIComponent(window.location.origin),a="resizable,scrollbars,status,width="+t+",height="+n+",left="+r+",top="+i;window.open(o,"Solid signup",a);var s=this;return new Promise(function(e){s.listen().then(function(t){return e(t)})})};var $i=(Mi(Mi(Mi(Mi(Mi(Mi(Mi(Mi(Mi(Mi(Wi={},v.ui("ColorField").uri,{size:9,type:"color",style:"height: 3em;",dt:"color",pattern:/^\s*#[0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f]([0-9a-f][0-9a-f])?\s*$/}),v.ui("DateField").uri,{size:20,type:"date",dt:"date",pattern:/^\s*[0-9][0-9][0-9][0-9](-[0-1]?[0-9]-[0-3]?[0-9])?Z?\s*$/}),v.ui("DateTimeField").uri,{size:20,type:"datetime-local",dt:"dateTime",pattern:/^\s*[0-9][0-9][0-9][0-9](-[0-1]?[0-9]-[0-3]?[0-9])?(T[0-2][0-9]:[0-5][0-9](:[0-5][0-9])?)?Z?\s*$/}),v.ui("TimeField").uri,{size:10,type:"time",dt:"time",pattern:/^\s*([0-2]?[0-9]:[0-5][0-9](:[0-5][0-9])?)\s*$/}),v.ui("IntegerField").uri,{size:12,style:"text-align: right;",dt:"integer",pattern:/^\s*-?[0-9]+\s*$/}),v.ui("DecimalField").uri,{size:12,style:"text-align: right;",dt:"decimal",pattern:/^\s*-?[0-9]*(\.[0-9]*)?\s*$/}),v.ui("FloatField").uri,{size:12,style:"text-align: right;",dt:"float",pattern:/^\s*-?[0-9]*(\.[0-9]*)?((e|E)-?[0-9]*)?\s*$/}),v.ui("SingleLineTextField").uri,{}),v.ui("NamedNodeURIField").uri,{namedNode:!0}),v.ui("TextField").uri,{}),Mi(Mi(Mi(Mi(Mi(Wi,v.ui("PhoneField").uri,{size:20,uriPrefix:"tel:",pattern:/^\+?[\d-]+[\d]*$/}),v.ui("EmailField").uri,{size:30,uriPrefix:"mailto:",pattern:/^\s*.*@.*\..*\s*$/}),v.ui("Group").uri,{style:ar.formGroupStyle}),v.ui("Comment").uri,{element:"p",style:ar.commentStyle}),v.ui("Heading").uri,{element:"h3",style:ar.formHeadingStyle})),Ji=Wt.store,zi={};function qi(e){var t=Ji,n=t.findTypeURIs(e),r=t.bottomTypeURIs(n),i=[];for(var o in r)i.push(o);return i[0]}function Ki(e,t){var n=qi(t),r=zi[n];return ln("paneUtils: Going to implement field "+t+" of type "+n),r||function(e,r){var i=Wr(e,"No handler for field "+t+" of type "+n);return r&&r.appendChild(i),i}}var Vi="https://www.w3.org/ns/css#";var Gi=Wt.store;function Qi(e,t,n,r,i){n.style.display="flex",n.style.flexDirection="row";var o=n.appendChild(e.createElement("div"));o.style.width=or.formFieldNameBoxWidth;var a=n.appendChild(e.createElement("div"));return o.setAttribute("class","formFieldName"),o.setAttribute("style",ar.formFieldNameBoxStyle),a.setAttribute("class","formFieldValue"),i?o.appendChild(e.createTextNode(i)):t.any(r,v.ui("property"))?o.appendChild(Zi(e,t.any(r,v.ui("property")),r)):(a.appendChild(Wr(e,"No property or label given for form field: "+r)),o.appendChild(e.createTextNode("???"))),a}function Zi(e,t,n){var r=Gi.any(n,v.ui("label"));if(r||(r=En(t,!0)),void 0===t)return e.createTextNode("@@Internal error: undefined property");var i=e.createElement("a");return t.uri&&i.setAttribute("href",t.uri),i.setAttribute("style","color: #3B5998; text-decoration: none;"),i.textContent=r,i}function Yi(e,t,n){var r=Gi.statementsMatching(e,t);if(0===r.length)return n;if(!Gi.updater)throw new Error("Store has no updater");return r.length>0&&r[0].why.value&&Gi.updater.editable(r[0].why.value,Gi)?Gi.sym(r[0].why.value):n}function Xi(e,t,n,r,i,o,a){var s=Gi,c=i.doc?i.doc():null,l=e.createElement("div"),u=s.any(i,v.ui("property"));if(t&&t.appendChild(l),!u)return l.appendChild(Wr(e,"Error: No property given for text field: "+i));var d=Qi(e,s,l,i),p=s.anyJS(i,v.ui("suppressEmptyUneditable"),null,c),f=qi(i),h=$i[f];void 0===h&&(h={style:""});var g=h.style||"",y=ar.textInputStyle+g,w=e.createElement("input");w.style=y,d.appendChild(w),w.setAttribute("type",h.type?h.type:"text");var b=s.anyJS(i,v.ui("size"))||or.textInputSize||20;w.setAttribute("size",b);var x=s.any(i,v.ui("maxLength"));w.setAttribute("maxLength",x?""+x:or.basicMaxLength),o=o||Yi(r,u,o);var E=s.any(r,u,void 0,o);if(E||(E=s.any(i,v.ui("default"))),E&&E.value&&h.uriPrefix?w.value=decodeURIComponent(E.value.replace(h.uriPrefix,"")).replace(/ /g,""):E&&(w.value=E.value||E.value||""),w.setAttribute("style",y),!s.updater)throw new Error("kb has no updater");return s.updater.editable(o.uri)?(w.addEventListener("keyup",function(e){h.pattern&&w.setAttribute("style",y+(w.value.match(h.pattern)?"color: green;":"color: red;"))},!0),w.addEventListener("change",function(t){if(!h.pattern||w.value.match(h.pattern)){w.disabled=!0,w.setAttribute("style",y+"color: gray;");var n,i=s.statementsMatching(r,u);h.namedNode?n=s.sym(w.value):h.uriPrefix?(n=encodeURIComponent(w.value.replace(/ /g,"")),n=s.sym(h.uriPrefix+w.value)):n=h.dt?new m.Literal(w.value.trim(),void 0,v.xsd(h.dt)):new m.Literal(w.value);var c=i.map(function(e){return(0,m.st)(e.subject,e.predicate,n,e.why)});0===c.length&&(c=[(0,m.st)(r,u,n,o)]),function e(t,n,r){var i=[];if(n.forEach(function(e){i.includes(e.why.uri)||i.push(e.why.uri)}),t.forEach(function(e){i.includes(e.why.uri)||i.push(e.why.uri)}),0===i.length)throw new Error("updateMany has no docs to patch");if(!s.updater)throw new Error("kb has no updater");if(1===i.length)return s.updater.update(t,n,r);var o=i.pop(),a=n.filter(function(e){return e.why.uri===o}),c=n.filter(function(e){return e.why.uri!==o}),l=t.filter(function(e){return e.why.uri===o}),u=t.filter(function(e){return e.why.uri!==o});s.updater.update(l,a,function(t,n,i){n?e(u,c,r):r(t,n,i)})}(i,c,function(t,n,r){n?(w.disabled=!1,w.setAttribute("style",y)):l.appendChild(Wr(e,r)),a(n,r)})}},!0),l):(w.readOnly=!0,w.style=ar.textInputStyleUneditable+g,p&&""===w.value&&(l.style.display="none"),l)}var eo="https://www.w3.org/ns/iana/language-code/",to=["en","fr","de","it","ar"];function no(e){return e||(e=[]),e.concat(to.filter(function(t){return!e.includes(t)}))}function ro(e){return io.apply(this,arguments)}function io(){return(io=w(x().mark(function e(t){var n,r,i,o;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.doc(),e.next=1,null===(n=qt.fetcher)||void 0===n?void 0:n.load(r);case 1:if(i=qt.any(t,v.schema("knowsLanguage"),null,r)){e.next=2;break}return e.abrupt("return",to);case 2:if(o=[],i.elements.forEach(function(e){var t=qt.any(e,v.solid("publicId"),null,r);if(t)if(t.value.startsWith(eo)){var n=t.value.slice(eo.length);o.push(n)}else console.error("What should be a language code ".concat(t.value," does not start with ").concat(eo));else console.warn("getPreferredLanguages: No publiID of language.")}),!(o.length>0)){e.next=3;break}return console.log('     User knows languages with codes: "'.concat(o.join(","),'"')),e.abrupt("return",no(o));case 3:return e.abrupt("return",null);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function oo(){return ao.apply(this,arguments)}function ao(){return(ao=w(x().mark(function e(){var t,n;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,Jt.currentUser();case 1:if(!(t=e.sent)){e.next=3;break}return e.next=2,ro(t);case 2:if(!(n=e.sent)){e.next=3;break}return e.abrupt("return",n);case 3:if("undefined"==typeof navigator){e.next=5;break}if(!navigator.languages){e.next=4;break}return e.abrupt("return",no(navigator.languages.map(function(e){return e.split("-")[0]})));case 4:if(!navigator.language){e.next=5;break}return e.abrupt("return",no([navigator.language.split("-")[0]]));case 5:return e.abrupt("return",to);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function so(e,t){var n={};e.forEach(function(e){var t=e.subject.value;n[t]=n[t]||[],n[t].push(e)});var r=t||to;r.reverse();var i=[];for(var o in n){var a=n[o].map(function(e){var t=e.name["xml:lang"];return[r.indexOf(t),e]});a.sort(),a.reverse(),i.push(a[0][1])}return kn.Rm(" Filter by language: ".concat(e.length," -> ").concat(i.length)),i}var co=200,lo=/\$\(subject\)/g,uo={Corporation:"http://www.wikidata.org/entity/Q6881511",EducationalOrganization:"http://www.wikidata.org/entity/Q178706",GovernmentOrganization:"http://www.wikidata.org/entity/Q327333",MedicalOrganization:"http://www.wikidata.org/entity/Q4287745",MusicGroup:"http://www.wikidata.org/entity/Q32178211",NGO:"http://www.wikidata.org/entity/Q163740",Occupation:"http://www.wikidata.org/entity/Q28640",Project:"http://www.wikidata.org/entity/Q170584",ResearchOrganization:"http://www.wikidata.org/entity/Q31855",SportsOrganization:"http://www.wikidata.org/entity/Q4438121"},po='prefix vcard: <http://www.w3.org/2006/vcard/ns#>\nCONSTRUCT\n{  wd:Q49108 vcard:fn ?itemLabel.\nwd:Q49108 rdf:type ?klass. ?klass rdfs:label ?klassLabel; rdfs:comment ?klassDescription .\nwd:Q49108 schema:logo ?logo;\n   schema:image ?image;\n   schema:logo  ?sealImage;\n   schema:subOrganization  ?subsidiary .\n      ?subsidiary rdfs:label ?subsidiaryLabel .\n ?supersidiary schema:subOrganization wd:Q49108 .\n      ?supersidiary rdfs:label ?supersidiaryLabel .\n  wd:Q49108 schema:location ?location .\n     ?location  schema:elevation  ?elevation .\n     ?location  wdt:P131  ?region .  ?region rdfs:label ?regionLabel .\n     ?location wdt:P625 ?coordinates .\n     ?location  schema:country  ?country . ?country rdfs:label ?countryLabel .\n}\nWHERE\n{  optional {wd:Q49108 rdfs:label ?itemLabel} .\n  optional {wd:Q49108 wdt:P154 ?logo .}\n  optional {wd:Q49108 wdt:P31 ?klass .}\n  optional {wd:Q49108 wdt:P158  ?sealImage .}\n  optional {wd:Q49108 wdt:P18 ?image .}\n\n  optional { wd:Q49108       wdt:P355 ?subsidiary . }\n  optional { ?supersidiary   wdt:P355 wd:Q49108. }\n\n  optional { wd:Q49108 wdt:P276 ?location .\n\n    optional { ?location  schema:eleveation  ?elevation }\n    optional { ?location  wdt:P131  ?region }\n    optional { ?location wdt:P625 ?coordinates }\n    optional {  ?location  wdt:P17  ?country }\n  }\n  SERVICE wikibase:label { bd:serviceParam wikibase:language "fr,en,de,it". }\n}',fo={credentials:"omit",headers:new Headers({Accept:"application/json"})},ho={label:"ESCO",logo:qt.sym("https://ec.europa.eu/esco/portal/static_resource2/images/logo/logo_en.gif"),searchByNameURI:"https://ec.europa.eu/esco/api/search?language=$(language)&type=occupation&text=$(name)"},mo={label:"DBPedia",logo:qt.sym("https://upload.wikimedia.org/wikipedia/commons/thumb/7/73/DBpediaLogo.svg/263px-DBpediaLogo.svg.png"),searchByNameQuery:'select distinct ?subject, ?name where {\n    ?subject a $(targetClass); rdfs:label ?name\n    FILTER regex(?name, "$(name)", "i")\n  } LIMIT $(limit)',endpoint:"https://dbpedia.org/sparql/"},go={AcademicInsitution:"http://umbel.org/umbel/rc/EducationalOrganization"},vo={AcademicInsitution:"http://www.wikidata.org/entity/Q4671277",Enterprise:"http://www.wikidata.org/entity/Q6881511",Business:"http://www.wikidata.org/entity/Q4830453",NGO:"http://www.wikidata.org/entity/Q79913",CharitableOrganization:"http://www.wikidata.org/entity/Q708676",Insitute:"http://www.wikidata.org/entity/Q1664720"},yo={label:"WikiData",limit:3e3,logo:qt.sym("https://www.wikimedia.org/static/images/project-logos/wikidatawiki.png"),endpoint:"https://query.wikidata.org/sparql",searchByNameQuery:'SELECT ?subject ?name\n  WHERE {\n    ?klass wdt:P279* $(targetClass) .\n    ?subject wdt:P31 ?klass .\n    ?subject rdfs:label ?name.\n    FILTER regex(?name, "$(name)", "i")\n  } LIMIT $(limit) ',insitituteDetailsQuery:'CONSTRUCT\n{  wd:Q49108 schema:name ?itemLabel;\n             schema:logo ?logo;\n              schema:logo  ?sealImage;\n             schema:subOrganization  ?subsidiary .\n                 ?subsidiary schema:name ?subsidiaryLabel .\n}\nWHERE\n{\n   wd:Q49108 # rdfs:label ?itemLabel ;\n             wdt:P154 ?logo;\n              wdt:P158  ?sealImage ;\n             wdt:P355  ?subsidiary .\n          #  ?subsidiary rdfs:label ?subsidiaryLabel .\n\n  SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE], fr". }\n}'},wo={"http://www.wikidata.org/entity/Q15936437":v.schema("CollegeOrUniversity"),"http://www.wikidata.org/entity/Q1664720":v.schema("EducationalOrganization"),"http://www.wikidata.org/entity/Q43229":v.schema("Organization"),"http://www.wikidata.org/entity/Q3918":v.schema("CollegeOrUniversity"),"http://www.wikidata.org/entity/Q170584":v.schema("Project"),"http://www.wikidata.org/entity/Q327333":v.schema("GovernmentOrganization"),"http://www.wikidata.org/entity/Q2221906":v.schema("Place"),"http://www.wikidata.org/entity/Q167037":v.schema("Corporation")},bo={targetClass:v.rdf("type"),sealImage:v.schema("logo"),shortName:v.foaf("nick"),subsidiary:v.schema("subOrganization"),city:v.vcard("locality"),state:v.vcard("region"),country:v.vcard("country-name"),homepage:v.foaf("homepage"),lat:v.schema("latitude"),long:v.schema("longitude")};function xo(e){var t=e.type.toLowerCase();if("uri"===t||"iri"===t)return qt.sym(e.value);if("literal"===t)return e["xml:lang"]?new m.Literal(e.value,e["xml:lang"]):new m.Literal(e.value);throw new Error('bindingToTerm: Unexpected type "'.concat(e.type,'" in sparql binding}'))}function Eo(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:bo,o={};kn.Rm("loadFromBindings:  subject: ".concat(t)),kn.Rm("                       doc: ".concat(r)),n.forEach(function(e){for(var t in e){var n=e[t],r=JSON.stringify(n);o[t]=o[t]||new Set,o[t].add(r)}});var a=function(n){var a=o[n];kn.Rm("    results ".concat(n," -> ").concat(a)),a.forEach(function(o){var a,s=JSON.parse(o),c=s.type,l=s.value;if("uri"===c)a=e.sym(l);else{if("literal"!==c)throw new Error("loadFromBindings:  unexpected type: ".concat(c));a=new m.Literal(l,s.language,s.datatype)}if("type"===n)wo[l]?a=wo[l]:kn.R8("Unmapped Wikidata Class: "+l);else if("coordinates"===n){kn.Rm("         @@@ hey a point: "+l);var u=/.*\(([-0-9.-]*) ([-0-9.-]*)\)/.exec(l);if(u){var d=v.xsd("float"),p=new m.Literal(u[1],null,d),f=new m.Literal(u[2],null,d);e.add(t,v.schema("longitude"),f,r),e.add(t,v.schema("latitude"),p,r)}else kn.Rm("Bad coordinates syntax: "+l)}else{var h=i[n]||v.schema(n);e.add(t,h,a,r),kn.Rm("  public data ".concat(h," ").concat(a,"."))}})};for(var s in o)a(s)}function Co(e){return e._embedded.results.map(function(e){return{name:{value:e.title,type:"literal"},subject:{type:"IRI",value:e.uri}}})}function ko(e,t,n){return Ao.apply(this,arguments)}function Ao(){return(Ao=w(x().mark(function e(t,n,r){var i,o,a,s,c,l;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.searchByNameURI){e.next=1;break}throw new Error("Missing queryTarget.searchByNameURI on queryESCODataByName");case 1:return o=r.limit||co,a=r.searchByNameURI.replace("$(name)",t).replace("$(limit)",""+o).replace("$(targetClass)",n.toNT()),kn.Rm("Querying ESCO data - uri: "+a),e.next=2,null===(i=qt.fetcher)||void 0===i?void 0:i.webOperation("GET",a,fo);case 2:if(s=e.sent,c=(null==s?void 0:s.responseText)||"",kn.Rm("    Query result  text"+c.slice(0,500)+"..."),0!==c.length){e.next=3;break}throw new Error("Wot no text back from ESCO query "+a);case 3:return l=JSON.parse(c),kn.Rm("    ESCO Query result JSON"+JSON.stringify(l,null,4).slice(0,500)+"..."),e.abrupt("return",Co(l));case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function _o(e){var t=e.indexOf("SPARQL-QUERY");if(t<0)return e;kn.R8("  ### Fixing JSON with wikidata error code injection "+e.slice(t,t+200));var n=e.lastIndexOf("}, {");return e.slice(0,n)+" } ] } } "}function So(e,t,n,r){return To.apply(this,arguments)}function To(){return(To=w(x().mark(function e(t,n,r,i){var o,a,s,c,l,u,d,p,f,h,m,g;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=function(e){var r=i.limit||co;return e.replace("$(name)",t).replace("$(limit)",""+r).replace("$(language)",a).replace("$(targetClass)",n.toNT())},n){e.next=1;break}throw new Error("queryPublicDataByName: No class provided");case 1:return e.next=2,oo();case 2:if(m=e.sent){e.next=3;break}m=to;case 3:if(a=m[0]||"en",!i.searchByNameQuery){e.next=4;break}return s=o(i.searchByNameQuery),kn.Rm("Querying public data - sparql: "+s),e.abrupt("return",Ro(s,i));case 4:if(!i.searchByNameURI){e.next=13;break}return c=o(i.searchByNameURI),e.prev=5,e.next=6,null===(u=qt.fetcher)||void 0===u?void 0:u.webOperation("GET",c,fo);case 6:l=e.sent,e.next=8;break;case 7:throw e.prev=7,g=e.catch(5),new Error("Exception when trying to fetch ".concat(c," \n ").concat(g));case 8:if(d=l.responseText||"",200===l.status){e.next=9;break}throw new Error("HTTP error status ".concat(l.status," trying to fetch ").concat(c," "));case 9:if(kn.Rm("    Query result  text"+d.slice(0,500)+"..."),0!==d.length){e.next=10;break}throw new Error("queryPublicDataByName: No text back from public data query "+c);case 10:if(p=_o(d),f=JSON.parse(p),kn.Rm("    API Query result JSON"+JSON.stringify(f,null,4).slice(0,500)+"..."),!f._embedded){e.next=11;break}return kn.Rm("      Looks like ESCO"),h=Co(f),e.abrupt("return",h);case 11:throw alert("Code me: unrecognized API return format"),new Error("*** Need to add code to parse unrecognized API JSON return\n".concat(JSON.stringify(f,null,4)));case 12:e.next=14;break;case 13:throw new Error("Query source must have either rest API or SPARQL endpoint.");case 14:case"end":return e.stop()}},e,null,[[5,7]])}))).apply(this,arguments)}function Ro(e,t){return Io.apply(this,arguments)}function Io(){return(Io=w(x().mark(function e(t,n){var r,i,o,a,s,c,l,u,d,p;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.endpoint){e.next=1;break}throw new Error("Missing queryTarget.endpoint required for queryPublicDataSelect");case 1:return(i=new URL(n.endpoint)).searchParams.append("query",t),o=i.href,kn.Rm(" queryPublicDataSelect uri: "+o),(a=new Headers).append("Accept","application/json"),s={credentials:"omit",headers:a},e.next=2,null===(r=qt.fetcher)||void 0===r?void 0:r.webOperation("GET",o,s);case 2:if(c=e.sent,0!==(l=(null==c?void 0:c.responseText)||"").length){e.next=3;break}throw new Error("No text back from query "+o);case 3:return u=_o(l),d=JSON.parse(u),kn.Rm("    Query result JSON"+JSON.stringify(d,null,4).slice(0,100)+"..."),p=d.results.bindings,e.abrupt("return",p);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Lo(e,t,n){return No.apply(this,arguments)}function No(){return(No=w(x().mark(function e(t,n,r){var i,o,a,s,c,l,u,d;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(kn.Rm("queryPublicDataConstruct: sparql:",t),r.endpoint){e.next=1;break}throw new Error("Missing queryTarget.endpoint required for queryPublicDataConstruct");case 1:return(o=new URL(r.endpoint)).searchParams.append("query",t),a=o.href,kn.Rm(" queryPublicDataConstruct uri: "+a),(s=new Headers).append("Accept","text/turtle"),c={credentials:"omit",headers:s},e.next=2,null===(i=qt.fetcher)||void 0===i?void 0:i.webOperation("GET",a,c);case 2:if(l=e.sent,u=(null==l?void 0:l.responseText)||"No response text?",d=u.length>500?u.slice(0,200)+" ... "+u.slice(-200):u,kn.Rm("    queryPublicDataConstruct result text:"+d),0!==u.length){e.next=3;break}throw new Error("queryPublicDataConstruct: No text back from construct query:"+a);case 3:(0,m.parse)(u,qt,n.uri,"text/turtle");case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Po(e,t,n){return Bo.apply(this,arguments)}function Bo(){return Bo=w(x().mark(function e(t,n,r){var i,o;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.uri.startsWith("https://dbpedia.org/resource/")){e.next=1;break}return e.abrupt("return",Ho(t,n,r));case 1:if(!r.uri.match(/^https?:\/\/www\.wikidata\.org\/entity\/.*/)){e.next=3;break}return e.next=2,Oo(t,n,r);case 2:e.next=4;break;case 3:return i=r.uri.startsWith("http:")?t.sym("https:"+r.uri.slice(5)):r,(o=new Headers).append("Accept","text/turtle"),e.abrupt("return",t.fetcher.load(i,{credentials:"omit",headers:o}));case 4:case"end":return e.stop()}},e)})),Bo.apply(this,arguments)}function Oo(e,t,n){return Do.apply(this,arguments)}function Do(){return(Do=w(x().mark(function e(t,n,r){var i,o;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=/wd:Q49108/g,o=po.replace(i,r.toNT()),e.next=1,Lo(o,r,yo);case 1:kn.Rm("getWikidataDetails: loaded.",r);case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Uo(e,t,n){return jo.apply(this,arguments)}function jo(){return jo=w(x().mark(function e(t,n,r){var i,o;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i='select distinct *  where {\n  optional { $(subject)  wdt:P31  ?targetClass } # instance of\n  optional { $(subject)  wdt:P154  ?logo }\n  optional { $(subject)  wdt:P158  ?sealImage }\n# optional { $(subject)  wdt:P159  ?headquartersLocation }\n\noptional { $(subject)  wdt:P17  ?country }\noptional { $(subject)  wdt:P18  ?image }\noptional { $(subject)  wdt:P1813  ?shortName }\n\noptional { $(subject)  wdt:P355  ?subsidiary }\n# SERVICE wikibase:label { bd:serviceParam wikibase:language "fr,en,de,it" }\n}'.replace(lo,r.toNT()),e.next=1,Ro(i,yo);case 1:o=e.sent,Eo(t,r,o,r.doc());case 2:case"end":return e.stop()}},e)})),jo.apply(this,arguments)}function Mo(e,t,n){return Fo.apply(this,arguments)}function Fo(){return Fo=w(x().mark(function e(t,n,r){var i,o;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i='select distinct *  where {\n\n  $(subject) wdt:P276 ?location .\n\n  optional { ?location  wdt:P2044  ?elevation }\n  optional { ?location  wdt:P131  ?region }\n  optional { ?location wdt:P625 ?coordinates }\noptional {  ?location  wdt:P17  ?country }\n\n# SERVICE wikibase:label { bd:serviceParam wikibase:language "fr,en,de,it" }\n}'.replace(lo,r.toNT()),kn.Rm(" location query sparql:"+i),e.next=1,Ro(i,yo);case 1:o=e.sent,kn.Rm(" location query bindings:",o),Eo(t,r,o,r.doc());case 2:case"end":return e.stop()}},e)})),Fo.apply(this,arguments)}function Ho(e,t,n){return Wo.apply(this,arguments)}function Wo(){return Wo=w(x().mark(function e(t,n,r){var i,o;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i="select distinct ?city, ?state, ?country, ?homepage, ?logo, ?lat, ?long,  WHERE {\n    OPTIONAL { <".concat(r,"> <http://dbpedia.org/ontology/city> ?city }\n    OPTIONAL { ").concat(r," <http://dbpedia.org/ontology/state> ?state }\n    OPTIONAL { ").concat(r," <http://dbpedia.org/ontology/country> ?country }\n    OPTIONAL { ").concat(r," foaf:homepage ?homepage }\n    OPTIONAL { ").concat(r," foaf:lat ?lat; foaf:long ?long }\n    OPTIONAL { ").concat(r," <http://dbpedia.org/ontology/country> ?country }\n   }"),e.next=1,Ro(i,mo);case 1:o=e.sent,Eo(t,r,o,r.doc()),kn.Rm("Finished getDbpediaDetails.");case 2:case"end":return e.stop()}},e)})),Wo.apply(this,arguments)}function $o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Jo(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Jo(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Jo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function zo(e,t){e.style.display=t?"":"none"}function qo(e,t,n,r){return Ko.apply(this,arguments)}function Ko(){return Ko=w(x().mark(function e(t,n,r,i){var o,a,s,c,l,u,d,p,f,h,m,g,v,y,b,E,C,k,A,_,S,T,R,I,L,N,P,B,O,D,U,j,M,F;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(k=function(){n.currentObject?(j.value=n.currentName?n.currentName.value:"??? wot no name for "+n.currentObject,P=n.currentName,I=n.currentName?n.currentName.value:void 0,B=n.currentObject):(j.value="",I=void 0,B=void 0),r.deleteButton&&zo(r.deleteButton,!!n.currentObject),r.acceptButton&&zo(r.acceptButton,!1),r.editButton&&zo(r.editButton,!0),r.cancelButton&&zo(r.cancelButton,!1),T=!1,h()},C=function(){return C=w(x().mark(function e(){var n,r,i,o,a,c,l,u,d;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=function(e,t){return t.name.value>e.name.value?1:t.name.name<e.name.value?-1:0},n=function(e){var n=t.createElement("tr");ar.setStyle(n,"autocompleteRowStyle"),n.setAttribute("style","padding: 0.3em;"),n.style.color=R?"#080":"#088",n.textContent=e.name.value;var r=xo(e.subject),i=xo(e.name);return n.addEventListener("click",function(){var e=w(x().mark(function e(t){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:kn.Rm("       click row textContent: "+n.textContent),kn.Rm("       click name: "+i.value),r&&i&&s(r,i);case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),n},!T){e.next=1;break}return kn.Rm('Ignoring "'.concat(j.value,'" because of lock ')),e.abrupt("return");case 1:return kn.Rm('Setting lock at "'.concat(j.value,'"')),T=!0,e.next=2,oo();case 2:if(i=e.sent,!((o=j.value.trim().toLowerCase()).length<4)){e.next=3;break}h(),L=20,e.next=6;break;case 3:if(R&&I&&o.startsWith(I)){e.next=5;break}return kn.Rm('   Querying database at "'.concat(o,'" cf last "').concat(I,'".')),e.next=4,v(o,i);case 4:_=e.sent;case 5:a=b(o,_),S&&a.length<=40&&(L=a.length),R=S&&a.length<=L,kn.Rm(' Filter:"'.concat(o,'" lastBindings: ').concat(_.length,", slimmed to ").concat(a.length,"; rows: ").concat(L,", Enough? ").concat(S,", All displayed? ").concat(R)),(c=a.slice(0,L)).sort(r),h(),l=$o(c);try{for(l.s();!(u=l.n()).done;)d=u.value,O.appendChild(n(d))}catch(e){l.e(e)}finally{l.f()}1===a.length&&s(xo(a[0].subject),xo(a[0].name));case 6:T=!1;case 7:case"end":return e.stop()}},e)})),C.apply(this,arguments)},E=function(){return C.apply(this,arguments)},b=function(e,t){return t.filter(function(t){return f(e,t.name.value)})},y=function(){return(y=w(x().mark(function e(t,r){var i,a,s;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,So(t,A,r||to,n.queryParams);case 1:i=e.sent,e.next=3;break;case 2:return e.prev=2,s=e.catch(0),o("Error querying db of organizations: "+s),T=!1,e.abrupt("return");case 3:return S=i.length<co,I=S?t:void 0,h(),a=so(i,r),e.abrupt("return",a);case 4:case"end":return e.stop()}},e,null,[[0,2]])}))).apply(this,arguments)},v=function(e,t){return y.apply(this,arguments)},g=function(){return(g=w(x().mark(function e(t){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:zo(r.cancelButton,!0),E();case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)},m=function(e){return g.apply(this,arguments)},h=function(){for(;O.children.length>1;)O.removeChild(O.lastChild)},f=function(e,t){for(var n=e.split(" "),r=0;r<n.length;r++){var i=n[r];if(t.toLowerCase().indexOf(i)<0)return!1}return!0},p=function(){return(p=w(x().mark(function e(t){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:kn.Rm("Auto complete: Canceled by user! "),n.permanent?k():N.parentNode&&N.parentNode.removeChild(N);case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)},d=function(e){return p.apply(this,arguments)},u=function(){return(u=w(x().mark(function e(t){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:P&&j.value===P.value&&a(B,P);case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)},l=function(e){return u.apply(this,arguments)},c=function(){return(c=w(x().mark(function e(t,n){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.acceptButton){e.next=1;break}return r.acceptButton.disbaled=!1,zo(r.acceptButton,!0),j.value=n.value,P=n,B=t,kn.Rm("Auto complete: name: "+n),kn.Rm("Auto complete: waiting for accept "+t),h(),e.abrupt("return");case 1:zo(r.cancelButton,!0),a(t,n);case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)},s=function(e,t){return c.apply(this,arguments)},a=function(e,t){kn.Rm("Auto complete: finish! "+e),"Literal"===e.termType&&n.queryParams.objectURIBase&&(e=qt.sym(n.queryParams.objectURIBase.value+e.value)),h(),i(e,t)},o=function(e){var n=O.appendChild(t.createElement("tr"));kn.Rm(e);var r=new Error(e);n.appendChild(Wr(t,r,"pink")),ar.setStyle(n,"autocompleteRowStyle"),n.style.padding="1em"},A=n.targetClass){e.next=1;break}throw new Error("renderAutoComplete: missing targetClass");case 1:return r.acceptButton&&r.acceptButton.addEventListener("click",l,!1),r.cancelButton&&r.cancelButton.addEventListener("click",d,!1),S=!1,T=!1,R=!1,I=void 0,L=20,N=t.createElement("div"),P=void 0,B=void 0,(O=N.appendChild(t.createElement("table"))).setAttribute("data-testid","autocomplete-table"),O.setAttribute("style","max-width: 30em; margin: 0.5em;"),D=O.appendChild(t.createElement("tr")),ar.setStyle(D,"autocompleteRowStyle"),U=D.appendChild(t.createElement("td")),(j=U.appendChild(t.createElement("input"))).setAttribute("type","text"),k(),M=n.size||or.textInputSize||20,j.setAttribute("size",M),j.setAttribute("data-testid","autocomplete-input"),F=ar.textInputStyle||"border: 0.1em solid #444; border-radius: 0.5em; width: 100%; font-size: 100%; padding: 0.1em 0.6em",j.setAttribute("style",F),j.addEventListener("keyup",function(e){13===e.keyCode&&l(e)},!1),j.addEventListener("input",m),e.abrupt("return",N);case 2:case"end":return e.stop()}},e)})),Ko.apply(this,arguments)}function Vo(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Go(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Go(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Go(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Qo=dr.Pt.iconBase+"noun_34653_green.svg",Zo=dr.Pt.iconBase+"noun_Search_875351.svg",Yo=dr.Pt.iconBase+"noun_253504.svg";function Xo(e,t,n,r,i,o){return ea.apply(this,arguments)}function ea(){return ea=w(x().mark(function e(t,n,r,i,o,a){var s,c,l,u,d,p,f,h,m,g,y,b,E,C,k,A,_,S,T,R,I,L;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T=function(){S?(zo(_,!1),zo(b,!1),zo(E,!1)):(zo(_,!0),zo(b,!1),zo(E,!1))},y=function(){return(y=w(x().mark(function e(t){var r,i,a,s;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=Vo(t),e.prev=1,r.s();case 2:if((i=r.n()).done){e.next=4;break}return a=i.value,e.next=3,o(n,a);case 3:e.next=2;break;case 4:e.next=6;break;case 5:e.prev=5,s=e.catch(1),r.e(s);case 6:return e.prev=6,r.f(),e.finish(6);case 7:case"end":return e.stop()}},e,null,[[1,5,6,7]])}))).apply(this,arguments)},g=function(e){return y.apply(this,arguments)},m=function(){return(m=w(x().mark(function e(t){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!I){e.next=1;break}L.removeChild(I),I=void 0,e.next=2;break;case 1:return e.next=2,p();case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)},h=function(e){return m.apply(this,arguments)},f=function(){return(f=w(x().mark(function e(){var n;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(I=t.createElement("div")).setAttribute("style","display: flex; flex-flow: wrap;"),n=I,e.next=1,qo(t,i,R,s);case 1:n.appendChild.call(n,e.sent),I.appendChild(b),I.appendChild(E),I.appendChild(_),I.appendChild(C),L.appendChild(I);case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)},p=function(){return f.apply(this,arguments)},d=function(){I&&(L.removeChild(I),I=void 0)},u=function(){return(u=w(x().mark(function e(r){var i;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,vi(t,0,L,v.vcard("url"),void 0,"Solid ID");case 1:if(i=e.sent){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",o(n,i));case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)},l=function(e){return u.apply(this,arguments)},c=function(){return(c=w(x().mark(function e(t,n){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i.permanent?(zo(_,!0),zo(b,!1),zo(E,!1)):d(),e.abrupt("return",o(t,n));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)},s=function(e,t){return c.apply(this,arguments)},(b=gi(t)).setAttribute("data-testid","accept-button"),(E=mi(t)).setAttribute("data-testid","cancel-button"),C=t.createElement("div"),k=i.targetClass?En(i.targetClass):"item",(A=fi(t,C,k,a)).setAttribute("data-testid","delete-button"),(_=hi(t,Yo,"Edit",function(e){S=!S,T()})).setAttribute("data-testid","edit-button"),S=!0,R={acceptButton:b,cancelButton:E,editButton:_,deleteButton:A},I=void 0,(L=t.createElement("div")).style.display="flex",L.style.flexDirection="row",!i.permanent&&!i.currentObject){e.next=1;break}return e.next=1,p();case 1:return r.editable&&(L.style.width="100%",r.manualURIEntry&&sr(L.appendChild(hi(t,Qo,r.idNoun,l)),g,void 0),!r.dbLookup||i.currentObject||i.permanent||L.appendChild(hi(t,Zo,r.idNoun,h))),T(),e.abrupt("return",L);case 2:case"end":return e.stop()}},e)})),ea.apply(this,arguments)}function ta(e){return function(e){if(Array.isArray(e))return Kn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Vn(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}
/**
 * @version IconicMultiSelect v0.7.0
 * @licence  MIT
 */
var na={multiselect__container:"\n        -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n        background-color: #fff;\n        border-radius: 2px;\n        -webkit-box-shadow: 0 1px 3px 0 #d1d1d2, 0 0 0 1px #d1d1d2;\n                box-shadow: 0 1px 3px 0 #d1d1d2, 0 0 0 1px #d1d1d2;\n        -webkit-box-sizing: border-box;\n                box-sizing: border-box;\n        display: -webkit-box;\n        display: -ms-flexbox;\n        display: flex;\n        min-height: 36px;\n        padding: 4px 8px 0 8px;\n        position: relative;\n        width: 354px;\n        margin-bottom: 5px;\n        font-size: 100%\n    ",multiselect__wrapper:"\n        display: -webkit-box;\n        display: -ms-flexbox;\n        display: flex;\n        -ms-flex-wrap: wrap;\n            flex-wrap: wrap;\n        height: 100%;\n        width: 100%;\n    ",multiselect__clear_btn:"\n        cursor: pointer;\n        align-items: center;\n        margin-bottom: 4px;\n        margin-left: 4px;\n    ",multiselect__options:"\n        background-color: #f6f6f6;\n        border-radius: 2px;\n        left: 0;\n        max-height: 0;\n        overflow: hidden;\n        position: absolute;\n        top: calc(100% + 3px);\n        z-index: 9999;\n        width: 100%;\n        opacity: 0;\n        transition: max-height 0.1s ease;\n    ",multiselect__options_visible:"\n        background-color: #f6f6f6;\n        border-radius: 2px;\n        left: 0;\n        max-height: 0;\n        overflow: hidden;\n        position: absolute;\n        top: calc(100% + 3px);\n        z-index: 9999;\n        width: 100%;\n        opacity: 0;\n        transition: max-height 0.1s ease;\n        max-height: 200px;\n        -webkit-box-shadow: 0 1px 3px 0 #d1d1d2, 0 0 0 1px #d1d1d2;\n        box-shadow: 0 1px 3px 0 #d1d1d2, 0 0 0 1px #d1d1d2;\n        opacity: 1;\n        transition: max-height 0.2s ease;\n    ",multiselect__options_ul:"\n        list-style: none;\n        margin: 0;\n        padding: 2px 0;\n        max-height: 200px;\n        overflow: auto;\n    ",multiselect__options_ul_li:"\n        cursor: pointer;\n        padding: 4px 8px;\n    ",multiselect__options_ul_li_hover:"\n        background-color: #dedede;\n    ",multiselect__options_ul_p_multiselect__options_no_results:"\n        margin: 0;\n        padding: 8px;\n        text-align: center;\n    ",multiselect__options_ul_p_multiselect__options_no_data:"\n        margin: 0;\n        padding: 8px;\n        text-align: center;\n    ",multiselect__options_ul_li_multiselect__options_selected:"\n        background-color: #656565;\n        color: #fff;\n    ",multiselect__options_ul_li_multiselect__options_selected_hover:"\n    background-color: #656565;\n    ",multiselect__options_ul_li_arrow_selected:"\n        border: 2px solid rgba(101, 101, 101, 0.5);\n    ",multiselect__selected:"\n        background-color: #656565;\n        border-radius: 2px;\n        color: #fff;\n        margin-bottom: 4px;\n        margin-right: 4px;\n        padding: 4px 8px;\n        display: -webkit-box;\n        display: -ms-flexbox;\n        display: flex;\n        -webkit-box-align: center;\n        -ms-flex-align: center;\n        align-items: center;\n    ",multiselect__selected_multiselect__remove_btn:"\n        cursor: pointer;\n        display: flex;\n        margin-left: 6px;\n    ",multiselect__input:"\n        border: none;\n        -ms-flex-preferred-size: 40%;\n            flex-basis: 40%;\n        -webkit-box-flex: 1;\n            -ms-flex-positive: 1;\n                flex-grow: 1;\n        height: 5px;        \n        margin-bottom: 4px;\n        min-width: 40%;\n        outline: none;      \n    ",setStyle:function(e,t){e.style=na[t]}},ra=function(){return qn(function e(t){var n=t.data,r=t.itemTemplate,i=t.noData,o=t.noResults,a=t.placeholder,s=t.select,c=t.container,l=t.tagTemplate,u=t.textField,d=t.valueField;Wn(this,e),Mi(this,"_data",void 0),Mi(this,"_domElements",void 0),Mi(this,"_event",function(){}),Mi(this,"_itemTemplate",void 0),Mi(this,"_multiselect",void 0),Mi(this,"_noData",void 0),Mi(this,"_noResults",void 0),Mi(this,"_options",[]),Mi(this,"_placeholder",void 0),Mi(this,"_select",void 0),Mi(this,"_selectContainer",void 0),Mi(this,"_selectedOptions",[]),Mi(this,"_tagTemplate",void 0),Mi(this,"_textField",void 0),Mi(this,"_valueField",void 0),Mi(this,"_cross",'\n    <svg\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      xmlns="http://www.w3.org/2000/svg"\n    >\n      <path\n        d="M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z"\n        fill="currentColor"\n      />\n    </svg>\n    '),this._data=null!=n?n:[],this._itemTemplate=null!=r?r:null,this._noData=null!=i?i:"No data found.",this._noResults=null!=o?o:"No results found.",this._placeholder=null!=a?a:"Select...",this._select=s,this._selectContainer=c,this._tagTemplate=null!=l?l:null,this._textField=null!=u?u:null,this._valueField=null!=d?d:null},[{key:"init",value:function(){if(!this._select||"SELECT"!==this._select.nodeName)throw new Error("The selector '".concat(this._select,"' did not select any valid select tag."));if(this._itemTemplate&&0===this._data.length)throw new Error("itemTemplate must be initialized with data from the component settings");if(this._tagTemplate&&0===this._data.length)throw new Error("tagTemplate must be initialized with data from the component settings");this._options=this._data.length>0?this._getDataFromSettings():this._getDataFromSelectTag(),this._renderMultiselect(),this._renderOptionsList(),this._domElements={clear:this._multiselect.querySelector(".multiselect__clear-btn"),input:this._multiselect.querySelector(".multiselect__input"),optionsContainer:this._multiselect.querySelector(".multiselect__options"),optionsContainerList:this._multiselect.querySelector(".multiselect__options > ul"),options:{list:this._multiselect.querySelectorAll(".multiselect__options > ul > li"),find:function(e){for(var t=0;t<this.list.length;t++){var n=this.list[t];if(e(n))return n}},some:function(e){for(var t=0;t<this.list.length;t++){if(e(this.list[t],t))return!0}return!1}}},this._enableEventListenners(),this._initSelectedList()}},{key:"subscribe",value:function(e){if("function"!=typeof e)throw new Error("parameter in the subscribe method is not a function");this._event=e}},{key:"_addOptionToList",value:function(e,t){var n=this,r='<span class="multiselect__selected" style="'.concat(na.multiselect__selected,'" data-value="').concat(e.value,'">').concat(this._tagTemplate?this._processTemplate(this._tagTemplate,t):e.text,'<span class="multiselect__remove-btn" style="').concat(na.multiselect__remove_btn,'">').concat(this._cross,"</span></span>");this._domElements.input.insertAdjacentHTML("beforebegin",r),this._multiselect.querySelector('span[data-value="'.concat(e.value,'"]')).lastElementChild.addEventListener("click",function(){var t=n._domElements.options.find(function(t){return t.dataset.value===e.value});n._handleOption(t)})}},{key:"_clearSelection",value:function(){for(var e=this,t=function(){var t=e._selectedOptions[n],r=e._domElements.options.find(function(e){return e.dataset.value===t.value});r.classList.remove("multiselect__options--selected"),r.setAttribute("style",na.multiselect__options),e._removeOptionFromList(r.dataset.value)},n=0;n<this._selectedOptions.length;n++)t();this._selectedOptions=[],this._handleClearSelectionBtn(),this._handlePlaceholder(),this._dispatchEvent({action:"CLEAR_ALL_OPTIONS",selection:this._selectedOptions})}},{key:"_closeList",value:function(){this._domElements.input.value="",this._domElements.optionsContainer.classList.remove("visible"),this._domElements.optionsContainer.setAttribute("style",na.multiselect__options),this._filterOptions(""),this._removeAllArrowSelected()}},{key:"_dispatchEvent",value:function(e){this._event(e)}},{key:"_enableEventListenners",value:function(){var e=this;document.addEventListener("mouseup",function(t){var n=t.target;e._multiselect.contains(n)||(e._filterOptions(""),e._closeList(),e._handlePlaceholder())}),this._domElements.clear.addEventListener("click",function(){e._clearSelection()});for(var t=0;t<this._domElements.options.list.length;t++){this._domElements.options.list[t].addEventListener("click",function(t){var n=t.target;e._handleOption(n),e._closeList()})}this._domElements.input.addEventListener("focus",function(){e._domElements.optionsContainer.classList.add("visible"),e._domElements.optionsContainer.setAttribute("style",na.multiselect__options_visible)}),this._domElements.input.addEventListener("input",function(t){var n=t.target.value;e._domElements.options.list.length>0&&e._filterOptions(n)}),this._domElements.input.addEventListener("keydown",function(t){e._handleArrows(t),e._handleBackspace(t),e._handleEnter(t)})}},{key:"_filterOptions",value:function(e){var t=this,n=this._domElements.optionsContainer.classList.contains("visible"),r=e.toLowerCase();if(!n&&e.length>0&&(this._domElements.optionsContainer.classList.add("visible"),this._domElements.optionsContainer.setAttribute("style",na.multiselect__options_visible)),this._domElements.options.list.length>0){for(var i=0;i<this._domElements.options.list.length;i++){var o=this._domElements.options.list[i];(this._itemTemplate?this._data[i][this._textField]:o.textContent).toLowerCase().substring(0,r.length)===r?this._domElements.optionsContainerList.appendChild(o):o.parentNode&&o.parentNode.removeChild(o)}var a=this._domElements.options.some(function(e,n){return(t._itemTemplate?t._data[n][t._textField]:e.textContent).toLowerCase().substring(0,r.length)===r});this._showNoResults(!a)}}},{key:"_generateId",value:function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(62*Math.random()));return t}},{key:"_getDataFromSelectTag",value:function(){for(var e=[],t=this._select.options,n=0;n<t.length;n++){var r=t[n];e.push({text:r.text,value:r.value,selected:r.hasAttribute("selected")})}return e}},{key:"_getDataFromSettings",value:function(){if(this._data.length>0&&this._valueField&&this._textField){var e="string"==typeof this._valueField,t="string"==typeof this._textField,n=[];if(!e||!t)throw new Error("textField and valueField must be of type string");for(var r=0;r<this._data.length;r++){var i=this._data[r];n.push({value:i[this._valueField],text:i[this._textField],selected:"boolean"==typeof i.selected&&i.selected})}return n}return null}},{key:"_handleArrows",value:function(e){if(40===e.keyCode||38===e.keyCode){e.preventDefault();var t=this._domElements.optionsContainer.classList.contains("visible"),n=this._multiselect.querySelector(".multiselect__options > ul");if(t){var r=this._multiselect.querySelector(".multiselect__options ul li.arrow-selected"),i={ArrowUp:"previous",Up:"previous",ArrowDown:"next",Down:"next"};if(!r)return n.firstElementChild.classList.add("arrow-selected"),n.firstElementChild.setAttribute("style",na.multiselect__options_ul_li_arrow_selected),void n.firstElementChild.scrollIntoView(!1);if(r.classList.remove("arrow-selected"),r.setAttribute("style",na.multiselect__options_ul_li),!(r=r[i[e.key]+"ElementSibling"]))return(r=n.children["next"===i[e.key]?0:n.children.length-1]).classList.add("arrow-selected"),r.setAttribute("style",na.multiselect__options_ul_li_arrow_selected),void this._scrollIntoView(n,r);r.classList.add("arrow-selected"),r.setAttribute("style",na.multiselect__options_ul_li_arrow_selected),this._scrollIntoView(n,r)}else this._domElements.optionsContainer.classList.add("visible"),this._domElements.optionsContainer.setAttribute("style",na.multiselect__options_visible),n.firstElementChild.classList.add("arrow-selected"),n.firstElementChild.setAttribute("style",na.multiselect__options_ul_li_arrow_selected),n.firstElementChild.scrollIntoView(!1)}}},{key:"_handleBackspace",value:function(e){if(8===e.keyCode&&""===e.target.value){var t=this._selectedOptions.length>0?this._selectedOptions[this._selectedOptions.length-1]:null;if(t){var n=this._multiselect.querySelector('li[data-value="'.concat(t.value,'"]'));this._handleOption(n),0===this._selectedOptions.length&&(this._domElements.optionsContainer.classList.remove("visible"),this._domElements.optionsContainer.setAttribute("style",na.multiselect__options))}}}},{key:"_handleClearSelectionBtn",value:function(){this._selectedOptions.length>0?this._domElements.clear.style.display="flex":this._domElements.clear.style.display="none"}},{key:"_handleEnter",value:function(e){if(13===e.keyCode){var t=this._multiselect.querySelector(".multiselect__options ul li.arrow-selected");t&&(this._handleOption(t),this._closeList())}}},{key:"_handleOption",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=0;n<this._selectedOptions.length;n++){if(this._selectedOptions[n].value===e.dataset.value)return e.classList.remove("multiselect__options--selected"),e.setAttribute("style",na.multiselect__options),this._selectedOptions.splice(n,1),this._removeOptionFromList(e.dataset.value),this._handleClearSelectionBtn(),this._handlePlaceholder(),t&&this._dispatchEvent({action:"REMOVE_OPTION",value:e.dataset.value,selection:this._selectedOptions})}for(var r=0;r<this._options.length;r++){var i=this._options[r];if(i.value===e.dataset.value)return e.classList.add("multiselect__options--selected"),e.setAttribute("style",na.multiselect__options_selected),this._selectedOptions=[].concat(ta(this._selectedOptions),[i]),this._addOptionToList(i,r),this._handleClearSelectionBtn(),this._handlePlaceholder(),t&&this._dispatchEvent({action:"ADD_OPTION",value:e.dataset.value,selection:this._selectedOptions})}}},{key:"_handlePlaceholder",value:function(){this._domElements.input.placeholder=this._placeholder}},{key:"_initSelectedList",value:function(){for(var e=this,t=!1,n=function(){var n=e._options[r];if(n.selected){t=!0;var i=e._domElements.options.find(function(e){return e.dataset.value===n.value});i.classList.add("multiselect__options--selected"),i.setAttribute("style",na.multiselect__options_selected),e._selectedOptions=[].concat(ta(e._selectedOptions),[n]),e._addOptionToList(n,r)}},r=0;r<this._options.length;r++)n();t&&this._handleClearSelectionBtn(),this._handlePlaceholder()}},{key:"_processTemplate",value:function(e,t){for(var n=e,r=e.match(/\$\{(\w+)\}/g).map(function(e){return e.replace(/\$\{|\}/g,"")}),i=0;i<r.length;i++){var o,a=r[i];n=n.replace("${".concat(a,"}"),null!==(o=this._data[t][a])&&void 0!==o?o:"")}return n}},{key:"_removeAllArrowSelected",value:function(){var e="arrow-selected",t=this._domElements.options.find(function(t){return t.classList.contains(e)});t&&t.classList.remove(e)&&t.setAttribute("style",na.multiselect__options_ul_li)}},{key:"_removeOptionFromList",value:function(e){var t=this._multiselect.querySelector('span[data-value="'.concat(e,'"]'));t&&t.parentNode&&t.parentNode.removeChild(t)}},{key:"_renderOptionsList",value:function(){var e=this,t='\n        <div class="multiselect__options" style="'.concat(na.multiselect__options,'">\n          <ul style="').concat(na.multiselect__options_ul,'">\n          ').concat(this._options.length>0&&!this._itemTemplate?this._options.map(function(e){return'\n              <li data-value="'.concat(e.value,'" style="').concat(na.multiselect__options_ul_li,'">').concat(e.text,"</li>\n            ")}).join(""):"","\n\n          ").concat(this._options.length>0&&this._itemTemplate?this._options.map(function(t,n){return'\n              <li data-value="'.concat(t.value,'" style="').concat(na.multiselect__options_ul_li,'">').concat(e._processTemplate(e._itemTemplate,n),"</li>\n            ")}).join(""):"","\n          ").concat(this._showNoData(0===this._options.length),"\n          </ul>\n        </div>\n      ");this._multiselect.insertAdjacentHTML("beforeend",t)}},{key:"_renderMultiselect",value:function(){this._select.style.display="none";var e="iconic-"+this._generateId(20);this._multiselect=document.createElement("div"),this._multiselect.setAttribute("id",e),this._multiselect.setAttribute("class","multiselect__container"),this._multiselect.setAttribute("style",na.multiselect__container);var t='\n        <div class="multiselect__wrapper" style="'.concat(na.multiselect__wrapper,'">\n          <input class="multiselect__input" style="').concat(na.multiselect__input,'" placeholder="').concat(this._placeholder,'" />\n        </div>\n        <span style="display: none;" class="multiselect__clear-btn" style="').concat(na.multiselect__clear_btn,'">').concat(this._cross,"</span>\n    ");this._multiselect.innerHTML=t,this._selectContainer.appendChild(this._multiselect)}},{key:"_scrollIntoView",value:function(e,t){var n=e.getBoundingClientRect(),r=t.getBoundingClientRect();n.top<r.bottom-t.offsetHeight||(e.scrollTop=t.clientHeight+(t.offsetTop-t.offsetHeight)),n.bottom>r.top+t.offsetHeight||(e.scrollTop=t.clientHeight+(t.offsetTop-t.offsetHeight)-(e.offsetHeight-(t.offsetHeight+(t.offsetHeight-t.clientHeight))))}},{key:"_showNoData",value:function(e){return e?'<p class="multiselect__options--no-data" style="'.concat(na.multiselect__options_ul_p_multiselect__options_no_data,'">').concat(this._noData,"</p>"):""}},{key:"_showNoResults",value:function(e){var t=this._multiselect.querySelector(".multiselect__options--no-results");if(e){var n='<p class="multiselect__options--no-results" style="'.concat(na.multiselect__options_ul_p_multiselect__options_no_results,'">').concat(this._noResults,"</p>");!t&&this._domElements.optionsContainerList.insertAdjacentHTML("beforeend",n)}else t&&t.parentNode&&t.parentNode.removeChild(t)}}])}();function ia(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return oa(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?oa(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function oa(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var aa="",sa="",ca="-",la=qt;function ua(e,t,n,r,i,o,a){for(var s=o.children,c=0;c<a.length;c++){var l=a[c];if(qi(l)===v.ui("Options").uri){var u=Ki(0,l)(e,null,t,n,l,r,i);kn.Rm("Refreshing Options field by replacing it."),o.insertBefore(u,s[c]),o.removeChild(s[c+1])}}}function da(e,t,n,r,i,o,a,s){var c=v.ui,l=qt,u=l.any(i,c("property"));if(!u){var d=Wr(e,"No property to boolean field: "+i);return t&&t.appendChild(d),d}var p=l.any(i,c("label"));p||(p=En(u,!0)),o=Yi(r,u,o);var f=l.any(r,u);void 0===f&&(f=!1);var h=m.st(r,u,!0,o),g=Sa(e,l,p,m.st(r,u,!1,o),h,i,o,s);return t&&t.appendChild(g),g}function pa(e,t,n,r,i,o,a){Ki(0,i)(e,t,n,r,i,o,a)}function fa(e,t,n,r,i){var o=e.createElement("button");return o.setAttribute("type","button"),o.innerHTML="Edit "+En(v.ui("Form")),o.addEventListener("click",function(a){ha(e,t,{},n,v.ui("FormForm"),r,i).setAttribute("style",v.ui("FormForm").sameTerm(n)?"background-color: #fee;":"background-color: #ffffe7;"),o.parentNode.removeChild(o)},!0),o}function ha(e,t,n,r,i,o,a){return Ki(0,i)(e,t,n,r,i,o,a)}function ma(e,t){var n=e.each(void 0,v.rdf("range"),t);[v.rdfs("comment"),v.dc("title"),v.foaf("name"),v.foaf("homepage")].forEach(function(e){n.push(e)});var r=e.each(void 0,v.rdf("type"),t);r.length>60&&(r=r.slice(0,60));for(var i={},o=0;o<(r.length>60?60:r.length);o++)e.statementsMatching(r[o],void 0,void 0).forEach(function(e){i[e.predicate.uri]=!0});n.forEach(function(e){i[e.uri]=!0});var a=[];for(var s in i)a.push(e.sym(s));return a}function ga(e,t,n){for(var r=[e.sym(t)];r.length>0;){var i=r.shift(),o=e.each(i,n);if(ln("Lists for "+i+", "+n+": "+o.length),0!==o.length)return o;for(var a=e.each(i,v.rdfs("subClassOf")),s=0;s<a.length;s++)r.push(a[s]),ln("findClosest: add super: "+a[s])}return[]}function va(e){var t=qt;ln("formsFor: subject="+e);var n,r=t.findTypeURIs(e);for(n in r)ln("   type: "+n);var i=t.bottomTypeURIs(r),o=[];for(var a in i)ln("candidatesFor: trying bottom type ="+a),o=(o=o.concat(ga(t,a,v.ui("creationForm")))).concat(ga(t,a,v.ui("annotationForm")));return o}function ya(e){var t=e.map(function(e){return[la.any(e,v.ui("sequence"))||9999,e]});return t.sort(function(e,t){return e[0]-t[0]}),t.map(function(e){return e[1]})}function wa(e){var t=e.map(function(e){return[En(e).toLowerCase(),e]});return t.sort(),t.map(function(e){return e[1]})}function ba(e,t,n,r,i,o,a,s){var c=e.createElement("button");return c.setAttribute("type","button"),c.innerHTML="New "+En(i),c.addEventListener("click",function(l){c.parentNode.appendChild(xa(e,t,n,r,i,o,a,s))},!1),c}function xa(e,t,n,r,i,o,a,s){var c=e.createElement("form");if(!o){var l=ga(t,i.uri,v.ui("creationForm"));if(0===l.length){c.appendChild(e.createElement("p")).textContent="I am sorry, you need to provide information about a "+En(i)+" but I don't know enough information about those to ask you.";var u=c.appendChild(e.createElement("button"));return u.setAttribute("type","button"),u.setAttribute("style","float: right;"),u.innerHTML="Goto "+En(i),u.addEventListener("click",function(t){e.outlineManager.GotoSubject(i,!0,void 0,!0,void 0)},!1),c}ln("lists[0] is "+l[0]),o=l[0]}ln("form is "+o),c.setAttribute("style","border: 0.05em solid ".concat(or.formBorderColor,"; color: ").concat(or.formBorderColor)),c.innerHTML="<h3>New "+En(i)+"</h3>";var d=Ki(0,o),p=Ta(a),f=!1;function h(e,t,n){return s(t,n)}un("paneUtils Object is "+p);var g=d(e,c,{},p,o,a,function(o,l){if(!o)return s(o,l);var u=[];n&&!t.holds(n,r,p,a)&&u.push(m.st(n,r,p,a)),n&&!t.holds(p,v.rdf("type"),i,a)&&u.push(m.st(p,v.rdf("type"),i,a)),u.length?t.updater.update([],u,h):s(!0,l),f||(f=c.appendChild(Ri(e,p)))});return Ii(e,g).setAttribute("style","float: right;"),c.AJAR_subject=p,c}function Ea(e,t,n,r,i,o){var a,s=e.createElement("div"),c=t.anyJS(n,r,null,i)||"",l=e.createElement("textarea");function u(c){a.disabled=!0,a.setAttribute("style","visibility: hidden; float: right;"),l.disabled=!0,l.style.color=or.textInputColorPending;var u=t.statementsMatching(n,r,null,i),d=m.st(n,r,l.value,i);t.updater.update(u,d,function(t,n,r){n?(l.style.color=or.textInputColor,l.disabled=!1):s.appendChild(Wr(e,"Error (while saving change to "+i.uri+"): "+r)),o&&o(n,r)})}return s.appendChild(l),l.rows=c?c.split("\n").length+2:2,l.cols=80,l.setAttribute("style",ar.multilineTextInputStyle),null!==c?l.value=c:l.select(),s.refresh=function(){var e=t.any(n,r,null,i);e&&e.value!==l.value&&(l.value=e.value)},t.updater.editable(i.uri)?((a=gi(e,u)).disabled=!0,a.style.visibility="hidden",a.style.float="right",s.appendChild(a),l.addEventListener("keyup",function(e){l.style.color="green",a&&(a.disabled=!1,a.style.visibility="")},!0),l.addEventListener("change",u,!0)):(l.disabled=!0,l.style.backgroundColor=or.textInputBackgroundColorUneditable),s}function Ca(e,t,n,r,i,o,a,s){ln("Select list length now "+i.length);for(var c,l=0,u={},d=t.updater.editable(a.uri),p=0;p<i.length;p++){var f=i[p];f.uri||kn.R8("makeSelectForClassifierOptions: option does not have an uri: ".concat(f,", with predicate: ").concat(r)),f.uri&&!(f.uri in u)&&(u[f.uri]=!0,l++)}if(0===l&&!o.mint)return Wr(e,"Can't do selector with no options, subject= "+n+" property = "+r+".");ln("makeSelectForClassifierOptions: dataDoc="+a);var h=function(){return c={},r.sameTerm(v.rdf("type"))?c=t.findTypeURIs(n):t.each(n,r,null,a).forEach(function(e){c[e.uri]=!0}),c};c=h();var g=e.createElement("select");for(var y in g.setAttribute("style",ar.formSelectStyle),o.multiple&&g.setAttribute("multiple","true"),g.currentURI=null,g.refresh=function(){c=h();for(var e=0;e<g.children.length;e++){var t=g.children[e];t.AJAR_uri&&(t.selected=t.AJAR_uri in c)}g.disabled=!1},u){var w=t.sym(y),b=e.createElement("option");o.disambiguate?b.appendChild(e.createTextNode(Br(w,!0))):b.appendChild(e.createTextNode(En(w,!0)));var x=t.any(w,t.sym("http://www.w3.org/ns/ui#backgroundColor"));x&&b.setAttribute("style","background-color: "+x.value+"; "),b.AJAR_uri=y,y in c&&(b.setAttribute("selected","true"),g.currentURI=y),g.appendChild(b)}if(d&&o.mint){var E=e.createElement("option");E.appendChild(e.createTextNode(o.mint)),E.AJAR_mint=!0,g.insertBefore(E,g.firstChild)}if(null==g.currentURI&&!o.multiple){var C=e.createElement("option");C.appendChild(e.createTextNode(o.nullLabel)),g.insertBefore(C,g.firstChild),C.selected=!0}return d&&g.addEventListener("change",function(i){g.disabled=!0;for(var l,u=[],d=[],p=function(e){t.holds(n,r,e,a)&&u.push(m.st(n,r,e,a))},f=0;f<g.options.length;f++){var v=g.options[f];if(v.selected&&v.AJAR_mint){if(o.mintClass){var y=xa(e,t,n,r,o.mintClass,null,a,function(e,t){e||s(e,t,{change:"new"})});g.parentNode.appendChild(y),l=y.AJAR_subject}else l=Ta(a);d.push(m.st(n,r,l,a)),o.mintStatementsFun&&(d=d.concat(o.mintStatementsFun(l)))}v.AJAR_uri&&(v.selected&&!(v.AJAR_uri in c)&&d.push(m.st(n,r,t.sym(v.AJAR_uri),a)),!v.selected&&v.AJAR_uri in c&&p(t.sym(v.AJAR_uri)),v.selected&&(g.currentURI=v.AJAR_uri))}for(var w=g.subSelect;w&&w.currentURI;)p(t.sym(w.currentURI)),w=w.subSelect;for(w=g.superSelect;w&&w.currentURI;)p(t.sym(w.currentURI)),w=w.superSelect;function b(e,t){s(e,{widget:"select",event:"new"})}un("makeSelectForClassifierOptions: data doc = "+a),t.updater.update(u,d,function(t,n,r){if(c=h(),!n)return g.parentNode.appendChild(Wr(e,"Error updating data in select: "+r));g.disabled=!1,l&&Ki(0,o.subForm)(e,g.parentNode,{},l,o.subForm,a,b),s&&s(n,{widget:"select",event:"change"})})},!1),g}function ka(e,t,n,r,i,o,a,s){ln("Select list length now "+i.length);for(var c,l=0,u={},d=t.updater.editable(a.uri),p=0;p<i.length;p++){var f=i[p];f.uri||kn.R8("makeSelectForOptions: option does not have an uri: ".concat(f,", with predicate: ").concat(r)),f.uri&&!(f.uri in u)&&(u[f.uri]=!0,l++)}if(0===l)return Wr(e,"Can't do selector with no options, subject= "+n+" property = "+r+".");ln("makeSelectForOptions: dataDoc="+a);var h=function(){return c={},r.sameTerm(v.rdf("type"))?c=t.findTypeURIs(n):t.each(n,r,null,a).forEach(function(e){e.uri&&(c[e.uri]=!0)}),c};c=h();var g=e.createElement("select");for(var y in g.setAttribute("style",ar.formSelectStyle),g.currentURI=null,g.refresh=function(){c=h();for(var e=0;e<g.children.length;e++){var t=g.children[e];t.AJAR_uri&&(t.selected=t.AJAR_uri in c)}g.disabled=!1},u){var w=t.sym(y),b=e.createElement("option");o.disambiguate?b.appendChild(e.createTextNode(Br(w,!0))):b.appendChild(e.createTextNode(En(w,!0)));var x=t.any(w,t.sym("http://www.w3.org/ns/ui#backgroundColor"));x&&b.setAttribute("style","background-color: "+x.value+"; "),b.AJAR_uri=y,y in c&&(b.setAttribute("selected","true"),g.currentURI=y),g.appendChild(b)}if(!g.currentURI){var E=e.createElement("option");E.appendChild(e.createTextNode(o.nullLabel)),g.insertBefore(E,g.firstChild),E.selected=!0}return d&&g.addEventListener("change",function(i){g.disabled=!0;for(var o=[],l=[],u=function(e){t.holds(n,r,e,a)&&o.push(m.st(n,r,e,a))},d=0;d<g.options.length;d++){var p=g.options[d];p.AJAR_uri&&(p.selected&&!(p.AJAR_uri in c)&&l.push(m.st(n,r,t.sym(p.AJAR_uri),a)),!p.selected&&p.AJAR_uri in c&&u(t.sym(p.AJAR_uri)),p.selected&&(g.currentURI=p.AJAR_uri))}for(var f=g.subSelect;f&&f.currentURI;)u(t.sym(f.currentURI)),f=f.subSelect;for(f=g.superSelect;f&&f.currentURI;)u(t.sym(f.currentURI)),f=f.superSelect;un("selectForOptions: data doc = "+a),t.updater.update(o,l,function(t,n,r){if(c=h(),!n)return g.parentNode.appendChild(Wr(e,"Error updating data in select: "+r));g.disabled=!1,s&&s(n,{widget:"select",event:"change"})})},!1),g}function Aa(e,t,n,r,i,o){var a,s=t.any(r,v.owl("disjointUnionOf")),c=!1;return s?a=s.elements:(a=t.each(void 0,v.rdfs("subClassOf"),r),c=!0),ln("Select list length "+a.length),0===a.length?Wr(e,"Can't do "+(c?"multiple ":"")+"selector with no subclasses of category: "+r):1===a.length?Wr(e,"Can't do "+(c?"multiple ":"")+"selector with only 1 subclass of category: "+r+":"+a[1]):Ca(e,t,n,v.rdf("type"),a,{multiple:c,nullLabel:"* Select type *"},i,o)}function _a(e,t,n,r,i,o){function a(){c&&(s.removeChild(c),c=null),l.currentURI&&t.any(t.sym(l.currentURI),v.owl("disjointUnionOf"))&&(c=_a(e,t,n,t.sym(l.currentURI),i,o),l.subSelect=c.firstChild,l.subSelect.superSelect=l,s.appendChild(c))}var s=e.createElement("span"),c=null;var l=Aa(e,t,n,r,i,function(e,t){e&&a(),o(e,t)});return s.appendChild(l),a(),s}function Sa(e,t,n,r,i,o,a,s){var c=e.createElement("div"),l=Qi(e,t,c,o,n),u=t.updater.editable(a.uri),d=e.createElement("button"),p=d;function f(e){if(!e)return[];if(e.object)return e.why||(e.why=a),[e];if(e instanceof Array)return e;throw new Error("buildCheckboxForm: bad param "+e)}function h(e){return 0===e.filter(function(e){return!t.holds(e.subject,e.predicate,e.object,e.why)}).length}if(d.style=ar.checkboxInputStyle,l.appendChild(d),i=f(i),r=f(r),function(){var n=h(i),a=n;if(r.length){var l=h(r);if(n&&l)return c.appendChild(Wr(e,"Inconsistent data in dataDoc!\n"+i+" and\n"+r)),c;if(!n&&!l){n=null;var u=t.any(o,v.ui("default"));a=u?"1"===u.value:!!s&&null}}d.state=n,d.textContent={true:aa,false:s?sa:" ",null:ca}[a]}(),!u)return c;return d.addEventListener("click",function(n){p.style.color="#bbb";var o=!0===d.state?i:!1===d.state?r:[];d.newState=null===d.state||!0!==d.state&&(!s||null);var a=!0===d.newState?i:!1===d.newState?r:[];kn.Rm("  Deleting  ".concat(o)),kn.Rm("  Inserting ".concat(a)),t.updater.update(o,a,function(n,r,i){if(r)p.style.color="#000",d.state=d.newState,d.textContent={true:aa,false:sa,null:ca}[d.state];else{if(o.why)t.holds(o.subject,o.predicate,o.object,o.why)&&kn.Rm(" @@@@@ weird if 409 - does hold statement");p.style.color="#000",p.style.backgroundColor="#fee",c.appendChild(Wr(e,"Checkbox: Error updating dataDoc from ".concat(d.state," to ").concat(d.newState,":\n\n").concat(i)))}})},!1),c}function Ta(e){var t=new Date;return m.sym(e.uri+"#id"+t.getTime())}function Ra(e,t,n,r,i,o,a,s,c,l,u){for(var d={},p=n.updater.editable(l.uri),f=0;f<o.length;f++){var h=o[f];h.uri&&!(h.uri in d)&&(d[h.uri]=!0)}if(0===Object.keys(d).length&&!c.mint)return Wr(e,"Can't do selector with no options, subject= "+r+" property = "+i+".");ln("makeSelectForChoice: dataDoc="+l);var g,y,w=e.createElement("select");for(var b in w.setAttribute("style",ar.formSelectStyle),w.setAttribute("id","formSelect"),w.currentURI=null,d)w.appendChild(E(b));if(p&&c.mint){var x=e.createElement("option");x.appendChild(e.createTextNode(c.mint)),x.AJAR_mint=!0,w.insertBefore(x,w.firstChild)}function E(t){var r,i=e.createElement("option"),o=n.sym(t);r=c.disambiguate?Br(o,!0):En(o,!0),i.appendChild(e.createTextNode(r)),i.setAttribute("value",t);var s=n.any(o,n.sym("http://www.w3.org/ns/ui#backgroundColor"));return s&&i.setAttribute("style","background-color: "+s.value+"; "),i.AJAR_uri=t,Ia(o.value,a)&&i.setAttribute("selected","true"),i}return 0===w.children.length&&w.insertBefore(((y=e.createElement("option")).appendChild(e.createTextNode((g="--- choice ---",i&&"BlankNode"!==i.termType&&(g="* Select for property: "+En(i)+" *"),r&&"BlankNode"!==r.termType&&(g="* Select for "+En(r,!0)+" *"),g))),y.disabled=!0,y.value=!0,y.hidden=!0,y.selected=!0,y),w.firstChild),w.update=function(t){a=t;var o,c=[],d=[],p=function(e){n.holds(r,i,e,l)&&c.push(m.st(r,i,e,l))},f=function(e){n.holds(r,i,e,l)||d.push(m.st(r,i,e,l)),s&&!n.holds(e,v.rdf("type"),n.sym(s),l)&&d.push(m.st(e,v.rdf("type"),n.sym(s),l))},h=n.each(r,i,null,l).map(function(e){return e.value}),g=ia(h);try{for(g.s();!(o=g.n()).done;){var y=o.value;Ia(y,a)||p(m.sym(y))}}catch(e){g.e(e)}finally{g.f()}var b,x=ia(a);try{for(x.s();!(b=x.n()).done;){var E=b.value;E in h||f(m.sym(E))}}catch(e){x.e(e)}finally{x.f()}n.updater.update(c,d,function(t,n,r){if(!n)return w.parentNode.appendChild(Wr(e,"Error updating data in select: "+r));w.refresh(),u&&u(n,{widget:"select",event:"change"})})},w.refresh=function(){w.disabled=!0;for(var o,d=[],p=0;p<w.options.length;p++){var f=w.options[p];if(f.selected&&f.AJAR_mint){if(c.mintClass){var h=xa(e,n,r,i,s,c.subForm,l,function(e,t){e||u(e,t,{change:"new"})});w.parentNode.appendChild(h),o=h.AJAR_subject}else o=Ta(l);d.push(m.st(r,i,n.sym(o),l)),s&&d.push(m.st(o,v.rdf("type"),n.sym(s),l)),c.mintStatementsFun&&(d=d.concat(c.mintStatementsFun(o))),w.currentURI=o}f.AJAR_uri&&(f.selected&&Ia(f.AJAR_uri,a)&&(w.currentURI=f.AJAR_uri),Ia(f.AJAR_uri,a)||f.removeAttribute("selected"),Ia(f.AJAR_uri,a)&&f.setAttribute("selected","true"))}un("selectForOptions: data doc = "+l),w.currentURI&&c.subForm&&!c.multiSelect&&pa(e,t,{},m.sym(w.currentURI),c.subForm,l,function(r,i){r?(n.updater.update([],d,function(n,r,i){r||t.appendChild(Wr(e,"Error updating select: "+i))}),u&&u(r,{widget:"select",event:"new"})):t.appendChild(Wr(e,"Error updating data in field of select: "+i))}),w.disabled=!1},p&&w.addEventListener("change",function(e){t.removeChild(t.lastChild),w.refresh()},!1),w}function Ia(e,t){var n;for(n=0;n<t.length;n++)if(t[n]===e)return!0;return!1}function La(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Na(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Na(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Na(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}zi[v.ui("AutocompleteField").uri]=function(e,t,n,r,i,o,a){var s;function c(){return(c=w(x().mark(function t(n,i){var s,c,l,d,f,h;return x().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i){t.next=1;break}throw new Error("autocompleteField:  No name set.");case 1:if(!(s=u.the(r,g,null,o))){t.next=2;break}if(c=u.any(s,y,null,o),!(s.equals(n)&&c&&c.sameTerm(i))){t.next=2;break}return t.abrupt("return");case 2:return l=s?u.statementsMatching(r,g,s,o).concat(u.statementsMatching(s,y,null,o)):[],d=[(0,m.st)(r,g,n,o),(0,m.st)(n,y,i,o)],t.prev=3,t.next=4,null===(f=u.updater)||void 0===f?void 0:f.updateMany(l,d);case 4:t.next=6;break;case 5:return t.prev=5,h=t.catch(3),a(!1,h),p.appendChild(Wr(e,"Autocomplete form data update error:"+h,null,h)),t.abrupt("return");case 6:a(!0,"");case 7:case"end":return t.stop()}},t,null,[[3,5]])}))).apply(this,arguments)}function l(){return(l=w(x().mark(function t(n,i){var s,c,l,d,f,h;return x().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(s=u.the(r,g,null,o)){t.next=1;break}return a(!1,"NO data to elete"),p.appendChild(Wr(e,"Autocomplete delete: no old data!")),t.abrupt("return");case 1:return c=u.statementsMatching(r,g,s,o).concat(u.statementsMatching(s,y,null,o)),l=[],t.prev=2,t.next=3,null===(d=u.updater)||void 0===d?void 0:d.updateMany(c,l);case 3:t.next=5;break;case 4:return t.prev=4,h=t.catch(2),f=new Error("Autocomplete form data delete error:"+h),a(!1,h),p.appendChild(Wr(e,f,null,h)),t.abrupt("return");case 5:a(!0,"");case 6:case"end":return t.stop()}},t,null,[[2,4]])}))).apply(this,arguments)}if("NamedNode"!==r.termType)throw new Error("Sorry this field only works on NamedNode subjects (for editable)");var u=qt,d=i.doc?i.doc():null,p=e.createElement("div");t&&t.appendChild(p);var f=e.createElement("div");f.setAttribute("class","formFieldName"),f.setAttribute("style",ar.formFieldNameBoxStyle),p.appendChild(f);var h=e.createElement("div");h.setAttribute("class","formFieldValue"),p.appendChild(h);var g=u.any(i,v.ui("property"));if(!g)return p.appendChild(Wr(e,"Error: No property given for autocomplete field: "+i));var y=u.any(i,v.ui("labelProperty"))||v.schema("name"),b=u.any(i,v.ui("dataSource"));if(!b)return p.appendChild(Wr(e,"Error: No data source given for autocomplete field: "+i));var E={label:u.anyJS(b,v.schema("name"),null,b.doc()),logo:u.any(b,v.schema("logo"),null,b.doc())},C=u.any(i,v.ui("targetClass"),null,i.doc())||u.any(b,v.ui("targetClass"),null,b.doc());C&&(E.targetClass=C),E.objectURIBase=u.any(b,v.ui("objectURIBase"),null,b.doc())||void 0;var k=u.anyJS(b,v.ui("endpoint"),null,b.doc());if(k){if(E.endpoint=k,E.searchByNameQuery=u.anyJS(b,v.ui("searchByNameQuery"),null,b.doc()),!E.searchByNameQuery)return p.appendChild(Wr(e,"Error: No searchByNameQuery given for endpoint data Source: "+i));E.insitituteDetailsQuery=u.anyJS(b,v.ui("insitituteDetailsQuery"),null,b.doc())}else{var A=u.anyJS(b,v.ui("searchByNameURI"));if(!A)return p.appendChild(Wr(e,"Error: No searchByNameURI OR sparql endpoint given for dataSource: "+b));E.searchByNameURI=A}var _=u.anyJS(i,v.ui("suppressEmptyUneditable"),null,d),S=null===(s=u.updater)||void 0===s?void 0:s.editable(o.uri),T={permanent:!0,targetClass:E.targetClass,queryParams:E};T.size=u.anyJS(i,v.ui("size"),null,d)||void 0;var R=u.any(r,g,void 0,o);if(R)T.currentObject=R,T.currentName=u.any(T.currentObject,y,null,o);else if(R=u.any(i,v.ui("default")))T.currentObject=R,T.currentName=u.any(T.currentObject,y,null,o);else if(_&&!S)return p.style.display="none",p;return f.appendChild(Zi(e,g,i)),Xo(e,r,{editable:S,dbLookup:!0},T,function(e,t){return c.apply(this,arguments)},function(e,t){return l.apply(this,arguments)}).then(function(e){h.appendChild(e)},function(t){h.appendChild(Wr(e,"Error rendering autocomplete ".concat(i,": ").concat(t),"#fee",t))}),p},zi[v.ui("Form").uri]=zi[v.ui("Group").uri]=function(e,t,n,r,i,o,a){var s=e.createElement("div"),c=v.ui;if(t&&t.appendChild(s),i){var l=r.toNT()+"|"+i.toNT();if(n[l])return s.appendChild(e.createTextNode("Group: see above "+l)),s;var u={};for(var d in n)u[d]=1;u[l]=1;var p=i.doc?i.doc():null,f=la.any(i,c("weight"),null,p),h=f?Number(f.value):1;if(h>3||h<0)return s.appendChild(Wr(e,"Form Group weight ".concat(h," should be 0-3")));s.setAttribute("style",ar.formGroupStyle[h]),s.style.display="flex",s.style.flexDirection="column",s.class="form-weight-"+h;var m,g=la.any(i,c("parts"),null,p);if(g?m=g.elements:(g=la.each(i,c("part"),null,p),m=ya(g)),!g)return s.appendChild(Wr(e,"No parts to form! "));for(var y=0;y<m.length;y++){var w=m[y],b=Ki(0,w),x=function(t,i){t&&i&&i.widget&&"select"===i.widget&&ua(e,n,r,o,a,s,m),a(t,{widget:"group",change:i})};s.appendChild(b(e,null,u,r,w,o,x))}return s}},zi[v.ui("Options").uri]=function(e,t,n,r,i,o,a){var s=qt,c=e.createElement("div"),l=i.doc?i.doc():null,u=v.ui;t&&t.appendChild(c);var d=s.any(i,u("dependingOn"));d||(d=v.rdf("type"));var p,f=s.each(i,u("case"),null,l);f||c.appendChild(Wr(e,"No cases to Options form. ")),p=d.sameTerm(v.rdf("type"))?Object.keys(s.findTypeURIs(r)).map(function(e){return m.sym(e)}):s.each(r,d);for(var h=0;h<f.length;h++){for(var g=f[h],y=s.each(g,u("for"),null,l),w=!1,b=0;b<y.length;b++){var x,E=ia(p);try{for(E.s();!(x=E.n()).done;){var C=x.value,k=y[b];(C.sameTerm(y)||C.termType===k.termType&&C.value===k.value)&&(w=!0)}}catch(e){E.e(e)}finally{E.f()}}if(w){var A=s.the(g,u("use"));if(!A)return c.appendChild(Wr(e,'No "use" part for case in form '+i)),c;ha(e,c,n,r,A,o,a);break}}return c},zi[v.ui("Multiple").uri]=function(e,t,n,r,i,o,a){function s(e){return e.map(function(e){return e.toString().slice(-7)}).join(", ")}function c(){return l.apply(this,arguments)}function l(){return l=w(x().mark(function t(){var n,i,a,s;return x().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Ta(o),!E){t.next=2;break}return B(),T.elements.push(n),t.next=1,O();case 1:t.next=7;break;case 2:return i=k?[m.st(n,C,r,o)]:[m.st(r,C,n,o)],t.prev=3,t.next=4,p.updater.update([],i);case 4:t.next=6;break;case 5:t.prev=5,s=t.catch(3),a="Error adding to unordered multiple: "+s,h.appendChild(Wr(e,a)),kn.z3(a);case 6:U();case 7:case"end":return t.stop()}},t,null,[[3,5]])})),l.apply(this,arguments)}function u(t){function i(){return i=w(x().mark(function n(){var i,a;return x().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!E){n.next=5;break}kn.Rm("pre delete: "+s(T.elements)),i=0;case 1:if(!(i<T.elements.length)){n.next=4;break}if(!T.elements[i].sameTerm(t)){n.next=3;break}return T.elements.splice(i,1),n.next=2,O();case 2:return n.abrupt("return");case 3:i++,n.next=1;break;case 4:n.next=6;break;case 5:p.holds(r,C,t,o)&&(a=[m.st(r,C,t,o)],p.updater.update(a,[],function(t,n,r){n?I.removeChild(u):I.appendChild(Wr(e,"Multiple: delete failed: "+r))}));case 6:case"end":return n.stop()}},n)})),i.apply(this,arguments)}function c(e,t){return l.apply(this,arguments)}function l(){return(l=w(x().mark(function e(n,r){var i;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:kn.Rm("pre move: "+s(T.elements)),i=0;case 1:if(!(i<T.elements.length)){e.next=3;break}if(!T.elements[i].sameTerm(t)){e.next=2;break}return e.abrupt("continue",3);case 2:i++,e.next=1;break;case 3:if(i===T.elements.length&&alert("list move: not found element for "+t),!r){e.next=5;break}if(0!==i){e.next=4;break}return alert("@@ boop - already at top   -temp message"),e.abrupt("return");case 4:T.elements.splice(i-1,2,T.elements[i],T.elements[i-1]),e.next=7;break;case 5:if(i!==T.elements.length-1){e.next=6;break}return alert("@@ boop - already at bottom   -temp message"),e.abrupt("return");case 6:T.elements.splice(i,2,T.elements[i+1],T.elements[i]);case 7:return e.next=8,O();case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}ln("Multiple: render object: "+t);var u=Ki(0,S)(e,null,n,t,S,o,function(e,n){kn.Rm("Item done callback for item ".concat(t.toString())),e||kn.z3("  Item done callback: Error: "+n),a(e,n)});if(u.subject=t,p.updater.editable(o.uri)&&(fi(e,u,A,function(){return i.apply(this,arguments)}),E)){var d=e.createElement("div");d.style.display="grid",d.style.gridTemplateColumns="auto 3em",d.style.gridTemplateRows="50% 50%";var f=hi(e,dr.Pt.iconBase+"noun_1369237.svg","Move Up",function(){var e=w(x().mark(function e(t){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c(t,!0));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),h=hi(e,dr.Pt.iconBase+"noun_1369241.svg","Move Down",function(){var e=w(x().mark(function e(t){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c(t,!1));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),g=e.createElement("div");return g.appendChild(u),d.appendChild(g),d.appendChild(f),d.appendChild(h),f.style.gridColumn=2,h.style.gridColumn=2,f.style.gridRow=1,h.style.padding="0em",f.style.padding="0em",h.style.gridRow=2,g.style.gridColumn=1,g.style.gridRowStart="span 2",d}return u}var d=dr.Pt.iconBase+"noun_19460_green.svg",p=qt,f=i.doc?i.doc():null,h=e.createElement("div"),g=h,y=v.ui;t&&t.appendChild(h);var b=p.any(i,y("ordered")),E=!!b&&m.Node.toJS(b),C=p.any(i,y("property")),k=p.anyJS(i,y("reverse"),null,f);if(!C)return h.appendChild(Wr(e,"No property to multiple: "+i)),g;var A=p.any(i,y("label"));A||(A=En(C));var _=p.any(i,y("min"));_=_?0+_.value:0;var S=p.any(i,y("part"));if(!S)return h.appendChild(Wr(e,"No part to multiple: "+i)),g;var T,R,I=h.appendChild(e.createElement("div"));if(I.style.display="flex",I.style.flexDirection="column",R=k?p.any(null,C,r,o):p.any(r,C,null,o),E?(T=k?p.any(null,C,r,o):p.any(r,C,null,o),R=T?T.elements:[]):(R=k?p.each(null,C,r,o):p.each(r,C,null,o),T=null),p.updater.editable(o.uri)){var L=h.appendChild(e.createElement("div"));L.style.padding="0.5em";var N=L.appendChild(e.createElement("img"));N.setAttribute("src",d),N.setAttribute("style","margin: 0.2em; width: 1.5em; height:1.5em"),N.title="Click to add another "+A;var P=e.createElement("span");P.textContent=(0===R.length?"Add another ":"Add ")+A,L.addEventListener("click",function(){var e=w(x().mark(function e(t){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,c();case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),!0),L.appendChild(P)}function B(){T||(T=new m.Collection,k?p.add(T,C,r,o):p.add(r,C,T,o))}function O(){return D.apply(this,arguments)}function D(){return(D=w(x().mark(function t(){var n;return x().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return kn.Rm("save list: "+s(T.elements)),B(),t.prev=1,t.next=2,p.fetcher.putBack(o);case 2:t.next=4;break;case 3:return t.prev=3,n=t.catch(1),h.appendChild(Wr(e,"Error trying to put back a list: "+n)),t.abrupt("return");case 4:U();case 5:case"end":return t.stop()}},t,null,[[1,3]])}))).apply(this,arguments)}function U(){var e;if(E){var t=k?p.the(null,C,r,o):p.the(r,C,null,o);e=t?t.elements:[]}else(e=k?p.each(null,C,r,o):p.each(r,C,null,o)).sort();br(I,e,u)}function j(){return(j=w(x().mark(function e(){var t,n;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=_-R.length)>0)){e.next=4;break}n=0;case 1:if(!(n<t)){e.next=3;break}return kn.Rm("Adding extra: min "+_),e.next=2,c();case 2:n++,e.next=1;break;case 3:return e.next=4,O();case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}return I.refresh=U,U(),function(){return j.apply(this,arguments)}().then(function(){kn.Rm(" Multiple render: async stuff ok")},function(e){kn.z3(" Multiple render: async stuff fails. #### ",e)}),g},zi[v.ui("PhoneField").uri]=Xi,zi[v.ui("EmailField").uri]=Xi,zi[v.ui("ColorField").uri]=Xi,zi[v.ui("DateField").uri]=Xi,zi[v.ui("DateTimeField").uri]=Xi,zi[v.ui("TimeField").uri]=Xi,zi[v.ui("NumericField").uri]=Xi,zi[v.ui("IntegerField").uri]=Xi,zi[v.ui("DecimalField").uri]=Xi,zi[v.ui("FloatField").uri]=Xi,zi[v.ui("TextField").uri]=Xi,zi[v.ui("SingleLineTextField").uri]=Xi,zi[v.ui("NamedNodeURIField").uri]=Xi,zi[v.ui("MultiLineTextField").uri]=function(e,t,n,r,i,o,a){var s=v.ui,c=qt,l=i.doc?i.doc():null,u=c.any(i,s("property"));if(!u)return Wr(e,"No property to text field: "+i);var d=e.createElement("div");d.style.display="flex",d.style.flexDirection="row";var p=d.appendChild(e.createElement("div"));p.style.width=or.formFieldNameBoxWidth;var f=d.appendChild(e.createElement("div"));p.appendChild(Zi(e,u,i)),o=Yi(r,u,o);var h=c.anyJS(r,u,null,o)||"",m=c.updater.editable(o.uri),g=i&&c.anyJS(i,v.ui("suppressEmptyUneditable"),null,l);!m&&g&&""===h&&(d.style.display="none");var y=Ea(e,c,r,u,o,a);return f.appendChild(y),t&&t.appendChild(d),d},zi[v.ui("BooleanField").uri]=function(e,t,n,r,i,o,a){return da(e,t,0,r,i,o,0,!1)},zi[v.ui("TristateField").uri]=function(e,t,n,r,i,o,a){return da(e,t,0,r,i,o,0,!0)},zi[v.ui("Classifier").uri]=function(e,t,n,r,i,o,a){var s=qt,c=v.ui,l=s.any(i,c("category"));if(!l)return Wr(e,"No category for classifier: "+i);ln("Classifier: dataDoc="+o);var u=_a(e,s,r,l,o,function(e,t){return a(e,t)});return t&&t.appendChild(u),u},zi[v.ui("Choice").uri]=function(e,t,n,r,i,o,a){var s,c=v.ui,l=qt,u=i.doc?i.doc():null,d=e.createElement("div");d.setAttribute("class","choiceBox"),t&&t.appendChild(d);var p=e.createElement("div");p.setAttribute("class","formFieldName choiceBox-label"),d.appendChild(p);var f=e.createElement("div");f.setAttribute("class","formFieldValue choiceBox-selectBox"),d.appendChild(f);var h=l.any(i,c("property"));if(!h)return d.appendChild(Wr(e,"No property for Choice: "+i));p.appendChild(Zi(e,h,i));var g=l.any(i,c("from"));if(!g)return Wr(e,"No 'from' for Choice: "+i);var y=l.any(i,c("use")),w={form:i,subForm:y,disambiguate:!1};l.any(i,c("canMintNew"))&&(w.mint="* Create new *");var b=l.any(i,c("multiselect"));b&&(w.multiSelect=!0);var x,E=l.each(i,c("search-full-store")).length?null:o;return f.refresh=function(){var t=l.each(r,h,null,o).map(function(e){return e.value}),n=function(e){var t,n=[];for(var r in n=l.each(void 0,v.rdf("type"),g,u),function(e,t,n){var r,i,o,a,s,c,l,u,d,p,f,h={};h[t.toNT()]=!0;var m={},g=e.transitiveClosure(h,e.rdfFactory.namedNode("http://www.w3.org/2000/01/rdf-schema#subClassOf"),!0);for(var v in g){for(var y=0,w=(s=e.statementsMatching(null,e.rdfFactory.namedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"),e.fromNT(v),n)).length;y<w;y++)m[(p=s[y]).subject.toNT()]=p;for(var b=0,x=(c=e.each(null,e.rdfFactory.namedNode("http://www.w3.org/2000/01/rdf-schema#domain"),e.fromNT(v),n)).length;b<x;b++)for(a=c[b],o=0,r=(l=e.statementsMatching(null,a,null,n)).length;o<r;o++)m[(p=l[o]).subject.toNT()]=p;for(var E=0,C=(u=e.each(null,e.rdfFactory.namedNode("http://www.w3.org/2000/01/rdf-schema#range"),e.fromNT(v),n)).length;E<C;E++)for(a=u[E],f=0,i=(d=e.statementsMatching(null,a,null,n)).length;f<i;f++)m[(p=d[f]).object.toNT()]=p}return m}(l,g,e))n.push(l.fromNT(r));if(g.sameTerm(v.rdfs("Class")))for(s in Si())n.push(l.sym(s));else if(g.sameTerm(v.rdf("Property"))){for(s in(t=Ti(l)).op)n.push(l.fromNT(s));for(s in t.dp)n.push(l.fromNT(s));w.disambiguate=!0}else if(g.sameTerm(v.owl("ObjectProperty"))){for(s in(t=Ti(l)).op)n.push(l.fromNT(s));w.disambiguate=!0}else if(g.sameTerm(v.owl("DatatypeProperty"))){for(s in(t=Ti(l)).dp)n.push(l.fromNT(s));w.disambiguate=!0}return n}(E);if(n.push(t),n=wa(n),x=Ra(e,f,l,r,h,n,t,g,w,o,a),f.innerHTML="",f.appendChild(x),b){var i=new ra({placeholder:x.selected,select:x,container:f,textField:"textField",valueField:"valueField"});i.init(),i.subscribe(function(n){if("REMOVE_OPTION"===n.action&&(t=t.filter(function(e){return e!==n.value})),"CLEAR_ALL_OPTIONS"===n.action&&(t=[]),"ADD_OPTION"===n.action)if((n.value+"").includes("Create new")){var i=Ta(o),s=[];s.push(m.st(r,h,l.sym(i),o)),g&&s.push(m.st(i,v.rdf("type"),l.sym(g),o)),y&&pa(e,f,{},m.sym(i),y,o,function(n,r){n?(l.updater.update([],s,function(t,n,r){n||f.appendChild(Wr(e,"Error updating select: "+r))}),t.push(i),a&&a(n,{widget:"select",event:"new"})):f.appendChild(Wr(e,"Error updating data in field of select: "+r))})}else t.push(n.value);x.update(t)})}},f.refresh(),x&&x.refresh&&x.refresh(),d},zi[v.ui("Comment").uri]=zi[v.ui("Heading").uri]=function(e,t,n,r,i,o,a){var s=v.ui,c=qt,l=c.any(i,s("contents"));l||(l="Error: No contents in comment field.");var u=i.doc?i.doc():null,d=qi(i),p=$i[d]||{},f=e.createElement("div");t&&t.appendChild(f);var h=f.appendChild(e.createElement(p.element));h.textContent=l,function(e,t){var n=qi(t),r=$i[n]||{},i=qt.any(t,v.ui("style"));i?"Literal"===i.termType?i&&e.setAttribute("style",i.value):qt.statementsMatching(i,null,null,t.doc()).forEach(function(t){if(t.predicate.uri&&t.predicate.uri.startsWith(Vi)){var n=t.predicate.uri.slice(26);try{e.style[n]=t.object.value}catch(r){console.warn("setFieldStyle: Error setting element style ".concat(n,' to "').concat(t.object.value,'"')),console.warn('setFieldStyle:   ... Element tagName was "'.concat(e.tagName||"???",'"'))}}}):r.style&&e.setAttribute("style",r.style)}(h,i);var m=c.anyJS(i,v.ui("suppressIfUneditable"),null,u),g=c.updater.editable(o.uri);return m&&!g&&(f.style.display="none"),f};Wt.store;var Pa=Wt.profile,Ba=Pa.loadPreferences,Oa=Pa.loadProfile,Da=Wt.typeIndex,Ua=Da.getScopedAppInstances,ja=Da.getRegistrations,Ma=Da.loadAllTypeIndexes,Fa=Da.getScopedAppsFromIndex,Ha=Da.deleteTypeIndexRegistration;function Wa(e){var t=Jt.currentUser();return t?(Jt.saveUser(t,e),Promise.resolve(e)):new Promise(function(t){Jt.checkUser().then(function(n){if(n)return kn.Rm("logIn: Already logged in as ".concat(n)),t(e);if(!e.div||!e.dom)return t(e);var r=ns(e.dom,function(n){Jt.saveUser(n,e),t(e)});e.div.appendChild(r)})})}function $a(e){return Ja.apply(this,arguments)}function Ja(){return(Ja=w(x().mark(function e(t){var n,r,i;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.preferencesFile){e.next=1;break}return e.abrupt("return",Promise.resolve(t));case 1:return e.prev=1,e.next=2,za(t);case 2:return t=e.sent,e.next=3,Ba(t.me);case 3:n=e.sent,t.preferencesFile=n,e.next=11;break;case 4:if(e.prev=4,!((i=e.catch(1))instanceof It)){e.next=5;break}fn(r="Oops  you are not authenticated (properly logged in), so SolidOS cannot read your preferences file. Try logging out and then logging back in."),e.next=11;break;case 5:if(!(i instanceof Lt)){e.next=6;break}return r="Unauthorized: Assuming preference file blocked for origin ".concat(window.location.origin),t.preferencesFileError=r,e.abrupt("return",t);case 6:if(!(i instanceof Nt)){e.next=7;break}return r="You are not authorized to read your preference file. This may be because you are using an untrusted web app.",kn.R8(r),e.abrupt("return",t);case 7:if(!(i instanceof Pt)){e.next=8;break}return r="You are not authorized to edit your preference file. This may be because you are using an untrusted web app.",kn.R8(r),e.abrupt("return",t);case 8:if(!(i instanceof Bt)){e.next=9;break}r="You are not authorized to edit your preference file. This may be because you are using an untrusted web app.",kn.R8(r),e.next=11;break;case 9:if(!(i instanceof Ot)){e.next=10;break}fn(r="Strange: Error ".concat(i.status," trying to read your preference file.").concat(i.message)),e.next=11;break;case 10:throw new Error("(via loadPrefs) ".concat(i));case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}},e,null,[[1,4]])}))).apply(this,arguments)}function za(e){return qa.apply(this,arguments)}function qa(){return(qa=w(x().mark(function e(t){var n,r;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.publicProfile){e.next=1;break}return e.abrupt("return",t);case 1:return e.prev=1,e.next=2,Wa(t);case 2:if((n=e.sent).me){e.next=3;break}throw new Error("Could not log in");case 3:return e.next=4,Oa(n.me);case 4:t.publicProfile=e.sent,e.next=6;break;case 5:throw e.prev=5,r=e.catch(1),t.div&&t.dom&&t.div.appendChild(Wr(t.dom,r.message)),new Error("Can't log in: ".concat(r));case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}},e,null,[[1,5]])}))).apply(this,arguments)}function Ka(e,t,n){return Va.apply(this,arguments)}function Va(){return(Va=w(x().mark(function e(t,n,r){var i,o;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.me){e.next=2;break}return e.next=1,Ua(n,t.me);case 1:o=e.sent,e.next=3;break;case 2:o=[];case 3:return i=o,!0===r?i=i.filter(function(e){return"public"===e.scope.label}):!1===r&&(i=i.filter(function(e){return"private"===e.scope.label})),t.instances=i.map(function(e){return e.instance}),e.abrupt("return",t);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ga(e,t){var n=e.me&&e.me.sameTerm(t.agent)?"":En(t.agent)+" ";return"".concat(n).concat(t.label)}function Qa(e,t,n){return Za.apply(this,arguments)}function Za(){return Za=w(x().mark(function e(t,n,r){var i,o,a,s,c,l,u,d,p,f,h,g,y;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=function(e){var n=i(e.index),r=Ga(t,e),o="".concat(r," link to this ").concat(t.noun);return Sa(t.dom,Wt.store,o,null,n,p,e.index)},i=function(e){var t=ja(n,r),i=t.length?t[0]:Ta(e);return[(0,m.st)(i,v.solid("instance"),n,e),(0,m.st)(i,v.solid("forClass"),r,e)]},(a=t.dom)&&t.div){e.next=1;break}throw new Error("registrationControl: need dom and div");case 1:if(s=a.createElement("div"),t.div.appendChild(s),t.me=Jt.currentUser(),c=t.me){e.next=2;break}return s.innerHTML='<p style="margin:2em;">(Log in to save a link to this)</p>',e.abrupt("return",t);case 2:return e.prev=2,e.next=3,Ma(c);case 3:l=e.sent,e.next=5;break;case 4:return e.prev=4,y=e.catch(2),t.div&&t.preferencesFileError?(u="(Lists of stuff not available)",t.div.appendChild(a.createElement("p")).textContent=u):t.div&&(u="registrationControl: Type indexes not available: ".concat(y),t.div.appendChild(Wr(t.dom,y))),kn.Rm(u),e.abrupt("return",t);case 5:s.innerHTML="<table><tbody></tbody></table>",s.setAttribute("style","font-size: 120%; text-align: right; padding: 1em; border: solid gray 0.05em;"),d=s.children[0].children[0],p=new m.BlankNode,f=La(l);try{for(f.s();!(h=f.n()).done;)g=h.value,d.appendChild(a.createElement("tr")).appendChild(o(g))}catch(e){f.e(e)}finally{f.f()}return e.abrupt("return",t);case 6:case"end":return e.stop()}},e,null,[[2,4]])})),Za.apply(this,arguments)}function Ya(e,t,n){var r=e.dom,i=Ga(e,n),o=r.createElement("tr"),a=o.appendChild(r.createElement("td"));a.setAttribute("colspan","3"),a.style.backgoundColor={private:"#fee",public:"#efe"}[n.label]||"white";var s=a.appendChild(r.createElement("h3"));return s.textContent=i+" links",s.style.textAlign="left",o}function Xa(e,t){return es.apply(this,arguments)}function es(){return es=w(x().mark(function e(t,n){var r,i,o,a,s,c,l,u,d,p,f,h,m,g,y,b;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.dom,i=t.div,o=r.createElement("div"),i.appendChild(o),t.me=Jt.currentUser(),t.me){e.next=1;break}return o.innerHTML='<p style="margin:2em;">(Log in list your stuff)</p>',e.abrupt("return",t);case 1:return e.next=2,Ma(t.me);case 2:a=e.sent,o.innerHTML="<table><tbody></tbody></table>",o.setAttribute("style","font-size: 120%; text-align: right; padding: 1em; border: solid #eee 0.5em;"),s=o.firstChild,c=s.firstChild,l=La(a),e.prev=3,l.s();case 4:if((u=l.n()).done){e.next=13;break}return d=u.value,p=Ya(t,0,d),c.appendChild(p),e.next=5,Fa(d,n.type||null);case 5:0===(f=e.sent).length&&(p.style.display="none"),h=La(f),e.prev=6,g=x().mark(function e(){var t,n;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=m.value,n=yi(r,v.solid("instance"),t.instance,{deleteFunction:function(){var e=w(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,Ha(t);case 1:c.removeChild(n);case 2:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}),n.children[0].style.paddingLeft="3em",c.appendChild(n);case 1:case"end":return e.stop()}},e)}),h.s();case 7:if((m=h.n()).done){e.next=9;break}return e.delegateYield(g(),"t0",8);case 8:e.next=7;break;case 9:e.next=11;break;case 10:e.prev=10,y=e.catch(6),h.e(y);case 11:return e.prev=11,h.f(),e.finish(11);case 12:e.next=4;break;case 13:e.next=15;break;case 14:e.prev=14,b=e.catch(3),l.e(b);case 15:return e.prev=15,l.f(),e.finish(15);case 16:return e.abrupt("return",t);case 17:case"end":return e.stop()}},e,null,[[3,14,15,16],[6,10,11,12]])})),es.apply(this,arguments)}function ts(e){var t=e.createElement("div");t.setAttribute("style","position: fixed; top: 0; left: 0; right: 0; bottom: 0; display: flex; justify-content: center; align-items: center;"),e.body.appendChild(t);var n=e.createElement("div");n.setAttribute("style","\n      background-color: white;\n      box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.2);\n      -webkit-box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.2);\n      -moz-box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.2);\n      -o-box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.2);\n      border-radius: 4px;\n      min-width: 400px;\n      padding: 10px;\n      z-index : 10;\n    "),t.appendChild(n);var r=e.createElement("div");r.setAttribute("style","\n      border-bottom: 1px solid #DDD;\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n      justify-content: space-between;\n    "),n.appendChild(r);var i=e.createElement("label");i.setAttribute("style","margin-right: 5px; font-weight: 800"),i.innerText="Select an identity provider";var o=e.createElement("button");o.innerHTML='<img src="https://solidos.github.io/solid-ui/src/icons/noun_1180156.svg" style="width: 2em; height: 2em;" title="Cancel">',o.setAttribute("style","background-color: transparent; border: none;"),o.addEventListener("click",function(){t.remove()}),r.appendChild(i),r.appendChild(o);var a=function(){var e=w(x().mark(function e(t){var n,r;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,Wt.store.updater.flagAuthorizationMetadata(),(n=new URL(window.location.href).hash)&&window.localStorage.setItem("preLoginRedirectHash",n),window.localStorage.setItem("loginIssuer",t),(r=new URL(window.location.href)).hash="",e.next=1,zt.login({redirectUrl:r.href,oidcIssuer:t});case 1:e.next=3;break;case 2:e.prev=2,fn(e.catch(0).message);case 3:case"end":return e.stop()}},e,null,[[0,2]])}));return function(t){return e.apply(this,arguments)}}(),s=e.createElement("div");s.setAttribute("style","\n      border-bottom: 1px solid #DDD;\n      display: flex;\n      flex-direction: column;\n      padding-top: 10px;\n    ");var c=e.createElement("div");c.setAttribute("style","\n      display: flex;\n      flex-direction: row;\n    ");var l=e.createElement("label");l.innerText="Enter the URL of your identity provider:",l.setAttribute("style","color: #888");var u=e.createElement("input");u.setAttribute("type","text"),u.setAttribute("style","margin-left: 0 !important; flex: 1; margin-right: 5px !important"),u.setAttribute("placeholder","https://example.com"),u.value=localStorage.getItem("loginIssuer")||"";var d=e.createElement("button");d.innerText="Go",d.setAttribute("style","margin-top: 12px; margin-bottom: 12px;"),d.addEventListener("click",function(){a(u.value)}),s.appendChild(l),c.appendChild(u),c.appendChild(d),s.appendChild(c),n.appendChild(s);var p=e.createElement("div");p.setAttribute("style","\n      display: flex;\n      flex-direction: column;\n      padding-top: 10px;\n    ");var f=e.createElement("label");f.innerText="Or pick an identity provider from the list below:",f.setAttribute("style","color: #888"),p.appendChild(f),function(){const e=[...$t],{host:t,origin:n}=new URL(location.href),r=e.map(({uri:e})=>new URL(e).host);return r.includes(t)||r.some(e=>function(e,t){const n=e.length-t.length-1;return n>0&&"."===e[n]&&e.endsWith(t)}(t,e))||e.unshift({name:t,uri:n}),e}().forEach(function(t){var n=e.createElement("button");n.innerText=t.name,n.setAttribute("style","height: 38px; margin-top: 10px"),n.addEventListener("click",function(){a(t.uri)}),p.appendChild(n)}),n.appendChild(p)}function ns(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Et(),i=e.createElement("div");function o(e){e&&(r=Jt.saveUser(e),i.refresh(),t&&t(r.uri))}function a(e){var n=r;zt.logout().then(function(){var e="Your WebID was ".concat(n,". It has been forgotten.");r=null;try{fn(e)}catch(t){window.alert(e)}i.refresh(),t&&t(null)},function(e){fn("Fail to log out:"+e)})}function s(){r=Jt.currentUser(),i.refresh()}return i.refresh=function(){var t=zt.info;((r=t&&t.webId&&t.isLoggedIn?Wt.store.sym(t.webId):null)&&i.me!==r.uri||!r&&i.me)&&(Yr(i),r?i.appendChild(function(t,n){var r=n.buttonStyle||ar.signInAndUpButtonStyle,i="WebID logout";if(t){var o=Wt.store.any(t,v.foaf("nick"))||Wt.store.any(t,v.foaf("name"));o&&(i="Logout "+o.value)}var s=e.createElement("input");return s.setAttribute("type","button"),s.setAttribute("value",i),s.setAttribute("style","".concat(r)),s.addEventListener("click",a,!1),s}(r,n)):i.appendChild(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=(n=n||{}).buttonStyle||ar.signInAndUpButtonStyle,i=e.createElement("div"),o="SolidSignInOrSignUpBox";kn.Rm("widgets.signInOrSignUpBox"),i.setUserCallback=t,i.setAttribute("class",o),i.setAttribute("style","display:flex;");var a=e.createElement("input");i.appendChild(a),a.setAttribute("type","button"),a.setAttribute("value","Log in"),a.setAttribute("style","".concat(r).concat(ar.headerBannerLoginInput)+ar.signUpBackground),zt.events.on("login",function(){var t=Jt.currentUser();if(t){var n=t.uri,r=e.getElementsByClassName(o);kn.Rm("Logged in, ".concat(r.length," panels to be serviced"));for(var i=0;i<r.length;i++){var a=r[i];if(a.setUserCallback)try{a.setUserCallback(n);var s=a.parentNode;s&&s.removeChild(a)}catch(t){kn.Rm("## Error satisfying login box: ".concat(t)),a.appendChild(Wr(e,t))}}}}),a.addEventListener("click",function(){var n=Et();if(n)return t(n.uri);ts(e)},!1);var s=e.createElement("input");return i.appendChild(s),s.setAttribute("type","button"),s.setAttribute("value","Sign Up for Solid"),s.setAttribute("style","".concat(r).concat(ar.headerBannerLoginInput)+ar.signInBackground),s.addEventListener("click",function(e){(new Hi).signup().then(function(e){kn.Rm("signInOrSignUpBox signed up "+e),t(e)})},!1),i}(e,o,n))),i.me=r?r.uri:null},i.refresh(),s(),zt.events.on("login",s),zt.events.on("logout",s),i.me="99999",i.refresh(),i}function rs(e,t,n){var r=t.noun,i=t.appPathSegment,o=Et(),a=e.createElement("div"),s={me:o,dom:e,div:a};function c(t,n){a.appendChild(Wr(e,t,n))}function l(e){var t,n=Wt.store.any(e,v.space("uriPrefix"));"/"!==(t=n?n.value:e.uri.split("#")[0]).slice(-1)&&(kn.Rm("".concat(i,": No / at end of uriPrefix ").concat(t)),t="".concat(t,"/"));var r=new Date;return t+="".concat(i,"/id").concat(r.getTime(),"/")}return $a(s).then(function(t){function i(){return i=w(x().mark(function n(r){var i,o,a,s,c,l;return x().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=f.appendChild(e.createElement("tr")),(o=i.appendChild(e.createElement("td"))).setAttribute("colspan","3"),o.style.padding="0.5em",l=encodeURI,n.next=1,vi(e,Wt.store,o,v.solid("URL"),v.space("Workspace"),"Workspace");case 1:if(a=l(n.sent),s=Ta(t.preferencesFile),c=[(0,m.st)(t.me,v.space("workspace"),s,t.preferencesFile),(0,m.st)(s,v.space("uriPrefix"),a,t.preferencesFile)],Wt.store.updater){n.next=2;break}throw new Error("store has no updater");case 2:return n.next=3,Wt.store.updater.update([],c);case 3:case"end":return n.stop()}},n)})),i.apply(this,arguments)}var o=t.me,s=t.preferencesFile,u=null,d=Wt.store.each(o,v.space("workspace"),void 0,s),p=Wt.store.each(o,v.space("storage"));0===d.length&&p&&(c("You don't seem to have any workspaces. You have ".concat(p.length," storage spaces."),"white"),p.map(function(e){return d=d.concat(Wt.store.each(e,v.ldp("contains")))}).filter(function(e){return e.id?["public","private"].includes(e.id().toLowerCase()):""})),1===d.length&&(c("Workspace used: ".concat(d[0].uri),"white"),u=l(d[0]));var f=e.createElement("table");f.setAttribute("style","border-collapse:separate; border-spacing: 0.5em;"),a.appendChild(f),a.appendChild(e.createElement("hr"));var h=a.appendChild(e.createElement("p"));h.setAttribute("style",ar.commentStyle),h.textContent="Where would you like to store the data for the ".concat(r,"?\n    Give the URL of the folder where you would like the data stored.\n    It can be anywhere in solid world - this URI is just an idea.");var g=a.appendChild(e.createElement("input"));g.setAttribute("type","text"),g.setAttribute("style",ar.textInputStyle),g.size=80,g.label="base URL",g.autocomplete="on",u&&(g.value=u),t.baseField=g,a.appendChild(e.createElement("br"));var y,b,E,C,k,A,_,S=a.appendChild(e.createElement("button"));S.setAttribute("style",ar.buttonStyle),S.textContent="Start new ".concat(r," at this URI"),S.addEventListener("click",function(e){var t=g.value.replace(" ","%20");"/"!==t.slice(-1)&&(t+="/"),n(null,t)}),d=d.filter(function(e){return!Wt.store.holds(e,v.rdf("type"),v.space("MasterWorkspace"))});for(var T="height: 3em; margin: 1em; padding: 1em white; border-radius: 0.3em;",R="".concat(T,"border: 0px;"),I=0;I<d.length;I++){if(k=d[I],C=e.createElement("tr"),0===I&&((y=e.createElement("td")).setAttribute("rowspan","".concat(d.length)),y.textContent="Choose a workspace for this:",y.setAttribute("style","vertical-align:middle;"),C.appendChild(y)),b=e.createElement("td"),!(A=Wt.store.anyValue(k,v.ui("style")))){var L="#".concat((16777215&function(e){return e.split("").reduce(function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e},0)}(k.uri)|12632256).toString(16));A="color: black ; background-color: ".concat(L,";")}b.setAttribute("style",R+A),C.target=k.uri;var N=Wt.store.any(k,v.rdfs("label"));N||(N=k.uri.split("/").slice(-1)[0]||k.uri.split("/").slice(-2)[0]),b.textContent=N||"???",C.appendChild(b),0===I&&((E=e.createElement("td")).setAttribute("rowspan","".concat(d.length,"1")),E.setAttribute("style","width:50%;"),C.appendChild(E)),f.appendChild(C),_=(_=Wt.store.any(k,v.rdfs("comment")))?_.value:"Use this workspace",b.addEventListener("click",function(t){E.textContent=_?_.value:"",E.setAttribute("style",R+A);var r=e.createElement("button");r.textContent="Continue";var i=l(k);g.value=i,r.addEventListener("click",function(e){r.disabled=!0,n(k,i),r.textContent="----\x3e"},!0),E.appendChild(r)},!0)}var P=e.createElement("tr");(b=e.createElement("td")).setAttribute("style",T),b.textContent="+ Make a new workspace",b.addEventListener("click",function(e){return i.apply(this,arguments)}),P.appendChild(b),f.appendChild(P)}).catch(function(e){a.appendChild(Wr(s.dom,e))}),a}function is(e,t,n){var r=function(e,t){n(e,t)},i=e.createElement("div"),o=e.createElement("button");return o.setAttribute("type","button"),i.appendChild(o),o.innerHTML="Make new ".concat(t.noun),o.addEventListener("click",function(n){i.appendChild(rs(e,t,r))},!1),i.appendChild(o),i}function os(){return as.apply(this,arguments)}function as(){return(as=w(x().mark(function e(){var t,n,r,i,o;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,$a({});case 1:if(t=e.sent,n=t.me,r=t.preferencesFile,i=t.preferencesFileError,r&&!i){e.next=2;break}throw new Error(i);case 2:return e.abrupt("return",Wt.store.each(n,v.rdf("type"),null,r.doc()));case 3:return e.prev=3,o=e.catch(0),kn.R8("Unable to fetch your preferences - this was the error: ",o),e.abrupt("return",[]);case 4:case"end":return e.stop()}},e,null,[[0,3]])}))).apply(this,arguments)}function ss(e){return cs.apply(this,arguments)}function cs(){return(cs=w(x().mark(function e(t){var n;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,os();case 1:return n=e.sent,e.abrupt("return",t.filter(function(e){return ls(e,n)}));case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ls(e,t){return(e.audience||[]).reduce(function(e,n){return e&&!!t.find(function(e){return e.equals(n)})},!0)}zt.events.on("logout",w(x().mark(function e(){var t,n,r,i;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=window.localStorage.getItem("loginIssuer"))){e.next=6;break}return e.prev=1,Wt.store.updater.flagAuthorizationMetadata(),(n=new URL(t)).pathname="/.well-known/openid-configuration",e.next=2,fetch(n.toString());case 2:if(200!==(r=e.sent).status){e.next=4;break}return e.next=3,r.json();case 3:if(!(i=e.sent)||!i.end_session_endpoint){e.next=4;break}return e.next=4,fetch(i.end_session_endpoint,{credentials:"include"});case 4:e.next=6;break;case 5:e.prev=5,e.catch(1);case 6:window.location.reload();case 7:case"end":return e.stop()}},e,null,[[1,5]])})));var us=function(){return qn(function e(t){Wn(this,e),Mi(this,"isExpanded",!1),this.groupList=t,this.rootElement=t.controller.dom.createElement("div"),this.barElement=t.controller.dom.createElement("div")},[{key:"render",value:function(){return this.rootElement.innerHTML="",this.rootElement.appendChild(this.renderAddButton()),this.rootElement.appendChild(this.barElement),this.rootElement}},{key:"renderAddButton",value:function(){var e=this;return hi(this.groupList.controller.dom,"".concat(dr.Pt.iconBase,"noun_34653_green.svg"),"Add ...",function(){e.toggleBar(),e.renderBar()})}},{key:"renderBar",value:function(){this.barElement.innerHTML="",this.isExpanded&&(this.barElement.appendChild(this.renderPersonButton()),this.barElement.appendChild(this.renderGroupButton()),this.barElement.appendChild(this.renderPublicButton()),this.barElement.appendChild(this.renderAuthenticatedAgentButton()),this.barElement.appendChild(this.renderBotButton()),this.barElement.appendChild(this.renderAppsButton()))}},{key:"renderSimplifiedBar",value:function(e){var t=this;Array.from(this.barElement.children).filter(function(t){return t!==e}).forEach(function(e){return t.barElement.removeChild(e)})}},{key:"renderPersonButton",value:function(){var e=this;return hi(this.groupList.controller.dom,dr.Pt.iconBase+ai["vcard:Individual"],"Add Person",function(t){e.renderSimplifiedBar(t.target),e.renderNameForm(v.vcard("Individual"),"person").then(function(t){return e.addPerson(t)}).then(function(){return e.renderCleanup()}).catch(function(t){return e.groupList.controller.renderStatus(t)})})}},{key:"renderGroupButton",value:function(){var e=this;return hi(this.groupList.controller.dom,dr.Pt.iconBase+ai["vcard:Group"],"Add Group",function(t){e.renderSimplifiedBar(t.target),e.renderNameForm(v.vcard("Group"),"group").then(function(t){return e.addGroup(t)}).then(function(){return e.renderCleanup()}).catch(function(t){return e.groupList.controller.renderStatus(t)})})}},{key:"renderNameForm",value:function(e,t){return vi(this.groupList.controller.dom,this.groupList.store,this.barElement,v.vcard("URI"),e,t)}},{key:"renderPublicButton",value:function(){var e=this;return hi(this.groupList.controller.dom,dr.Pt.iconBase+ai["foaf:Agent"],"Add Everyone",function(){return e.addAgent(v.foaf("Agent").uri).then(function(){return e.groupList.controller.renderTemporaryStatus("Adding the general public to those who can read. Drag the globe to a different level to give them more access.")}).then(function(){return e.renderCleanup()})})}},{key:"renderAuthenticatedAgentButton",value:function(){var e=this;return hi(this.groupList.controller.dom,"".concat(dr.Pt.iconBase,"noun_99101.svg"),"Anyone logged In",function(){return e.addAgent(v.acl("AuthenticatedAgent").uri).then(function(){return e.groupList.controller.renderTemporaryStatus("Adding anyone logged in to those who can read. Drag the ID icon to a different level to give them more access.")}).then(function(){return e.renderCleanup()})})}},{key:"renderBotButton",value:function(){var e=this;return hi(this.groupList.controller.dom,dr.Pt.iconBase+"noun_Robot_849764.svg","A Software Agent (bot)",function(t){e.renderSimplifiedBar(t.target),e.renderNameForm(v.schema("Application"),"bot").then(function(t){return e.addBot(t)}).then(function(){return e.renderCleanup()})})}},{key:"renderAppsButton",value:function(){var e=this;return hi(this.groupList.controller.dom,"".concat(dr.Pt.iconBase,"noun_15177.svg"),"A Web App (origin)",function(t){e.renderSimplifiedBar(t.target);var n={div:e.barElement,dom:e.groupList.controller.dom},r=e.renderAppsTable(n).catch(function(t){return e.groupList.controller.renderStatus(t)});e.renderAppsView();var i=e.renderNameForm(v.schema("WebApplication"),"webapp domain").then(function(t){return e.getOriginFromName(t)});Promise.race([r,i]).then(function(t){t&&e.groupList.addNewURI(t)}).then(function(){return e.renderCleanup()})})}},{key:"renderAppsView",value:function(){var e=this,t=this.groupList.controller.context.session.paneRegistry.byName("trustedApplications");if(t){var n=t.render(null,this.groupList.controller.context);n.setAttribute("style",ar.trustedAppController);var r=mi(this.groupList.controller.dom,function(){return e.renderCleanup()});r.setAttribute("style",ar.trustedAppCancelButton),n.insertBefore(r,n.firstChild),this.barElement.appendChild(n)}}},{key:"renderAppsTable",value:(o=w(x().mark(function e(t){var n,r,i=this;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,za(t);case 1:return n=this.groupList.store.each(t.me,v.acl("trustedApp")),r=n.flatMap(function(e){return i.groupList.store.each(e,v.acl("origin"))}),this.barElement.appendChild(this.groupList.controller.dom.createElement("p")).textContent="You have ".concat(r.length," selected web apps."),e.abrupt("return",new Promise(function(e,t){var r=i.barElement.appendChild(i.groupList.controller.dom.createElement("table"));r.setAttribute("style",ar.trustedAppAddApplicationsTable),n.forEach(function(n){var o=i.groupList.store.any(n,v.acl("origin"));o||t(new Error("Unable to pick app: ".concat(n.value)));var a=yi(i.groupList.controller.dom,v.acl("origin"),o,{}),s=i.groupList.controller.dom.createElement("table"),c=s.appendChild(i.groupList.controller.dom.createElement("tr"));c.appendChild(i.groupList.controller.dom.createElement("td")).appendChild(a),c.appendChild(i.groupList.controller.dom.createElement("td")).textContent="Give access to ".concat(i.groupList.controller.noun," ").concat(En(i.groupList.controller.subject),"?"),c.appendChild(i.groupList.controller.dom.createElement("td")).appendChild(gi(i.groupList.controller.dom,function(){return e(o.value)})),r.appendChild(s)})}));case 2:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"renderCleanup",value:function(){this.renderBar(),this.groupList.render()}},{key:"addPerson",value:(i=w(x().mark(function e(t){var n;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}return e.abrupt("return",this.toggleBar());case 1:if(n=/^https?:/i,t.match(n)){e.next=2;break}return e.abrupt("return",Promise.reject(new Error("Not a http URI")));case 2:return kn.Rm("Adding to ACL person: ".concat(t)),e.next=3,this.groupList.addNewURI(t);case 3:this.toggleBar();case 4:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"addGroup",value:(r=w(x().mark(function e(t){var n;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}return e.abrupt("return",this.toggleBar());case 1:if(n=/^https?:/i,t.match(n)){e.next=2;break}return e.abrupt("return",Promise.reject(new Error("Not a http URI")));case 2:return kn.Rm("Adding to ACL group: "+t),e.next=3,this.groupList.addNewURI(t);case 3:this.toggleBar();case 4:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"addAgent",value:(n=w(x().mark(function e(t){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.groupList.addNewURI(t);case 1:this.toggleBar();case 2:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"addBot",value:(t=w(x().mark(function e(t){var n;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}return e.abrupt("return",this.toggleBar());case 1:if(n=/^https?:/i,t.match(n)){e.next=2;break}return e.abrupt("return",Promise.reject(new Error("Not a http URI")));case 2:return kn.Rm("Adding to ACL bot: "+t),e.next=3,this.groupList.addNewURI(t);case 3:this.toggleBar();case 4:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"getOriginFromName",value:(e=w(x().mark(function e(t){var n,r;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}return e.abrupt("return",Promise.resolve());case 1:if(n=/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i,t.match(n)){e.next=2;break}return e.abrupt("return",Promise.reject(new Error("Not a domain name")));case 2:return r="https://"+t,kn.Rm("Adding to ACL origin: "+r),this.toggleBar(),e.abrupt("return",r);case 3:case"end":return e.stop()}},e,this)})),function(t){return e.apply(this,arguments)})},{key:"toggleBar",value:function(){this.isExpanded=!this.isExpanded}}]);var e,t,n,r,i,o}(),ds=v.acl,ps={13:"Owners",9:"Owners (write locked)",5:"Editors",3:"Posters",2:"Submitters",1:"Viewers"},fs={13:!0,5:!0,3:!0,2:!0,1:!0},hs={13:"can read, write, and control sharing.",9:"can read and control sharing, currently write-locked.",5:"can read and change information",3:"can add new information, and read but not change existing information",2:"can add new information but not read any",1:"can read but not change information"},ms=function(){return qn(function e(t,n,r,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};Wn(this,e),this.doc=t,this.aclDoc=n,this.controller=r,this._options=o,this.defaults=this._options.defaults||!1,this._store=i,this.aclMap=Sn(t,n,i,this.defaults),this.byCombo=Ln(this.aclMap),this.addAgentButton=new us(this),this.rootElement=this.controller.dom.createElement("div"),this.rootElement.setAttribute("style",ar.accessGroupList)},[{key:"store",get:function(){return this._store},set:function(e){this._store=e,this.aclMap=Sn(this.doc,this.aclDoc,e,this.defaults),this.byCombo=Ln(this.aclMap)}},{key:"render",value:function(){var e=this;return this.rootElement.innerHTML="",this.renderGroups().forEach(function(t){return e.rootElement.appendChild(t)}),this.controller.isEditable&&this.rootElement.appendChild(this.addAgentButton.render()),this.rootElement}},{key:"renderGroups",value:function(){for(var e=[],t=15;t>0;t--){var n=gs(t);(this.controller.isEditable&&fs[t]||this.byCombo[n])&&e.push(this.renderGroup(t,n))}return e}},{key:"renderGroup",value:function(e,t){var n=this,r=this.controller.dom.createElement("div");return r.setAttribute("style",ar.accessGroupListItem),sr(r,function(e){return n.handleDroppedUris(e,t).then(function(){return n.controller.render()}).catch(function(e){return n.controller.renderStatus(e)})}),this.renderGroupElements(e,t).forEach(function(e){return r.appendChild(e)}),r}},{key:"renderGroupElements",value:function(e,t){var n=this,r=this.controller.dom.createElement("div");if(r.setAttribute("style",ar.group),this.controller.isEditable)switch(e){case 1:r.setAttribute("style",ar.group1);break;case 2:r.setAttribute("style",ar.group2);break;case 3:r.setAttribute("style",ar.group3);break;case 5:r.setAttribute("style",ar.group5);break;case 9:r.setAttribute("style",ar.group9);break;case 13:r.setAttribute("style",ar.group13);break;default:r.setAttribute("style",ar.group)}r.innerText=ps[e]||function(e){for(var t="",n=["Read","Append","Write","Control"],r=0;r<4;r++)e&1<<r&&(t+=n[r]);return t}(e);var i=this.controller.dom.createElement("div");if(i.setAttribute("style",ar.group),this.controller.isEditable)switch(e){case 1:i.setAttribute("style",ar.group1);break;case 2:i.setAttribute("style",ar.group2);break;case 3:i.setAttribute("style",ar.group3);break;case 5:i.setAttribute("style",ar.group5);break;case 9:i.setAttribute("style",ar.group9);break;case 13:i.setAttribute("style",ar.group13);break;default:i.setAttribute("style",ar.group)}var o=i.appendChild(this.controller.dom.createElement("table"));(this.byCombo[t]||[]).map(function(e){var r=Gn(e,2),i=r[0],a=r[1];return n.renderAgent(o,t,i,a)}).forEach(function(e){return o.appendChild(e)});var a=this.controller.dom.createElement("div");if(a.setAttribute("style",ar.group),this.controller.isEditable)switch(e){case 1:a.setAttribute("style",ar.group1);break;case 2:a.setAttribute("style",ar.group2);break;case 3:a.setAttribute("style",ar.group3);break;case 5:a.setAttribute("style",ar.group5);break;case 9:a.setAttribute("style",ar.group9);break;case 13:a.setAttribute("style",ar.group13);break;default:a.setAttribute("style",ar.group)}return a.innerText=hs[e]||"Unusual combination",[r,i,a]}},{key:"renderAgent",value:function(e,t,n,r){var i=this,o=yi(this.controller.dom,ds(n),(0,m.sym)(r),this.controller.isEditable?{deleteFunction:function(){return i.deleteAgent(t,n,r).then(function(){return e.removeChild(o)}).catch(function(e){return i.controller.renderStatus(e)})}}:{});return o}},{key:"deleteAgent",value:(r=w(x().mark(function e(t,n,r){var i,o;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.byCombo[t]||[],(o=i.find(function(e){var t=Gn(e,2),i=t[0],o=t[1];return i===n&&o===r}))&&i.splice(i.indexOf(o),1),e.next=1,this.controller.save();case 1:case"end":return e.stop()}},e,this)})),function(e,t,n){return r.apply(this,arguments)})},{key:"addNewURI",value:(n=w(x().mark(function e(t){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.handleDroppedUri(t,gs(1));case 1:return e.next=2,this.controller.save();case 2:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"handleDroppedUris",value:(t=w(x().mark(function e(t,n){var r,i=this;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,Promise.all(t.map(function(e){return i.handleDroppedUri(e,n)}));case 1:return e.next=2,this.controller.save();case 2:e.next=4;break;case 3:return e.prev=3,r=e.catch(0),e.abrupt("return",Promise.reject(r));case 4:case"end":return e.stop()}},e,this,[[0,3]])})),function(e,n){return t.apply(this,arguments)})},{key:"handleDroppedUri",value:(e=w(x().mark(function e(t,n){var r,i,o,a,s,c,l,u=arguments;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>2&&void 0!==u[2]&&u[2],i=vs(t,this.store),o=(0,m.sym)(t),i||r){e.next=5;break}return kn.Rm("   Not obvious: looking up dropped thing ".concat(o)),e.prev=1,e.next=2,null===(a=this._store)||void 0===a||null===(a=a.fetcher)||void 0===a?void 0:a.load(o.doc());case 2:e.next=4;break;case 3:return e.prev=3,l=e.catch(1),s="Ignore error looking up dropped thing: ".concat(l),kn.z3(s),e.abrupt("return",Promise.reject(new Error(s)));case 4:return e.abrupt("return",this.handleDroppedUri(t,n,!0));case 5:if(i){e.next=6;break}return c="   Error: Drop fails to drop appropriate thing! ".concat(t),kn.z3(c),e.abrupt("return",Promise.reject(new Error(c)));case 6:this.setACLCombo(n,t,i,this.controller.subject);case 7:case"end":return e.stop()}},e,this,[[1,3]])})),function(t,n){return e.apply(this,arguments)})},{key:"setACLCombo",value:function(e,t,n,r){e in this.byCombo||(this.byCombo[e]=[]),this.removeAgentFromCombos(t),this.byCombo[e].push([n.pred,n.obj.uri]),kn.Rm("ACL: setting access to ".concat(r," by ").concat(n.pred,": ").concat(n.obj))}},{key:"removeAgentFromCombos",value:function(e){for(var t=0;t<16;t++){var n=this.byCombo[gs(t)];if(n)for(var r=0;r<n.length;r++)for(;r<n.length&&n[r][1]===e;)n.splice(r,1)}}}]);var e,t,n,r}();function gs(e){for(var t=["Read","Append","Write","Control"],n=[],r=0;r<4;r++)e&1<<r&&n.push("http://www.w3.org/ns/auth/acl#"+t[r]);return n.sort(),n.join("\n")}function vs(e,t){var n=(0,m.sym)(e),r=t.findTypeURIs(n);for(var i in r)kn.Rm("    drop object type includes: "+i);if(e.startsWith("http")&&3===e.split("/").length)return{pred:"origin",obj:n};if(e.startsWith("http")&&4===e.split("/").length&&e.endsWith("/"))return kn.Rm("Assuming final slash on dragged origin URI was unintended!"),{pred:"origin",obj:(0,m.sym)(e.slice(0,-1))};if(v.vcard("WebID").uri in r)return{pred:"agent",obj:n};if(v.vcard("Group").uri in r)return{pred:"agentGroup",obj:n};if(n.sameTerm(v.foaf("Agent"))||n.sameTerm(v.acl("AuthenticatedAgent"))||n.sameTerm(v.rdf("Resource"))||n.sameTerm(v.owl("Thing")))return{pred:"agentClass",obj:n};if(v.vcard("Individual").uri in r||v.foaf("Person").uri in r||v.foaf("Agent").uri in r){var o=t.any(n,v.foaf("preferredURI"));return o?{pred:"agent",obj:(0,m.sym)(o)}:{pred:"agent",obj:n}}return v.solid("AppProvider").uri in r?{pred:"origin",obj:n}:v.solid("AppProviderClass").uri in r?{pred:"originClass",obj:n}:(kn.Rm("    Triage fails for "+e),null)}var ys=function(){return qn(function e(t,n,r,i,o,a,s,c,l,u,d,p){if(Wn(this,e),this.subject=t,this.noun=n,this.context=r,this.statusElement=i,this.targetIsProtected=o,this.targetDoc=a,this.targetACLDoc=s,this.defaultHolder=c,this.defaultACLDoc=l,this.prospectiveDefaultHolder=u,this.store=d,this.dom=p,this.rootElement=p.createElement("div"),this.rootElement.setAttribute("style",ar.aclGroupContent),this.isContainer="/"===a.uri.slice(-1),c&&l){this.isUsingDefaults=!0;var f=_n(this.targetDoc,s,c,l);this.mainCombo=new ms(a,s,this,f,{defaults:this.isContainer}),this.defaultsCombo=null,this.defaultsDiffer=!1}else this.isUsingDefaults=!1,this.mainCombo=new ms(a,s,this,d),this.defaultsCombo=new ms(a,s,this,d,{defaults:this.isContainer}),this.defaultsDiffer=!Tn(this.mainCombo.aclMap,this.defaultsCombo.aclMap)},[{key:"isEditable",get:function(){return!this.isUsingDefaults}},{key:"render",value:function(){if(this.rootElement.innerHTML="",this.isUsingDefaults){if(this.renderStatus("The sharing for this ".concat(this.noun," is the default for folder ")),this.defaultHolder){var e=this.statusElement.appendChild(this.dom.createElement("a"));e.href=this.defaultHolder.uri,e.innerText=Cs(this.defaultHolder)}}else!this.defaultsDiffer&&this.isContainer?this.renderStatus("This is also the default for things in this folder."):this.renderStatus("");return this.rootElement.appendChild(this.mainCombo.render()),this.defaultsCombo&&this.defaultsDiffer?(this.rootElement.appendChild(this.renderRemoveDefaultsController()),this.rootElement.appendChild(this.defaultsCombo.render())):this.isEditable&&this.isContainer&&this.rootElement.appendChild(this.renderAddDefaultsController()),!this.targetIsProtected&&this.isUsingDefaults?this.rootElement.appendChild(this.renderAddAclsController()):this.targetIsProtected||this.rootElement.appendChild(this.renderRemoveAclsController()),this.rootElement}},{key:"renderRemoveAclsController",value:function(){var e=this,t=this.dom.createElement("button");return t.innerText="Remove custom sharing settings for this ".concat(this.noun," -- just use default").concat(this.prospectiveDefaultHolder?" for ".concat(En(this.prospectiveDefaultHolder)):""),t.setAttribute("style",ar.bigButton),t.addEventListener("click",function(){return e.removeAcls().then(function(){return e.render()}).catch(function(t){return e.renderStatus(t)})}),t}},{key:"renderAddAclsController",value:function(){var e=this,t=this.dom.createElement("button");return t.innerText="Set specific sharing for this ".concat(this.noun),t.setAttribute("style",ar.bigButton),t.addEventListener("click",function(){return e.addAcls().then(function(){return e.render()}).catch(function(t){return e.renderStatus(t)})}),t}},{key:"renderAddDefaultsController",value:function(){var e=this,t=this.dom.createElement("div");t.setAttribute("style",ar.defaultsController);var n=t.appendChild(this.dom.createElement("div"));n.innerText="Sharing for things within the folder currently tracks sharing for the folder.",n.setAttribute("style",ar.defaultsControllerNotice);var r=t.appendChild(this.dom.createElement("button"));return r.innerText="Set the sharing of folder contents separately from the sharing for the folder",r.setAttribute("style",ar.bigButton),r.addEventListener("click",function(){return e.addDefaults().then(function(){return e.render()})}),t}},{key:"renderRemoveDefaultsController",value:function(){var e=this,t=this.dom.createElement("div");t.setAttribute("style",ar.defaultsController);var n=t.appendChild(this.dom.createElement("div"));n.innerText="Access to things within this folder:",n.setAttribute("style",ar.defaultsControllerNotice);var r=t.appendChild(this.dom.createElement("button"));return r.innerText="Set default for folder contents to just track the sharing for the folder",r.setAttribute("style",ar.bigButton),r.addEventListener("click",function(){return e.removeDefaults().then(function(){return e.render()}).catch(function(t){return e.renderStatus(t)})}),t}},{key:"renderTemporaryStatus",value:function(e){var t=this;this.statusElement.setAttribute("style",ar.aclControlBoxStatusRevealed),this.statusElement.innerText=e,this.statusElement.setAttribute("style",ar.temporaryStatusInit),setTimeout(function(){t.statusElement.setAttribute("style",ar.temporaryStatusEnd)}),setTimeout(function(){t.statusElement.innerText=""},5e3)}},{key:"renderStatus",value:function(e){e||this.statusElement.setAttribute("style",ar.aclControlBoxStatusRevealed),this.statusElement.innerText=e}},{key:"addAcls",value:(r=w(x().mark(function e(){var t,n,r,i=this;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.defaultHolder&&this.defaultACLDoc){e.next=1;break}return t="Unable to find defaults to copy",kn.z3(t),e.abrupt("return",Promise.reject(t));case 1:return _n(this.targetDoc,this.targetACLDoc,this.defaultHolder,this.defaultACLDoc).statements.forEach(function(e){return i.store.add(e.subject,e.predicate,e.object,i.targetACLDoc)}),e.prev=2,e.next=3,this.store.fetcher.putBack(this.targetACLDoc);case 3:return this.isUsingDefaults=!1,e.abrupt("return",Promise.resolve());case 4:return e.prev=4,r=e.catch(2),n=" Error writing back access control file! ".concat(r),kn.z3(n),e.abrupt("return",Promise.reject(n));case 5:case"end":return e.stop()}},e,this,[[2,4]])})),function(){return r.apply(this,arguments)})},{key:"addDefaults",value:(n=w(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.defaultsCombo=new ms(this.targetDoc,this.targetACLDoc,this,this.store,{defaults:!0}),this.defaultsDiffer=!0;case 1:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"removeAcls",value:(t=w(x().mark(function e(){var t,n,r;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,this.store.fetcher.delete(this.targetACLDoc.uri,{});case 1:return this.isUsingDefaults=!0,e.prev=2,e.next=3,Fn(this.targetDoc.uri);case 3:this.prospectiveDefaultHolder=e.sent,e.next=5;break;case 4:e.prev=4,n=e.catch(2),kn.R8(n);case 5:e.next=7;break;case 6:return e.prev=6,r=e.catch(0),t="Error deleting access control file: ".concat(this.targetACLDoc,": ").concat(r),kn.z3(t),e.abrupt("return",Promise.reject(t));case 7:case"end":return e.stop()}},e,this,[[0,6],[2,4]])})),function(){return t.apply(this,arguments)})},{key:"removeDefaults",value:(e=w(x().mark(function e(){var t,n;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.defaultsCombo,e.prev=1,this.defaultsCombo=null,this.defaultsDiffer=!1,e.next=2,this.save();case 2:e.next=4;break;case 3:return e.prev=3,n=e.catch(1),this.defaultsCombo=t,this.defaultsDiffer=!0,kn.z3(n),e.abrupt("return",Promise.reject(n));case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(){return e.apply(this,arguments)})},{key:"save",value:function(){var e=this,t=(0,m.graph)();this.isContainer?this.defaultsCombo&&this.defaultsDiffer?(Pn(t,this.targetDoc,this.mainCombo.byCombo,this.targetACLDoc,!0),Pn(t,this.targetDoc,this.defaultsCombo.byCombo,this.targetACLDoc,!1,!0)):Pn(t,this.targetDoc,this.mainCombo.byCombo,this.targetACLDoc,!0,!0):Pn(t,this.targetDoc,this.mainCombo.byCombo,this.targetACLDoc,!0),t.fetcher=(0,m.fetcher)(t,{fetch:this.store.fetcher._fetch});var n=t.updater||new m.UpdateManager(t);return new Promise(function(r,i){n.put(e.targetACLDoc,t.statementsMatching(void 0,void 0,void 0,e.targetACLDoc),"text/turtle",function(n,o,a){if(!o)return i(new Error("ACL file save failed: ".concat(a)));e.store.fetcher.unload(e.targetACLDoc),e.store.add(t.statements),e.store.fetcher.requested[e.targetACLDoc.uri]="done",e.mainCombo.store=e.store,e.defaultsCombo&&(e.defaultsCombo.store=e.store),e.defaultsDiffer=!!e.defaultsCombo&&!Tn(e.mainCombo.aclMap,e.defaultsCombo.aclMap),kn.Rm("ACL modification: success!"),r()})})}}]);var e,t,n,r}(),ws=window,bs=Symbol("prevent double triggering of drop event");function xs(e){e.stopPropagation(),e.preventDefault()}function Es(e){e.dataTransfer.files.length>0&&(ws.confirm("Are you sure you want to drop this file here? (Cancel opens it in a new tab)")||(e.stopPropagation(),e.preventDefault(),(0,kn.Rm)("@@@@ document-level DROP suppressed: "+e.dataTransfer.dropEffect)))}function Cs(e){var t=e.uri;"/"===t.slice(-1)&&(t=t.slice(0,-1));var n=t.lastIndexOf("/");return n>=0&&(t=t.slice(n+1)),t||"/"}function ks(){return ks=w(x().mark(function e(t,n,r,i,o,a,s){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,c){return jn(t,function(){var t=w(x().mark(function t(l,u,d,p,f,h){var m,g,v,y,w;return x().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(y=function(e){return new ys(r,i,o,s,g,d,p,f,h,e,n,a)},l){t.next=1;break}return t.abrupt("return",c(new Error("Error reading ".concat(u?"":" default ","ACL. status ").concat(d,": ").concat(p))));case 1:if(m=As(d),(g=_s(d,p,n)||Ss(d))||!m){t.next=5;break}return t.prev=2,t.next=3,Fn(m);case 3:return v=t.sent,t.abrupt("return",e(y(v)));case 4:t.prev=4,w=t.catch(2),(0,kn.R8)(w);case 5:return t.abrupt("return",e(y()));case 6:case"end":return t.stop()}},t,null,[[2,4]])}));return function(e,n,r,i,o,a){return t.apply(this,arguments)}}())}));case 1:case"end":return e.stop()}},e)})),ks.apply(this,arguments)}function As(e){var t=e.uri.split("#")[0],n=t.slice(0,-1).lastIndexOf("/"),r=t.indexOf("//");return r>=0&&n<r+2||n<0?null:t.slice(0,n+1)}function _s(e,t,n){return n.holds(e,v.rdf("type"),v.space("Storage"),t)}function Ss(e){return e.uri===e.site().uri}var Ts={adoptACLDefault:_n,readACL:Sn,sameACL:Tn,ACLunion:Rn,loadUnionACL:In,ACLbyCombination:Ln,makeACLGraph:Nn,makeACLGraphbyCombo:Pn,ACLToString:function(e){return Bn(Ln(e))},comboToString:Bn,makeACLString:function(e,t,n){var r=(0,m.graph)();return Nn(r,e,t,n),(0,m.serialize)(n,r,n.uri,"text/turtle")||""},putACLObject:On,putACLbyCombo:Dn,fixIndividualCardACL:function(e,t,n){var r=An.each(void 0,v.vcard("hasMember"),e);r?Un(e,r,t,n):(t("This card is in no groups"),n(!0))},fixIndividualACL:Un,setACL:function(e,t,n){var r=An.any(e,bt);if(!An.fetcher)throw new Error("Store has no fetcher");r?An.fetcher.webOperation("PUT",r.value,{data:t,contentType:"text/turtle"}).then(function(e){n(e.ok,e.error||"")}):An.fetcher.nowOrWhenFetched(e,void 0,function(r,i){if(!r)return n(r,"Gettting headers for ACL: "+i);var o=An.any(e,bt);if(o){if(!An.fetcher)throw new Error("Store has no fetcher");An.fetcher.webOperation("PUT",o.value,{data:t,contentType:"text/turtle"}).then(function(e){n(e.ok,e.error||"")})}else n(!1,"No Link rel=ACL header for "+e)})},getACLorDefault:jn,getACL:Mn},Rs={preventBrowserDropEvents:function(e){if((0,kn.Rm)("preventBrowserDropEvents called."),void 0!==ws){if(ws[bs])return;ws[bs]=!0}e.addEventListener("drop",Es,!1),e.addEventListener("dragenter",xs,!1),e.addEventListener("dragover",xs,!1)},shortNameForFolder:Cs,ACLControlBox5:function(e,t,n,r){var i=t.dom,o=e.doc(),a=i.createElement("div");a.setAttribute("style",ar.aclControlBoxContainer);var s=a.appendChild(i.createElement("h1"));s.textContent="Sharing for ".concat(n," ").concat(En(e)),s.setAttribute("style",ar.aclControlBoxHeader);var c=a.appendChild(i.createElement("div"));c.setAttribute("style",ar.aclControlBoxStatus);try{(function(e,t,n,r,i,o,a){return ks.apply(this,arguments)})(o,r,e,n,t,i,c).then(function(e){return a.appendChild(e.render())})}catch(e){c.innerText=e}return a}},Is=Wt.store;var Ls={newThingUI:function(e,t,n){var r=e.dom,i=e.div;if(e.me&&!e.me.uri)throw new Error("newThingUI:  Invalid userid: "+e.me);var o="padding: 0.7em; width: 2em; height: 2em;",a=i.appendChild(r.createElement("img")),s=!1;a.setAttribute("src",dr.Pt.iconBase+"noun_34653_green.svg"),a.setAttribute("style",o),a.setAttribute("title","Add another tool");var c=function(e){var t=i.appendChild(r.createElement("pre"));t.setAttribute("style","background-color: pink"),t.appendChild(r.createTextNode(e))};function l(e){for(var t=0;t<d.length;t++){var n=o+e;d[t].disabled&&(n+="opacity: 0.3;"),d[t].setAttribute("style",n)}}function u(e){s=!s,a.setAttribute("style",o+(s?"background-color: yellow;":"")),l(s?"":"display: none;")}a.addEventListener("click",u);var d=[],p=Object.values(n).filter(function(e){return e.mintNew}),f=p.reduce(function(e,t){return t.mintClass&&(e[t.mintClass.uri]=(e[t.mintClass.uri]||0)+1),e},{});p.forEach(function(n){var i=e.div.appendChild(r.createElement("img"));i.setAttribute("src",n.icon);var a=n.mintClass?f[n.mintClass.uri]>1?"".concat(En(n.mintClass)," (using ").concat(n.name," pane)"):En(n.mintClass):n.name+" @@";i.setAttribute("title","Make new "+a),i.setAttribute("style",o+"display: none;"),d.push(i),i.disabled||i.addEventListener("click",function(s){var d;!function(e){l("display: none;"),e.setAttribute("style",o+"background-color: yellow;")}(i),d={event:s,folder:e.folder||null,iconEle:i,pane:n,noun:a,noIndexHTML:!0,div:e.div,me:e.me,dom:e.dom,refreshTarget:e.refreshTarget},new Promise(function(n,i){var o;function a(n,o){za(e).then(function(e){var a=Object.assign({newBase:o,folder:d.folder||void 0,workspace:n},d);for(var s in d)a[s]=d[s];kn.Rm("newThingUI: Minting new ".concat(a.pane.name," at ").concat(a.newBase)),d.pane.mintNew(t,a).then(function(e){if(!e||!e.newInstance)throw new Error("Cannot mint new - missing newInstance");if(e.folder){var t=e.newInstance.uri.slice(e.folder.uri.length).includes("/");kn.Rm("  new thing is packge? "+t),t?Is.add(e.folder,v.ldp("contains"),Is.sym(e.newBase),e.folder.doc()):Is.add(e.folder,v.ldp("contains"),e.newInstance,e.folder.doc()),e.refreshTarget&&e.refreshTarget.refresh&&e.refreshTarget.refresh()}else{var n=d.div.appendChild(r.createElement("p"));n.setAttribute("style","font-size: 120%;"),n.innerHTML="Your <a target='_blank' href='"+e.newInstance.uri+"'><b>new "+d.noun+"</b></a> is ready to be set up. <br/><br/><a target='_blank' href='"+e.newInstance.uri+"'>Go to your new "+d.noun+".</a>"}u()}).catch(function(e){c(e),i(e)})},function(e){c("Error logging on: "+e)})}var s=d.pane;d.noun=s.mintClass?En(s.mintClass):s.name,d.appPathSegment=d.noun.slice(0,1).toUpperCase()+d.noun.slice(1),d.folder?vi(r,0,d.div,v.foaf("name"),null,d.noun).then(function(e){if(e){var t=d.folder.uri;t.endsWith("/")||(t+="/"),a(null,t=t+encodeURIComponent(e)+"/")}else u()}):(o=rs(r,{noun:d.noun,appPathSegment:d.appPathSegment},a),d.div.appendChild(o))})})})}},Ns=Wt.store;var Ps={matrixForQuery:function(e,t,n,r,i,o,a){var s=e.createElement("table"),c=e.createElement("tr");c.appendChild(e.createElement("td")).setAttribute("class","MatrixCorner"),s.appendChild(c),s.lastHeader=c;var l=[],u=[],d=function(e,t,n,r){for(;e.firstChild;)e.removeChild(e.firstChild);e.setAttribute("style",""),e.style.textAlign="center",o.cellFunction?o.cellFunction(e,t,n,r):(e.textContent=En(r),e.setAttribute("style","padding: 0.3em")),delete e.old},p=function(t){var n=t.toNT();if(u[n])return u[n];var r=e.createElement("tr"),i=r.appendChild(e.createElement("td"));i.setAttribute("style","padding: 0.3em;"),i.textContent=En(t),"NamedNode"===t.termType&&Ns.fetcher.nowOrWhenFetched(t.uri.split("#")[0],void 0,function(e,n,r){e&&(i.textContent=En(t))});for(var a=0;a<l.length;a++)d(r.appendChild(e.createElement("td")),m.fromNT(l[a]),t,null);r.dataValueNT=n,u[n]=r;for(var c=s.lastHeader.nextSibling;c;c=c.nextSibling)if(n>c.dataValueNT&&o&&o.yDecreasing||n<c.dataValueNT&&(!o||!o.yDecreasing))return s.insertBefore(r,c);return s.appendChild(r)},f=function(t){for(var n=t.toNT(),r=null,i=0;i<l.length;i++){if(l[i]===n)return i;if(n>l[i]&&o.xDecreasing||n<l[i]&&!o.xDecreasing){l=l.slice(0,i).concat([n]).concat(l.slice(i)),r=i;break}}null===r&&(r=l.length,l.push(n));for(var a=s.firstChild;a;a=a.nextSibling){var c=a.dataValueNT,u=e.createElement("td");if(u.style.textAlign="center",a===s.firstChild?u.textContent=En(t):d(u,t,m.fromNT(c),null),r===l.length-1)a.appendChild(u);else{for(var p=a.firstChild,f=0;f<r+1;f++)p=p.nextSibling;a.insertBefore(u,p)}}return r},h=function(){var e,t,n=[],r=[];if(o.set_y)for(var i=0;i<o.set_y.length;i++)r[o.set_y[i]]=!0;if(o.set_x)for(var a=0;a<o.set_x.length;a++)n[f(o.set_x[a])+1]=!0;for(var c=1;c<s.children.length;c++){e=s.children[c];for(var p=1;p<e.children.length;p++)if((t=e.children[p]).old){var h=m.fromNT(e.dataValueNT),g=m.fromNT(l[p-1]);d(t,g,h,null)}else r[e.dataValueNT]=!0,n[p]=!0}for(var v=0;v<s.children.length;v++)if(e=s.children[v],v>0&&!r[e.dataValueNT])delete u[e.dataValueNT],s.removeChild(e);else for(var y=e.children.length-1;y>0;y--){var w=e.children[y];n[y]||e.removeChild(w)}for(var b=[],x=0;x<l.length;x++)n[x+1]&&b.push(l[x]);l=b};s.refresh=function(){!function(){for(var e=1;e<s.children.length;e++)for(var t=s.children[e],n=1;n<t.children.length;n++)t.children[n].old=!0}(),Ns.query(t,g,void 0,h)};var g=function(e){var t=e[n.toString()],o=e[r.toString()],a=e[i.toString()],s=p(o),c=f(t),l=s.children[c+1];d(l,t,o,a)};if(o.set_y)for(var v=0;v<o.set_y.length;v++)p(o.set_y[v]);if(o.set_x)for(var y=0;y<o.set_x.length;y++)f(o.set_x[y]);return Ns.query(t,g,void 0,a),s}},Bs=dr.Pt.iconBase+"noun_Camera_1618446_000000.svg",Os=dr.Pt.iconBase+"noun_479395.svg";function Ds(e,t,n,r){var i,o,a,s,c=e.createElement("div"),l=c.appendChild(e.createElement("table")),u=l.appendChild(e.createElement("tr")).appendChild(e.createElement("td"));u.setAttribute("colspan","4");var d=l.appendChild(e.createElement("tr"));d.appendChild(e.createElement("td")).appendChild(mi(e)).addEventListener("click",function(e){v(),r(null)});var p=d.appendChild(e.createElement("td")).appendChild(hi(e,Os,"Retake"));p.addEventListener("click",function(e){u.removeChild(s),m()}),p.style.visibility="collapse";var f=d.appendChild(e.createElement("td")).appendChild(hi(e,dr.Pt.iconBase+"noun_10636.svg","Snap"));f.addEventListener("click",function(){(s=e.createElement("canvas")).setAttribute("width",ar.canvasWidth),s.setAttribute("height",ar.canvasHeight),s.setAttribute("style",ar.controlStyle),u.appendChild(s),s.getContext("2d").drawImage(a,0,0,s.width,s.height),a.parentNode.removeChild(a),s.toBlob(function(e){var t="got blob type ".concat(e.type," size ").concat(e.size);kn.Rm(t),i=n(),o=e,h.style.visibility="visible",p.style.visibility="visible",f.style.visibility="collapse"},"image/png")}),f.style.visibility="collapse";var h=d.appendChild(e.createElement("td")).appendChild(gi(e));function m(){if((a=u.appendChild(e.createElement("video"))).setAttribute("controls","1"),a.setAttribute("autoplay","1"),a.setAttribute("style",ar.controlStyle),!navigator.mediaDevices)throw new Error("navigator.mediaDevices not available");navigator.mediaDevices.getUserMedia(g).then(function(e){a.srcObject=e,f.style.visibility="visible",h.style.visibility="collapse",p.style.visibility="collapse"})}h.addEventListener("click",function(e){!function(e,n){var i=e.type;kn.Rm("Putting "+e.size+" bytes of "+i+" to "+n),t.fetcher.webOperation("PUT",n.uri,{data:e,contentType:i}).then(function(e){kn.Rm("ok saved "+n),v(),r(n)},function(e){v(),alert(e)})}(o,i)}),h.style.visibility="collapse";var g={video:!0};function v(){a&&a.srcObject&&a.srcObject.getVideoTracks().forEach(function(e){return e.stop()})}return m(),c}var Us={cameraCaptureControl:Ds,cameraButton:function(e,t,n,r){var i,o=e.createElement("div"),a=hi(e,Bs,"Take picture");function s(e){return c.apply(this,arguments)}function c(){return(c=w(x().mark(function e(t){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o.removeChild(i),o.appendChild(a),r(t);case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}return o.appendChild(a),a.addEventListener("click",function(r){o.removeChild(a),i=Ds(e,t,n,s),o.appendChild(i)}),o}};var js=o(580),Ms=o.n(js);const Fs={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let Hs;const Ws=new Uint8Array(16);const $s=[];for(let e=0;e<256;++e)$s.push((e+256).toString(16).slice(1));function Js(e,t=0){return($s[e[t+0]]+$s[e[t+1]]+$s[e[t+2]]+$s[e[t+3]]+"-"+$s[e[t+4]]+$s[e[t+5]]+"-"+$s[e[t+6]]+$s[e[t+7]]+"-"+$s[e[t+8]]+$s[e[t+9]]+"-"+$s[e[t+10]]+$s[e[t+11]]+$s[e[t+12]]+$s[e[t+13]]+$s[e[t+14]]+$s[e[t+15]]).toLowerCase()}const zs=function(e,t,n){if(Fs.randomUUID&&!t&&!e)return Fs.randomUUID();const r=(e=e||{}).random??e.rng?.()??function(){if(!Hs){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Hs=crypto.getRandomValues.bind(crypto)}return Hs(Ws)}();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){if((n=n||0)<0||n+16>t.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[n+e]=r[e];return t}return Js(r)};var qs,Ks=Wt.store,Vs=function(){return qn(function e(t,n,r,i){Wn(this,e),this.options=i||{},this.element=t,this.typeIndex=n,this.groupPickedCb=r,this.selectedgroup=this.options.selectedgroup,this.onSelectGroup=this.onSelectGroup.bind(this)},[{key:"render",value:function(){var e=this,t=document.createElement("div");if(t.style.maxWidth="350px",t.style.minHeight="200px",t.style.outline="1px solid black",t.style.display="flex",this.selectedgroup){t.style.flexDirection="column";var n=document.createElement("div");new Qs(n,this.selectedgroup).render();var r=document.createElement("button");r.textContent=Ms()("Change group"),r.addEventListener("click",function(t){e.selectedgroup=null,e.render()}),t.appendChild(n),t.appendChild(r)}else this.findAddressBook(this.typeIndex).then(function(n){var r=n.book,i=document.createElement("button");i.textContent=Ms()("Pick an existing group"),i.style.margin="auto",i.addEventListener("click",function(n){new Gs(t,r,e.onSelectGroup).render()});var o=document.createElement("button");o.textContent=Ms()("Create a new group"),o.style.margin="auto",o.addEventListener("click",function(t){e.createNewGroup(r,e.options.defaultNewGroupName).then(function(t){var n=t.group;new Zs(e.element,r,n,e.onSelectGroup).render()}).catch(function(t){e.element.appendChild(Wr(document,Ms()("Error creating a new group. (".concat(t,")"))))})}),t.appendChild(i),t.appendChild(o),e.element.innerHTML="",e.element.appendChild(t)}).catch(function(t){e.element.appendChild(Wr(document,Ms()("Could find your groups. (".concat(t,")"))))});return this.element.innerHTML="",this.element.appendChild(t),this}},{key:"findAddressBook",value:function(e){return new Promise(function(t,n){Ks.fetcher.nowOrWhenFetched(e,function(r,i){if(!r)return n(i);var o=Ks.any(null,v.solid("forClass"),v.vcard("AddressBook"));if(!o)return n(new Error("no address book registered in the solid type index "+e));var a=Ks.any(o,v.solid("instance"));if(!a)return n(new Error("incomplete address book registration"));Ks.fetcher.load(a).then(function(e){return t({book:a})}).catch(function(e){return n(new Error("Could not load address book "+e))})})})}},{key:"createNewGroup",value:function(e,t){var n=tc(e),r=n.groupIndex,i=n.groupContainer,o=m.sym("".concat(i.uri).concat(zs().slice(0,8),".ttl#this")),a=t||"Untitled Group",s=[o.doc(),r].map(function(t){var n=m.st(o,v.rdf("type"),v.vcard("Group"),t),i=m.st(o,v.vcard("fn"),a,o.doc(),t),s=m.st(e,v.vcard("includesGroup"),o,t),c=t.equals(r)?[n,i,s]:[n,i];return ec(t.uri,{toIns:c}).then(function(){c.forEach(function(e){Ks.add(e)})})});return Promise.all(s).then(function(){return{group:o}}).catch(function(e){throw kn.Rm("Could not create new group.  PATCH failed "+e),new Error("Couldn't create new group.  PATCH failed for (".concat(e.xhr?e.xhr.responseURL:""," )"))})}},{key:"onSelectGroup",value:function(e){this.selectedgroup=e,this.groupPickedCb(e),this.render()}}])}(),Gs=function(){return qn(function e(t,n,r){Wn(this,e),this.element=t,this.book=n,this.onSelectGroup=r},[{key:"render",value:function(){var e=this;return this.loadGroups().then(function(t){var n=document.createElement("div");n.style.display="flex",n.style.flexDirection="column",t.forEach(function(t){var r=document.createElement("button");r.addEventListener("click",e.handleClickGroup(t)),new Qs(r,t).render(),n.appendChild(r)}),e.element.innerHTML="",e.element.appendChild(n)}).catch(function(t){e.element.appendChild(Wr(document,Ms()("There was an error loading your groups. (".concat(t,")"))))}),this}},{key:"loadGroups",value:function(){var e=this;return new Promise(function(t,n){var r=tc(e.book).groupIndex;Ks.fetcher.nowOrWhenFetched(r,function(r,i){if(!r)return n(i);var o=Ks.each(e.book,v.vcard("includesGroup"));return t(o)})})}},{key:"handleClickGroup",value:function(e){var t=this;return function(n){t.onSelectGroup(e)}}}])}(),Qs=function(){return qn(function e(t,n){Wn(this,e),this.element=t,this.group=n},[{key:"render",value:function(){var e=document.createElement("div");return e.textContent=Ms()(Xs(this.group,v.vcard("fn"),"[".concat(this.group.value,"]"))),this.element.innerHTML="",this.element.appendChild(e),this}}])}(),Zs=function(){return qn(function e(t,n,r,i,o){Wn(this,e),this.element=t,this.book=n,this.group=r,this.onGroupChanged=function(e,t,n){o&&o(e,t,n)},this.groupChangedCb=o,this.doneBuildingCb=i},[{key:"refresh",value:function(){}},{key:"render",value:function(){var e=this,t=document.createElement("div");t.style.maxWidth="350px",t.style.minHeight="200px",t.style.outline="1px solid black",t.style.display="flex",t.style.flexDirection="column",sr(t,function(t){t.forEach(function(t){e.add(t).catch(function(t){e.element.appendChild(Wr(document,Ms()("Could not add the given WebId. (".concat(t,")"))))})})});var n=document.createElement("input");n.type="text",n.value=Xs(this.group,v.vcard("fn"),"Untitled Group"),n.addEventListener("change",function(t){e.setGroupName(t.target.value).catch(function(t){e.element.appendChild(Wr(document,"Error changing group name. (".concat(t,")")))})});var r,i,o=document.createElement("label");if(o.textContent=Ms()("Group Name:"),o.appendChild(n),t.appendChild(o),Ks.any(this.group,v.vcard("hasMember")))Ks.match(this.group,v.vcard("hasMember")).forEach(function(n){var r=n.object,i=document.createElement("div");new Ys(i,r,e.handleRemove(r)).render(),t.appendChild(i)});else{var a=document.createElement("p");a.textContent=Ms()(qs||(r=["\n        To add someone to this group, drag and drop their WebID URL onto the box.\n      "],i||(i=r.slice(0)),qs=Object.freeze(Object.defineProperties(r,{raw:{value:Object.freeze(i)}})))),t.appendChild(a)}var s=document.createElement("button");return s.textContent=Ms()("Done"),s.addEventListener("click",function(t){e.doneBuildingCb(e.group)}),t.appendChild(s),this.element.innerHTML="",this.element.appendChild(t),this}},{key:"add",value:function(e){var t=this;return new Promise(function(n,r){Ks.fetcher.nowOrWhenFetched(e,function(i,o){if(!i)return t.onGroupChanged(o),r(o);var a=m.namedNode(e),s=Ks.any(a,v.rdf("type"));return s&&s.equals(v.foaf("Person"))?n(a):r(new Error("Only people supported right now. (tried to add something of type ".concat(s.value,")")))})}).then(function(e){var n=m.st(t.group,v.vcard("hasMember"),e);return Ks.holdsStatement(n)?e:ec(t.group.doc().uri,{toIns:[n]}).then(function(){n.why=t.group.doc(),Ks.add(n),t.onGroupChanged(null,"added",e),t.render()})})}},{key:"handleRemove",value:function(e){var t=this;return function(n){var r=m.st(t.group,v.vcard("hasMember"),e);return ec(t.group.doc().uri,{toDel:[r]}).then(function(){return Ks.remove(r),t.onGroupChanged(null,"removed",e),t.render(),!0}).catch(function(t){var n=Ks.any(e,v.foaf("name")),r=n&&n.value?"Could not remove ".concat(n.value,". (").concat(t,")"):"Could not remove ".concat(e.value,". (").concat(t,")");throw new Error(r)})}}},{key:"setGroupName",value:function(e){var t=this,n=tc(this.book).groupIndex,r=[this.group.doc(),n].map(function(n){var r=Ks.match(t.group,v.vcard("fn"),null,n),i=m.st(t.group,v.vcard("fn"),m.literal(e));return ec(n.value,{toDel:r,toIns:[i]}).then(function(e){Ks.removeStatements(r),i.why=n,Ks.add(i)})});return Promise.all(r)}}])}(),Ys=function(){return qn(function e(t,n,r){Wn(this,e),this.webIdNode=n,this.element=t,this.handleRemove=r},[{key:"render",value:function(){var e=this,t=document.createElement("div");t.style.display="flex";var n=Xs(this.webIdNode,v.foaf("img"),dr.LN+"noun_15059.svg"),r=document.createElement("img");r.src=Ms()(n),r.width="50",r.height="50",r.style.margin="5px";var i=Xs(this.webIdNode,v.foaf("name"),"[".concat(this.webIdNode,"]")),o=document.createElement("span");o.innerHTML=Ms()(i),o.style.flexGrow="1",o.style.margin="auto 0";var a=document.createElement("button");return a.textContent="Remove",a.addEventListener("click",function(t){return e.handleRemove().catch(function(t){e.element.appendChild(Wr(document,Ms()("".concat(t))))})}),a.style.margin="5px",t.appendChild(r),t.appendChild(o),t.appendChild(a),this.element.innerHTML="",this.element.appendChild(t),this}}])}();function Xs(e,t,n){var r=Ks.any(e,t);return r?r.value:n}function ec(e,t){var n=t.toDel,r=t.toIns;return new Promise(function(e,t){Ks.updater.update(n,r,function(n,r,i){if(!r)return t(new Error("PATCH failed for resource <".concat(n,">: ").concat(i)));e()})})}function tc(e){return{groupIndex:Ks.any(e,v.vcard("groupIndex")),groupContainer:Ks.sym(e.dir().uri+"Group/")}}var nc={icons:dr.Pt,ns:v,rdf:m,style:ar,widgets:s};function rc(e,t,n,r,i){t=t||Wt.store,r=r.doc();var o,a,s=nc.ns,c=m.Namespace("http://www.w3.org/2005/01/wf/flow#"),l=m.Namespace("http://purl.org/dc/terms/"),u=!!(i=i||{}).newestFirst,d="white-space: pre-wrap; width: 90%; font-size:100%; border: 0.07em solid #eee; padding: .2em 0.5em; margin: 0.1em 1em 0.1em 1em;",p=e.createElement("div"),f=Wt.store.updater,h=function(t,n){var r=e.createElement("a");return n&&n.uri&&(r.setAttribute("href",n.uri),r.addEventListener("click",nc.widgets.openHrefInOutlineMode,!0),r.setAttribute("style","color: #3B5998; text-decoration: none; ")),r.textContent=t,r},g=function(t,n){var r=e.createElement("pre");return r.setAttribute("style",n||"color: grey"),p.appendChild(r),r.appendChild(e.createTextNode(t)),r},v=function(e){g(e,"color: #800;")};function y(e){var t=Wt.store.any(e,nc.ns.foaf("nick"));return t?""+t.value:""+En(e)}function w(t,n,r,i){var o=t.appendChild(h(y(n),n));n.uri&&Wt.store.fetcher.nowOrWhenFetched(n.doc(),void 0,function(e,t){o.textContent=y(n)}),t.appendChild(e.createElement("br")),t.appendChild(h(r,i))}function b(e,n){var r,i,o={};for(r=n.firstChild;r;r=r.nextSibling)r.AJAR_subject&&(o[r.AJAR_subject.uri]=!0);var a=t.each(e,s.wf("message")),c={};for(a.forEach(function(e){c[e.uri]=!0,o[e.uri]||x(e)}),r=n.firstChild;r;)i=r.nextSibling,r.AJAR_subject&&!c[r.AJAR_subject.uri]&&n.removeChild(r),r=i}var x=function(e){var n={"?msg":e,"?creator":t.any(e,s.foaf("maker")),"?date":t.any(e,l("created")),"?content":t.any(e,s.sioc("content"))};E(n,!0)},E=function(r,i){var a=r["?creator"],s=r["?msg"],c=r["?date"],l=r["?content"],p=c.value,h=e.createElement("tr");h.AJAR_date=p,h.AJAR_subject=s;for(var m=!1,g=o.firstChild;g;g=g.nextSibling)if(p>g.AJAR_date&&u||p<g.AJAR_date&&!u){o.insertBefore(h,g),m=!0;break}m||o.appendChild(h);var y=e.createElement("td");h.appendChild(y),w(y,a,nc.widgets.shortDate(p),s);var x=e.createElement("td");h.appendChild(x);var E=e.createElement("p");E.setAttribute("style",d+(i?"background-color: #e8ffe8;":"background-color: #white;")),x.appendChild(E),E.textContent=l.value;var C=e.createElement("td");h.appendChild(C);var k=e.createElement("button");C.appendChild(k),k.textContent="-",h.setAttribute("class","hoverControl"),k.setAttribute("class","hoverControlHide"),k.setAttribute("style","color: red;"),k.addEventListener("click",function(r){C.removeChild(k);var i=e.createElement("button");i.textContent="cancel",C.appendChild(i).addEventListener("click",function(e){C.removeChild(a),C.removeChild(i),C.appendChild(k)},!1);var a=e.createElement("button");a.textContent="Delete message",C.appendChild(a).addEventListener("click",function(e){C.removeChild(a),C.removeChild(i),function(e){var r=t.statementsMatching(e).concat(t.statementsMatching(void 0,void 0,e));f.update(r,[],function(e,t,r){t?b(n,o):v("Cant delete messages:"+r)})}(s)},!1)},!1)};(o=e.createElement("table")).fresh=!1,p.appendChild(o),o.setAttribute("style","width: 100%;");var C,k=function(){var i=e.createElement("tr"),o=e.createElement("td"),c=e.createElement("td"),u=e.createElement("td");i.appendChild(o),i.appendChild(c),i.appendChild(u),i.AJAR_date="9999-01-01T00:00:00Z";var p,h,g=function(){p.setAttribute("class","pendingedit"),p.disabled=!0;var o=[],c=new Date,u=""+c.getTime(),d=m.term(c),h=t.sym(r.uri+"#Msg"+u);o.push(new m.Statement(n,s.wf("message"),h,r)),o.push(new m.Statement(h,s.sioc("content"),t.literal(p.value),r)),o.push(new m.Statement(h,l("created"),d,r)),a&&o.push(new m.Statement(h,s.foaf("maker"),a,r));f.update([],o,function(n,r,o){if(r){var s={"?msg":h,"?content":t.literal(p.value),"?date":d,"?creator":a};E(s,!1),p.value="",p.setAttribute("class",""),p.disabled=!1}else i.appendChild(nc.widgets.errorMessageBlock(e,"Error writing message: "+o))})};i.appendChild(e.createElement("br"));return Wa({div:c,dom:e}).then(function(t){a=t.me,w(o,a,"",null),p=e.createElement("textarea"),c.innerHTML="",c.appendChild(p),p.rows=3,p.setAttribute("style",d+"background-color: #eef;"),p.addEventListener("keyup",function(e){13===e.keyCode&&(e.altKey||g())},!1),u.innerHTML="",(h=nc.widgets.button(e,nc.icons.iconBase+"noun_383448.svg","Send")).setAttribute("style",nc.style.buttonStyle+"float: right;"),h.addEventListener("click",g,!1),u.appendChild(h)}),i}();if(u?o.insertBefore(k,o.firstChild):o.appendChild(k),i.query)C=i.query;else{C=new m.Query("Messages");var A={};["msg","date","creator","content"].forEach(function(e){C.vars.push(A[e]=m.variable(e))}),C.pat.add(n,c("message"),A.msg),C.pat.add(A.msg,s.dct("created"),A.date),C.pat.add(A.msg,s.foaf("maker"),A.creator),C.pat.add(A.msg,s.sioc("content"),A.content)}return t.query(C,E,void 0,function(){o.fresh=!0}),p.refresh=function(){b(n,o)},p}function ic(e){return oc.apply(this,arguments)}function oc(){return(oc=w(x().mark(function e(t){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,qt.fetcher.load(t);case 1:return e.abrupt("return",!(qt.statementsMatching(null,v.dct("created"),null,t).length>0));case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}var ac=function(){return qn(function e(t,n,r){Wn(this,e),this.root=t,this.rootFolder=t.dir(),this.leafFileName=n||"index.ttl",this.membershipProperty=r||v.wf("leafObject")},[{key:"leafDocumentFromDate",value:function(e){var t=e.toISOString().split("T")[0].replace(/-/g,"/");return t=this.root.dir().uri+t+"/"+this.leafFileName,qt.sym(t)}},{key:"dateFromLeafDocument",value:function(e){var t=this.rootFolder.uri.length,n=e.uri.slice(t,t+10).replace(/\//g,"-");return new Date(n)}},{key:"loadPrevious",value:(t=w(x().mark(function e(t,n){var r,i,o,a,s,c;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=function(){return(i=w(x().mark(function e(t,i){var o,a,s,c,l,u,d,p,f,h;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=function(e){return(e=e.filter(a)).sort(),n||e.reverse(),e.pop()},a=function(e){var t=e.uri.slice(0,-1).split("/").slice(-1)[0];return!!"0123456789".includes(t[0])},o=function(e){return!(n?e.uri>=t.uri:e.uri<=t.uri)},c=t.dir(),e.prev=1,e.next=2,qt.fetcher.load(c);case 2:if(l=(l=qt.each(c,v.ldp("contains"))).filter(o),!(u=s(l))){e.next=3;break}return e.abrupt("return",u);case 3:e.next=6;break;case 4:if(e.prev=4,!(h=e.catch(1)).response||!h.response.status||404!==h.response.status){e.next=5;break}kn.Rm("Error 404 for chat parent file "+c),e.next=6;break;case 5:throw kn.Rm("*** Error NON 404 for chat parent file "+c),new Error("*** ".concat(h.message," for chat folder ").concat(c));case 6:if(0!==i){e.next=7;break}return e.abrupt("return",null);case 7:return e.next=8,r(c,i-1);case 8:if(d=e.sent){e.next=9;break}return e.abrupt("return",null);case 9:return e.next=10,qt.fetcher.load(d);case 10:return p=qt.each(d,v.ldp("contains")),f=s(p),e.abrupt("return",f);case 11:case"end":return e.stop()}},e,null,[[1,4]])}))).apply(this,arguments)},r=function(e,t){return i.apply(this,arguments)},o=this.leafDocumentFromDate(t).dir();case 1:return e.next=2,r(o,3);case 2:if(!(a=e.sent)){e.next=6;break}return s=qt.sym(a.uri+this.leafFileName),c=this.dateFromLeafDocument(s),e.next=3,ic(s);case 3:if(e.sent){e.next=4;break}return e.abrupt("return",c);case 4:t=c,o=this.leafDocumentFromDate(t).dir();case 5:e.next=7;break;case 6:return e.abrupt("return",null);case 7:e.next=1;break;case 8:case"end":return e.stop()}},e,this)})),function(e,n){return t.apply(this,arguments)})},{key:"firstLeaf",value:(e=w(x().mark(function e(t){var n,r,i,o,a,s,c,l,u,d,p;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=function(){return(o=w(x().mark(function e(i){var o,a;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=function(e){var t=e.uri.slice(0,-1).split("/").slice(-1)[0];return!!"0123456789".includes(t[0])},delete r.requested[i.uri],e.next=1,r.load(i,{force:!0});case 1:if(0!==(a=(a=n.each(i,v.ldp("contains"))).filter(o)).length){e.next=2;break}throw new Error(" @@@  No children to         parent2 "+i);case 2:return a.sort(),t&&a.reverse(),e.abrupt("return",a[0]);case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)},i=function(e){return o.apply(this,arguments)},n=m.graph(),r=new m.Fetcher(n),e.next=1,i(this.root.dir());case 1:return a=e.sent,e.next=2,i(a);case 2:return s=e.sent,e.next=3,i(s);case 3:return c=e.sent,l=m.sym(c.uri+"chat.ttl"),e.next=4,r.load(l);case 4:if(0!==(u=n.each(this.root,this.membershipProperty,null,l)).length){e.next=5;break}throw d="  INCONSISTENCY -- no chat leafObject in file "+l,kn.uP(d),new Error(d);case 5:return(p=u.map(function(e){return[n.any(e,v.dct("created")),e]})).sort(),t&&p.reverse(),e.abrupt("return",p[0][1]);case 6:case"end":return e.stop()}},e,this)})),function(t){return e.apply(this,arguments)})}]);var e,t}();const sc="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
function cc(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function lc(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function uc(e,...t){if(!cc(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function dc(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.createHasher");lc(e.outputLen),lc(e.blockLen)}function pc(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function fc(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function hc(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function mc(e,t){return e<<32-t|e>>>t}const gc=(()=>"function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex)(),vc=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function yc(e){if(uc(e),gc)return e.toHex();let t="";for(let n=0;n<e.length;n++)t+=vc[e[n]];return t}const wc=48,bc=57,xc=65,Ec=70,Cc=97,kc=102;function Ac(e){return e>=wc&&e<=bc?e-wc:e>=xc&&e<=Ec?e-(xc-10):e>=Cc&&e<=kc?e-(Cc-10):void 0}function _c(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);if(gc)return Uint8Array.fromHex(e);const t=e.length,n=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(n);for(let t=0,i=0;t<n;t++,i+=2){const n=Ac(e.charCodeAt(i)),o=Ac(e.charCodeAt(i+1));if(void 0===n||void 0===o){const t=e[i]+e[i+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+i)}r[t]=16*n+o}return r}function Sc(e){if("string"!=typeof e)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(e))}function Tc(e){return"string"==typeof e&&(e=Sc(e)),uc(e),e}function Rc(...e){let t=0;for(let n=0;n<e.length;n++){const r=e[n];uc(r),t+=r.length}const n=new Uint8Array(t);for(let t=0,r=0;t<e.length;t++){const i=e[t];n.set(i,r),r+=i.length}return n}class Ic{}function Lc(e){const t=t=>e().update(Tc(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Nc(e=32){if(sc&&"function"==typeof sc.getRandomValues)return sc.getRandomValues(new Uint8Array(e));if(sc&&"function"==typeof sc.randomBytes)return Uint8Array.from(sc.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")}function Pc(e,t,n){return e&t^~e&n}function Bc(e,t,n){return e&t^e&n^t&n}class Oc extends Ic{constructor(e,t,n,r){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.buffer=new Uint8Array(e),this.view=hc(this.buffer)}update(e){pc(this),uc(e=Tc(e));const{view:t,buffer:n,blockLen:r}=this,i=e.length;for(let o=0;o<i;){const a=Math.min(r-this.pos,i-o);if(a===r){const t=hc(e);for(;r<=i-o;o+=r)this.process(t,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){pc(this),function(e,t){uc(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:r,isLE:i}=this;let{pos:o}=this;t[o++]=128,fc(this.buffer.subarray(o)),this.padOffset>r-o&&(this.process(n,0),o=0);for(let e=o;e<r;e++)t[e]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const i=BigInt(32),o=BigInt(4294967295),a=Number(n>>i&o),s=Number(n&o),c=r?4:0,l=r?0:4;e.setUint32(t+c,a,r),e.setUint32(t+l,s,r)}(n,r-8,BigInt(8*this.length),i),this.process(n,0);const a=hc(e),s=this.outputLen;if(s%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=s/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)a.setUint32(4*e,l[e],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:i,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=i,e.length=r,e.pos=a,r%t&&e.buffer.set(n),e}clone(){return this._cloneInto()}}const Dc=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);const Uc=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),jc=new Uint32Array(64);class Mc extends Oc{constructor(e=32){super(64,e,8,!1),this.A=0|Dc[0],this.B=0|Dc[1],this.C=0|Dc[2],this.D=0|Dc[3],this.E=0|Dc[4],this.F=0|Dc[5],this.G=0|Dc[6],this.H=0|Dc[7]}get(){const{A:e,B:t,C:n,D:r,E:i,F:o,G:a,H:s}=this;return[e,t,n,r,i,o,a,s]}set(e,t,n,r,i,o,a,s){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|o,this.G=0|a,this.H=0|s}process(e,t){for(let n=0;n<16;n++,t+=4)jc[n]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=jc[e-15],n=jc[e-2],r=mc(t,7)^mc(t,18)^t>>>3,i=mc(n,17)^mc(n,19)^n>>>10;jc[e]=i+jc[e-7]+r+jc[e-16]|0}let{A:n,B:r,C:i,D:o,E:a,F:s,G:c,H:l}=this;for(let e=0;e<64;e++){const t=l+(mc(a,6)^mc(a,11)^mc(a,25))+Pc(a,s,c)+Uc[e]+jc[e]|0,u=(mc(n,2)^mc(n,13)^mc(n,22))+Bc(n,r,i)|0;l=c,c=s,s=a,a=o+t|0,o=i,i=r,r=n,n=t+u|0}n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,s=s+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,r,i,o,a,s,c,l)}roundClean(){fc(jc)}destroy(){this.set(0,0,0,0,0,0,0,0),fc(this.buffer)}}const Fc=Lc(()=>new Mc);class Hc extends Ic{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,dc(e);const n=Tc(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?e.create().update(n).digest():n);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),fc(i)}update(e){return pc(this),this.iHash.update(e),this}digestInto(e){pc(this),uc(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:r,destroyed:i,blockLen:o,outputLen:a}=this;return e.finished=r,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Wc=(e,t,n)=>new Hc(e,t).update(n).digest();Wc.create=(e,t)=>new Hc(e,t);
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const $c=BigInt(0),Jc=BigInt(1);function zc(e,t=""){if("boolean"!=typeof e){throw new Error((t&&`"${t}"`)+"expected boolean, got type="+typeof e)}return e}function qc(e,t,n=""){const r=cc(e),i=e?.length,o=void 0!==t;if(!r||o&&i!==t){throw new Error((n&&`"${n}" `)+"expected Uint8Array"+(o?` of length ${t}`:"")+", got "+(r?`length=${i}`:"type="+typeof e))}return e}function Kc(e){const t=e.toString(16);return 1&t.length?"0"+t:t}function Vc(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return""===e?$c:BigInt("0x"+e)}function Gc(e){return Vc(yc(e))}function Qc(e){return uc(e),Vc(yc(Uint8Array.from(e).reverse()))}function Zc(e,t){return _c(e.toString(16).padStart(2*t,"0"))}function Yc(e,t){return Zc(e,t).reverse()}function Xc(e,t,n){let r;if("string"==typeof t)try{r=_c(t)}catch(t){throw new Error(e+" must be hex string or Uint8Array, cause: "+t)}else{if(!cc(t))throw new Error(e+" must be hex string or Uint8Array");r=Uint8Array.from(t)}const i=r.length;if("number"==typeof n&&i!==n)throw new Error(e+" of length "+n+" expected, got "+i);return r}const el=e=>"bigint"==typeof e&&$c<=e;function tl(e,t,n){return el(e)&&el(t)&&el(n)&&t<=e&&e<n}function nl(e){let t;for(t=0;e>$c;e>>=Jc,t+=1);return t}const rl=e=>(Jc<<BigInt(e))-Jc;function il(e,t,n={}){if(!e||"object"!=typeof e)throw new Error("expected valid options object");function r(t,n,r){const i=e[t];if(r&&void 0===i)return;const o=typeof i;if(o!==n||null===i)throw new Error(`param "${t}" is invalid: expected ${n}, got ${o}`)}Object.entries(t).forEach(([e,t])=>r(e,t,!1)),Object.entries(n).forEach(([e,t])=>r(e,t,!0))}function ol(e){const t=new WeakMap;return(n,...r)=>{const i=t.get(n);if(void 0!==i)return i;const o=e(n,...r);return t.set(n,o),o}}
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const al=BigInt(0),sl=BigInt(1),cl=BigInt(2),ll=BigInt(3),ul=BigInt(4),dl=BigInt(5),pl=BigInt(7),fl=BigInt(8),hl=BigInt(9),ml=BigInt(16);function gl(e,t){const n=e%t;return n>=al?n:t+n}function vl(e,t,n){let r=e;for(;t-- >al;)r*=r,r%=n;return r}function yl(e,t){if(e===al)throw new Error("invert: expected non-zero number");if(t<=al)throw new Error("invert: expected positive modulus, got "+t);let n=gl(e,t),r=t,i=al,o=sl,a=sl,s=al;for(;n!==al;){const e=r/n,t=r%n,c=i-a*e,l=o-s*e;r=n,n=t,i=a,o=s,a=c,s=l}if(r!==sl)throw new Error("invert: does not exist");return gl(i,t)}function wl(e,t,n){if(!e.eql(e.sqr(t),n))throw new Error("Cannot find square root")}function bl(e,t){const n=(e.ORDER+sl)/ul,r=e.pow(t,n);return wl(e,r,t),r}function xl(e,t){const n=(e.ORDER-dl)/fl,r=e.mul(t,cl),i=e.pow(r,n),o=e.mul(t,i),a=e.mul(e.mul(o,cl),i),s=e.mul(o,e.sub(a,e.ONE));return wl(e,s,t),s}function El(e){if(e<ll)throw new Error("sqrt is not defined for small field");let t=e-sl,n=0;for(;t%cl===al;)t/=cl,n++;let r=cl;const i=Rl(e);for(;1===Sl(i,r);)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(1===n)return bl;let o=i.pow(r,t);const a=(t+sl)/cl;return function(e,r){if(e.is0(r))return r;if(1!==Sl(e,r))throw new Error("Cannot find square root");let i=n,s=e.mul(e.ONE,o),c=e.pow(r,t),l=e.pow(r,a);for(;!e.eql(c,e.ONE);){if(e.is0(c))return e.ZERO;let t=1,n=e.sqr(c);for(;!e.eql(n,e.ONE);)if(t++,n=e.sqr(n),t===i)throw new Error("Cannot find square root");const r=sl<<BigInt(i-t-1),o=e.pow(s,r);i=t,s=e.sqr(o),c=e.mul(c,s),l=e.mul(l,o)}return l}}function Cl(e){return e%ul===ll?bl:e%fl===dl?xl:e%ml===hl?function(e){const t=Rl(e),n=El(e),r=n(t,t.neg(t.ONE)),i=n(t,r),o=n(t,t.neg(r)),a=(e+pl)/ml;return(e,t)=>{let n=e.pow(t,a),s=e.mul(n,r);const c=e.mul(n,i),l=e.mul(n,o),u=e.eql(e.sqr(s),t),d=e.eql(e.sqr(c),t);n=e.cmov(n,s,u),s=e.cmov(l,c,d);const p=e.eql(e.sqr(s),t),f=e.cmov(n,s,p);return wl(e,f,t),f}}(e):El(e)}const kl=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Al(e,t,n){if(n<al)throw new Error("invalid exponent, negatives unsupported");if(n===al)return e.ONE;if(n===sl)return t;let r=e.ONE,i=t;for(;n>al;)n&sl&&(r=e.mul(r,i)),i=e.sqr(i),n>>=sl;return r}function _l(e,t,n=!1){const r=new Array(t.length).fill(n?e.ZERO:void 0),i=t.reduce((t,n,i)=>e.is0(n)?t:(r[i]=t,e.mul(t,n)),e.ONE),o=e.inv(i);return t.reduceRight((t,n,i)=>e.is0(n)?t:(r[i]=e.mul(t,r[i]),e.mul(t,n)),o),r}function Sl(e,t){const n=(e.ORDER-sl)/cl,r=e.pow(t,n),i=e.eql(r,e.ONE),o=e.eql(r,e.ZERO),a=e.eql(r,e.neg(e.ONE));if(!i&&!o&&!a)throw new Error("invalid Legendre symbol result");return i?1:o?0:-1}function Tl(e,t){void 0!==t&&lc(t);const n=void 0!==t?t:e.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function Rl(e,t,n=!1,r={}){if(e<=al)throw new Error("invalid field: expected ORDER > 0, got "+e);let i,o,a,s=!1;if("object"==typeof t&&null!=t){if(r.sqrt||n)throw new Error("cannot specify opts in two arguments");const e=t;e.BITS&&(i=e.BITS),e.sqrt&&(o=e.sqrt),"boolean"==typeof e.isLE&&(n=e.isLE),"boolean"==typeof e.modFromBytes&&(s=e.modFromBytes),a=e.allowedLengths}else"number"==typeof t&&(i=t),r.sqrt&&(o=r.sqrt);const{nBitLength:c,nByteLength:l}=Tl(e,i);if(l>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u;const d=Object.freeze({ORDER:e,isLE:n,BITS:c,BYTES:l,MASK:rl(c),ZERO:al,ONE:sl,allowedLengths:a,create:t=>gl(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("invalid field element: expected bigint, got "+typeof t);return al<=t&&t<e},is0:e=>e===al,isValidNot0:e=>!d.is0(e)&&d.isValid(e),isOdd:e=>(e&sl)===sl,neg:t=>gl(-t,e),eql:(e,t)=>e===t,sqr:t=>gl(t*t,e),add:(t,n)=>gl(t+n,e),sub:(t,n)=>gl(t-n,e),mul:(t,n)=>gl(t*n,e),pow:(e,t)=>Al(d,e,t),div:(t,n)=>gl(t*yl(n,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>yl(t,e),sqrt:o||(t=>(u||(u=Cl(e)),u(d,t))),toBytes:e=>n?Yc(e,l):Zc(e,l),fromBytes:(t,r=!0)=>{if(a){if(!a.includes(t.length)||t.length>l)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+t.length);const e=new Uint8Array(l);e.set(t,n?0:e.length-t.length),t=e}if(t.length!==l)throw new Error("Field.fromBytes: expected "+l+" bytes, got "+t.length);let i=n?Qc(t):Gc(t);if(s&&(i=gl(i,e)),!r&&!d.isValid(i))throw new Error("invalid field element: outside of range 0..ORDER");return i},invertBatch:e=>_l(d,e),cmov:(e,t,n)=>n?t:e});return Object.freeze(d)}function Il(e){if("bigint"!=typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function Ll(e){const t=Il(e);return t+Math.ceil(t/2)}function Nl(e,t,n=!1){const r=e.length,i=Il(t),o=Ll(t);if(r<16||r<o||r>1024)throw new Error("expected "+o+"-1024 bytes of input, got "+r);const a=gl(n?Qc(e):Gc(e),t-sl)+sl;return n?Yc(a,i):Zc(a,i)}
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const Pl=BigInt(0),Bl=BigInt(1);function Ol(e,t){const n=t.negate();return e?n:t}function Dl(e,t){const n=_l(e.Fp,t.map(e=>e.Z));return t.map((t,r)=>e.fromAffine(t.toAffine(n[r])))}function Ul(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function jl(e,t){Ul(e,t);const n=2**e;return{windows:Math.ceil(t/e)+1,windowSize:2**(e-1),mask:rl(e),maxNumber:n,shiftBy:BigInt(e)}}function Ml(e,t,n){const{windowSize:r,mask:i,maxNumber:o,shiftBy:a}=n;let s=Number(e&i),c=e>>a;s>r&&(s-=o,c+=Bl);const l=t*r;return{nextN:c,offset:l+Math.abs(s)-1,isZero:0===s,isNeg:s<0,isNegF:t%2!=0,offsetF:l}}function Fl(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((e,n)=>{if(!(e instanceof t))throw new Error("invalid point at index "+n)})}function Hl(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((e,n)=>{if(!t.isValid(e))throw new Error("invalid scalar at index "+n)})}const Wl=new WeakMap,$l=new WeakMap;function Jl(e){return $l.get(e)||1}function zl(e){if(e!==Pl)throw new Error("invalid wNAF")}class ql{constructor(e,t){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=t}_unsafeLadder(e,t,n=this.ZERO){let r=e;for(;t>Pl;)t&Bl&&(n=n.add(r)),r=r.double(),t>>=Bl;return n}precomputeWindow(e,t){const{windows:n,windowSize:r}=jl(t,this.bits),i=[];let o=e,a=o;for(let e=0;e<n;e++){a=o,i.push(a);for(let e=1;e<r;e++)a=a.add(o),i.push(a);o=a.double()}return i}wNAF(e,t,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let r=this.ZERO,i=this.BASE;const o=jl(e,this.bits);for(let e=0;e<o.windows;e++){const{nextN:a,offset:s,isZero:c,isNeg:l,isNegF:u,offsetF:d}=Ml(n,e,o);n=a,c?i=i.add(Ol(u,t[d])):r=r.add(Ol(l,t[s]))}return zl(n),{p:r,f:i}}wNAFUnsafe(e,t,n,r=this.ZERO){const i=jl(e,this.bits);for(let e=0;e<i.windows&&n!==Pl;e++){const{nextN:o,offset:a,isZero:s,isNeg:c}=Ml(n,e,i);if(n=o,!s){const e=t[a];r=r.add(c?e.negate():e)}}return zl(n),r}getPrecomputes(e,t,n){let r=Wl.get(t);return r||(r=this.precomputeWindow(t,e),1!==e&&("function"==typeof n&&(r=n(r)),Wl.set(t,r))),r}cached(e,t,n){const r=Jl(e);return this.wNAF(r,this.getPrecomputes(r,e,n),t)}unsafe(e,t,n,r){const i=Jl(e);return 1===i?this._unsafeLadder(e,t,r):this.wNAFUnsafe(i,this.getPrecomputes(i,e,n),t,r)}createCache(e,t){Ul(t,this.bits),$l.set(e,t),Wl.delete(e)}hasCache(e){return 1!==Jl(e)}}function Kl(e,t,n){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return function(e){il(e,kl.reduce((e,t)=>(e[t]="function",e),{ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"}))}(t),t}return Rl(e,{isLE:n})}
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const Vl=(e,t)=>(e+(e>=0?t:-t)/tu)/t;function Gl(e){if(!["compact","recovered","der"].includes(e))throw new Error('Signature format must be "compact", "recovered", or "der"');return e}function Ql(e,t){const n={};for(let r of Object.keys(t))n[r]=void 0===e[r]?t[r]:e[r];return zc(n.lowS,"lowS"),zc(n.prehash,"prehash"),void 0!==n.format&&Gl(n.format),n}class Zl extends Error{constructor(e=""){super(e)}}const Yl={Err:Zl,_tlv:{encode:(e,t)=>{const{Err:n}=Yl;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(1&t.length)throw new n("tlv.encode: unpadded data");const r=t.length/2,i=Kc(r);if(i.length/2&128)throw new n("tlv.encode: long form length too big");const o=r>127?Kc(i.length/2|128):"";return Kc(e)+o+i+t},decode(e,t){const{Err:n}=Yl;let r=0;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(t.length<2||t[r++]!==e)throw new n("tlv.decode: wrong tlv");const i=t[r++];let o=0;if(!!(128&i)){const e=127&i;if(!e)throw new n("tlv.decode(long): indefinite length not supported");if(e>4)throw new n("tlv.decode(long): byte length is too big");const a=t.subarray(r,r+e);if(a.length!==e)throw new n("tlv.decode: length bytes not complete");if(0===a[0])throw new n("tlv.decode(long): zero leftmost byte");for(const e of a)o=o<<8|e;if(r+=e,o<128)throw new n("tlv.decode(long): not minimal encoding")}else o=i;const a=t.subarray(r,r+o);if(a.length!==o)throw new n("tlv.decode: wrong value length");return{v:a,l:t.subarray(r+o)}}},_int:{encode(e){const{Err:t}=Yl;if(e<Xl)throw new t("integer: negative integers are not allowed");let n=Kc(e);if(8&Number.parseInt(n[0],16)&&(n="00"+n),1&n.length)throw new t("unexpected DER parsing assertion: unpadded hex");return n},decode(e){const{Err:t}=Yl;if(128&e[0])throw new t("invalid signature integer: negative");if(0===e[0]&&!(128&e[1]))throw new t("invalid signature integer: unnecessary leading zero");return Gc(e)}},toSig(e){const{Err:t,_int:n,_tlv:r}=Yl,i=Xc("signature",e),{v:o,l:a}=r.decode(48,i);if(a.length)throw new t("invalid signature: left bytes after parsing");const{v:s,l:c}=r.decode(2,o),{v:l,l:u}=r.decode(2,c);if(u.length)throw new t("invalid signature: left bytes after parsing");return{r:n.decode(s),s:n.decode(l)}},hexFromSig(e){const{_tlv:t,_int:n}=Yl,r=t.encode(2,n.encode(e.r))+t.encode(2,n.encode(e.s));return t.encode(48,r)}},Xl=BigInt(0),eu=BigInt(1),tu=BigInt(2),nu=BigInt(3),ru=BigInt(4);function iu(e,t){const{BYTES:n}=e;let r;if("bigint"==typeof t)r=t;else{let i=Xc("private key",t);try{r=e.fromBytes(i)}catch(e){throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof t}`)}}if(!e.isValidNot0(r))throw new Error("invalid private key: out of range [1..N-1]");return r}function ou(e,t={}){const n=function(e,t,n={},r){if(void 0===r&&(r="edwards"===e),!t||"object"!=typeof t)throw new Error(`expected valid ${e} CURVE object`);for(const e of["p","n","h"]){const n=t[e];if(!("bigint"==typeof n&&n>Pl))throw new Error(`CURVE.${e} must be positive bigint`)}const i=Kl(t.p,n.Fp,r),o=Kl(t.n,n.Fn,r),a=["Gx","Gy","a","weierstrass"===e?"b":"d"];for(const e of a)if(!i.isValid(t[e]))throw new Error(`CURVE.${e} must be valid field element of CURVE.Fp`);return{CURVE:t=Object.freeze(Object.assign({},t)),Fp:i,Fn:o}}("weierstrass",e,t),{Fp:r,Fn:i}=n;let o=n.CURVE;const{h:a,n:s}=o;il(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=t;if(c&&(!r.is0(o.a)||"bigint"!=typeof c.beta||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const l=su(r,i);function u(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}const d=t.toBytes||function(e,t,n){const{x:i,y:o}=t.toAffine(),a=r.toBytes(i);if(zc(n,"isCompressed"),n){u();return Rc(au(!r.isOdd(o)),a)}return Rc(Uint8Array.of(4),a,r.toBytes(o))},p=t.fromBytes||function(e){qc(e,void 0,"Point");const{publicKey:t,publicKeyUncompressed:n}=l,i=e.length,o=e[0],a=e.subarray(1);if(i!==t||2!==o&&3!==o){if(i===n&&4===o){const e=r.BYTES,t=r.fromBytes(a.subarray(0,e)),n=r.fromBytes(a.subarray(e,2*e));if(!h(t,n))throw new Error("bad point: is not on curve");return{x:t,y:n}}throw new Error(`bad point: got length ${i}, expected compressed=${t} or uncompressed=${n}`)}{const e=r.fromBytes(a);if(!r.isValid(e))throw new Error("bad point: is not on curve, wrong x");const t=f(e);let n;try{n=r.sqrt(t)}catch(e){const t=e instanceof Error?": "+e.message:"";throw new Error("bad point: is not on curve, sqrt error"+t)}u();return!(1&~o)!==r.isOdd(n)&&(n=r.neg(n)),{x:e,y:n}}};function f(e){const t=r.sqr(e),n=r.mul(t,e);return r.add(r.add(n,r.mul(e,o.a)),o.b)}function h(e,t){const n=r.sqr(t),i=f(e);return r.eql(n,i)}if(!h(o.Gx,o.Gy))throw new Error("bad curve params: generator point");const m=r.mul(r.pow(o.a,nu),ru),g=r.mul(r.sqr(o.b),BigInt(27));if(r.is0(r.add(m,g)))throw new Error("bad curve params: a or b");function v(e,t,n=!1){if(!r.isValid(t)||n&&r.is0(t))throw new Error(`bad point coordinate ${e}`);return t}function y(e){if(!(e instanceof C))throw new Error("ProjectivePoint expected")}function w(e){if(!c||!c.basises)throw new Error("no endo");return function(e,t,n){const[[r,i],[o,a]]=t,s=Vl(a*e,n),c=Vl(-i*e,n);let l=e-s*r-c*o,u=-s*i-c*a;const d=l<Xl,p=u<Xl;d&&(l=-l),p&&(u=-u);const f=rl(Math.ceil(nl(n)/2))+eu;if(l<Xl||l>=f||u<Xl||u>=f)throw new Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:d,k1:l,k2neg:p,k2:u}}(e,c.basises,i.ORDER)}const b=ol((e,t)=>{const{X:n,Y:i,Z:o}=e;if(r.eql(o,r.ONE))return{x:n,y:i};const a=e.is0();null==t&&(t=a?r.ONE:r.inv(o));const s=r.mul(n,t),c=r.mul(i,t),l=r.mul(o,t);if(a)return{x:r.ZERO,y:r.ZERO};if(!r.eql(l,r.ONE))throw new Error("invZ was invalid");return{x:s,y:c}}),x=ol(e=>{if(e.is0()){if(t.allowInfinityPoint&&!r.is0(e.Y))return;throw new Error("bad point: ZERO")}const{x:n,y:i}=e.toAffine();if(!r.isValid(n)||!r.isValid(i))throw new Error("bad point: x or y not field elements");if(!h(n,i))throw new Error("bad point: equation left != right");if(!e.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function E(e,t,n,i,o){return n=new C(r.mul(n.X,e),n.Y,n.Z),t=Ol(i,t),n=Ol(o,n),t.add(n)}class C{constructor(e,t,n){this.X=v("x",e),this.Y=v("y",t,!0),this.Z=v("z",n),Object.freeze(this)}static CURVE(){return o}static fromAffine(e){const{x:t,y:n}=e||{};if(!e||!r.isValid(t)||!r.isValid(n))throw new Error("invalid affine point");if(e instanceof C)throw new Error("projective point not allowed");return r.is0(t)&&r.is0(n)?C.ZERO:new C(t,n,r.ONE)}static fromBytes(e){const t=C.fromAffine(p(qc(e,void 0,"point")));return t.assertValidity(),t}static fromHex(e){return C.fromBytes(Xc("pointHex",e))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(e=8,t=!0){return A.createCache(this,e),t||this.multiply(nu),this}assertValidity(){x(this)}hasEvenY(){const{y:e}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(e)}equals(e){y(e);const{X:t,Y:n,Z:i}=this,{X:o,Y:a,Z:s}=e,c=r.eql(r.mul(t,s),r.mul(o,i)),l=r.eql(r.mul(n,s),r.mul(a,i));return c&&l}negate(){return new C(this.X,r.neg(this.Y),this.Z)}double(){const{a:e,b:t}=o,n=r.mul(t,nu),{X:i,Y:a,Z:s}=this;let c=r.ZERO,l=r.ZERO,u=r.ZERO,d=r.mul(i,i),p=r.mul(a,a),f=r.mul(s,s),h=r.mul(i,a);return h=r.add(h,h),u=r.mul(i,s),u=r.add(u,u),c=r.mul(e,u),l=r.mul(n,f),l=r.add(c,l),c=r.sub(p,l),l=r.add(p,l),l=r.mul(c,l),c=r.mul(h,c),u=r.mul(n,u),f=r.mul(e,f),h=r.sub(d,f),h=r.mul(e,h),h=r.add(h,u),u=r.add(d,d),d=r.add(u,d),d=r.add(d,f),d=r.mul(d,h),l=r.add(l,d),f=r.mul(a,s),f=r.add(f,f),d=r.mul(f,h),c=r.sub(c,d),u=r.mul(f,p),u=r.add(u,u),u=r.add(u,u),new C(c,l,u)}add(e){y(e);const{X:t,Y:n,Z:i}=this,{X:a,Y:s,Z:c}=e;let l=r.ZERO,u=r.ZERO,d=r.ZERO;const p=o.a,f=r.mul(o.b,nu);let h=r.mul(t,a),m=r.mul(n,s),g=r.mul(i,c),v=r.add(t,n),w=r.add(a,s);v=r.mul(v,w),w=r.add(h,m),v=r.sub(v,w),w=r.add(t,i);let b=r.add(a,c);return w=r.mul(w,b),b=r.add(h,g),w=r.sub(w,b),b=r.add(n,i),l=r.add(s,c),b=r.mul(b,l),l=r.add(m,g),b=r.sub(b,l),d=r.mul(p,w),l=r.mul(f,g),d=r.add(l,d),l=r.sub(m,d),d=r.add(m,d),u=r.mul(l,d),m=r.add(h,h),m=r.add(m,h),g=r.mul(p,g),w=r.mul(f,w),m=r.add(m,g),g=r.sub(h,g),g=r.mul(p,g),w=r.add(w,g),h=r.mul(m,w),u=r.add(u,h),h=r.mul(b,w),l=r.mul(v,l),l=r.sub(l,h),h=r.mul(v,m),d=r.mul(b,d),d=r.add(d,h),new C(l,u,d)}subtract(e){return this.add(e.negate())}is0(){return this.equals(C.ZERO)}multiply(e){const{endo:n}=t;if(!i.isValidNot0(e))throw new Error("invalid scalar: out of range");let r,o;const a=e=>A.cached(this,e,e=>Dl(C,e));if(n){const{k1neg:t,k1:i,k2neg:s,k2:c}=w(e),{p:l,f:u}=a(i),{p:d,f:p}=a(c);o=u.add(p),r=E(n.beta,l,d,t,s)}else{const{p:t,f:n}=a(e);r=t,o=n}return Dl(C,[r,o])[0]}multiplyUnsafe(e){const{endo:n}=t,r=this;if(!i.isValid(e))throw new Error("invalid scalar: out of range");if(e===Xl||r.is0())return C.ZERO;if(e===eu)return r;if(A.hasCache(this))return this.multiply(e);if(n){const{k1neg:t,k1:i,k2neg:o,k2:a}=w(e),{p1:s,p2:c}=function(e,t,n,r){let i=t,o=e.ZERO,a=e.ZERO;for(;n>Pl||r>Pl;)n&Bl&&(o=o.add(i)),r&Bl&&(a=a.add(i)),i=i.double(),n>>=Bl,r>>=Bl;return{p1:o,p2:a}}(C,r,i,a);return E(n.beta,s,c,t,o)}return A.unsafe(r,e)}multiplyAndAddUnsafe(e,t,n){const r=this.multiplyUnsafe(t).add(e.multiplyUnsafe(n));return r.is0()?void 0:r}toAffine(e){return b(this,e)}isTorsionFree(){const{isTorsionFree:e}=t;return a===eu||(e?e(C,this):A.unsafe(this,s).is0())}clearCofactor(){const{clearCofactor:e}=t;return a===eu?this:e?e(C,this):this.multiplyUnsafe(a)}isSmallOrder(){return this.multiplyUnsafe(a).is0()}toBytes(e=!0){return zc(e,"isCompressed"),this.assertValidity(),d(C,this,e)}toHex(e=!0){return yc(this.toBytes(e))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(e=!0){return this.toBytes(e)}_setWindowSize(e){this.precompute(e)}static normalizeZ(e){return Dl(C,e)}static msm(e,t){return function(e,t,n,r){Fl(n,e),Hl(r,t);const i=n.length,o=r.length;if(i!==o)throw new Error("arrays of points and scalars must have equal length");const a=e.ZERO,s=nl(BigInt(i));let c=1;s>12?c=s-3:s>4?c=s-2:s>0&&(c=2);const l=rl(c),u=new Array(Number(l)+1).fill(a);let d=a;for(let e=Math.floor((t.BITS-1)/c)*c;e>=0;e-=c){u.fill(a);for(let t=0;t<o;t++){const i=r[t],o=Number(i>>BigInt(e)&l);u[o]=u[o].add(n[t])}let t=a;for(let e=u.length-1,n=a;e>0;e--)n=n.add(u[e]),t=t.add(n);if(d=d.add(t),0!==e)for(let e=0;e<c;e++)d=d.double()}return d}(C,i,e,t)}static fromPrivateKey(e){return C.BASE.multiply(iu(i,e))}}C.BASE=new C(o.Gx,o.Gy,r.ONE),C.ZERO=new C(r.ZERO,r.ONE,r.ZERO),C.Fp=r,C.Fn=i;const k=i.BITS,A=new ql(C,t.endo?Math.ceil(k/2):k);return C.BASE.precompute(8),C}function au(e){return Uint8Array.of(e?2:3)}function su(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function cu(e,t,n={}){dc(t),il(n,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const r=n.randomBytes||Nc,i=n.hmac||((e,...n)=>Wc(t,e,Rc(...n))),{Fp:o,Fn:a}=e,{ORDER:s,BITS:c}=a,{keygen:l,getPublicKey:u,getSharedSecret:d,utils:p,lengths:f}=function(e,t={}){const{Fn:n}=e,r=t.randomBytes||Nc,i=Object.assign(su(e.Fp,n),{seed:Ll(n.ORDER)});function o(e){try{return!!iu(n,e)}catch(e){return!1}}function a(e=r(i.seed)){return Nl(qc(e,i.seed,"seed"),n.ORDER)}function s(t,r=!0){return e.BASE.multiply(iu(n,t)).toBytes(r)}function c(t){if("bigint"==typeof t)return!1;if(t instanceof e)return!0;const{secretKey:r,publicKey:o,publicKeyUncompressed:a}=i;if(n.allowedLengths||r===o)return;const s=Xc("key",t).length;return s===o||s===a}const l={isValidSecretKey:o,isValidPublicKey:function(t,n){const{publicKey:r,publicKeyUncompressed:o}=i;try{const i=t.length;return!(!0===n&&i!==r||!1===n&&i!==o||!e.fromBytes(t))}catch(e){return!1}},randomSecretKey:a,isValidPrivateKey:o,randomPrivateKey:a,normPrivateKeyToScalar:e=>iu(n,e),precompute:(t=8,n=e.BASE)=>n.precompute(t,!1)};return Object.freeze({getPublicKey:s,getSharedSecret:function(t,r,i=!0){if(!0===c(t))throw new Error("first arg must be private key");if(!1===c(r))throw new Error("second arg must be public key");const o=iu(n,t);return e.fromHex(r).multiply(o).toBytes(i)},keygen:function(e){const t=a(e);return{secretKey:t,publicKey:s(t)}},Point:e,utils:l,lengths:i})}(e,n),h={prehash:!1,lowS:"boolean"==typeof n.lowS&&n.lowS,format:void 0,extraEntropy:!1},m="compact";function g(e){return e>s>>eu}function v(e,t){if(!a.isValidNot0(t))throw new Error(`invalid signature ${e}: out of range 1..Point.Fn.ORDER`);return t}class y{constructor(e,t,n){this.r=v("r",e),this.s=v("s",t),null!=n&&(this.recovery=n),Object.freeze(this)}static fromBytes(e,t=m){let n;if(function(e,t){Gl(t);const n=f.signature;qc(e,"compact"===t?n:"recovered"===t?n+1:void 0,`${t} signature`)}(e,t),"der"===t){const{r:t,s:n}=Yl.toSig(qc(e));return new y(t,n)}"recovered"===t&&(n=e[0],t="compact",e=e.subarray(1));const r=a.BYTES,i=e.subarray(0,r),o=e.subarray(r,2*r);return new y(a.fromBytes(i),a.fromBytes(o),n)}static fromHex(e,t){return this.fromBytes(_c(e),t)}addRecoveryBit(e){return new y(this.r,this.s,e)}recoverPublicKey(t){const n=o.ORDER,{r,s:i,recovery:c}=this;if(null==c||![0,1,2,3].includes(c))throw new Error("recovery id invalid");if(s*tu<n&&c>1)throw new Error("recovery id is ambiguous for h>1 curve");const l=2===c||3===c?r+s:r;if(!o.isValid(l))throw new Error("recovery id 2 or 3 invalid");const u=o.toBytes(l),d=e.fromBytes(Rc(au(!(1&c)),u)),p=a.inv(l),f=b(Xc("msgHash",t)),h=a.create(-f*p),m=a.create(i*p),g=e.BASE.multiplyUnsafe(h).add(d.multiplyUnsafe(m));if(g.is0())throw new Error("point at infinify");return g.assertValidity(),g}hasHighS(){return g(this.s)}toBytes(e=m){if(Gl(e),"der"===e)return _c(Yl.hexFromSig(this));const t=a.toBytes(this.r),n=a.toBytes(this.s);if("recovered"===e){if(null==this.recovery)throw new Error("recovery bit must be present");return Rc(Uint8Array.of(this.recovery),t,n)}return Rc(t,n)}toHex(e){return yc(this.toBytes(e))}assertValidity(){}static fromCompact(e){return y.fromBytes(Xc("sig",e),"compact")}static fromDER(e){return y.fromBytes(Xc("sig",e),"der")}normalizeS(){return this.hasHighS()?new y(this.r,a.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return yc(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return yc(this.toBytes("compact"))}}const w=n.bits2int||function(e){if(e.length>8192)throw new Error("input is too large");const t=Gc(e),n=8*e.length-c;return n>0?t>>BigInt(n):t},b=n.bits2int_modN||function(e){return a.create(w(e))},x=rl(c);function E(e){return function(e,t,n,r){if(!tl(t,n,r))throw new Error("expected valid "+e+": "+n+" <= n < "+r+", got "+t)}("num < 2^"+c,e,Xl,x),a.toBytes(e)}function C(e,n){return qc(e,void 0,"message"),n?qc(t(e),void 0,"prehashed message"):e}return Object.freeze({keygen:l,getPublicKey:u,getSharedSecret:d,utils:p,lengths:f,Point:e,sign:function(n,o,s={}){n=Xc("message",n);const{seed:c,k2sig:l}=function(t,n,i){if(["recovered","canonical"].some(e=>e in i))throw new Error("sign() legacy options not supported");const{lowS:o,prehash:s,extraEntropy:c}=Ql(i,h);t=C(t,s);const l=b(t),u=iu(a,n),d=[E(u),E(l)];if(null!=c&&!1!==c){const e=!0===c?r(f.secretKey):c;d.push(Xc("extraEntropy",e))}const p=Rc(...d),m=l;return{seed:p,k2sig:function(t){const n=w(t);if(!a.isValidNot0(n))return;const r=a.inv(n),i=e.BASE.multiply(n).toAffine(),s=a.create(i.x);if(s===Xl)return;const c=a.create(r*a.create(m+s*u));if(c===Xl)return;let l=(i.x===s?0:2)|Number(i.y&eu),d=c;return o&&g(c)&&(d=a.neg(c),l^=1),new y(s,d,l)}}}(n,o,s);return function(e,t,n){if("number"!=typeof e||e<2)throw new Error("hashLen must be a number");if("number"!=typeof t||t<2)throw new Error("qByteLen must be a number");if("function"!=typeof n)throw new Error("hmacFn must be a function");const r=e=>new Uint8Array(e),i=e=>Uint8Array.of(e);let o=r(e),a=r(e),s=0;const c=()=>{o.fill(1),a.fill(0),s=0},l=(...e)=>n(a,o,...e),u=(e=r(0))=>{a=l(i(0),e),o=l(),0!==e.length&&(a=l(i(1),e),o=l())},d=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const n=[];for(;e<t;){o=l();const t=o.slice();n.push(t),e+=o.length}return Rc(...n)};return(e,t)=>{let n;for(c(),u(e);!(n=t(d()));)u();return c(),n}}(t.outputLen,a.BYTES,i)(c,l)},verify:function(t,n,r,i={}){const{lowS:o,prehash:s,format:c}=Ql(i,h);if(r=Xc("publicKey",r),n=C(Xc("message",n),s),"strict"in i)throw new Error("options.strict was renamed to lowS");const l=void 0===c?function(e){let t;const n="string"==typeof e||cc(e),r=!n&&null!==e&&"object"==typeof e&&"bigint"==typeof e.r&&"bigint"==typeof e.s;if(!n&&!r)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(r)t=new y(e.r,e.s);else if(n){try{t=y.fromBytes(Xc("sig",e),"der")}catch(e){if(!(e instanceof Yl.Err))throw e}if(!t)try{t=y.fromBytes(Xc("sig",e),"compact")}catch(e){return!1}}return t||!1}(t):y.fromBytes(Xc("sig",t),c);if(!1===l)return!1;try{const t=e.fromBytes(r);if(o&&l.hasHighS())return!1;const{r:i,s}=l,c=b(n),u=a.inv(s),d=a.create(c*u),p=a.create(i*u),f=e.BASE.multiplyUnsafe(d).add(t.multiplyUnsafe(p));if(f.is0())return!1;return a.create(f.x)===i}catch(e){return!1}},recoverPublicKey:function(e,t,n={}){const{prehash:r}=Ql(n,h);return t=C(t,r),y.fromBytes(e,"recovered").recoverPublicKey(t).toBytes()},Signature:y,hash:t})}function lu(e){const t={a:e.a,b:e.b,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},n=e.Fp;let r=e.allowedPrivateKeyLengths?Array.from(new Set(e.allowedPrivateKeyLengths.map(e=>Math.ceil(e/2)))):void 0;return{CURVE:t,curveOpts:{Fp:n,Fn:Rl(t.n,{BITS:e.nBitLength,allowedLengths:r,modFromBytes:e.wrapPrivateKey}),allowInfinityPoint:e.allowInfinityPoint,endo:e.endo,isTorsionFree:e.isTorsionFree,clearCofactor:e.clearCofactor,fromBytes:e.fromBytes,toBytes:e.toBytes}}}function uu(e){const{CURVE:t,curveOpts:n,hash:r,ecdsaOpts:i}=function(e){const{CURVE:t,curveOpts:n}=lu(e),r={hmac:e.hmac,randomBytes:e.randomBytes,lowS:e.lowS,bits2int:e.bits2int,bits2int_modN:e.bits2int_modN};return{CURVE:t,curveOpts:n,hash:e.hash,ecdsaOpts:r}}(e);return function(e,t){const n=t.Point;return Object.assign({},t,{ProjectivePoint:n,CURVE:Object.assign({},e,Tl(n.Fn.ORDER,n.Fn.BITS))})}(e,cu(ou(t,n),r,i))}
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const du={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},pu={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},fu=BigInt(0),hu=BigInt(1),mu=BigInt(2);const gu=Rl(du.p,{sqrt:function(e){const t=du.p,n=BigInt(3),r=BigInt(6),i=BigInt(11),o=BigInt(22),a=BigInt(23),s=BigInt(44),c=BigInt(88),l=e*e*e%t,u=l*l*e%t,d=vl(u,n,t)*u%t,p=vl(d,n,t)*u%t,f=vl(p,mu,t)*l%t,h=vl(f,i,t)*f%t,m=vl(h,o,t)*h%t,g=vl(m,s,t)*m%t,v=vl(g,c,t)*g%t,y=vl(v,s,t)*m%t,w=vl(y,n,t)*u%t,b=vl(w,a,t)*h%t,x=vl(b,r,t)*l%t,E=vl(x,mu,t);if(!gu.eql(gu.sqr(E),e))throw new Error("Cannot find square root");return E}}),vu=function(e,t){const n=t=>uu({...e,hash:t});return{...n(t),create:n}}({...du,Fp:gu,lowS:!0,endo:pu},Fc),yu={};function wu(e,...t){let n=yu[e];if(void 0===n){const t=Fc(Sc(e));n=Rc(t,t),yu[e]=n}return Fc(Rc(n,...t))}const bu=e=>e.toBytes(!0).slice(1),xu=(()=>vu.Point)(),Eu=e=>e%mu===fu;function Cu(e){const{Fn:t,BASE:n}=xu,r=iu(t,e),i=n.multiply(r);return{scalar:Eu(i.y)?r:t.neg(r),bytes:bu(i)}}function ku(e){const t=gu;if(!t.isValidNot0(e))throw new Error("invalid x: Fail if x  p");const n=t.create(e*e),r=t.create(n*e+BigInt(7));let i=t.sqrt(r);Eu(i)||(i=t.neg(i));const o=xu.fromAffine({x:e,y:i});return o.assertValidity(),o}const Au=Gc;function _u(...e){return xu.Fn.create(Au(wu("BIP0340/challenge",...e)))}function Su(e){return Cu(e).bytes}function Tu(e,t,n=Nc(32)){const{Fn:r}=xu,i=Xc("message",e),{bytes:o,scalar:a}=Cu(t),s=Xc("auxRand",n,32),c=r.toBytes(a^Au(wu("BIP0340/aux",s))),l=wu("BIP0340/nonce",c,o,i),{bytes:u,scalar:d}=Cu(l),p=_u(u,o,i),f=new Uint8Array(64);if(f.set(u,0),f.set(r.toBytes(r.create(d+p*a)),32),!Ru(f,i,o))throw new Error("sign: Invalid signature produced");return f}function Ru(e,t,n){const{Fn:r,BASE:i}=xu,o=Xc("signature",e,64),a=Xc("message",t),s=Xc("publicKey",n,32);try{const e=ku(Au(s)),t=Au(o.subarray(0,32));if(!tl(t,hu,du.p))return!1;const n=Au(o.subarray(32,64));if(!tl(n,hu,du.n))return!1;const c=_u(r.toBytes(t),bu(e),a),l=i.multiplyUnsafe(n).add(e.multiplyUnsafe(r.neg(c))),{x:u,y:d}=l.toAffine();return!(l.is0()||!Eu(d)||u!==t)}catch(e){return!1}}const Iu=(()=>{const e=(e=Nc(48))=>Nl(e,du.n);return vu.utils.randomSecretKey,{keygen:function(t){const n=e(t);return{secretKey:n,publicKey:Su(n)}},getPublicKey:Su,sign:Tu,verify:Ru,Point:xu,utils:{randomSecretKey:e,randomPrivateKey:e,taggedHash:wu,lift_x:ku,pointToBytes:bu,numberToBytesBE:Zc,bytesToNumberBE:Gc,mod:gl},lengths:{secretKey:32,publicKey:32,publicKeyHasPrefix:!1,signature:64,seed:48}}})(),Lu=Fc;new TextDecoder("utf-8");var Nu=new TextEncoder,Pu="https://w3id.org/security#";function Bu(){return{id:"",created:"",dateDeleted:"",content:"",maker:"",sig:""}}function Ou(e){var t=Lu(Nu.encode(function(e){return JSON.stringify(e)}(e)));return yc(t)}function Du(e,t,n){return Iu.verify(e,Ou(t),n)}function Uu(e,t){return yc(Iu.sign(Ou(e),t))}var ju=function(e){var t,n,r=null===(t=qt.any(e,v.space("preferencesFile"),null,e.doc()))||void 0===t?void 0:t.value;if(!(r=null===(n=r)||void 0===n?void 0:n.split("/").slice(0,-2).join("/")))throw new Error("prefererencesFile is expected to exist in ".concat(e));return r},Mu=function(e){var t;try{var n=ju(e);t="".concat(n,"/profile/keys/publicKey.ttl")}catch(e){kn.z3(e)}return t},Fu=function(e){var t;try{var n=ju(e);t="".concat(n,"/settings/keys/privateKey.ttl")}catch(e){kn.z3(e)}return t};function Hu(e,t){return Wu.apply(this,arguments)}function Wu(){return(Wu=w(x().mark(function e(t,n){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,zu(t,n,"publicKey");case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function $u(e,t){return Ju.apply(this,arguments)}function Ju(){return(Ju=w(x().mark(function e(t,n){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,zu(t,n,"privateKey");case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function zu(e,t,n){return qu.apply(this,arguments)}function qu(){return(qu=w(x().mark(function e(t,n,r){var i,o,a;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,qt.fetcher.load(n);case 1:return i=qt.any(t,v.solid(r)),e.abrupt("return",null==i?void 0:i.value);case 2:if(e.prev=2,404!==(o=e.catch(0)).response.status){e.next=7;break}return kn.Rm("createIfNotExists: doc does NOT exist, will create... "+n),e.prev=3,e.next=4,qt.fetcher.webOperation("PUT",n,{data:"",contentType:"text/turtle"});case 4:e.next=6;break;case 5:throw e.prev=5,a=e.catch(3),kn.Rm("createIfNotExists doc FAILED: "+n+": "+a),a;case 6:return delete qt.fetcher.requested[n],e.abrupt("return",void 0);case 7:throw kn.Rm("createIfNotExists doc FAILED: "+n+": "+o),o;case 8:case"end":return e.stop()}},e,null,[[0,2],[3,5]])}))).apply(this,arguments)}function Ku(e,t){return Vu.apply(this,arguments)}function Vu(){return(Vu=w(x().mark(function e(t,n){var r,i,o;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,qt.fetcher.load(t);case 1:if(r=qt.any(qt.sym(t),qt.sym("http://www.iana.org/assignments/link-relations/acl"))){e.next=2;break}throw new Error("Key ACL doc not found!");case 2:return e.prev=2,e.next=3,qt.fetcher.webOperation("PUT",r.value,{data:n,contentType:"text/turtle"});case 3:e.next=6;break;case 4:if(e.prev=4,404===(null==(o=e.catch(2))||null===(i=o.response)||void 0===i?void 0:i.status)){e.next=5;break}throw new Error(o);case 5:kn.Rm("delete "+r.value+" "+o.response.status);case 6:case"end":return e.stop()}},e,null,[[2,4]])}))).apply(this,arguments)}var Gu=function(e){return"\n@prefix : <#>.\n@prefix acl: <http://www.w3.org/ns/auth/acl#>.\n@prefix foaf: <http://xmlns.com/foaf/0.1/>.\n@prefix key: <./>.\n\n:ReadWrite\n    a acl:Authorization;\n    acl:accessTo key:;\n    acl:default key:;\n    acl:agent <".concat(e,">;\n    acl:mode acl:Read, acl:Write.\n")},Qu=function(e,t){var n="acl:agentClass foaf:Agent";return null!=t&&t.length&&(n="acl:agent <".concat(t,">")),"\n@prefix foaf: <http://xmlns.com/foaf/0.1/>.\n@prefix acl: <http://www.w3.org/ns/auth/acl#>.\n<#Read>\n    a acl:Authorization;\n    ".concat(n,";\n    acl:accessTo <").concat(e.split("/").pop(),">;\n    acl:mode acl:Read.\n")};function Zu(){return yc(Iu.utils.randomPrivateKey())}function Yu(e){return yc(Iu.getPublicKey(e))}function Xu(e){return ed.apply(this,arguments)}function ed(){return(ed=w(x().mark(function e(t){var n,r;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,qt.fetcher.load(t);case 1:return e.next=2,Mu(t);case 2:return n=e.sent,e.prev=3,e.next=4,qt.fetcher.load(n);case 4:return r=qt.any(t,v.solid("publicKey")),e.abrupt("return",null==r?void 0:r.value);case 5:return e.prev=5,e.catch(3),e.abrupt("return",void 0);case 6:case"end":return e.stop()}},e,null,[[3,5]])}))).apply(this,arguments)}function td(e){return nd.apply(this,arguments)}function nd(){return nd=w(x().mark(function e(t){var n,r,i,o,a,s,c,l,u;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,qt.fetcher.load(t);case 1:return e.next=2,Mu(t);case 2:return n=e.sent,e.next=3,Fu(t);case 3:return r=e.sent,e.next=4,Hu(t,n);case 4:return i=e.sent,e.next=5,$u(t,r);case 5:if(o=e.sent,a=!0,o&&i!==Yu(o)&&confirm("This is strange the publicKey is not valid for\n"+(null==t?void 0:t.uri)+"'shall we repair keeping the private key ?")&&(a=!1),o&&i&&a){e.next=8;break}if(s=[],c=[],o){e.next=6;break}return o=Zu(),c=[m.st(t,v.solid("privateKey"),m.literal(o),qt.sym(r))],e.next=6,id(r,[],c,t.uri);case 6:if(i&&a){e.next=7;break}return s=[],i&&(s=[m.st(t,v.solid("publicKey"),m.lit(i),qt.sym(n))],kn.Rm("delete invalid publicKey "+s)),l=Yu(o),c=[m.st(t,v.solid("publicKey"),m.literal(l),qt.sym(n))],e.next=7,id(n,s,c);case 7:return u=r.substring(0,r.lastIndexOf("/")+1),e.next=8,Ku(u,Gu(t.uri));case 8:return e.abrupt("return",o);case 9:case"end":return e.stop()}},e)})),nd.apply(this,arguments)}var rd=function(){var e=w(x().mark(function e(t){var n,r,i;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,qt.fetcher.load(t);case 1:if(!(n=qt.any(qt.sym(t),qt.sym("http://www.iana.org/assignments/link-relations/acl")))){e.next=6;break}return e.prev=2,e.next=3,qt.fetcher.webOperation("DELETE",n.value);case 3:r=e.sent,kn.Rm("delete keyAcl"+n.value+" "+r.status),e.next=6;break;case 4:if(e.prev=4,404===(i=e.catch(2)).response.status){e.next=5;break}throw new Error(i);case 5:kn.Rm("delete keyAcl"+n.value+" "+i.response.status);case 6:case"end":return e.stop()}},e,null,[[2,4]])}));return function(t){return e.apply(this,arguments)}}();function id(e,t,n){return od.apply(this,arguments)}function od(){return od=w(x().mark(function e(t,n,r){var i,o,a=arguments;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.length>3&&void 0!==a[3]?a[3]:"",e.next=1,rd(t);case 1:return e.next=2,qt.updater.updateMany(n,r);case 2:return o=Qu(t,i),e.next=3,Ku(t,o);case 3:case"end":return e.stop()}},e)})),od.apply(this,arguments)}var ad=function(){return qn(function e(t,n){Wn(this,e),this.channel=t,this.channelRoot=t.doc(),this.options=n,this.dateFolder=new ac(this.channelRoot,"chat.ttl"),this.div=null},[{key:"createMessage",value:(r=w(x().mark(function e(t){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.updateMessage(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"updateMessage",value:(n=w(x().mark(function e(t){var n,r,i,o,a,s,c,l,u,d,p,f,h,g,y,w,b,E,C,k=arguments;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=k.length>1&&void 0!==k[1]?k[1]:null,r=k.length>2?k[2]:void 0,i=k.length>3&&void 0!==k[3]?k[3]:null,o=[],a=new Date,s=""+a.getTime(),c=m.term(a),l=n?n.doc():this.dateFolder.leafDocumentFromDate(a),u=qt.sym(l.uri+"#Msg"+s),d=Jt.currentUser(),(p=Bu()).id=u.uri,!n){e.next=4;break}if((f=qt.any(n,v.foaf("maker"))).uri!==d.uri){e.next=2;break}return e.next=1,dd(n);case 1:h=e.sent,o.push(m.st(h,v.dct("isReplacedBy"),u,l)),(g=qt.any(h,v.sioc("has_reply")))&&o.push(m.st(u,v.sioc("has_reply"),g,l)),r&&o.push(m.st(u,v.schema("dateDeleted"),c,l)),e.next=3;break;case 2:throw y="Error you cannot delete/edit a message from someone else : \n"+f.uri,kn.R8(y),alert(y),new Error(y);case 3:e.next=5;break;case 4:o.push(m.st(this.channel,v.wf("message"),u,l));case 5:if(o.push(m.st(u,v.sioc("content"),qt.literal(t),l)),p.content=t,o.push(m.st(u,v.dct("created"),c,l)),p.created=c.value,!d){e.next=7;break}return o.push(m.st(u,v.foaf("maker"),d,l)),p.maker=d.uri,e.next=6,td(d);case 6:w=e.sent,b=Uu(p,w),o.push(m.st(u,m.sym("".concat(Pu,"proofValue")),m.lit(b),l));case 7:return i&&(o.push(m.st(i,v.sioc("has_member"),u,l)),i.doc().sameTerm(u.doc())||o.push(m.st(i,v.sioc("has_member"),u,i.doc()))),e.prev=8,e.next=9,qt.updater.updateMany([],o);case 9:e.next=11;break;case 10:throw e.prev=10,C=e.catch(8),E="Error saving chat message: "+C,kn.R8(E),alert(E),new Error(E);case 11:return e.abrupt("return",u);case 12:case"end":return e.stop()}},e,this,[[8,10]])})),function(e){return n.apply(this,arguments)})},{key:"deleteMessage",value:(t=w(x().mark(function e(t){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.updateMessage("(message deleted)",t,!0));case 1:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"createThread",value:(e=w(x().mark(function e(t){var n,r,i;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=qt.each(t,v.sioc("has_reply"),null,t.doc()).filter(function(e){return qt.holds(e,v.rdf("type"),v.sioc("Thread"),e.doc())}),!(n.length>0)){e.next=1;break}return e.abrupt("return",n[0]);case 1:return r=m.sym(t.uri+"-thread"),i=[m.st(r,v.rdf("type"),v.sioc("Thread"),r.doc()),m.st(t,v.sioc("has_reply"),r,r.doc())],e.next=2,qt.updater.update([],i);case 2:return e.abrupt("return",r);case 3:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)})}]);var e,t,n,r}();function sd(e){return cd.apply(this,arguments)}function cd(){return cd=w(x().mark(function e(t){var n,r,i,o,a;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=[t],(r={})[t.uri]=!0,i=t;case 1:if((o=qt.any(null,v.dct("isReplacedBy"),i,i.doc()))&&!r[o.uri]){e.next=2;break}return e.abrupt("continue",4);case 2:return e.next=3,qt.fetcher.load(o);case 3:n.unshift(o),r[o.uri]=!0,i=o,e.next=1;break;case 4:i=t;case 5:if((a=qt.any(i,v.dct("isReplacedBy"),null,i.doc()))&&!r[a.uri]){e.next=6;break}return e.abrupt("continue",7);case 6:n.push(a),r[a.uri]=!0,i=a,e.next=5;break;case 7:return e.abrupt("return",n);case 8:case"end":return e.stop()}},e)})),cd.apply(this,arguments)}function ld(e){return ud.apply(this,arguments)}function ud(){return ud=w(x().mark(function e(t){var n,r;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t,r={};case 1:if(!n){e.next=4;break}if(!r[n.uri]){e.next=2;break}return kn.z3("originalVersion: verion loop"+t),e.abrupt("return",t);case 2:return r[n.uri]=!0,t=n,e.next=3,qt.fetcher.load(t);case 3:n=qt.any(null,v.dct("isReplacedBy"),t,t.doc()),e.next=1;break;case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}},e)})),ud.apply(this,arguments)}function dd(e){return pd.apply(this,arguments)}function pd(){return pd=w(x().mark(function e(t){var n,r;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t,r={};case 1:if(!n){e.next=4;break}if(!r[n.uri]){e.next=2;break}return kn.z3("mostRecentVersion: verion loop"+t),e.abrupt("return",t);case 2:return r[n.uri]=!0,t=n,e.next=3,qt.fetcher.load(t);case 3:n=qt.any(t,v.dct("isReplacedBy"),null,t.doc()),e.next=1;break;case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}},e)})),pd.apply(this,arguments)}function fd(e){return qt.holds(e,v.schema("dateDeleted"),null,e.doc())}function hd(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return md(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?md(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function md(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var gd=Wt.store;function vd(e,t,n,r,i,o){t.setAttribute("style",ar.participantsStyle);var a=function(n){var r,i=gd.any(n,v.wf("participant"));if(!i)return(r=e.createElement("tr")).textContent="???",r;var a=gd.anyValue(n,v.ui("backgroundColor"))||or.participationDefaultBackground,s=e.createElement("div");s.setAttribute("style",ar.participantsBlock),s.style.backgroundColor=a,r=yi(e,null,i,o),t.appendChild(r);var c=e.createElement("td");return c.setAttribute("style",ar.personTableTD),c.appendChild(s),r.insertBefore(c,r.firstChild),r},s=function(){var e=gd.each(r,v.wf("participation")).map(function(e){return(0,kn.Rm)("in participants"),[gd.anyValue(e,v.cal("dtstart"))||"9999-12-31",e]});e.sort();var n=e.map(function(e){return e[1]});wr(t,n,a)};return t.refresh=s,s(),t}function yd(e,t,n){return new Promise(function(r,i){if(!n)throw new Error("No user id");var o=gd.each(e,v.wf("participation")).filter(function(e){return gd.holds(e,v.wf("participant"),n)});if(o.length>1){var a,s=[],c=hd(o);try{for(c.s();!(a=c.n()).done;){var l=a.value,u=gd.anyValue(l,v.cal("dtstart"));u&&s.push([u,l])}}catch(e){c.e(e)}finally{c.f()}s.sort(),kn.R8("Multiple participation objects, picking earliest, in "+t),r(s[0][1])}if(o.length)r(o[0]);else{var d=Ta(t),p=[(0,m.st)(e,v.wf("participation"),d,t),(0,m.st)(d,v.wf("participant"),n,t),(0,m.st)(d,v.cal("dtstart"),new Date,t),(0,m.st)(d,v.ui("backgroundColor"),Cd(n),t)];gd.updater.update([],p,function(e,t,n){t?r(d):i(new Error("Error recording your participation: "+n))}),r(d)}})}function wd(e,t,n){var r=Jt.currentUser();if(r){var i=gd.each(e,v.wf("participation")).filter(function(e){return gd.holds(e,v.wf("participant"),r)});if(i.length>1)throw new Error("Multiple records of your participation");if(i.length)return i[0];if(!gd.updater.editable(t))return kn.Rm("Not recording participation, as no write access as "+r+" to "+t),null;var o=Ta(t),a=[(0,m.st)(e,v.wf("participation"),o,t),(0,m.st)(o,v.wf("participant"),r,t),(0,m.st)(o,v.cal("dtstart"),new Date,t),(0,m.st)(o,v.ui("backgroundColor"),Cd(r),t)];return gd.updater.update([],a,function(e,t,r){if(!t)throw new Error("Error recording your participation: "+r);n&&n.refresh&&n.refresh()}),o}}function bd(e,t,n,r,i,o){var a=e.createElement("table");t.appendChild(a),vd(e,a,0,r,0,o);try{wd(r,n,a)}catch(n){t.appendChild(Wr(e,"Error recording your participation: "+n))}return a}var xd=Wt.store,Ed=(0,m.Namespace)("http://www.w3.org/ns/pim/pad#");function Cd(e){var t;return e&&e.uri?"#"+(16777215&(t=e.uri,t.split("").reduce(function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e},0))|12632256).toString(16):"#ffffff"}function kd(e,t,n,r,i){var o=(i=i||{}).exists,a=e.createElement("table"),s=xd;if(r&&!r.uri)throw new Error("UI.pad.notepad:  Invalid userid");var c=xd.updater,l=(0,m.Namespace)("http://www.w3.org/ns/pim/pad#");a.setAttribute("style",ar.notepadStyle);var u=null,d=null;if(i.statusArea){var p=i.statusArea.appendChild(e.createElement("table")).appendChild(e.createElement("tr"));u=p.appendChild(e.createElement("td")),d=p.appendChild(e.createElement("td")),u&&u.setAttribute("style",ar.upstreamStatus),d&&d.setAttribute("style",ar.downstreamStatus)}var f=function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,kn.Rm)(t),i.statusArea&&(n?u:d).appendChild(Wr(e,t,"pink"))},h=function(e){i.statusArea&&(i.statusArea.innerHTML="")},g=function(e,t,n){var r=e.subject;t=t||"";var i=ar.baseStyle,o=ar.headingCore,a=ar.headingStyle,c=s.any(r,v.dc("author"));!t&&c&&(t="color: "+(n?"#888":"black")+"; background-color: "+Cd(c)+";");var u=s.any(r,l("indent")),d=(u=u?u.value:0)>=0?i+"text-indent: "+3*u+"em;":o+a[-1-u];e.setAttribute("style",d+t)},y=function(e){var r=e.subject;if(!r)throw new Error("No chunk for line to be deleted!");var i=s.any(void 0,l("next"),r),o=s.any(r,l("next"));if(i.sameTerm(n)&&o.sameTerm(n))(0,kn.Rm)("You can't delete the only line.");else{var a=s.statementsMatching(r,void 0,void 0,t).concat(s.statementsMatching(void 0,void 0,r,t)),u=[(0,m.st)(i,l("next"),o,t)];if(r instanceof m.NamedNode){var d=r.uri.slice(-4);(0,kn.Rm)("Deleting line "+d)}if(!c)throw new Error("have no updater");c.update(a,u,function(t,n,i,o){if(n){var s=e.parentNode;if(s){var c=s.previousSibling;s.parentNode&&s.parentNode.removeChild(s),c&&c.firstChild&&c.firstChild.focus()}}else if(o&&409===o.status)g(e,"color: black;  background-color: #ffd;"),e.state=0,gr(),setTimeout(function(){_()},1e3);else{(0,kn.Rm)("    removePart FAILED "+r+": "+i),(0,kn.Rm)("    removePart was deleteing :'"+a),g(e,"color: black;  background-color: #fdd;");var l=o?o.status:" [no response field] ";f("Error "+l+" saving changes: "+i.true)}})}},w=function(e,n){e.addEventListener("keydown",function(r){if(!c)throw new Error("no updater");var i,o;switch(r.keyCode){case 13:var a=r.shiftKey;if((0,kn.Rm)("enter"),a?(o=s.any(void 0,l("next"),n),i="newlinesAfter"):(o=s.any(n,l("next")),i="newlinesBefore"),o[i]=o[i]||0,o[i]+=1,o[i]>1)return void(0,kn.Rm)("    queueing newline queue = "+o[i]);(0,kn.Rm)("    go ahead line before "+o[i]),x(e,a);break;case 8:if(0===e.value.length)switch((0,kn.Rm)("Delete key line "+n.uri.slice(-4)+" state "+e.state),e.state){case 1:case 2:return void(e.state=4);case 3:case 4:return;case void 0:case 0:e.state=3,y(e),r.preventDefault();break;default:throw new Error("pad: Unexpected state "+e)}break;case 9:var u=r.shiftKey?-1:1;!function(e,n,r){var i=s.statementsMatching(n,l("indent")),o=i.length?Number(i[0].object.value):0;if(!(o+r<-3)){var a=o+r,u=(0,m.st)(n,l("indent"),a,t);if(!c)throw new Error("no updater");c.update(i,u,function(n,r,i){r?g(e):((0,kn.Rm)("Indent change FAILED '"+a+"' for "+t+": "+i),g(e,"color: black;  background-color: #fdd;"),c.requestDownstreamAction(t,_))})}}(e,n,u),r.preventDefault();break;case 27:(0,kn.Rm)("escape"),c.requestDownstreamAction(t,_),r.preventDefault();break;case 38:e.parentNode.previousSibling&&(e.parentNode.previousSibling.firstChild.focus(),r.preventDefault());break;case 40:e.parentNode.nextSibling&&(e.parentNode.nextSibling.firstChild.focus(),r.preventDefault())}});var r=function(e){var n=e.subject;g(e,void 0,!0);var i,o=s.any(n,v.sioc("content")).value,a=[(0,m.st)(n,v.sioc("content"),o,t)];e.value&&(i=[(0,m.st)(n,v.sioc("content"),e.value,t)]);var l=e.value;if(e.lastSent&&o!==e.lastSent)throw new Error("Out of order, last sent expected '"+o+"' but found '"+e.lastSent+"'");if(e.lastSent=l,!c)throw new Error("no updater");c.update(a,i,function(n,i,a,s){i?(h(),g(e),(0,kn.Rm)("    Patch ok '"+o+"' -> '"+l+"' "),4===e.state?(e.state=3,y(e)):3===e.state||(2===e.state?(e.state=1,r(e)):e.state=0)):((0,kn.Rm)("    patch FAILED "+s.status+" for '"+o+"' -> '"+l+"': "+a),409===s.status?(g(e,"color: black;  background-color: #fdd;"),e.state=0,gr(),setTimeout(function(){c.requestDownstreamAction(t,_)},1e3)):(g(e,"color: black;  background-color: #fdd;"),e.state=0,f("    Error "+s.status+" sending data: "+a,!0),gr()))})};e.addEventListener("input",function(t){switch(g(e,void 0,!0),(0,kn.Rm)("Input event state "+e.state+" value '"+e.value+"'"),e.state){case 3:case 4:case 2:return;case 1:return void(e.state=2);case 0:case void 0:e.state=1,r(e)}})},b=function(t,n,i){var o=s.any(n,v.sioc("content"));o=o?o.value:"";var c=e.createElement("tr");i?a.insertBefore(c,t):t&&t.nextSibling?a.insertBefore(c,t.nextSibling):a.appendChild(c);var l=c.appendChild(e.createElement("input"));return l.subject=n,l.setAttribute("type","text"),l.value=o,r?(g(l,""),w(l,n)):(g(l,"color: #222; background-color: #fff"),(0,kn.Rm)("Note can't add listeners - not logged in")),l},x=function(e,i){var o,a,s,u,d,p=xd,f=0,h=null;e?("input"!==e.tagName.toLowerCase()&&(0,kn.Rm)("return pressed when current document is: "+e.tagName),o=e.subject,f=(f=p.any(o,l("indent")))?Number(f.value):0,i?(a=p.any(void 0,l("next"),o),s=o,u=a,h="newlinesAfter"):(a=o,s=p.any(o,l("next")),u=s,h="newlinesBefore"),d=e.parentNode):(a=n,s=n,d=void 0);var y=Ta(t),w=y.uri.slice(-4),E=[(0,m.st)(a,l("next"),s,t)],C=[(0,m.st)(a,l("next"),y,t),(0,m.st)(y,l("next"),s,t),(0,m.st)(y,v.dc("author"),r,t),(0,m.st)(y,v.sioc("content"),"",t)];if(f>0&&C.push((0,m.st)(y,l("indent"),f,t)),(0,kn.Rm)("    Fresh chunk "+w+" proposed"),!c)throw new Error("no updater");c.update(E,C,function(e,t,n,r){if(t){var o=b(d,y,i);g(o),o.focus(),h&&((0,kn.Rm)("    Fresh chunk "+w+" updated, queue = "+u[h]),u[h]-=1,u[h]>0&&((0,kn.Rm)("    Implementing queued newlines = "+s.newLinesBefore),x(o,i)))}else(0,kn.Rm)("    ERROR writing new line "+w+": "+n)})},E=function(){var e={},t=0;function r(e){f(e),t++}if(!s.the(n,l("next")))return r("No initial next pointer"),!1;for(var i,o=n;(i=s.the(o,l("next")))||r("No next pointer from "+o),!i.sameTerm(n);){o=i;var a=i.uri.split("#")[1];if(e[i.uri])return r("Loop!"),!1;e[i.uri]=!0;var c=s.each(i,l("next")).length;1!==c&&r("Should be 1 not "+c+" next pointer for "+a),(c=s.each(i,l("indent")).length)>1&&r("Should be 0 or 1 not "+c+" indent for "+a),1!==(c=s.each(i,v.sioc("content")).length)&&r("Should be 1 not "+c+" contents for "+a),1!==(c=s.each(i,v.dc("author")).length)&&r("Should be 1 not "+c+" author for "+a),s.statementsMatching(void 0,v.sioc("contents")).forEach(function(t){e[t.subject.value]||r("Loose chunk! "+t.subject.value)})}return!t},C=function(){if(1!==s.each(n,l("next")).length){var e="Pad: Inconsistent data - NEXT pointers: "+s.each(n,l("next")).length;return(0,kn.Rm)(e),void(i.statusArea&&(i.statusArea.textContent+=e))}for(var t,r=[],o=s.the(n,l("next"));!o.sameTerm(n);o=s.the(o,l("next")))for(var c=0;c<a.children.length;c++){var u=a.children[c];u.firstChild&&u.firstChild.subject.sameTerm(o)&&(r[o.uri]=u.firstChild)}for(var d=a.children.length-1;d>=0;d--)r[(t=a.children[d]).firstChild.subject.uri]||a.removeChild(t);t=a.firstChild;for(var p=s.the(n,l("next"));!p.sameTerm(n);p=s.the(p,l("next"))){var f=s.any(p,v.sioc("content")).value;if(t&&r[p.uri]){var h=t.firstChild;f!==h.value&&(h.value=f),g(h),h.state=0,delete h.lastSent,t=t.nextSibling}else b(t,p,!0)}},k=function(e){if(e.refresh)e.refresh();else for(var t=0;t<e.children.length;t++)k(e.children[t])},A=!1,_=function(){if(A)(0,kn.Rm)("   Already reloading - stop");else{A=!0;var e=1e3,n=function(){if((0,kn.Rm)("try reload - timeout = "+e),!c)throw new Error("no updater");c.reload(c.store,t,function(r,i,o){A=!1,r?((0,kn.Rm)("    reloaded OK"),h(),E()?k(a):f("CONSISTENCY CHECK FAILED")):0===o.status?(f("Network error refreshing the pad. Retrying in "+e/1e3),A=!0,e*=2,setTimeout(n,e)):f("Error "+o.status+"refreshing the pad:"+i+". Stopped. "+t)})};n()}};if(a.refresh=C,a.reloadAndSync=_,r||(0,kn.Rm)("Warning: must be logged in for pad to be edited"),o)(0,kn.Rm)("Existing pad."),E()?(C(),s.holds(n,l("next"),n)&&x()):(0,kn.Rm)(a.textContent="Inconsistent data. Abort");else{(0,kn.Rm)("No pad exists - making new one.");var S=[(0,m.st)(n,v.rdf("type"),l("Notepad"),t),(0,m.st)(n,v.dc("author"),r,t),(0,m.st)(n,v.dc("created"),new Date,t),(0,m.st)(n,l("next"),n,t)];if(!c)throw new Error("no updater");c.update([],S,function(e,t,n){t?((0,kn.Rm)("Initial pad created"),x()):f(n||"")})}return a}function Ad(e,t){for(var n=[],r=t.the(e,Ed("next"));!r.sameTerm(e);r=t.the(r,Ed("next")))n.push(r);return n}function _d(e){return e.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;")}function Sd(e,t){var n=Ad(e,t),r="<html>\n  <head>\n",i=t.anyValue(e,v.dct("title"));i&&(r+="    <title>".concat(_d(i),"</title>\n")),r+="  </head>\n  <body>\n";var o=0;function a(e){for(;o>e;o--)r+="</ul>\n"}return n.forEach(function(e){var n=t.anyJS(e,Ed("indent")),i=t.anyJS(e,v.sioc("content"));if(i){var s=_d(i);if(n<0){a(0);var c=n>=-3?4+n:1;r+="\n<h".concat(c,">").concat(s,"</h").concat(c,">\n")}else n>0?(a(n),function(e){for(;o<e;o++)r+="<ul>\n"}(n),r+="<li>".concat(s,"</li>\n")):(a(n),r+="<p>".concat(s,"</p>\n"))}}),a(0),r+="  </body>\n</html>\n"}var Td={icons:dr.Pt,ns:v,media:Us,pad:l,style:ar,utils:t,widgets:s},Rd=m.Namespace("http://www.w3.org/2002/01/bookmark#"),Id=En,Ld=window.document||null;function Nd(e,t){return new Promise(function(n,r){qt.updater.update(e,t,function(e,t,i){t?n():r(new Error(i))})})}function Pd(){return(Pd=w(x().mark(function e(t){var n,r,i,o;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Rd("Bookmark"),r="bookmarks.ttl",e.next=1,Ka(t,n,true);case 1:if(!(t.instances&&t.instances.length>0)){e.next=2;break}t.bookmarkDocument=t.instances[0],t.instances.length>1&&kn.R8("More than one bookmark file! "+t.instances),e.next=9;break;case 2:if(!t.publicProfile){e.next=8;break}return i=m.sym(t.publicProfile.dir().uri+r),e.prev=3,kn.Rm("Creating new bookmark file "+i),e.next=4,qt.fetcher.createIfNotExists(i);case 4:e.next=6;break;case 5:return e.prev=5,o=e.catch(3),kn.R8("Can't make fresh bookmark file:"+o),e.abrupt("return",t);case 6:return e.next=7,Ut.registerInTypeIndex(i,t.index,n);case 7:t.bookmarkDocument=i,e.next=9;break;case 8:kn.R8("You seem to have no bookmark file, nor even a profile file!");case 9:return e.abrupt("return",t);case 10:case"end":return e.stop()}},e,null,[[3,5]])}))).apply(this,arguments)}function Bd(e,t){return Od.apply(this,arguments)}function Od(){return Od=w(x().mark(function e(t,n){var r,i,o,a,s,c,l,u;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r="",i=Jt.currentUser()){e.next=1;break}throw new Error("Must be logged on to add Bookmark");case 1:return o=qt.any(n,v.foaf("maker")),r=Id(o)+": "+qt.anyValue(n,v.sioc("content")).slice(0,80),a=t.bookmarkDocument,s=Td.widgets.newThing(a,r),c=[m.st(a,Td.ns.dct("references"),s,a),m.st(s,Td.ns.rdf("type"),Rd("Bookmark"),a),m.st(s,Td.ns.dct("created"),new Date,a),m.st(s,Rd("recalls"),n,a),m.st(s,Td.ns.foaf("maker"),i,a),m.st(s,Td.ns.dct("title"),r,a)],e.prev=2,e.next=3,Nd([],c);case 3:e.next=5;break;case 4:return e.prev=4,u=e.catch(2),l="Making bookmark: "+u,kn.R8(l),e.abrupt("return",null);case 5:return e.abrupt("return",s);case 6:case"end":return e.stop()}},e,null,[[2,4]])})),Od.apply(this,arguments)}function Dd(e,t,n){return Ud.apply(this,arguments)}function Ud(){return(Ud=w(x().mark(function e(t,n,r){var i,o,a,s;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,qt.fetcher.load(t.bookmarkDocument);case 1:if(!(i=qt.each(null,Rd("recalls"),n,t.bookmarkDocument)).length){e.next=9;break}if(confirm("Delete bookmark on this?"+i.length)){e.next=2;break}return e.abrupt("return");case 2:o=0;case 3:if(!(o<i.length)){e.next=8;break}return e.prev=4,e.next=5,Nd(qt.connectedStatements(i[o]),[]);case 5:r.style.backgroundColor="white",kn.Rm("Bookmark deleted: "+i[o]),e.next=7;break;case 6:e.prev=6,s=e.catch(4),kn.z3("Cant delete bookmark:"+s),kn.R8("Cannot delete bookmark:"+s);case 7:o++,e.next=3;break;case 8:e.next=11;break;case 9:return e.next=10,Bd(t,n);case 10:a=e.sent,r.style.backgroundColor="yellow",kn.Rm("Bookmark added: "+a);case 11:case"end":return e.stop()}},e,null,[[4,6]])}))).apply(this,arguments)}function jd(e,t){return Md.apply(this,arguments)}function Md(){return Md=w(x().mark(function e(t,n){var r,i,o;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=function(){return i=w(x().mark(function e(n){var r;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,qt.fetcher.load(t.bookmarkDocument);case 1:r=qt.any(null,Rd("recalls"),n.target,t.bookmarkDocument),n.style=Td.style.buttonStyle,r&&(n.style.backgroundColor="yellow");case 2:case"end":return e.stop()}},e)})),i.apply(this,arguments)},r=function(e){return i.apply(this,arguments)},!t.bookmarkDocument){e.next=2;break}return(o=Td.widgets.button(Ld,Td.icons.iconBase+"noun_45961.svg",Id(Rd("Bookmark")),function(){Dd(t,n,o)})).target=n,e.next=1,r(o);case 1:return e.abrupt("return",o);case 2:case"end":return e.stop()}},e)})),Md.apply(this,arguments)}var Fd=window.document,Hd={};function Wd(e,t){return $d.apply(this,arguments)}function $d(){return $d=w(x().mark(function e(t,n){var r,i,o;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=function(){return(o=w(x().mark(function e(){var i,o,a;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.innerHTML="",!fd(t)){e.next=1;break}return e.abrupt("return",r);case 1:return e.next=2,sd(t);case 2:if(i=e.sent,0!==(o=i.map(function(e){return qt.each(null,v.schema("target"),e,n)}).flat()).length){e.next=3;break}return e.abrupt("return",r);case 3:(a=o.map(function(e){return[qt.any(e,v.rdf("type"),null,n),qt.any(e,v.sioc("content"),null,n),qt.any(e,v.schema("agent"),null,n)]})).sort(),a.forEach(function(e){var t,n=Gn(e,3),i=n[0],o=n[1],a=n[2];a?(t=Fd.createElement("a")).setAttribute("href",a.uri):t=Fd.createTextNode(""),t.textContent=o||Hd[i]||"",r.appendChild(t)});case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)},i=function(){return o.apply(this,arguments)},r=Fd.createElement("span"),i().then(kn.Rm("sentimentStripLinked: sentimentStripLinked async refreshed")),r.refresh=i,e.abrupt("return",r);case 1:case"end":return e.stop()}},e)})),$d.apply(this,arguments)}function Jd(e,t,n,r){return zd.apply(this,arguments)}function zd(){return zd=w(x().mark(function e(t,n,r,i){var o,a,s,c,l,u,d,p,f,h,g,y,b,E,C,k,A,_,S;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return y=function(e,t,r,i,o,a){function s(){l.style.backgroundColor=c?"yellow":"white"}var c,l=hi(Fd,r,En(i),function(){var r=w(x().mark(function r(l){var d,p,h,g;return x().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!c){r.next=2;break}return r.next=1,f(c);case 1:c=null,s(),r.next=8;break;case 2:return c=Ta(o),d=[m.st(c,v.schema("agent"),e.me,o),m.st(c,v.rdf("type"),i,o),m.st(c,v.schema("target"),t,o)],r.next=3,qt.updater.update([],d);case 3:if(s(),!a){r.next=8;break}p=!1,h=0;case 4:if(!(h<a.length)){r.next=7;break}if(!(g=u(a[h]))){r.next=6;break}return r.next=5,f(g);case 5:p=!0;case 6:h++,r.next=4;break;case 7:p&&Ci(n);case 8:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}());function u(n){var r=qt.each(null,v.schema("agent"),e.me,o).filter(function(e){return qt.holds(e,v.rdf("type"),n,o)}).filter(function(e){return qt.holds(e,v.schema("target"),t,o)});return r.length?r[0]:null}function d(){c=u(i),s()}return l.refresh=d,d(),l},h=function(){return(h=w(x().mark(function e(t){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,qt.updater.update(qt.connectedStatements(t),[]);case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)},f=function(e){return h.apply(this,arguments)},p=function(){d.parentElement.parentElement.removeChild(d.parentElement)},u=function(){return(u=w(x().mark(function e(){var n,o;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,i.createThread(t);case 1:if(n=e.sent,o=r.chatOptions){e.next=2;break}throw new Error("replyInThread: missing options");case 2:o.showThread(n,o),p();case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)},l=function(){return u.apply(this,arguments)},c=function(){return c=w(x().mark(function e(n){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(g.value!==qt.any(t,v.foaf("maker")).value){e.next=1;break}return p(),e.next=1,ap(n,t,i,r);case 1:case"end":return e.stop()}},e)})),c.apply(this,arguments)},s=function(e){return c.apply(this,arguments)},a=function(){return a=w(x().mark(function e(){var o,a,s;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=qt.any(t,v.foaf("maker")),g){e.next=1;break}alert("You can't delete the message, you are not logged in."),e.next=7;break;case 1:if(!g.sameTerm(o)){e.next=6;break}return e.prev=2,e.next=3,i.deleteMessage(t);case 3:e.next=5;break;case 4:e.prev=4,s=e.catch(2),a="Error deleting messaage "+s,kn.R8(a),alert(a),(r.statusArea||n.parentNode).appendChild(Wr(Fd,a));case 5:n.parentNode.removeChild(n),e.next=7;break;case 6:alert("You can't delete the message, you are not logged in as the author, "+o);case 7:p();case 8:case"end":return e.stop()}},e,null,[[2,4]])})),a.apply(this,arguments)},o=function(){return a.apply(this,arguments)},d=Fd.createElement("div"),e.next=1,dd(t).value;case 1:if(C=e.sent,k=v.schema("dateDeleted").value,C!==k){e.next=2;break}return e.abrupt("return",d);case 2:if((g=Jt.currentUser())&&qt.holds(t,v.foaf("maker"),g)&&(d.appendChild(fi(Fd,d,"message",o)),d.appendChild(hi(Fd,dr.Pt.iconBase+"noun_253504.svg","edit",function(){return s(n)}))),jd(r).then(function(e){e&&d.appendChild(e)}),g=Jt.currentUser(),!(A=g)){e.next=4;break}return e.next=3,dd(t).value;case 3:_=e.sent,S=v.schema("dateDeleted").value,A=_!==S;case 4:if(!A){e.next=5;break}b={me:g,dom:Fd,div:d},d.appendChild(y(b,t,dr.Pt.iconBase+"noun_1384132.svg",v.schema("AgreeAction"),t.doc(),[v.schema("DisagreeAction")])),d.appendChild(y(b,t,dr.Pt.iconBase+"noun_1384135.svg",v.schema("DisagreeAction"),t.doc(),[v.schema("AgreeAction")]));case 5:return qt.any(t,v.dct("created"))&&d.appendChild(hi(Fd,dr.Pt.iconBase+"noun-reply-5506924.svg","Reply in thread",w(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,l();case 1:case"end":return e.stop()}},e)})))),(E=d.appendChild(mi(Fd))).style.float="right",E.firstChild.style.opacity="0.3",E.addEventListener("click",p),e.abrupt("return",d);case 6:case"end":return e.stop()}},e)})),zd.apply(this,arguments)}function qd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Kd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qd(Object(n),!0).forEach(function(t){Mi(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qd(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Vd(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Gd(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Gd(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Gd(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}Hd[v.schema("AgreeAction")]="",Hd[v.schema("DisagreeAction")]="",Hd[v.schema("EndorseAction")]="",Hd[v.schema("LikeAction")]="";var Qd=window.document,Zd=ar.messageBodyStyle,Yd=En;function Xd(e,t){var n=Qd.createElement("img"),r="10";t.inlineImageHeightEms&&(r=(""+t.inlineImageHeightEms).trim()),n.setAttribute("style","max-height: "+r+"em; border-radius: 1em; margin: 0.7em;"),e&&n.setAttribute("src",e);var i=Qd.createElement("a");return i.setAttribute("href",e),i.setAttribute("target","images"),i.appendChild(n),cr(n,$rdf.sym(e)),i}var ep=function(e,t){var n=Qd.createElement("a");return t&&t.uri&&(n.setAttribute("href",t.uri),n.addEventListener("click",Ai,!0),n.setAttribute("style","color: #3B5998; text-decoration: none; ")),n.textContent=e,n};function tp(e){var t=qt.any(e,v.foaf("nick"));return t?""+t.value:""+Yd(e)}function np(e,t,n,r){var i=e.appendChild(ep(tp(t),t));t.uri&&qt.fetcher.nowOrWhenFetched(t.doc(),void 0,function(e,n){i.textContent=tp(t)}),e.appendChild(Qd.createElement("br")),e.appendChild(ep(n,r))}function rp(e,t,n,r){var i=e.appendChild(ep(Yd(t),t));t.uri&&qt.fetcher.nowOrWhenFetched(t.doc(),void 0,function(e,n){i.textContent=tp(t)});var o=e.appendChild(ep(n,r));o.style.fontSize="80%",o.style.marginLeft="1em",e.appendChild(Qd.createElement("br"))}function ip(e,t,n,r,i){return op.apply(this,arguments)}function op(){return op=w(x().mark(function e(t,n,r,i,o){var a,s,c,l,u,d,p,f,h,m,g,y,b,E,C,k,A,_,S,T,R,I,L,N,P,B,O,D,U,j,M,F,H,W,$;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return F=function(e){return e?"#e8ffe8":"white"},a=!1,s="1"===i.colorizeByAuthor||!0===i.colorizeByAuthor,c=qt.any(n,v.foaf("maker")),l=qt.any(n,v.dct("created")),e.next=1,dd(n);case 1:return u=e.sent,d=qt.any(u,v.foaf("maker")),p=c.uri===(null==d?void 0:d.uri)?u:n,f=qt.any(p,v.sioc("content")),e.next=2,sd(p);case 2:(h=e.sent).length>1&&kn.Rm("renderMessageRow versions: ",h.join(",  ")),m=h.map(function(e){return qt.each(e,v.sioc("has_reply"))}).flat(),g=null,y=[],b=Vd(m);try{for(b.s();!(E=b.n()).done;)C=E.value,qt.holds(C,v.rdf("type"),v.sioc("Thread"))?(g=C,kn.Rm("renderMessageRow: found thread: "+g)):y.push(C)}catch(e){b.e(e)}finally{b.f()}return y.length>1&&kn.Rm("renderMessageRow: found normal replies: ",y),g||(g=qt.any(null,v.sioc("has_member"),n)),k=qt.any(p,$rdf.sym("".concat(Pu,"proofValue"))),(A=Bu()).id=p.uri,A.created=qt.any(p,v.dct("created")).value,A.content=f.value,A.maker=c.uri,null!=k&&k.value?Xu(c).then(function(e){e||kn.R8("message is signed but "+c.uri+" is missing publicKey");null!=e&&e.match(/[0-9A-Fa-f]{6}/g)?null!=k&&k.value&&!Du(null==k?void 0:k.value,A,e)&&kn.R8("invalid signature\n"+A.id):kn.R8("invalid publicKey hex string\n"+c.uri+"\n"+e)}):(a=!0,kn.R8(p.uri+" is unsigned")),e.next=3,ld(n);case 3:return _=e.sent,S=!n.sameTerm(_),T=qt.the(_,v.dct("created"),null,_.doc())||qt.the(n,v.dct("created"),null,n.doc()),R=Qd.createElement("tr"),a&&R.setAttribute("style","background-color: red"),R.AJAR_date=T.value,R.AJAR_subject=n,I=Qd.createElement("td"),R.appendChild(I),i.authorDateOnLeft?np(I,c,ei(T.value),n):((L=Qd.createElement("img")).setAttribute("style","max-height: 2.5em; max-width: 2.5em; border-radius: 0.5em; margin: auto;"),di(L,c),I.appendChild(L)),N=ei(T.value),S&&(N+=" ... "+ei(l.value)),P=R.appendChild(Qd.createElement("td")),i.authorDateOnLeft||rp(P,c,N,n),B=f?f.value.trim():"??? no content?",O=/^https?:\/[^ <>]*$/i.test(B),D=null,O?/\.(gif|jpg|jpeg|tiff|png|svg)$/i.test(B)&&i.expandImagesInline?(U=Xd(B,i),P.appendChild(U)):(j=P.appendChild(Qd.createElement("a")),D=j.appendChild(Qd.createElement("p")),j.href=B,D.textContent=B,P.appendChild(j)):(D=Qd.createElement("p"),P.appendChild(D),D.textContent=B),D&&(M=s?Cd(c):F(r),D.setAttribute("style",Zd+"background-color: "+M+";")),e.next=4,Wd(n,n.doc());case 4:return(H=e.sent).children.length&&(P.appendChild(Qd.createElement("br")),P.appendChild(H)),W=Qd.createElement("td"),R.appendChild(W),$=hi(Qd,dr.Pt.iconBase+"noun_243787.svg","..."),W.appendChild($),$.addEventListener("click",function(){var e=w(x().mark(function e(r){var a,s,c;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!R.toolTR){e.next=1;break}return R.parentNode.removeChild(R.toolTR),delete R.toolTR,e.abrupt("return");case 1:return a=Qd.createElement("tr"),e.next=2,Jd(n,R,Kd(Kd({},o),{},{chatOptions:i}),t);case 2:(s=e.sent).style="border: 0.05em solid #888; border-radius: 0 0 0.7em 0.7em;  border-top: 0; height:3.5em; background-color: #fff;",R.nextSibling?R.parentElement.insertBefore(a,R.nextSibling):R.parentElement.appendChild(a),R.toolTR=a,a.appendChild(Qd.createElement("td")),c=a.appendChild(Qd.createElement("td")),a.appendChild(Qd.createElement("td")),c.appendChild(s);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),g&&i.showThread&&W.appendChild(hi(Qd,dr.Pt.iconBase+"noun_1180164.svg","see thread",function(e){i.showThread(g,i)})),e.abrupt("return",R);case 5:case"end":return e.stop()}},e)})),op.apply(this,arguments)}function ap(e,t,n,r){return sp.apply(this,arguments)}function sp(){return sp=w(x().mark(function e(t,n,r,i){var o,a,s,c,l,u,d;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.parentNode,s=cp,c=r,l=o,u=i,d=r.options,e.next=1,dd(n);case 1:a=s(c,l,u,d,e.sent),o.insertBefore(a,t),a.originalRow=t,t.style.visibility="hidden";case 2:case"end":return e.stop()}},e)})),sp.apply(this,arguments)}function cp(e,t,n,r,i){function o(e){return a.apply(this,arguments)}function a(){return(a=w(x().mark(function e(t){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,s(f.value,!0);case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function s(e,t){return c.apply(this,arguments)}function c(){return c=w(x().mark(function o(a,s){var c,l,u,d;return x().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return l=function(){return l=w(x().mark(function o(a,c){var l;return x().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=1,pp(e,t,a,!1,r,n);case 1:i?((l=m.originalRow).parentNode?l.parentNode.removeChild(l):(kn.R8("No parentNode on old message "+l.textContent),l.style.backgroundColor="#fee",l.style.visibility="hidden"),m.parentNode.removeChild(m)):s&&(f.value="",f.setAttribute("style",Zd),f.disabled=!1,f.scrollIntoView(r.newestFirst),f.focus(),f.select());case 2:case"end":return o.stop()}},o)})),l.apply(this,arguments)},c=function(e,t){return l.apply(this,arguments)},s&&(f.setAttribute("style",Zd+"color: #bbb;"),f.disabled=!0),o.prev=1,o.next=2,e.updateMessage(a,i,null,r.thread);case 2:u=o.sent,o.next=4;break;case 3:return o.prev=3,d=o.catch(1),(n.statusArea||m).appendChild(Wr(Qd,"Error writing message: "+d)),o.abrupt("return");case 4:return o.next=5,c(u,a);case 5:case"end":return o.stop()}},o,null,[[1,3]])})),c.apply(this,arguments)}function l(e){var n=t.chatDocument.dir().uri;lr(qt.fetcher,e,n+"Files",n+"Pictures",function(){var e=w(x().mark(function e(t,n){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,s(n);case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}())}var u,d,p=function(){var e=w(x().mark(function e(t){var n,r,i,o;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=Vd(t),e.prev=1,n.s();case 2:if((r=n.n()).done){e.next=4;break}return i=r.value,e.next=3,s(i);case 3:e.next=2;break;case 4:e.next=6;break;case 5:e.prev=5,o=e.catch(1),n.e(o);case 6:return e.prev=6,n.f(),e.finish(6);case 7:case"end":return e.stop()}},e,null,[[1,5,6,7]])}));return function(t){return e.apply(this,arguments)}}();i?(u=qt.anyValue(i,v.dct("created"),null,i.doc()),d=dr.Pt.iconBase+"noun_1180158.svg"):(d=dr.Pt.iconBase+"noun_383448.svg",u="9999-01-01T00:00:00Z");var f,h,m=Qd.createElement("tr"),g=Qd.createElement("td"),y=Qd.createElement("td"),b=Qd.createElement("td");return m.appendChild(g),m.appendChild(y),m.appendChild(b),m.AJAR_date=u,Wa({div:y,dom:Qd}).then(function(t){!function(){function t(){return(t=w(x().mark(function e(t){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=1;break}return e.next=1,s(t.uri);case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}if(r.menuHandler){var n=hi(Qd,dr.Pt.iconBase+"noun_243787.svg","More");n.setAttribute("style",ar.buttonStyle+"float: right;"),b.appendChild(n)}r.menuHandler;var a=Jt.currentUser();if(np(g,a,"",null),f=Qd.createElement("textarea"),y.innerHTML="",y.appendChild(f),f.rows=3,i&&(f.value=qt.anyValue(i,v.sioc("content"),null,i.doc())),f.setAttribute("style",Zd+"background-color: #eef;"),f.addEventListener("keydown",function(){var e=w(x().mark(function e(t){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.code){e.next=1;break}if(!(!t.shiftKey&&!r.shiftEnterSendsMessage||t.shiftKey&&r.shiftEnterSendsMessage)){e.next=1;break}return e.next=1,o(t);case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),!1),sr(f,p,l),b.innerHTML="",(h=hi(Qd,d,"Send")).style.float="right",h.addEventListener("click",function(e){return o()},!1),b.appendChild(h),i){var c=b.appendChild(mi(Qd));c.style.float="left",c.addEventListener("click",function(e){return function(e){e.originalRow.style.visibility="visible",e.parentNode.removeChild(e)}(m)},!1),b.appendChild(c)}var u=e.dateFolder.leafDocumentFromDate(new Date);y.appendChild(Us.cameraButton(Qd,qt,function(){return $rdf.sym(u.dir().uri+"Image_"+Date.now()+".png")},function(e){return t.apply(this,arguments)})),wd(e.channel,e.channel.doc())}(),Object.assign(t,n),function(e){return Pd.apply(this,arguments)}(t).then(function(e){})}),m}function lp(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return up(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?up(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function up(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function dp(e){"Notification"in window?"granted"===Notification.permission?new Notification(e):"denied"!==Notification.permission&&Notification.requestPermission().then(function(t){"granted"===t&&new Notification(e)}):kn.R8("This browser does no t support desktop notification")}function pp(e,t,n,r,i,o){return fp.apply(this,arguments)}function fp(){return fp=w(x().mark(function e(t,n,r,i,o,a){var s,c,l,u,d;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,ip(t,r,i,o,a);case 1:s=e.sent,o.selectedMessage&&o.selectedMessage.sameTerm(r)&&(s.style.backgroundColor="yellow",o.selectedElement=s,n.selectedElement=s),c=!1,l=n.firstChild;case 2:if(l){e.next=3;break}return e.abrupt("continue",5);case 3:if(u=!0===o.newestfirst,!((d=s.AJAR_date)>l.AJAR_date&&u||d<l.AJAR_date&&!u)){e.next=4;break}return n.insertBefore(s,l),c=!0,e.abrupt("continue",5);case 4:l=l.nextSibling,e.next=2;break;case 5:c||n.appendChild(s);case 6:case"end":return e.stop()}},e)})),fp.apply(this,arguments)}function hp(e,t,n,r){return mp.apply(this,arguments)}function mp(){return mp=w(x().mark(function e(t,n,r,i){var o,a,s,c,l,u,d,p,f,h,g,y,b,E,C,k,A,_,S,T,R,I,L,N,P,B,O,D,U,j,M,F;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return S=function(){return(S=w(x().mark(function e(){var t,n,r,o,a,s,c,l,u,d;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=function(){i.selectedElement?i.selectedElement.scrollIntoView({block:"center"}):B.inputRow.scrollIntoView&&B.inputRow.scrollIntoView(T)},t=function(){u&&u.selectedElement&&u.selectedElement.scrollIntoView({block:"center"})},i.selectedMessage&&(o=i.selectedMessage.doc()),O&&(a=O.doc()),(s=o||a)&&(c=new Date,l=I.leafDocumentFromDate(c),r=l.sameTerm(s)),!s||r){e.next=2;break}return d=I.dateFromLeafDocument(s),e.next=1,p(d,r);case 1:u=e.sent,L.appendChild(u),D.messageTable=u,U.messageTable=u,t(),setTimeout(t,1e3),e.next=4;break;case 2:return e.next=3,E();case 3:D.messageTable=B,U.messageTable=B;case 4:return e.next=5,k(null,n);case 5:L.addEventListener("scroll",k),i.solo&&document.body.addEventListener("scroll",k);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)},_=function(){return S.apply(this,arguments)},A=function(){return(A=w(x().mark(function e(t,n){var r,o,a,s,c;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!F){e.next=1;break}return e.abrupt("return");case 1:F=!0,r=!n,o=150;case 2:if(!(L.scrollTop<o&&D.messageTable&&!D.messageTable.initial&&D.messageTable.extendBackwards)){e.next=6;break}if(0!==L.scrollHeight){e.next=3;break}return setTimeout(k,2e3),F=!1,e.abrupt("return");case 3:return s=L.scrollHeight-L.scrollTop,e.next=4,D.messageTable.extendBackwards();case 4:if(a=e.sent,r&&(L.scrollTop=L.scrollHeight-s),n&&n(),!a){e.next=5;break}return e.abrupt("continue",6);case 5:e.next=2;break;case 6:if(!(i.selectedMessage&&L.scrollHeight-L.scrollTop-L.clientHeight<o&&U.messageTable&&!U.messageTable.final&&U.messageTable.extendForwards)){e.next=9;break}return c=L.scrollTop,e.next=7,U.messageTable.extendForwards();case 7:if(a=e.sent,r&&(L.scrollTop=c),n&&n(),!a){e.next=8;break}return e.abrupt("continue",9);case 8:e.next=6;break;case 9:F=!1;case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)},k=function(e,t){return A.apply(this,arguments)},C=function(){return(C=w(x().mark(function e(){var t,n,i;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Date,n=I.leafDocumentFromDate(t),e.next=1,p(t,!0);case 1:return i=e.sent,L.appendChild(i),L.refresh=w(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,y(new Date);case 1:return e.next=2,o(r,i);case 2:dp(r);case 3:case"end":return e.stop()}},e)})),qt.updater.addDownstreamChangeListener(n,L.refresh),B=i,U.messageTable=B,e.abrupt("return",i);case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)},E=function(){return C.apply(this,arguments)},b=function(){return(b=w(x().mark(function e(){var t,n,r;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((t=I.leafDocumentFromDate(new Date)).sameTerm(U.messageTable.chatDocument)){e.next=2;break}return B.inputRow&&(B.removeChild(B.inputRow),delete B.inputRow),n=U.messageTable.chatDocument,e.next=1,E();case 1:if(!qt.holds(n,v.rdfs("seeAlso"),t,n)){r=[m.st(n,v.rdfs("seeAlso"),t,n)];try{qt.updater.update([],r)}catch(e){alert("Unable to link old chat file to new one:"+e)}}case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)},y=function(){return b.apply(this,arguments)},g=function(){return g=w(x().mark(function e(n,r){var o,a,c,u,p,f,h,m,g,y,b,E,C,k,A,_,S,N,O,D;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:g=function(){return(g=w(x().mark(function e(t){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!y.extendedForwards){e.next=1;break}d(!1,y),y.extendedForwards=!1,m(),e.next=3;break;case 1:return e.next=2,f();case 2:U.messageTable.scrollIntoView(T);case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)},m=function(){if(a){var e=y.extendedForwards?!T:T,t=y.final?"noun_T-Block_1114657_000000.svg":function(e){return e?"noun_1369237.svg":"noun_1369241.svg"}(e);a.firstChild.setAttribute("src",dr.Pt.iconBase+t)}},h=function(){return(h=w(x().mark(function e(){var t;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,l(!1);case 1:return t=e.sent,e.abrupt("return",t);case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)},f=function(){return h.apply(this,arguments)},p=function(){if(o){var e=y.extendedBack?!T:T,t=y.initial?"noun_T-Block_1114655_000000.svg":function(e){return e?"noun_1369241.svg":"noun_1369237.svg"}(e);o.firstChild.setAttribute("src",dr.Pt.iconBase+t)}},u=function(){return(u=w(x().mark(function e(){var t;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,l(!0);case 1:return(t=e.sent)?(o&&(o.firstChild.setAttribute("src",dr.Pt.iconBase+"noun_T-Block_1114655_000000.svg"),o.disabled=!0),y.initial=!0):y.extendedBack=!0,p(),e.abrupt("return",t);case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)},c=function(){return u.apply(this,arguments)},o=null,a=null,(y=t.createElement("table")).style.width="100%",y.extendBackwards=c,y.extendForwards=f,y.date=n,b=I.leafDocumentFromDate(n),y.chatDocument=b,y.fresh=!1,y.setAttribute("style","width: 100%;"),r&&(y.final=!0,B=y,U.messageTable=y,E=cp(R,y,P,i),T?y.insertBefore(E,y.firstChild):y.appendChild(E),y.inputRow=E),C=t.createElement("tr"),(k=C.appendChild(t.createElement("td"))).style="text-align: center; vertical-align: middle; color: #888; font-style: italic;",k.textContent=ei(n.toISOString(),!0),A=C.appendChild(t.createElement("td")),i.includeRemoveButton&&A.appendChild(mi(t,function(e){L.parentNode.removeChild(L)})),y.extendedForwards=!1,T?y.appendChild(C):y.insertBefore(C,y.firstChild),_=qt.statementsMatching(null,v.wf("message"),null,b),!r&&_.length,S=lp(_),e.prev=1,S.s();case 2:if((N=S.n()).done){e.next=4;break}return O=N.value,e.next=3,s(O.object,y);case 3:e.next=2;break;case 4:e.next=6;break;case 5:e.prev=5,D=e.catch(1),S.e(D);case 6:return e.prev=6,S.f(),e.finish(6);case 7:return y.fresh=!0,e.abrupt("return",y);case 8:case"end":return e.stop()}},e,null,[[1,5,6,7]])})),g.apply(this,arguments)},h=function(e,t){return g.apply(this,arguments)},f=function(){return(f=w(x().mark(function e(n,r){var i,o,a,s;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=I.leafDocumentFromDate(n),e.prev=1,e.next=2,qt.fetcher.createIfNotExists(i);case 2:e.next=7;break;case 3:if(e.prev=3,s=e.catch(1),o=t.createElement("table"),a=o.appendChild(t.createElement("tr")),!s.response||!s.response.status||404!==s.response.status){e.next=5;break}return e.next=4,h(n,r);case 4:return e.abrupt("return",e.sent);case 5:kn.Rm("*** Error NON 404 for chat file "+i),a.appendChild(Wr(t,s,"pink"));case 6:return e.abrupt("return",a);case 7:return e.next=8,h(n,r);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},e,null,[[1,3]])}))).apply(this,arguments)},p=function(e,t){return f.apply(this,arguments)},d=function(e,t){if(e?T:!T)for(;t.nextSibling;)L.removeChild(t.nextSibling);else for(;t.previousSibling;)L.removeChild(t.previousSibling);(e?D:U).messageTable=t},u=function(){return(u=w(x().mark(function e(t){var n,r,i,o,a,s;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=t?D:U).messageTable.date,!(t&&D.limit&&r<=D.limit)){e.next=2;break}if(B){e.next=1;break}return e.next=1,E();case 1:return e.abrupt("return",!0);case 2:return e.next=3,I.loadPrevious(r,t);case 3:if((r=e.sent)||t||B){e.next=4;break}return e.next=4,E();case 4:if(r){e.next=5;break}return e.abrupt("return",!0);case 5:return i=!1,t||(o=I.leafDocumentFromDate(new Date),a=I.leafDocumentFromDate(r),i=a.sameTerm(o)),e.next=6,p(r,i);case 6:return s=e.sent,n.messageTable=s,(t?T:!T)?L.appendChild(s):L.insertBefore(s,L.firstChild),e.abrupt("return",i);case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)},l=function(e){return u.apply(this,arguments)},c=function(){return c=w(x().mark(function e(t,n){var r,o;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!fd(t)||i.showDeletedMessages){e.next=1;break}return e.abrupt("return");case 1:if(r=qt.any(null,v.sioc("has_member"),t,t.doc()),(o=qt.any(t,v.sioc("id"),null,t.doc()))&&!r&&(r=qt.any(null,v.sioc("has_member"),o,t.doc())),!i.thread){e.next=5;break}if(!qt.holds(t,v.sioc("has_reply"),i.thread)){e.next=2;break}e.next=4;break;case 2:if(!r||!r.sameTerm(i.thread)){e.next=3;break}e.next=4;break;case 3:return e.abrupt("return");case 4:e.next=6;break;case 5:if(!r){e.next=6;break}return e.abrupt("return");case 6:if(n.fresh){e.next=7;break}return e.next=7,pp(R,n,t,n.fresh,i,P);case 7:case"end":return e.stop()}},e)})),c.apply(this,arguments)},s=function(e,t){return c.apply(this,arguments)},a=function(){return a=w(x().mark(function e(t,n){var r,i,o,a,c,l,u,d,p;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r={},i=n.firstChild;i;i=i.nextSibling)i.AJAR_subject&&(r[i.AJAR_subject.uri]=!0);a=qt.each(t,v.wf("message"),null,n.chatDocument),c={},l=lp(a),e.prev=1,l.s();case 2:if((u=l.n()).done){e.next=4;break}if(d=u.value,c[d.uri]=!0,r[d.uri]){e.next=3;break}return e.next=3,s(d,n);case 3:e.next=2;break;case 4:e.next=6;break;case 5:e.prev=5,p=e.catch(1),l.e(p);case 6:return e.prev=6,l.f(),e.finish(6);case 7:for(i=n.firstChild;i;)o=i.nextSibling,i.AJAR_subject&&!c[i.AJAR_subject.uri]&&n.removeChild(i),i=o;for(i=n.firstChild;i;i=i.nextSibling)i.AJAR_subject&&Ci(i);case 8:case"end":return e.stop()}},e,null,[[1,5,6,7]])})),a.apply(this,arguments)},o=function(e,t){return a.apply(this,arguments)},(i=i||{}).authorDateOnLeft=!1,T="1"===i.newestFirst||!0===i.newestFirst,R=new ad(r,i),I=R.dateFolder,L=t.createElement("div"),R.div=L,N=L.appendChild(t.createElement("div")),P={dom:t,statusArea:N,div:N},D={messageTable:null},U={messageTable:null},i.thread&&(j=i.thread,(O=qt.any(null,v.sioc("has_reply"),j,j.doc()))&&(M=qt.any(O,v.dct("created"),null,O.doc()))&&(D.limit=new Date(M.value))),F=!1,e.next=1,_();case 1:return e.abrupt("return",L);case 2:case"end":return e.stop()}},e)})),mp.apply(this,arguments)}var gp=qt,vp=[];function yp(e){return vp[e]}function wp(e,t){if("string"!=typeof t)throw kn.Rm("Non-string value of preference "+e+": "+t),new Error("Non-string value of preference "+e+": "+t);this.value[e]=t}function bp(e,t){return new Promise(function(n,r){var i=gp.any(e,v.ui("sharedPreferences"));if(i)t.sharedPreferences=i,n(t);else{gp.updater.editable(e.doc())||(kn.Rm(" Cant make shared preferences, may not change ".concat(e.doc)),n(t));var o=m.sym(e.doc().uri+"#SharedPreferences"),a=[m.st(e,v.ui("sharedPreferences"),o,e.doc())];kn.Rm("Creating shared preferences "+o),gp.updater.update([],a,function(e,i,a){i?(t.sharedPreferences=o,n(t)):r(new Error("Error creating shared prefs: "+a))})}})}function xp(e,t){return new Promise(function(n,r){$a(t).then(function(t){if(t.preferencesFile){var i,o,a=gp.each(null,v.solid("forClass"),e,t.preferencesFile),s=[];if(a.length){if(a.forEach(function(e){i=i||gp.any(e,v.solid("personalDefaults"))}),i)return t.personalDefaults=i,void n(t);i=Ta(t.preferencesFile),o=a[0]}else o=Ta(t.preferencesFile),s=[m.st(o,v.rdf("type"),v.solid("TypeRegistration"),t.preferencesFile),m.st(o,v.solid("forClass"),e,t.preferencesFile)];i=Ta(t.preferencesFile),s.push(m.st(o,v.solid("personalDefaults"),i,t.preferencesFile)),gp.updater.update([],s,function(o,a,s){a?(t.personalDefaults=i,n(t)):r(new Error("Setting preferences for "+e+": "+s))})}else kn.Rm("Not doing private class preferences as no access to preferences file. "+t.preferencesFileError)},function(e){r(e)})})}function Ep(e,t,n,r){var i=r.dom.createElement("div");return yd(e,e.doc(),r.me).then(function(o){var a=r.dom;function s(e){i.appendChild(a.createElement("h5")).textContent=e}s("My view of this "+r.noun),ha(a,i,{},o,n,e.doc(),function(e,t){e||Zr(r,t)}),s("Everyone's  view of this "+r.noun),bp(e,r).then(function(r){var o=r.sharedPreferences;ha(a,i,{},o,n,e.doc(),function(e,t){e||Zr(r,t)}),s("My default view of any "+r.noun),xp(t,r).then(function(e){ha(a,i,{},e.personalDefaults,n,e.preferencesFile,function(t,n){t||Zr(e,n)})},function(e){Zr(r,e)})})},function(e){i.appendChild(Wr(r.dom,e))}),i}function Cp(e){return e.datatype?e.datatype.equals(v.xsd("boolean"))?"1"===e.value:e.datatype.equals(v.xsd("dateTime"))||e.datatype.equals(v.xsd("date"))?new Date(e.value):e.datatype.equals(v.xsd("integer"))||e.datatype.equals(v.xsd("float"))||e.datatype.equals(v.xsd("decimal"))?Number(e.value):e.value:e}function kp(e,t,n,r){return new Promise(function(i,o){bp(e,r).then(function(r){var a=r.sharedPreferences;if(r.me)yd(e,e.doc(),r.me).then(function(e){xp(t,r).then(function(t){var r=[],o=t.personalDefaults;n.forEach(function(t){var n=gp.any(e,t)||gp.any(a,t)||gp.any(o,t);n&&(r[t.uri]=Cp(n))}),i(r)},o)},o);else{var s=[];n.forEach(function(e){var t=gp.any(a,e);t&&(s[e.uri]=Cp(t))}),i(s)}})})}var Ap={icons:dr.Pt,log:e,ns:v,utils:t,widgets:s};function _p(e,t){var n,r,i,o,a=t.sourceDocument,s=t.tableClass,c=t.query,l=Ap.ns,u=qt,d={},p={"http://www.w3.org/2002/07/owl#sameAs":!0,"http://www.w3.org/1999/02/22-rdf-syntax-ns#type":!0},f={"http://www.w3.org/2001/XMLSchema#decimal":!0,"http://www.w3.org/2001/XMLSchema#float":!0,"http://www.w3.org/2001/XMLSchema#double":!0,"http://www.w3.org/2001/XMLSchema#integer":!0,"http://www.w3.org/2001/XMLSchema#nonNegativeInteger":!0,"http://www.w3.org/2001/XMLSchema#positiveInteger":!0,"http://www.w3.org/2001/XMLSchema#nonPositiveInteger":!0,"http://www.w3.org/2001/XMLSchema#negativeInteger":!0,"http://www.w3.org/2001/XMLSchema#long":!0,"http://www.w3.org/2001/XMLSchema#int":!0,"http://www.w3.org/2001/XMLSchema#short":!0,"http://www.w3.org/2001/XMLSchema#byte":!0,"http://www.w3.org/2001/XMLSchema#unsignedLong":!0,"http://www.w3.org/2001/XMLSchema#unsignedInt":!0,"http://www.w3.org/2001/XMLSchema#unsignedShort":!0,"http://www.w3.org/2001/XMLSchema#unsignedByte":!0},h={"http://www.w3.org/2001/XMLSchema#dateTime":!0,"http://www.w3.org/2001/XMLSchema#date":!0},g={"http://xmlns.com/foaf/0.1/Image":!0,"http://purl.org/dc/terms/Image":!0},v=t.keyVariable||"?_row",y=0,w=null,b=null,x=e.createElement("div");x.className="tableViewPane",x.appendChild(function(){var t=e.createElement("table");t.setAttribute("class","toolbar");var n=e.createElement("tr");return i=e.createElement("td"),n.appendChild(i),o=e.createElement("td"),n.appendChild(o),t.appendChild(n),t}());var E,C=e.createElement("div");if(x.appendChild(C),x.refresh=function(){Q(E.query,E.logicalRows,E.columns,E)},c)E=X(c),C.appendChild(E);else{var k=function(){var e,t,n=function(){for(var e={},t=u.statementsMatching(void 0,Ap.ns.rdf("type"),s,a),n={},r=0;r<t.length;++r){var i=t[r].object;if("NamedNode"===i.termType){var o=P(e,i);i.uri in n||(n[i.uri]=[]),n[i.uri].push(t[r].subject),o.addUse()}}return[n,e]}();for(var r in e=n[0],t=n[1],e){var i=e[r];O(t[r],i)}var o=new T(null);return[o,I(t)]}();n=k[0],r=k[1],s||i.appendChild(function(t,n){var r=e.createElement("div");r.appendChild(e.createTextNode("Select type: "));var i=e.createElement("select");for(var o in i.appendChild(L("All types","null")),n)i.appendChild(L(n[o].getLabel(),o));return i.addEventListener("click",function(){var e;e="null"===i.value?t:n[i.value],_(e)},!1),r.appendChild(i),r}(n,r)),b=function(e){var t,n=-1,r=null;for(t in e){var i=e[t];i.useCount>n&&(r=i,n=i.useCount)}return r}(r),_(b||n)}return x;function A(e){var t=new m.Query,n=u.variable(v.slice(1));return function(e,t){for(var n=t.getColumns(),r=0;r<n.length;++r){var i=u.variable("_col"+r);e.vars.push(i),n[r].setVariable(i)}}(t,e),function(e,t,n){var r=n.type;r||(r=u.variable("_any")),e.pat.add(t,Ap.ns.rdf("type"),r)}(t,n,e),function(e,t,n){for(var r=n.getColumns(),i=0;i<r.length;++i){var o=r[i],a=u.formula();a.add(t,o.predicate,o.getVariable()),e.pat.optional.push(a)}}(t,n,e),t}function _(t){S(o),o.appendChild(function(t){var n=e.createElement("div"),r=t.getUnusedColumns();if(r.sort(function(e,t){var n=e.sortKey(),r=t.sortKey();return(n>r)-(n<r)}),r.length>0){n.appendChild(e.createTextNode("Add column: "));var i=e.createElement("select");i.appendChild(L("","-1"));for(var o=0;o<r.length;++o){var a=r[o];i.appendChild(L(a.getLabel(),""+o))}n.appendChild(i),i.addEventListener("click",function(){var e=Number(i.value);e>=0&&(t.addColumn(r[e]),_(t))},!1)}return n}(t)),function(e,t){w&&(w.running=!1);var n=X(e,t);S(C),C.appendChild(n),w=e}(A(t),t)}function S(e){for(;e.childNodes.length>0;)e.removeChild(e.childNodes[0])}function T(e){this.type=e,this.columns=null,this.allColumns=[],this.useCount=0,this.getAllColumns=function(){return this.allColumns},this.getColumns=function(){if(!this.columns){var e=this.getAllColumns();this.columns=e.slice(0,7)}return this.columns},this.getUnusedColumns=function(){for(var e=this.getAllColumns(),t=this.getColumns(),n=[],r=0;r<e.length;++r)-1===t.indexOf(e[r])&&n.push(e[r]);return n},this.addColumn=function(e){this.columns.push(e)},this.removeColumn=function(e){this.columns=this.columns.filter(function(t){return t!==e})},this.getLabel=function(){return En(this.type)},this.addUse=function(){this.useCount+=1}}function R(){this.useCount=0,this.checkedAnyValues=!1,this.possiblyLiteral=!0,this.possiblyNumber=!0,this.constraints=[],this.checkValue=function(e){var t=e.termType;if(this.possiblyLiteral&&"Literal"!==t&&"NamedNode"!==t)this.possiblyNumber=!1,this.possiblyLiteral=!1;else if(this.possiblyNumber){if("Literal"!==t)this.possiblyNumber=!1;else e.value.match(/^-?\d+(\.\d*)?$/)||(this.possiblyNumber=!1)}this.checkedAnyValues=!0},this.getVariable=function(){return this.variable},this.setVariable=function(e){this.variable=e},this.getKey=function(){return this.variable.toString()},this.addUse=function(){this.useCount+=1},this.getHints=function(){return t&&t.hints&&this.variable&&t.hints[this.variable.toNT()]?t.hints[this.variable.toNT()]:{}},this.getLabel=function(){return this.getHints().label?this.getHints().label:this.predicate?this.predicate.sameTerm(l.rdf("type"))&&this.superClass?En(this.superClass,!0):En(this.predicate):this.variable?this.variable.toString():"unlabeled column?"},this.setPredicate=function(e,t,n){t?(this.inverse=e,this.constraints=this.constraints.concat(u.each(e,Ap.ns.rdfs("domain"))),e.sameTerm(l.rdfs("subClassOf"))&&"NamedNode"===n.termType&&(this.superClass=n,this.alternatives=u.each(void 0,l.rdfs("subClassOf"),n))):(this.predicate=e,this.constraints=this.constraints.concat(u.each(e,Ap.ns.rdfs("range"))))},this.getConstraints=function(){return this.constraints},this.filterFunction=function(){return!0},this.sortKey=function(){return this.getLabel().toLowerCase()},this.isImageColumn=function(){for(var e=0;e<this.constraints.length;e++)if(this.constraints[e].uri in g)return!0;return!1}}function I(e,t){var n=[];for(var r in e){var i=e[r];t&&!t(r,i)||n.push(i)}return n}function L(t,n){var r=e.createElement("option");return r.setAttribute("value",n),r.appendChild(e.createTextNode(t)),r}function N(e,t){var n;return t.uri in e?n=e[t.uri]:((n=new R).setPredicate(t),e[t.uri]=n),n}function P(e,t){var n;return t.uri in e?n=e[t.uri]:(n=new T(t),e[t.uri]=n),n}function B(e,t){for(var n=u.statementsMatching(e,void 0,void 0,a),r={},i=0;i<n.length;++i){var o=n[i].predicate;if(!(o.uri in p)){var s=N(t,o);s.checkValue(n[i].object),r[o.uri]=s}}return r}function O(e,t){for(var n={},r=0;r<t.length;++r){var i=B(t[r],n);for(var o in i){i[o].addUse()}}var a=I(n);!function(e){function t(e,t){return(e.useCount<t.useCount)-(e.useCount>t.useCount)}e.sort(t)}(a),e.allColumns=a}function D(t,n){var r=e.createElement("a");return r.appendChild(e.createTextNode("[x]")),r.addEventListener("click",function(){t.removeColumn(n),_(t)},!1),r}function U(e,t){for(var n=!0,r=0;r<t.length;++r){var i=t[r],o=i.getKey(),a=null;if(o in e.values&&(a=e.values[o][0]),!i.filterFunction(a)){n=!1;break}}var s=e._htmlRow;s.style.display=n?"":"none"}function j(e,t){for(var n=0;n<e.length;++n){U(e[n],t)}}function M(e,t,n){function r(e){return e?"Literal"===e.termType?e.value.toLowerCase():"NamedNode"===e.termType?En(e).toLowerCase():e.value.toLowerCase():""}!function(e,t,n,r){var i=t.getKey();if(e.sort(function(e,t){var o=null,a=null;i in e.values&&(o=e.values[i][0]),i in t.values&&(a=t.values[i][0]);var s=n(o,a);return r?-s:s}),e.length){for(var o=e[0]._htmlRow.parentNode,a=0;a<e.length;++a)o.removeChild(e[a]._htmlRow);for(var s=0;s<e.length;++s)o.appendChild(e[s]._htmlRow)}}(e,t,function(e,t){var n=r(e),i=r(t);return n<i?-1:n>i?1:0},n)}function F(t,n,r){var i=e.createElement("div"),o=e.createElement("input");o.setAttribute("type","text"),o.style.width="70%",i.appendChild(o);var a=e.createElement("span");a.appendChild(e.createTextNode("")),a.addEventListener("click",function(){M(t,r,!1)},!1),i.appendChild(a);var s=e.createElement("span");s.appendChild(e.createTextNode("")),s.addEventListener("click",function(){M(t,r,!0)},!1),i.appendChild(s);var c=null;return r.filterFunction=function(e){return!c||!!e&&("Literal"===e.termType?e.value:"NamedNode"===e.termType?En(e):"").toLowerCase().indexOf(c)>=0},o.addEventListener("keyup",function(){c=""!==o.value?o.value.toLowerCase():null,j(t,n)},!1),i}function H(t,n,r,i){for(var o=e.createElement("div"),a=e.createElement("select"),s={},c=0;c<i.length;++c){var l=i[c];s[l.uri]=!0}var u=z(r).initialSelection;u&&(s=u),a.setAttribute("multiple","true");for(var d=0;d<i.length;++d){var p=i[d],f=L(En(p),d);s[p.uri]&&(f.selected=!0),a.appendChild(f)}return o.appendChild(a),r.filterFunction=function(e){return!s||e&&s[e.uri]},a.addEventListener("click",function(){s={};for(var e=a.options,r=0;r<e.length;r++){var o=e[r],c=Number(o.value);e[r].selected&&(s[i[c].uri]=!0)}j(t,n)},!0),o}function W(t,n,r){var i=e.createElement("div"),o=e.createElement("input");o.setAttribute("type","text"),o.style.width="40px",i.appendChild(o);var a=e.createElement("input");a.setAttribute("type","text"),a.style.width="40px",i.appendChild(a);var s=null,c=null;function l(){s=""===o.value?null:Number(o.value),c=""===a.value?null:Number(a.value),j(t,n)}return r.filterFunction=function(e){return e&&(e=Number(e)),!(s&&(!e||e<s))&&!(c&&(!e||e>c))},o.addEventListener("keyup",l,!1),a.addEventListener("keyup",l,!1),i}function $(e,t,n){if(n.superClass&&n.alternatives.length>0)return H(e,t,n,n.alternatives);for(var r,i=n.getConstraints(),o=0;o<i.length;o++){if(r=i[o],n.checkedAnyValues&&n.possiblyNumber||r.uri in f)return W(e,t,n);if("http://www.w3.org/2000/01/rdf-schema#Literal"===r.uri)return F(e,t,n);var a=u.each(r,Ap.ns.owl("oneOf"));if(a.length>0)return H(e,t,n,a.elements)}return function(e,t,n){return n.checkedAnyValues&&n.possiblyNumber?W(e,t,n):n.possiblyLiteral?F(e,t,n):null}(e,t,n)}function J(t,n,r){r=r||{};var i=e.createElement("a"),o=r.linkFunction;return i.setAttribute("href",t),i.appendChild(e.createTextNode(n)),o?i.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation();var t=Cr(e).getAttribute("href");t||kn.Rm("No href found \n"),o(t)},!0):i.addEventListener("click",Ap.widgets.openHrefInOutlineMode,!0),i}function z(e){return t&&t.hints&&e.variable&&t.hints[e.variable.toNT()]?t.hints[e.variable.toNT()]:{}}function q(t,n){var r=z(n),i=r.cellFormat;if(!i){if("Literal"===t.termType){if(t.datatype){if(h[t.datatype.uri])return e.createTextNode(Ap.widgets.shortDate(t.value));if(f[t.datatype.uri]){var o=e.createElement("span");return o.textContent=t.value,o.setAttribute("style","text-align: right"),o}}return e.createTextNode(t.value)}if("NamedNode"===t.termType&&n.isImageColumn())return function(t){var n=e.createElement("img");return n.setAttribute("src",t.uri),n.style.height="40px",n}(t);if("NamedNode"===t.termType||"BlankNode"===t.termType)return function(e,t){var n=!1;return e.uri&&(n=e.uri.match(/^mailto:(.*)/)),J(e.uri,n?n[1]:En(e),t)}(t,r);if("Collection"===t.termType){var a=e.createElement("span");return a.appendChild(e.createTextNode("[")),t.elements.forEach(function(t){a.appendChild(q(t,n)),a.appendChild(e.createTextNode(", "))}),a.removeChild(a.lastChild),a.appendChild(e.createTextNode("]")),a}return e.createTextNode("unknown termtype '"+t.termType+"'!")}if("shortDate"===i)return e.createTextNode(Ap.widgets.shortDate(t.value))}function K(e,t){var n,r=null;if("Literal"===e.termType)r="value";else{if("NamedNode"!==e.termType)return t.indexOf(e)>=0;r="uri"}for(n=0;n<t.length;++n)if(t[n].termType===e.termType&&t[n][r]===e[r])return!0;return!1}function V(t,n,r){var i,o=!1;for(i in r){var a=r[i];i in t.values||(t.values[i]=[]),K(a,t.values[i])||(t.values[i].push(a),o=!0)}o&&(S(t._htmlRow),function(t,n,r){var i=e.createElement("td");n._subject&&"uri"in n._subject&&i.appendChild(J(n._subject.uri,"")),t.appendChild(i);for(var o=0;o<r.length;++o){var a=r[o],s=e.createElement("td"),c=void 0,l=a.getKey();if(l in n.values){var u=n.values[l],d=!1;n.originalValues&&n.originalValues[l]&&u.length!==n.originalValues[l].length&&(d=!0);for(var p=0;p<u.length;++p){var f=u[p];n.originalValues&&n.originalValues[l]&&n.originalValues[l].length>p&&(c=n.originalValues[l][p],f.toString()!==c.toString()&&(d=!0)),s.appendChild(q(f,a)),p!==u.length-1&&s.appendChild(e.createTextNode(",\n")),d&&(s.style.background="#efe")}}t.appendChild(s)}n._htmlRow=t}(t._htmlRow,t,n)),U(t,n)}function G(e){if("uri"in e)return e.uri;if("_subject_id"in e)return e._subject_id;var t=""+y;return e._subject_id=t,++y,t}function Q(n,r,i,o){n.running=!0;var a=Date.now(),s=e.createElement("tr");o.appendChild(s),s.textContent="Loading ...";for(var c=0;c<r.length;c++)r[c].original=!0,r[c].originalValues||(r[c].originalValues=r[c].values),r[c].values={};u.query(n,function(t){if(n.running){s.textContent+=".";var a,c=null,l=null;if(v in t&&(a=G(l=t[v]))in d&&(c=d[a]),!c){var u=e.createElement("tr");o.appendChild(u),c={_htmlRow:u,_subject:l,values:{}},r.push(c),l&&(d[a]=c)}delete c.original,V(c,i,t)}},void 0,function(){s&&s.parentNode&&s.parentNode.removeChild&&(s.parentNode.removeChild(s),s=null);var e=Date.now()-a;kn.Rm("Query done: "+r.length+" rows, "+e+"ms");for(var n=r.length-1;n>=0;n--)if(r[n].original){kn.Rm("   deleting row "+r[n]._subject);var o=r[n]._htmlRow;o.parentNode.removeChild(o),delete d[G(r[n]._subject)],r.splice(n,1)}if(t.sortBy){var c=function(e,t){for(var n in e){var r=e[n];if(r.variable.toNT()===t)return r}throw new Error("getColumnForVariable: no column for variable ".concat(t))}(i,t.sortBy);M(r,c,t.sortReverse)}t.onDone&&t.onDone(x)})}function Z(e,t){Ap.log.debug(">> processing formula");for(var n=0;n<t.statements.length;++n){var r=t.statements[n];if("NamedNode"===r.predicate.termType&&"Variable"===r.object.termType){var i=r.object.toString();if(i in e)e[i].setPredicate(r.predicate,!1,r.subject)}if("NamedNode"===r.predicate.termType&&"Variable"===r.subject.termType){var o=r.subject.toString();if(o in e)e[o].setPredicate(r.predicate,!0,r.object)}}for(var a=0;a<t.optional.length;++a)Ap.log.debug("recurse to optional subformula "+a),Z(e,t.optional[a]);Ap.log.debug("<< finished processing formula")}function Y(e){for(var t=[],n={},r=0;r<e.vars.length;++r){var i=new R,o=e.vars[r];Ap.log.debug("column "+r+" : "+o),i.setVariable(o),n[o]=i,t.push(i)}return Z(n,e.pat),t}function X(t,n){var r;r=c?Y(t):n.getColumns();var i=[],o=e.createElement("table");return o.appendChild(function(t,n){var r=e.createElement("tr"),i=e.createElement("th");r.appendChild(i);for(var o=0;o<t.length;++o){var a=e.createElement("th"),s=t[o];a.appendChild(e.createTextNode(s.getLabel())),n&&a.appendChild(D(n,s)),r.appendChild(a)}return r}(r,n)),o.appendChild(function(t,n){var r=e.createElement("tr");r.className="selectors",r.appendChild(e.createElement("td"));for(var i=0;i<n.length;++i){var o=e.createElement("td"),a=$(t,n,n[i]);a&&o.appendChild(a),r.appendChild(o)}return r}(i,r)),o.logicalRows=i,o.columns=r,o.query=t,Q(t,i,r,o),o}}function Sp(e,t){if(t&&("object"==$n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Tp(e){return Tp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Tp(e)}function Rp(e,t){return Rp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Rp(e,t)}function Ip(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Ip=function(){return!!e})()}function Lp(e){var t="function"==typeof Map?new Map:void 0;return Lp=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return function(e,t,n){if(Ip())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var i=new(e.bind.apply(e,r));return n&&Rp(i,n.prototype),i}(e,arguments,Tp(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Rp(n,e)},Lp(e)}function Np(e,t,n){return t=Tp(t),Sp(e,Pp()?Reflect.construct(t,n||[],Tp(e).constructor):t.apply(e,n))}function Pp(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Pp=function(){return!!e})()}var Bp=function(e){function t(){return Wn(this,t),Np(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Rp(e,t)}(t,e),qn(t)}(Lp(HTMLElement)),Op="#ddddcc";function Dp(e){var t=e.subject,n=e.dom||document,r=parseInt(e.orientation||"0"),i=e.backgroundColor||Op,o=2&r,a=1&r,s=e.onClose,c=function(e){return function(e){for(var t=0,n=0;n<3;n++)t+=parseInt(e.slice(2*n+1,2*n+3),16);return t>384}(e)?[Up(e,"#ffffff",.3),"#000000"]:[Up(e,"#000000",.3),"#ffffff"]}(i),l=Gn(c,2),u=l[0],d=l[1],p="flex: 2; width: auto; height: 100%; border: 0.1em; border-style: solid; border-color: ".concat(u,"; padding: 1em;"),f=n.createElement("div");f.setAttribute("style",ar.tabsRootElement),f.style.flexDirection=(a?"row":"column")+(o?"-reverse":"");var h=f.appendChild(n.createElement("nav"));h.setAttribute("style",ar.tabsNavElement);var m=f.appendChild(n.createElement("main"));m.setAttribute("style",ar.tabsMainElement);var g=h.appendChild(n.createElement("ul"));g.setAttribute("style",ar.tabContainer),g.style.flexDirection="".concat(a?"column":"row");var v=m;f.tabContainer=g,f.bodyContainer=v;var y=["0.2em","0.2em","0","0"],w=y.concat(y).slice(r,r+4),b="border-radius: ".concat(w.join(" "),";"),x=["0.3em","0.3em","0","0.3em"],E=x.concat(x).slice(r,r+4),C="margin: ".concat(E.join(" "),";"),k="padding: ".concat(E.join(" "),";"),A=b+"position: relative; padding: 0.7em; max-width: 20em; color: ".concat(d,";"),_="".concat(A+C," opacity: 50%; background-color: ").concat(i,";"),S="".concat(A+C," background-color: ").concat(u,";"),T="height: 100%; width: 100%;",R=T+"display: none;";if(f.refresh=O,O(),!e.startEmpty&&g.children.length&&e.selectedTab){var I=Array.from(g.children).map(function(e){return e.firstChild}).find(function(t){return t.dataset.name===e.selectedTab}),L=e.selectedTab.uri,N=Array.from(g.children).find(function(e){return e.subject&&e.subject.uri&&e.subject.uri===L}),P=(N||I||g.children[0]).firstChild;P&&P.click()}else e.startEmpty||g.children[0].firstChild.click();return f;function B(t){var r=n.createElement("li");r.setAttribute("style",_),r.subject=t;var i=r.appendChild(n.createElement("button"));if(i.setAttribute("style",ar.makeNewSlot),i.onclick=function(){if(D(),U(),r.setAttribute("style",S),r.bodyTR){r.bodyTR.setAttribute("style",T);var n=a(r);e.renderMain&&r.subject&&!1!==n.asSettings&&(n.innerHTML="loading item ..."+t,e.renderMain(n,r.subject),n.asSettings=!1)}},e.renderTabSettings&&r.subject){var o=n.createElement("button");o.textContent="...",o.setAttribute("style",ar.ellipsis),o.onclick=function(){if(D(),U(),r.setAttribute("style",S),r.bodyTR){r.bodyTR.setAttribute("style",T);var n=a(r);e.renderTabSettings&&r.subject&&!0!==n.asSettings&&(n.innerHTML="loading settings ..."+t,e.renderTabSettings(n,r.subject),n.asSettings=!0)}},r.appendChild(o)}return e.renderTab?e.renderTab(i,t):i.innerHTML=En(t),r;function a(e){var t,r=null===(t=e.bodyTR)||void 0===t?void 0:t.children[0];if(r)return r;var i=e.bodyTR.appendChild(n.createElement("main"));return i.setAttribute("style",p),i}}function O(){var r,i,o,a,c,l=e.items?e.items:!1!==e.ordered?qt.the(t,e.predicate).elements:qt.each(t,e.predicate),u=!1;for(a=0;a<g.children.length;a++)if(r=g.children[a],a>=l.length||r.subject&&!r.subject.sameTerm(l[a])){u=!0;break}if(u||l.length!==g.children.length){for(c=g.children.length-1;c>=0&&(r=g.children[c],o=c-g.children.length+l.length,!r.subject||r.subject.sameTerm(l[o]));c--);for(var d=l.slice(a,c-g.children.length+l.length+1);c>=a;)g.removeChild(g.children[a]),v.removeChild(v.children[a]),c-=1;for(i=0;i<d.length;i++){var p=B(d[i]),f=n.createElement("div");p.bodyTR=f,a===g.children.length?(g.appendChild(p),v.appendChild(f)):(g.insertBefore(p,g.children[a+i]),v.insertBefore(f,v.children[a+i]))}s&&function(e){if(e.dataset.onCloseSet){var t=e.querySelector(".unstyled");e.removeChild(t)}var r=n.createElement("li");r.classList.add("unstyled");var i=mi(n,s);i.setAttribute("style",i.getAttribute("style")+k),r.appendChild(i),e.appendChild(r),e.dataset.onCloseSet="true"}(g)}}function D(){for(var e=0;e<g.children.length;e++){var t=g.children[e];t.classList.contains("unstyled")||t.setAttribute("style",_)}}function U(){for(var e=0;e<v.children.length;e++)v.children[e].setAttribute("style",R)}}function Up(e,t,n){for(var r,i,o="#",a="0123456789abcdef",s=0;s<3;s++){r=parseInt(e.slice(2*s+1,2*s+3),16),i=parseInt(t.slice(2*s+1,2*s+3),16);var c=parseInt((""+(r*(1-n)+i*n)).split(".")[0]),l=parseInt((""+c/16).split(".")[0]),u=parseInt((""+c%16).split(".")[0]);o+=a[l]+a[u]}return o}var jp='\n<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 26 26" fill="none">\n    <path fill-rule="evenodd" clip-rule="evenodd" d="M13 25C19.6274 25 25 19.6274 25 13C25 6.37258 19.6274 1 13 1C6.37258 1 1 6.37258 1 13C1 19.6274 6.37258 25 13 25Z" fill="#D8D8D8" stroke="#8B8B8B"/>\n    <mask id="mask0" mask-type="alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="26" height="26">\n        <path fill-rule="evenodd" clip-rule="evenodd" d="M13 25C19.6274 25 25 19.6274 25 13C25 6.37258 19.6274 1 13 1C6.37258 1 1 6.37258 1 13C1 19.6274 6.37258 25 13 25Z" fill="white" stroke="white"/>\n    </mask>\n    <g mask="url(#mask0)">\n        <path fill-rule="evenodd" clip-rule="evenodd" d="M17.0468 10.4586C17.0468 14.4979 15.4281 16.9214 12.9999 16.9214C10.5718 16.9214 8.95298 14.4979 8.95298 10.4586C8.95298 6.41931 12.9999 6.41931 12.9999 6.41931C12.9999 6.41931 17.0468 6.41931 17.0468 10.4586ZM4.09668 23.3842C6.52483 17.7293 12.9999 17.7293 12.9999 17.7293C12.9999 17.7293 19.475 17.7293 21.9031 23.3842C21.9031 23.3842 17.8481 25 12.9999 25C8.15169 25 4.09668 23.3842 4.09668 23.3842Z" fill="#8B8B8B"/>\n    </g>\n</svg>';function Mp(){return(0,m.sym)(document.location.origin).site()}function Fp(e,t){return Hp.apply(this,arguments)}function Hp(){return(Hp=w(x().mark(function e(t,n){var r,i,o,a,s;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n.any(t,null,v.ldp("Container"),t)){e.next=2;break}return e.next=1,n.fetcher.webOperation("GET",t.uri,n.fetcher.initFetchOptions(t.uri,{headers:{accept:"text/turtle"}}));case 1:r=e.sent,i=r.responseText,(0,m.parse)(i,n,t.uri,"text/turtle");case 2:e.next=4;break;case 3:return e.prev=3,s=e.catch(0),console.error("Error loading pod "+t+": "+s),e.abrupt("return",null);case 4:if(n.holds(t,v.rdf("type"),v.space("Storage"),t)){e.next=5;break}return console.warn("Pod  "+t+" does not declare itself as a space:Storage"),e.abrupt("return",null);case 5:if(!(o=n.any(t,v.solid("owner"),null,t)||n.any(null,v.space("storage"),t,t))){e.next=10;break}return e.prev=6,e.next=7,n.fetcher.load(o.doc());case 7:e.next=9;break;case 8:return e.prev=8,e.catch(6),console.warn("Unable to load profile of pod owner "+o),e.abrupt("return",null);case 9:return n.holds(o,v.space("storage"),t,o.doc())||console.warn("Pod owner ".concat(o," does NOT list pod ").concat(t," as their storage")),e.abrupt("return",o);case 10:return a=(0,m.sym)("".concat(t.uri,"profile/card#me")),e.prev=11,e.next=12,n.fetcher.load(a);case 12:e.next=14;break;case 13:return e.prev=13,e.catch(11),console.error("Ooops. Guessed wrong pod owner webid {$guess} : can't load it."),e.abrupt("return",null);case 14:if(!n.holds(a,v.space("storage"),t,a.doc())){e.next=15;break}return console.warn("Using guessed pod owner webid but it links back."),e.abrupt("return",a);case 15:return e.abrupt("return",null);case 16:case"end":return e.stop()}},e,null,[[0,3],[6,8],[11,13]])}))).apply(this,arguments)}function Wp(e,t){var n,r,i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=null,s=0,c=function(){s=o.leading?Date.now():0,a=null,i=e.apply(n,r),a||(n=r=null)};return function(){var l=Date.now();s||o.leading||(s=l);var u=t-(l-s);return n=this,r=arguments,u<=0||u>t?(a&&(clearTimeout(a),a=null),s=l,i=e.apply(n,r),a||(n=r=null)):a||!1===o.trailing||(a=setTimeout(c,u)),i}}var $p=dr.Pt.iconBase+"noun_help.svg";function Jp(e,t,n){return zp.apply(this,arguments)}function zp(){return(zp=w(x().mark(function e(t,n,r){var i,o;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=document.getElementById("PageHeader")){e.next=1;break}return e.abrupt("return");case 1:o=Mp(),qp(i,t,o,n,r)(),zt.events.on("logout",qp(i,t,o,n,r)),zt.events.on("login",qp(i,t,o,n,r));case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function qp(e,t,n,r,i){return w(x().mark(function o(){var a,s;return x().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return a=Jt.currentUser(),e.innerHTML="",s=e,o.next=1,Kp(t,n,a,r,i);case 1:s.appendChild.call(s,o.sent);case 2:case"end":return o.stop()}},o)}))}function Kp(e,t,n,r,i){return Vp.apply(this,arguments)}function Vp(){return(Vp=w(x().mark(function e(t,n,r,i,o){var a,s,c,l,u,d,p;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((a=document.createElement("a")).href=n.uri,a.setAttribute("style",ar.headerBannerLink),s=document.createElement("img"),o&&(s.src=o.logo?o.logo:"https://solidproject.org/assets/img/solid-emblem.svg"),s.setAttribute("style",ar.headerBannerIcon),a.appendChild(s),!r){e.next=2;break}return e.next=1,Xp(t,r,i);case 1:p=e.sent,e.next=3;break;case 2:p=Qp();case 3:return c=p,(l=document.createElement("div")).setAttribute("style",ar.headerBanner),l.appendChild(a),(u=document.createElement("div")).setAttribute("style",ar.headerBannerRightMenu),u.appendChild(c),o&&o.helpMenuList&&(d=Gp(o,o.helpMenuList),u.appendChild(d)),l.appendChild(u),e.abrupt("return",l);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Gp(e,t){if(t){var n=document.createElement("ul");n.setAttribute("style",ar.headerUserMenuList),t.forEach(function(e){"url"===(e.url?"url":"onclick")?n.appendChild(tf(Yp(e.label,e.url,e.target))):n.appendChild(tf(Zp(e.label,e.onclick)))});var r=document.createElement("nav");r.setAttribute("style",ar.headerUserMenuNavigationMenuNotDisplayed),r.setAttribute("aria-hidden","true"),r.setAttribute("id","helperNav"),r.appendChild(n);var i=document.createElement("div");i.setAttribute("style",ar.headerBannerUserMenu),i.appendChild(r);var o=document.createElement("button");o.setAttribute("style",ar.headerUserMenuTrigger),o.type="button";var a=document.createElement("img");a.src=e&&e.helpIcon?e.helpIcon:dr.Pt.iconBase+$p,a.setAttribute("style",ar.headerUserMenuTriggerImg),i.appendChild(o),o.appendChild(a);var s=Wp(function(e){return rf(e,o,r)},50);o.addEventListener("click",s);var c=setTimeout(function(){return null},0);return i.addEventListener("mouseover",function(e){clearTimeout(c),s(e);var t=document.getElementById("helperNav");null==t||t.setAttribute("style",ar.headerUserMenuNavigationMenu)}),i.addEventListener("mouseout",function(e){c=setTimeout(function(){return s(e)},200);var t=document.getElementById("helperNav");null==t||t.setAttribute("style",ar.headerUserMenuNavigationMenuNotDisplayed)}),i}}function Qp(){var e=document.createElement("div");return e.setAttribute("style",ar.headerBannerLogin),e.appendChild(ns(document,null,{})),e}function Zp(e,t){var n=document.createElement("button");return n.setAttribute("style",ar.headerUserMenuButton),n.onmouseover=function(){n.setAttribute("style",ar.headerUserMenuButtonHover)},n.onmouseout=function(){n.setAttribute("style",ar.headerUserMenuButton)},n.addEventListener("click",t),n.innerText=e,n}function Yp(e,t,n){var r=document.createElement("a");return r.setAttribute("style",ar.headerUserMenuLink),r.onmouseover=function(){r.setAttribute("style",ar.headerUserMenuLinkHover)},r.onmouseout=function(){r.setAttribute("style",ar.headerUserMenuLink)},r.href=t,r.innerText=e,n&&(r.target=n),r}function Xp(e,t,n){return ef.apply(this,arguments)}function ef(){return(ef=w(x().mark(function e(t,n,r){var i,o,a,s,c,l,u,d;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=t.fetcher)){e.next=1;break}return e.next=1,i.load(n);case 1:return(o=document.createElement("ul")).setAttribute("style",ar.headerUserMenuList),r&&r.forEach(function(e){"url"===(e.url?"url":"onclick")?o.appendChild(tf(Yp(e.label,e.url,e.target))):o.appendChild(tf(Zp(e.label,e.onclick)))}),(a=document.createElement("nav")).setAttribute("style",ar.headerUserMenuNavigationMenuNotDisplayed),a.setAttribute("aria-hidden","true"),a.setAttribute("id","loggedInNav"),a.appendChild(o),(s=document.createElement("button")).setAttribute("style",ar.headerUserMenuTrigger),s.type="button","string"==typeof(c=nf(t,n))?s.innerHTML=c:s.appendChild(c),(l=document.createElement("div")).setAttribute("style",ar.headerBannerUserMenuNotDisplayed),l.appendChild(s),l.appendChild(a),u=Wp(function(e){return rf(e,s,a)},50),s.addEventListener("click",u),d=setTimeout(function(){return null},0),l.addEventListener("mouseover",function(e){clearTimeout(d),u(e);var t=document.getElementById("loggedInNav");null==t||t.setAttribute("style",ar.headerUserMenuNavigationMenu)}),l.addEventListener("mouseout",function(e){d=setTimeout(function(){return u(e)},200);var t=document.getElementById("loggedInNav");null==t||t.setAttribute("style",ar.headerUserMenuNavigationMenuNotDisplayed)}),e.abrupt("return",l);case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function tf(e){var t=document.createElement("li");return t.setAttribute("style",ar.headerUserMenuListItem),t.appendChild(e),t}function nf(e,t){var n=null;try{if(!(n=li(t)))return jp}catch(e){return jp}var r=document.createElement("div");return r.setAttribute("style",ar.headerUserMenuPhoto),r.style.backgroundImage="url(".concat(n,")"),r}function rf(e,t,n){var r="true"===t.getAttribute("aria-expanded"),i="mouseover"===e.type,o="mouseout"===e.type;r&&i||!r&&o||(t.setAttribute("aria-expanded",(!r).toString()),n.setAttribute("aria-hidden",r.toString()))}function of(e,t){return af.apply(this,arguments)}function af(){return(af=w(x().mark(function e(t,n){var r,i,o;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=document.getElementById("PageFooter")){e.next=1;break}return e.abrupt("return");case 1:return i=Mp(),e.next=2,Fp(i,t);case 2:o=e.sent,sf(r,t,i,o,n)(),zt.events.on("login",sf(r,t,i,o,n)),zt.events.on("logout",sf(r,t,i,o,n));case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function sf(e,t,n,r,i){return w(x().mark(function o(){var a,s;return x().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return a=Jt.currentUser(),e.innerHTML="",s=e,o.next=1,cf(t,a,n,r,i);case 1:s.appendChild.call(s,o.sent);case 2:case"end":return o.stop()}},o)}))}function cf(e,t,n,r,i){var o=document.createElement("div");if(!n||!r||t&&t.equals(r))return o;o.setAttribute("style",ar.footer);var a=document.createElement("span");a.innerText="You're visiting ";var s=document.createElement("a");s.href=n.uri,s.innerText="the Pod";var c=document.createElement("span");c.innerText=" controlled by ";var l=document.createElement("a");l.href=r.uri,l.innerText=function(e,t){return e.anyValue(t,v.vcard("fn"),null,t.doc())||e.anyValue(t,v.foaf("name"),null,t.doc())||t.uri}(e,r);var u=document.createElement("span");u.innerText=". For more info, check out ";var d=document.createElement("a");d.href=i&&i.solidProjectUrl?i.solidProjectUrl:"https://solidproject.org",d.innerText=i&&i.solidProjectName?i.solidProjectName:"solidproject.org";var p=document.createElement("span");return p.innerText=".",o.appendChild(a),o.appendChild(s),o.appendChild(c),o.appendChild(l),o.appendChild(u),o.appendChild(d),o.appendChild(p),o}var lf=window?window.document:null;"undefined"!=typeof window&&(window.UI={ns:v,acl:Ts,aclControl:Rs,create:Ls,createTypes:p,dom:lf,icons:dr.Pt,language:n,log:e,login:i,matrix:Ps,media:Us,messageArea:rc,infiniteMessageArea:hp,pad:l,participation:c,preferences:u,style:ar,table:_p,tabs:d,utils:t,widgets:s,initHeader:Jp,initFooter:of})})(),a})());
//# sourceMappingURL=solid-ui.min.js.map